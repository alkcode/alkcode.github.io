(self.webpackChunkmapasApp=self.webpackChunkmapasApp||[]).push([[179],{574:(Hn,Vt,Re)=>{"use strict";var Y=Re(808),Fe=Re(223);class Pt extends Y.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class c extends Pt{static makeCurrent(){(0,Y.HT)(new c)}onAndCancel(J,ne,Ae){return J.addEventListener(ne,Ae,!1),()=>{J.removeEventListener(ne,Ae,!1)}}dispatchEvent(J,ne){J.dispatchEvent(ne)}remove(J){J.parentNode&&J.parentNode.removeChild(J)}createElement(J,ne){return(ne=ne||this.getDefaultDocument()).createElement(J)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(J){return J.nodeType===Node.ELEMENT_NODE}isShadowRoot(J){return J instanceof DocumentFragment}getGlobalEventTarget(J,ne){return"window"===ne?window:"document"===ne?J:"body"===ne?J.body:null}getBaseHref(J){const ne=function Jt(){return Tt=Tt||document.querySelector("base"),Tt?Tt.getAttribute("href"):null}();return null==ne?null:function Ve(W){Ft=Ft||document.createElement("a"),Ft.setAttribute("href",W);const J=Ft.pathname;return"/"===J.charAt(0)?J:`/${J}`}(ne)}resetBaseElement(){Tt=null}getUserAgent(){return window.navigator.userAgent}getCookie(J){return(0,Y.Mx)(document.cookie,J)}}let Ft,Tt=null;const ze=new Fe.OlP("TRANSITION_ID"),lt=[{provide:Fe.ip1,useFactory:function qe(W,J,ne){return()=>{ne.get(Fe.CZH).donePromise.then(()=>{const Ae=(0,Y.q)(),je=J.querySelectorAll(`style[ng-transition="${W}"]`);for(let yt=0;yt<je.length;yt++)Ae.remove(je[yt])})}},deps:[ze,Y.K0,Fe.zs3],multi:!0}];class en{static init(){(0,Fe.VLi)(new en)}addToWindow(J){Fe.dqk.getAngularTestability=(Ae,je=!0)=>{const yt=J.findTestabilityInTree(Ae,je);if(null==yt)throw new Error("Could not find testability for element.");return yt},Fe.dqk.getAllAngularTestabilities=()=>J.getAllTestabilities(),Fe.dqk.getAllAngularRootElements=()=>J.getAllRootElements(),Fe.dqk.frameworkStabilizers||(Fe.dqk.frameworkStabilizers=[]),Fe.dqk.frameworkStabilizers.push(Ae=>{const je=Fe.dqk.getAllAngularTestabilities();let yt=je.length,$t=!1;const _r=function(cr){$t=$t||cr,yt--,0==yt&&Ae($t)};je.forEach(function(cr){cr.whenStable(_r)})})}findTestabilityInTree(J,ne,Ae){if(null==ne)return null;const je=J.getTestability(ne);return null!=je?je:Ae?(0,Y.q)().isShadowRoot(ne)?this.findTestabilityInTree(J,ne.host,!0):this.findTestabilityInTree(J,ne.parentElement,!0):null}}let On=(()=>{class W{build(){return new XMLHttpRequest}}return W.\u0275fac=function(ne){return new(ne||W)},W.\u0275prov=Fe.Yz7({token:W,factory:W.\u0275fac}),W})();const bt=new Fe.OlP("EventManagerPlugins");let Ct=(()=>{class W{constructor(ne,Ae){this._zone=Ae,this._eventNameToPlugin=new Map,ne.forEach(je=>je.manager=this),this._plugins=ne.slice().reverse()}addEventListener(ne,Ae,je){return this._findPluginFor(Ae).addEventListener(ne,Ae,je)}addGlobalEventListener(ne,Ae,je){return this._findPluginFor(Ae).addGlobalEventListener(ne,Ae,je)}getZone(){return this._zone}_findPluginFor(ne){const Ae=this._eventNameToPlugin.get(ne);if(Ae)return Ae;const je=this._plugins;for(let yt=0;yt<je.length;yt++){const $t=je[yt];if($t.supports(ne))return this._eventNameToPlugin.set(ne,$t),$t}throw new Error(`No event manager plugin found for event ${ne}`)}}return W.\u0275fac=function(ne){return new(ne||W)(Fe.LFG(bt),Fe.LFG(Fe.R0b))},W.\u0275prov=Fe.Yz7({token:W,factory:W.\u0275fac}),W})();class sn{constructor(J){this._doc=J}addGlobalEventListener(J,ne,Ae){const je=(0,Y.q)().getGlobalEventTarget(this._doc,J);if(!je)throw new Error(`Unsupported event target ${je} for event ${ne}`);return this.addEventListener(je,ne,Ae)}}let Ot=(()=>{class W{constructor(){this._stylesSet=new Set}addStyles(ne){const Ae=new Set;ne.forEach(je=>{this._stylesSet.has(je)||(this._stylesSet.add(je),Ae.add(je))}),this.onStylesAdded(Ae)}onStylesAdded(ne){}getAllStyles(){return Array.from(this._stylesSet)}}return W.\u0275fac=function(ne){return new(ne||W)},W.\u0275prov=Fe.Yz7({token:W,factory:W.\u0275fac}),W})(),ln=(()=>{class W extends Ot{constructor(ne){super(),this._doc=ne,this._hostNodes=new Map,this._hostNodes.set(ne.head,[])}_addStylesToHost(ne,Ae,je){ne.forEach(yt=>{const $t=this._doc.createElement("style");$t.textContent=yt,je.push(Ae.appendChild($t))})}addHost(ne){const Ae=[];this._addStylesToHost(this._stylesSet,ne,Ae),this._hostNodes.set(ne,Ae)}removeHost(ne){const Ae=this._hostNodes.get(ne);Ae&&Ae.forEach(Yt),this._hostNodes.delete(ne)}onStylesAdded(ne){this._hostNodes.forEach((Ae,je)=>{this._addStylesToHost(ne,je,Ae)})}ngOnDestroy(){this._hostNodes.forEach(ne=>ne.forEach(Yt))}}return W.\u0275fac=function(ne){return new(ne||W)(Fe.LFG(Y.K0))},W.\u0275prov=Fe.Yz7({token:W,factory:W.\u0275fac}),W})();function Yt(W){(0,Y.q)().remove(W)}const At={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},ft=/%COMP%/g;function He(W,J,ne){for(let Ae=0;Ae<J.length;Ae++){let je=J[Ae];Array.isArray(je)?He(W,je,ne):(je=je.replace(ft,W),ne.push(je))}return ne}function Je(W){return J=>{if("__ngUnwrap__"===J)return W;!1===W(J)&&(J.preventDefault(),J.returnValue=!1)}}let _t=(()=>{class W{constructor(ne,Ae,je){this.eventManager=ne,this.sharedStylesHost=Ae,this.appId=je,this.rendererByCompId=new Map,this.defaultRenderer=new $e(ne)}createRenderer(ne,Ae){if(!ne||!Ae)return this.defaultRenderer;switch(Ae.encapsulation){case Fe.ifc.Emulated:{let je=this.rendererByCompId.get(Ae.id);return je||(je=new ri(this.eventManager,this.sharedStylesHost,Ae,this.appId),this.rendererByCompId.set(Ae.id,je)),je.applyToHost(ne),je}case 1:case Fe.ifc.ShadowDom:return new zt(this.eventManager,this.sharedStylesHost,ne,Ae);default:if(!this.rendererByCompId.has(Ae.id)){const je=He(Ae.id,Ae.styles,[]);this.sharedStylesHost.addStyles(je),this.rendererByCompId.set(Ae.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return W.\u0275fac=function(ne){return new(ne||W)(Fe.LFG(Ct),Fe.LFG(ln),Fe.LFG(Fe.AFp))},W.\u0275prov=Fe.Yz7({token:W,factory:W.\u0275fac}),W})();class $e{constructor(J){this.eventManager=J,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(J,ne){return ne?document.createElementNS(At[ne],J):document.createElement(J)}createComment(J){return document.createComment(J)}createText(J){return document.createTextNode(J)}appendChild(J,ne){J.appendChild(ne)}insertBefore(J,ne,Ae){J&&J.insertBefore(ne,Ae)}removeChild(J,ne){J&&J.removeChild(ne)}selectRootElement(J,ne){let Ae="string"==typeof J?document.querySelector(J):J;if(!Ae)throw new Error(`The selector "${J}" did not match any elements`);return ne||(Ae.textContent=""),Ae}parentNode(J){return J.parentNode}nextSibling(J){return J.nextSibling}setAttribute(J,ne,Ae,je){if(je){ne=je+":"+ne;const yt=At[je];yt?J.setAttributeNS(yt,ne,Ae):J.setAttribute(ne,Ae)}else J.setAttribute(ne,Ae)}removeAttribute(J,ne,Ae){if(Ae){const je=At[Ae];je?J.removeAttributeNS(je,ne):J.removeAttribute(`${Ae}:${ne}`)}else J.removeAttribute(ne)}addClass(J,ne){J.classList.add(ne)}removeClass(J,ne){J.classList.remove(ne)}setStyle(J,ne,Ae,je){je&(Fe.JOm.DashCase|Fe.JOm.Important)?J.style.setProperty(ne,Ae,je&Fe.JOm.Important?"important":""):J.style[ne]=Ae}removeStyle(J,ne,Ae){Ae&Fe.JOm.DashCase?J.style.removeProperty(ne):J.style[ne]=""}setProperty(J,ne,Ae){J[ne]=Ae}setValue(J,ne){J.nodeValue=ne}listen(J,ne,Ae){return"string"==typeof J?this.eventManager.addGlobalEventListener(J,ne,Je(Ae)):this.eventManager.addEventListener(J,ne,Je(Ae))}}class ri extends $e{constructor(J,ne,Ae,je){super(J),this.component=Ae;const yt=He(je+"-"+Ae.id,Ae.styles,[]);ne.addStyles(yt),this.contentAttr=function gt(W){return"_ngcontent-%COMP%".replace(ft,W)}(je+"-"+Ae.id),this.hostAttr=function Be(W){return"_nghost-%COMP%".replace(ft,W)}(je+"-"+Ae.id)}applyToHost(J){super.setAttribute(J,this.hostAttr,"")}createElement(J,ne){const Ae=super.createElement(J,ne);return super.setAttribute(Ae,this.contentAttr,""),Ae}}class zt extends $e{constructor(J,ne,Ae,je){super(J),this.sharedStylesHost=ne,this.hostEl=Ae,this.shadowRoot=Ae.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const yt=He(je.id,je.styles,[]);for(let $t=0;$t<yt.length;$t++){const _r=document.createElement("style");_r.textContent=yt[$t],this.shadowRoot.appendChild(_r)}}nodeOrShadowRoot(J){return J===this.hostEl?this.shadowRoot:J}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(J,ne){return super.appendChild(this.nodeOrShadowRoot(J),ne)}insertBefore(J,ne,Ae){return super.insertBefore(this.nodeOrShadowRoot(J),ne,Ae)}removeChild(J,ne){return super.removeChild(this.nodeOrShadowRoot(J),ne)}parentNode(J){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(J)))}}let Zn=(()=>{class W extends sn{constructor(ne){super(ne)}supports(ne){return!0}addEventListener(ne,Ae,je){return ne.addEventListener(Ae,je,!1),()=>this.removeEventListener(ne,Ae,je)}removeEventListener(ne,Ae,je){return ne.removeEventListener(Ae,je)}}return W.\u0275fac=function(ne){return new(ne||W)(Fe.LFG(Y.K0))},W.\u0275prov=Fe.Yz7({token:W,factory:W.\u0275fac}),W})();const Ui=["alt","control","meta","shift"],vi={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Fr={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},pn={alt:W=>W.altKey,control:W=>W.ctrlKey,meta:W=>W.metaKey,shift:W=>W.shiftKey};let mr=(()=>{class W extends sn{constructor(ne){super(ne)}supports(ne){return null!=W.parseEventName(ne)}addEventListener(ne,Ae,je){const yt=W.parseEventName(Ae),$t=W.eventCallback(yt.fullKey,je,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,Y.q)().onAndCancel(ne,yt.domEventName,$t))}static parseEventName(ne){const Ae=ne.toLowerCase().split("."),je=Ae.shift();if(0===Ae.length||"keydown"!==je&&"keyup"!==je)return null;const yt=W._normalizeKey(Ae.pop());let $t="";if(Ui.forEach(cr=>{const Dt=Ae.indexOf(cr);Dt>-1&&(Ae.splice(Dt,1),$t+=cr+".")}),$t+=yt,0!=Ae.length||0===yt.length)return null;const _r={};return _r.domEventName=je,_r.fullKey=$t,_r}static getEventFullKey(ne){let Ae="",je=function Ur(W){let J=W.key;if(null==J){if(J=W.keyIdentifier,null==J)return"Unidentified";J.startsWith("U+")&&(J=String.fromCharCode(parseInt(J.substring(2),16)),3===W.location&&Fr.hasOwnProperty(J)&&(J=Fr[J]))}return vi[J]||J}(ne);return je=je.toLowerCase()," "===je?je="space":"."===je&&(je="dot"),Ui.forEach(yt=>{yt!=je&&pn[yt](ne)&&(Ae+=yt+".")}),Ae+=je,Ae}static eventCallback(ne,Ae,je){return yt=>{W.getEventFullKey(yt)===ne&&je.runGuarded(()=>Ae(yt))}}static _normalizeKey(ne){return"esc"===ne?"escape":ne}}return W.\u0275fac=function(ne){return new(ne||W)(Fe.LFG(Y.K0))},W.\u0275prov=Fe.Yz7({token:W,factory:W.\u0275fac}),W})();const Fn=(0,Fe.eFA)(Fe._c5,"browser",[{provide:Fe.Lbi,useValue:Y.bD},{provide:Fe.g9A,useValue:function xr(){c.makeCurrent(),en.init()},multi:!0},{provide:Y.K0,useFactory:function Mi(){return(0,Fe.RDi)(document),document},deps:[]}]),Ir=[{provide:Fe.zSh,useValue:"root"},{provide:Fe.qLn,useFactory:function $n(){return new Fe.qLn},deps:[]},{provide:bt,useClass:Zn,multi:!0,deps:[Y.K0,Fe.R0b,Fe.Lbi]},{provide:bt,useClass:mr,multi:!0,deps:[Y.K0]},{provide:_t,useClass:_t,deps:[Ct,ln,Fe.AFp]},{provide:Fe.FYo,useExisting:_t},{provide:Ot,useExisting:ln},{provide:ln,useClass:ln,deps:[Y.K0]},{provide:Fe.dDg,useClass:Fe.dDg,deps:[Fe.R0b]},{provide:Ct,useClass:Ct,deps:[bt,Fe.R0b]},{provide:Y.JF,useClass:On,deps:[]}];let Wi=(()=>{class W{constructor(ne){if(ne)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(ne){return{ngModule:W,providers:[{provide:Fe.AFp,useValue:ne.appId},{provide:ze,useExisting:Fe.AFp},lt]}}}return W.\u0275fac=function(ne){return new(ne||W)(Fe.LFG(W,12))},W.\u0275mod=Fe.oAB({type:W}),W.\u0275inj=Fe.cJS({providers:Ir,imports:[Y.ez,Fe.hGG]}),W})();"undefined"!=typeof window&&window;var xe=Re(895);const ke=[{path:"mapas",loadChildren:()=>Re.e(161).then(Re.bind(Re,161)).then(W=>W.MapasModule)},{path:"**",redirectTo:"mapas"}];let Me=(()=>{class W{}return W.\u0275fac=function(ne){return new(ne||W)},W.\u0275mod=Fe.oAB({type:W}),W.\u0275inj=Fe.cJS({imports:[[xe.Bz.forRoot(ke)],xe.Bz]}),W})();var we=Re(898);const rt=function(W){return[W]};function wt(W,J){if(1&W&&(Fe.TgZ(0,"li",2),Fe._uU(1),Fe.qZA()),2&W){const ne=J.$implicit;Fe.Q6J("routerLink",Fe.VKq(2,rt,ne.ruta)),Fe.xp6(1),Fe.hij(" ",ne.nombre," ")}}let it=(()=>{class W{constructor(){this.menuItems=[{ruta:"/mapas/fullscreen",nombre:"FullScreen"},{ruta:"/mapas/zoom-range",nombre:"Zoom Range"},{ruta:"/mapas/marcadores",nombre:"Marcadores"},{ruta:"/mapas/propiedades",nombre:"Propiedades"}]}}return W.\u0275fac=function(ne){return new(ne||W)},W.\u0275cmp=Fe.Xpm({type:W,selectors:[["app-menu"]],decls:2,vars:1,consts:[[1,"list-group"],["routerLinkActive","active","class","list-group-item",3,"routerLink",4,"ngFor","ngForOf"],["routerLinkActive","active",1,"list-group-item",3,"routerLink"]],template:function(ne,Ae){1&ne&&(Fe.TgZ(0,"ul",0),Fe.YNc(1,wt,2,4,"li",1),Fe.qZA()),2&ne&&(Fe.xp6(1),Fe.Q6J("ngForOf",Ae.menuItems))},directives:[Y.sg,xe.Od,xe.rH],styles:["li[_ngcontent-%COMP%]{cursor:pointer}"]}),W})(),Ht=(()=>{class W{constructor(){this.title="mapasApp"}ngOnInit(){we.accessToken="pk.eyJ1IjoiYWxrY29kZSIsImEiOiJja3ozNGxnNW4wMzd1Mm9tcDFsdGFqbXBoIn0.EISiywgmcdUJR68wdC1GHQ"}}return W.\u0275fac=function(ne){return new(ne||W)},W.\u0275cmp=Fe.Xpm({type:W,selectors:[["app-root"]],decls:2,vars:0,template:function(ne,Ae){1&ne&&(Fe._UZ(0,"app-menu"),Fe._UZ(1,"router-outlet"))},directives:[it,xe.lC],styles:[""]}),W})(),vt=(()=>{class W{}return W.\u0275fac=function(ne){return new(ne||W)},W.\u0275mod=Fe.oAB({type:W,bootstrap:[Ht]}),W.\u0275inj=Fe.cJS({providers:[],imports:[[Wi,Me]]}),W})();(0,Fe.G48)(),Fn().bootstrapModule(vt).catch(W=>console.error(W))},898:function(Hn){Hn.exports=function(){"use strict";var Vt,Re,Y;function Fe(c,Tt){if(Vt)if(Re){var Jt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Vt+")(sharedChunk); ("+Re+")(sharedChunk); self.onerror = null;",Ft={};Vt(Ft),Y=Tt(Ft),"undefined"!=typeof window&&(Y.workerUrl=window.URL.createObjectURL(new Blob([Jt],{type:"text/javascript"})))}else Re=Tt;else Vt=Tt}return Fe(0,function(c){var Jt=Ft;function Ft(n,e,i,a){this.cx=3*n,this.bx=3*(i-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=a,this.p2x=i,this.p2y=a}Ft.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n},Ft.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n},Ft.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},Ft.prototype.solveCurveX=function(n,e){var i,a,u,f,g;for(void 0===e&&(e=1e-6),u=n,g=0;g<8;g++){if(f=this.sampleCurveX(u)-n,Math.abs(f)<e)return u;var x=this.sampleCurveDerivativeX(u);if(Math.abs(x)<1e-6)break;u-=f/x}if((u=n)<(i=0))return i;if(u>(a=1))return a;for(;i<a;){if(f=this.sampleCurveX(u),Math.abs(f-n)<e)return u;n>f?i=u:a=u,u=.5*(a-i)+i}return u},Ft.prototype.solve=function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))};var Ve=ze;function ze(n,e){this.x=n,this.y=e}ze.prototype={clone:function(){return new ze(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),i=Math.sin(n),a=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=a,this},_rotateAround:function(n,e){var i=Math.cos(n),a=Math.sin(n),u=e.y+a*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-a*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ze.convert=function(n){return n instanceof ze?n:Array.isArray(n)?new ze(n[0],n[1]):n};var qe="undefined"!=typeof self?self:{};const lt=Math.pow(2,53)-1,en=Math.PI/180,On=180/Math.PI;function bt(n){return n*en}function Ct(n){return n*On}const sn=[[0,0],[1,0],[1,1],[0,1]];function Ot(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function ln(n,e,i,a){const u=new Jt(n,e,i,a);return function(f){return u.solve(f)}}const Yt=ln(.25,.1,.25,1);function At(n,e,i){return Math.min(i,Math.max(e,n))}function ft(n,e,i){const a=i-e,u=((n-e)%a+a)%a+e;return u===e?i:u}function cn(n,e,i){if(!n.length)return i(null,[]);let a=n.length;const u=new Array(n.length);let f=null;n.forEach((g,x)=>{e(g,(b,D)=>{b&&(f=b),u[x]=D,0==--a&&i(f,u)})})}function Pn(n){const e=[];for(const i in n)e.push(n[i]);return e}function Gt(n,...e){for(const i of e)for(const a in i)n[a]=i[a];return n}let an=1;function gt(){return an++}function Be(){return function n(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function He(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Je(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function Ke(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function _t(n,e){return-1!==n.indexOf(e,n.length-e.length)}function $e(n,e,i){const a={};for(const u in n)a[u]=e.call(i||this,n[u],u,n);return a}function tn(n,e,i){const a={};for(const u in n)e.call(i||this,n[u],u,n)&&(a[u]=n[u]);return a}function wn(n){return Array.isArray(n)?n.map(wn):"object"==typeof n&&n?$e(n,wn):n}const ri={};function zt(n){ri[n]||("undefined"!=typeof console&&console.warn(n),ri[n]=!0)}function Zn(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function Ui(n){let e=0;for(let i,a,u=0,f=n.length,g=f-1;u<f;g=u++)i=n[u],a=n[g],e+=(a.x-i.x)*(i.y+a.y);return e}function sr(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function vi(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,u,f)=>{const g=u||f;return e[a]=!g||g.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Fr,pn,mr,Ur=null;function xr(n){if(null==Ur){const e=n.navigator?n.navigator.userAgent:null;Ur=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ur}function $n(n){try{const e=qe[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(e){return!1}}const Mi={now:()=>void 0!==mr?mr:qe.performance.now(),setNow(n){mr=n},restoreNow(){mr=void 0},frame(n){const e=qe.requestAnimationFrame(n);return{cancel:()=>qe.cancelAnimationFrame(e)}},getImageData(n,e=0){const i=qe.document.createElement("canvas"),a=i.getContext("2d");if(!a)throw new Error("failed to create canvas 2d context");return i.width=n.width,i.height=n.height,a.drawImage(n,0,0,n.width,n.height),a.getImageData(-e,-e,n.width+2*e,n.height+2*e)},resolveURL:n=>(Fr||(Fr=qe.document.createElement("a")),Fr.href=n,Fr.href),get devicePixelRatio(){return qe.devicePixelRatio},get prefersReducedMotion(){return!!qe.matchMedia&&(null==pn&&(pn=qe.matchMedia("(prefers-reduced-motion: reduce)")),pn.matches)}};let xs;const Fn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==xs){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{xs=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):n}catch(e){xs=n}}return xs},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ir={supported:!1,testSupport:function(n){!Or&&Vr&&(ko?lr(n):Wi=n)}};let Wi,Vr,Or=!1,ko=!1;function lr(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Vr),n.isContextLost())return;Ir.supported=!0}catch(i){}n.deleteTexture(e),Or=!0}qe.document&&(Vr=qe.document.createElement("img"),Vr.onload=function(){Wi&&lr(Wi),Wi=null,ko=!0},Vr.onerror=function(){Or=!0,Wi=null},Vr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Kr="01",co="NO_ACCESS_TOKEN";function zr(n){return 0===n.indexOf("mapbox:")}function Xi(n){return Fn.API_URL_REGEX.test(n)}const bs=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function jr(n){const e=n.match(bs);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function qt(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}function gr(n){if(!n)return null;const e=n.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(qe.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(i){return null}}class rn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=gr(Fn.ACCESS_TOKEN);let a="";return a=i&&i.u?qe.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(u,f)=>String.fromCharCode(Number("0x"+f)))):Fn.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${a}`:`mapbox.eventData:${a}`}fetchEventData(){const e=$n("localStorage"),i=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const u=qe.localStorage.getItem(i);u&&(this.eventData=JSON.parse(u));const f=qe.localStorage.getItem(a);f&&(this.anonId=f)}catch(u){zt("Unable to read from LocalStorage")}}saveEventData(){const e=$n("localStorage"),i=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{qe.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&qe.localStorage.setItem(i,JSON.stringify(this.eventData))}catch(u){zt("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,a,u){if(!Fn.EVENTS_URL)return;const f=jr(Fn.EVENTS_URL);f.params.push(`access_token=${u||Fn.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.6.1",skuId:Kr,userId:this.anonId},x=i?Gt(g,i):g,b={url:qt(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=ce(b,D=>{this.pendingRequest=null,a(D),this.saveEventData(),this.processRequests(u)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const on=new class extends rn{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){Fn.EVENTS_URL&&Fn.ACCESS_TOKEN&&Array.isArray(n)&&n.some(i=>zr(i)||Xi(i))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=gr(Fn.ACCESS_TOKEN),i=e?e.u:Fn.ACCESS_TOKEN;let a=i!==this.eventData.tokenU;Je(this.anonId)||(this.anonId=Be(),a=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),g=new Date(u),x=(u-this.eventData.lastSuccess)/864e5;a=a||x>=1||x<-1||f.getDate()!==g.getDate()}else a=!0;if(!a)return this.processRequests();this.postEvent(u,{"enabled.telemetry":!1},f=>{f||(this.eventData.lastSuccess=u,this.eventData.tokenU=i)},n)}},wo=on.postTurnstileEvent.bind(on),Eo=new class extends rn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,i,a){this.skuToken=e,this.errorCb=a,Fn.EVENTS_URL&&(i||Fn.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(co)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Je(this.anonId)||(this.anonId=Be()),this.postEvent(i,{skuToken:this.skuToken},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},n))}},$r=Eo.postMapLoadEvent.bind(Eo),Qr=new class extends rn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,i,a){if(!Fn.API_URL||!Fn.SESSION_PATH)return;const u=jr(Fn.API_URL+Fn.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${a||Fn.ACCESS_TOKEN||""}`);const f={url:qt(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=he(f,g=>{this.pendingRequest=null,i(g),this.saveEventData(),this.processRequests(a)})}getSessionAPI(n,e,i,a){this.skuToken=e,this.errorCb=a,Fn.SESSION_PATH&&Fn.API_URL&&(i||Fn.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(co)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},n)}},xi=Qr.getSessionAPI.bind(Qr),jo=new Set,Un="mapbox-tiles";let dn,qn,Do=500,Yi=50;function Wn(){qe.caches&&!dn&&(dn=qe.caches.open(Un))}function Ro(n){const e=n.indexOf("?");return e<0?n:n.slice(0,e)}let Vs=1/0;const Ai={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Ai);class En extends Error{constructor(e,i,a){401===i&&Xi(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ae=sr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===qe.location.protocol?qe.parent:qe).location.href,V=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(ae())&&!/^\w+:/.test(i))){if(qe.fetch&&qe.Request&&qe.AbortController&&qe.Request.prototype.hasOwnProperty("signal"))return function(a,u){const f=new qe.AbortController,g=new qe.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:ae(),signal:f.signal});let x=!1,b=!1;const D=(A=g.url).indexOf("sku=")>0&&Xi(A);var A;"json"===a.type&&g.headers.set("Accept","application/json");const P=($,H,ee)=>{if(b)return;if($&&"SecurityError"!==$.message&&zt($),H&&ee)return F(H);const ue=Date.now();qe.fetch(g).then(fe=>{if(fe.ok){const ve=D?fe.clone():null;return F(fe,ve,ue)}return u(new En(fe.statusText,fe.status,a.url))}).catch(fe=>{20!==fe.code&&u(new Error(fe.message))})},F=($,H,ee)=>{("arrayBuffer"===a.type?$.arrayBuffer():"json"===a.type?$.json():$.text()).then(ue=>{b||(H&&ee&&function(fe,ve,Te){if(Wn(),!dn)return;const Se={status:ve.status,statusText:ve.statusText,headers:new qe.Headers};ve.headers.forEach((Pe,Ye)=>Se.headers.set(Ye,Pe));const Ie=vi(ve.headers.get("Cache-Control")||"");Ie["no-store"]||(Ie["max-age"]&&Se.headers.set("Expires",new Date(Te+1e3*Ie["max-age"]).toUTCString()),new Date(Se.headers.get("Expires")).getTime()-Te<42e4||function(Pe,Ye){if(void 0===qn)try{new Response(new ReadableStream),qn=!0}catch(We){qn=!1}qn?Ye(Pe.body):Pe.blob().then(Ye)}(ve,Pe=>{const Ye=new qe.Response(Pe,Se);Wn(),dn&&dn.then(We=>We.put(Ro(fe.url),Ye)).catch(We=>zt(We.message))}))}(g,H,ee),x=!0,u(null,ue,$.headers.get("Cache-Control"),$.headers.get("Expires")))}).catch(ue=>{b||u(new Error(ue.message))})};return D?function($,H){if(Wn(),!dn)return H(null);const ee=Ro($.url);dn.then(ue=>{ue.match(ee).then(fe=>{const ve=function(Te){if(!Te)return!1;const Se=new Date(Te.headers.get("Expires")||0),Ie=vi(Te.headers.get("Cache-Control")||"");return Se>Date.now()&&!Ie["no-cache"]}(fe);ue.delete(ee),ve&&ue.put(ee,fe.clone()),H(null,fe,ve)}).catch(H)}).catch(H)}(g,P):P(null,null),{cancel:()=>{b=!0,x||f.abort()}}}(n,e);if(sr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(a,u){const f=new qe.XMLHttpRequest;f.open(a.method||"GET",a.url,!0),"arrayBuffer"===a.type&&(f.responseType="arraybuffer");for(const g in a.headers)f.setRequestHeader(g,a.headers[g]);return"json"===a.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===a.credentials,f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let g=f.response;if("json"===a.type)try{g=JSON.parse(f.response)}catch(x){return u(x)}u(null,g,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new En(f.statusText,f.status,a.url))},f.send(a.body),{cancel:()=>f.abort()}}(n,e)},Z=function(n,e){return V(Gt(n,{type:"arrayBuffer"}),e)},ce=function(n,e){return V(Gt(n,{method:"POST"}),e)},he=function(n,e){return V(Gt(n,{method:"GET"}),e)};function xe(n){const e=qe.document.createElement("a");return e.href=n,e.protocol===qe.document.location.protocol&&e.host===qe.document.location.host}const ke="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Me,we;Me=[],we=0;const Le=function(n,e){if(Ir.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),we>=Fn.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Me.push(f),f}we++;let i=!1;const a=()=>{if(!i)for(i=!0,we--;Me.length&&we<Fn.MAX_PARALLEL_IMAGE_REQUESTS;){const f=Me.shift(),{requestParameters:g,callback:x,cancelled:b}=f;b||(f.cancel=Le(g,x).cancel)}},u=Z(n,(f,g,x,b)=>{a(),f?e(f):g&&(qe.createImageBitmap?function(D,A){const P=new qe.Blob([new Uint8Array(D)],{type:"image/png"});qe.createImageBitmap(P).then(F=>{A(null,F)}).catch(F=>{A(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(D,A)=>e(D,A,x,b)):function(D,A){const P=new qe.Image,F=qe.URL;P.onload=()=>{A(null,P),F.revokeObjectURL(P.src),P.onload=null,qe.requestAnimationFrame(()=>{P.src=ke})},P.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const $=new qe.Blob([new Uint8Array(D)],{type:"image/png"});P.src=D.byteLength?F.createObjectURL($):ke}(g,(D,A)=>e(D,A,x,b)))});return{cancel:()=>{u.cancel(),a()}}};function rt(n,e,i){i[n]&&-1!==i[n].indexOf(e)||(i[n]=i[n]||[],i[n].push(e))}function wt(n,e,i){if(i&&i[n]){const a=i[n].indexOf(e);-1!==a&&i[n].splice(a,1)}}class it{constructor(e,i={}){Gt(this,i),this.type=e}}class Ht extends it{constructor(e,i={}){super("error",Gt({error:e},i))}}class vt{on(e,i){return this._listeners=this._listeners||{},rt(e,i,this._listeners),this}off(e,i){return wt(e,i,this._listeners),wt(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},rt(e,i,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,i){"string"==typeof e&&(e=new it(e,i||{}));const a=e.type;if(this.listens(a)){e.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const x of u)x.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const x of f)wt(a,x,this._oneTimeListeners),x.call(this,e);const g=this._eventedParent;g&&(Gt(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof Ht&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var W=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class J{constructor(e,i,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),null!=i&&i.__line__&&(this.line=i.__line__)}}function ne(n){const e=n.value;return e?[new J(n.key,e,"constants have been deprecated as of v8")]:[]}function Ae(n,...e){for(const i of e)for(const a in i)n[a]=i[a];return n}function je(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function yt(n){if(Array.isArray(n))return n.map(yt);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=yt(n[i]);return e}return je(n)}class $t extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class _r{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[a,u]of i)this.bindings[a]=u}concat(e){return new _r(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const cr={kind:"null"},Dt={kind:"number"},fn={kind:"string"},Wt={kind:"boolean"},br={kind:"color"},Pr={kind:"object"},at={kind:"value"},kn={kind:"collator"},Kn={kind:"formatted"},Gr={kind:"resolvedImage"};function Nr(n,e){return{kind:"array",itemType:n,N:e}}function Rn(n){if("array"===n.kind){const e=Rn(n.itemType);return"number"==typeof n.N?`array<${e}, ${n.N}>`:"value"===n.itemType.kind?"array":`array<${e}>`}return n.kind}const Lo=[cr,Dt,fn,Wt,br,Kn,Pr,Nr(at),Gr];function rr(n,e){if("error"===e.kind)return null;if("array"===n.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!rr(n.itemType,e.itemType))&&("number"!=typeof n.N||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if("value"===n.kind)for(const i of Lo)if(!rr(i,e))return null}return`Expected ${Rn(n)} but found ${Rn(e)} instead.`}function Fo(n,e){return e.some(i=>i.kind===n.kind)}function ui(n,e){return e.some(i=>"null"===i?null===n:"array"===i?Array.isArray(n):"object"===i?n&&!Array.isArray(n)&&"object"==typeof n:i===typeof n)}function Cn(n){var e={exports:{}};return n(e,e.exports),e.exports}var bi=Cn(function(n,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function a(x){return(x=Math.round(x))<0?0:x>255?255:x}function u(x){return a("%"===x[x.length-1]?parseFloat(x)/100*255:parseInt(x))}function f(x){return(b="%"===x[x.length-1]?parseFloat(x)/100:parseFloat(x))<0?0:b>1?1:b;var b}function g(x,b,D){return D<0?D+=1:D>1&&(D-=1),6*D<1?x+(b-x)*D*6:2*D<1?b:3*D<2?x+(b-x)*(2/3-D)*6:x}try{e.parseCSSColor=function(x){var b,D=x.replace(/ /g,"").toLowerCase();if(D in i)return i[D].slice();if("#"===D[0])return 4===D.length?(b=parseInt(D.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:7===D.length&&(b=parseInt(D.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var A=D.indexOf("("),P=D.indexOf(")");if(-1!==A&&P+1===D.length){var F=D.substr(0,A),$=D.substr(A+1,P-(A+1)).split(","),H=1;switch(F){case"rgba":if(4!==$.length)return null;H=f($.pop());case"rgb":return 3!==$.length?null:[u($[0]),u($[1]),u($[2]),H];case"hsla":if(4!==$.length)return null;H=f($.pop());case"hsl":if(3!==$.length)return null;var ee=(parseFloat($[0])%360+360)%360/360,ue=f($[1]),fe=f($[2]),ve=fe<=.5?fe*(ue+1):fe+ue-fe*ue,Te=2*fe-ve;return[a(255*g(Te,ve,ee+1/3)),a(255*g(Te,ve,ee)),a(255*g(Te,ve,ee-1/3)),H];default:return null}}return null}}catch(x){}});class Ln{constructor(e,i,a,u=1){this.r=e,this.g=i,this.b=a,this.a=u}static parse(e){if(!e)return;if(e instanceof Ln)return e;if("string"!=typeof e)return;const i=bi.parseCSSColor(e);return i?new Ln(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,a,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(a)},${u})`}toArray(){const{r:e,g:i,b:a,a:u}=this;return 0===u?[0,0,0,0]:[255*e/u,255*i/u,255*a/u,u]}}Ln.black=new Ln(0,0,0,1),Ln.white=new Ln(1,1,1,1),Ln.transparent=new Ln(0,0,0,0),Ln.red=new Ln(1,0,0,1),Ln.blue=new Ln(0,0,1,1);class $o{constructor(e,i,a){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Vi{constructor(e,i,a,u,f){this.text=e,this.image=i,this.scale=a,this.fontStack=u,this.textColor=f}}class Jn{constructor(e){this.sections=e}static fromString(e){return new Jn([new Vi(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Jn?e:Jn.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const a={};i.fontStack&&(a["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(a["font-scale"]=i.scale),i.textColor&&(a["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(a)}return e}}class ii{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ii({name:e,available:!1}):null}serialize(){return["image",this.name]}}function hi(n,e,i,a){return"number"==typeof n&&n>=0&&n<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===a||"number"==typeof a&&a>=0&&a<=1?null:`Invalid rgba value [${[n,e,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof a?[n,e,i,a]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Hr(n){if(null===n||"string"==typeof n||"boolean"==typeof n||"number"==typeof n||n instanceof Ln||n instanceof $o||n instanceof Jn||n instanceof ii)return!0;if(Array.isArray(n)){for(const e of n)if(!Hr(e))return!1;return!0}if("object"==typeof n){for(const e in n)if(!Hr(n[e]))return!1;return!0}return!1}function _n(n){if(null===n)return cr;if("string"==typeof n)return fn;if("boolean"==typeof n)return Wt;if("number"==typeof n)return Dt;if(n instanceof Ln)return br;if(n instanceof $o)return kn;if(n instanceof Jn)return Kn;if(n instanceof ii)return Gr;if(Array.isArray(n)){const e=n.length;let i;for(const a of n){const u=_n(a);if(i){if(i===u)continue;i=at;break}i=u}return Nr(i||at,e)}return Pr}function Go(n){const e=typeof n;return null===n?"":"string"===e||"number"===e||"boolean"===e?String(n):n instanceof Ln||n instanceof Jn||n instanceof ii?n.toString():JSON.stringify(n)}class ws{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(2!==e.length)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Hr(e[1]))return i.error("invalid value");const a=e[1];let u=_n(a);const f=i.expectedType;return"array"!==u.kind||0!==u.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(u=f),new ws(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Ln?["rgba"].concat(this.value.toArray()):this.value instanceof Jn?this.value.serialize():this.value}}class Tn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Pi={string:fn,number:Dt,boolean:Wt,object:Pr};class ji{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a,u=1;const f=e[0];if("array"===f){let x,b;if(e.length>2){const D=e[1];if("string"!=typeof D||!(D in Pi)||"object"===D)return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=Pi[D],u++}else x=at;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=e[2],u++}a=Nr(x,b)}else a=Pi[f];const g=[];for(;u<e.length;u++){const x=i.parse(e[u],u,at);if(!x)return null;g.push(x)}return new ji(a,g)}evaluate(e){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(e);if(!rr(this.type,_n(a)))return a;if(i===this.args.length-1)throw new Tn(`Expected value to be of type ${Rn(this.type)}, but found ${Rn(_n(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if("array"===e.kind){const a=e.itemType;if("string"===a.kind||"number"===a.kind||"boolean"===a.kind){i.push(a.kind);const u=e.N;("number"==typeof u||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map(a=>a.serialize()))}}class uo{constructor(e){this.type=Kn,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&"object"==typeof a)return i.error("First argument must be an image or text section.");const u=[];let f=!1;for(let g=1;g<=e.length-1;++g){const x=e[g];if(f&&"object"==typeof x&&!Array.isArray(x)){f=!1;let b=null;if(x["font-scale"]&&(b=i.parse(x["font-scale"],1,Dt),!b))return null;let D=null;if(x["text-font"]&&(D=i.parse(x["text-font"],1,Nr(fn)),!D))return null;let A=null;if(x["text-color"]&&(A=i.parse(x["text-color"],1,br),!A))return null;const P=u[u.length-1];P.scale=b,P.font=D,P.textColor=A}else{const b=i.parse(e[g],1,at);if(!b)return null;const D=b.type.kind;if("string"!==D&&"value"!==D&&"null"!==D&&"resolvedImage"!==D)return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:b,scale:null,font:null,textColor:null})}}return new uo(u)}evaluate(e){return new Jn(this.sections.map(i=>{const a=i.content.evaluate(e);return _n(a)===Gr?new Vi("",a,null,null,null):new Vi(Go(a),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const a={};i.scale&&(a["font-scale"]=i.scale.serialize()),i.font&&(a["text-font"]=i.font.serialize()),i.textColor&&(a["text-color"]=i.textColor.serialize()),e.push(a)}return e}}class Ho{constructor(e){this.type=Gr,this.input=e}static parse(e,i){if(2!==e.length)return i.error("Expected two arguments.");const a=i.parse(e[1],1,fn);return a?new Ho(a):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),a=ii.fromString(i);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(i)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const $i={"to-boolean":Wt,"to-color":br,"to-number":Dt,"to-string":fn};class Oo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[0];if(("to-boolean"===a||"to-string"===a)&&2!==e.length)return i.error("Expected one argument.");const u=$i[a],f=[];for(let g=1;g<e.length;g++){const x=i.parse(e[g],g,at);if(!x)return null;f.push(x)}return new Oo(u,f)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let i,a;for(const u of this.args){if(i=u.evaluate(e),a=null,i instanceof Ln)return i;if("string"==typeof i){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:hi(i[0],i[1],i[2],i[3]),!a))return new Ln(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Tn(a||`Could not parse color from value '${"string"==typeof i?i:String(JSON.stringify(i))}'`)}if("number"===this.type.kind){let i=null;for(const a of this.args){if(i=a.evaluate(e),null===i)return 0;const u=Number(i);if(!isNaN(u))return u}throw new Tn(`Could not convert ${JSON.stringify(i)} to number.`)}return"formatted"===this.type.kind?Jn.fromString(Go(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?ii.fromString(Go(this.args[0].evaluate(e))):Go(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new uo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ho(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const hl=["Unknown","Point","LineString","Polygon"];class js{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?hl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:a,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*i-e[0])+this.featureDistanceData.bearing[1]*(u*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Ln.parse(e)),i}}class di{constructor(e,i,a,u){this.name=e,this.type=i,this._evaluate=a,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const a=e[0],u=di.definitions[a];if(!u)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,g=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,x=g.filter(([D])=>!Array.isArray(D)||D.length===e.length-1);let b=null;for(const[D,A]of x){b=new fa(i.registry,i.path,null,i.scope);const P=[];let F=!1;for(let $=1;$<e.length;$++){const H=e[$],ee=Array.isArray(D)?D[$-1]:D.type,ue=b.parse(H,1+P.length,ee);if(!ue){F=!0;break}P.push(ue)}if(!F)if(Array.isArray(D)&&D.length!==P.length)b.error(`Expected ${D.length} arguments, but found ${P.length} instead.`);else{for(let $=0;$<P.length;$++){const H=Array.isArray(D)?D[$]:D.type,ee=P[$];b.concat($+1).checkSubtype(H,ee.type)}if(0===b.errors.length)return new di(a,f,A,P)}}if(1===x.length)i.errors.push(...b.errors);else{const D=(x.length?x:g).map(([P])=>{return F=P,Array.isArray(F)?`(${F.map(Rn).join(", ")})`:`(${Rn(F.type)}...)`;var F}).join(" | "),A=[];for(let P=1;P<e.length;P++){const F=i.parse(e[P],1+A.length);if(!F)return null;A.push(Rn(F.type))}i.error(`Expected arguments of type ${D}, but found (${A.join(", ")}) instead.`)}return null}static register(e,i){di.definitions=i;for(const a in i)e[a]=di}}class ns{constructor(e,i,a){this.type=kn,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(2!==e.length)return i.error("Expected one argument.");const a=e[1];if("object"!=typeof a||Array.isArray(a))return i.error("Collator options argument must be an object.");const u=i.parse(void 0!==a["case-sensitive"]&&a["case-sensitive"],1,Wt);if(!u)return null;const f=i.parse(void 0!==a["diacritic-sensitive"]&&a["diacritic-sensitive"],1,Wt);if(!f)return null;let g=null;return a.locale&&(g=i.parse(a.locale,1,fn),!g)?null:new ns(u,f,g)}evaluate(e){return new $o(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const rs=8192;function dl(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Oa(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function za(n,e){const i=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*rs),Math.round(a*u*rs)]}function ua(n,e,i){const a=n[0]-e[0],u=n[1]-e[1],f=n[0]-i[0],g=n[1]-i[1];return a*g-f*u==0&&a*f<=0&&u*g<=0}function $s(n,e){let i=!1;for(let g=0,x=e.length;g<x;g++){const b=e[g];for(let D=0,A=b.length;D<A-1;D++){if(ua(n,b[D],b[D+1]))return!1;(u=b[D])[1]>(a=n)[1]!=(f=b[D+1])[1]>a[1]&&a[0]<(f[0]-u[0])*(a[1]-u[1])/(f[1]-u[1])+u[0]&&(i=!i)}}var a,u,f;return i}function ha(n,e){for(let i=0;i<e.length;i++)if($s(n,e[i]))return!0;return!1}function Ba(n,e,i,a){const u=a[0]-i[0],f=a[1]-i[1],g=(n[0]-i[0])*f-u*(n[1]-i[1]),x=(e[0]-i[0])*f-u*(e[1]-i[1]);return g>0&&x<0||g<0&&x>0}function Vl(n,e,i){for(const D of i)for(let A=0;A<D.length-1;++A)if((x=[(g=D[A+1])[0]-(f=D[A])[0],g[1]-f[1]])[0]*(b=[(u=e)[0]-(a=n)[0],u[1]-a[1]])[1]-x[1]*b[0]!=0&&Ba(a,u,f,g)&&Ba(f,g,a,u))return!0;var a,u,f,g,x,b;return!1}function Na(n,e){for(let i=0;i<n.length;++i)if(!$s(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(Vl(n[i],n[i+1],e))return!1;return!0}function dc(n,e){for(let i=0;i<e.length;i++)if(Na(n,e[i]))return!0;return!1}function Gi(n,e,i){const a=[];for(let u=0;u<n.length;u++){const f=[];for(let g=0;g<n[u].length;g++){const x=za(n[u][g],i);dl(e,x),f.push(x)}a.push(f)}return a}function da(n,e,i){const a=[];for(let u=0;u<n.length;u++){const f=Gi(n[u],e,i);a.push(f)}return a}function Gs(n,e,i,a){if(n[0]<i[0]||n[0]>i[2]){const u=.5*a;let f=n[0]-i[0]>u?-a:i[0]-n[0]>u?a:0;0===f&&(f=n[0]-i[2]>u?-a:i[2]-n[0]>u?a:0),n[0]+=f}dl(e,n)}function zo(n,e,i,a){const u=Math.pow(2,a.z)*rs,f=[a.x*rs,a.y*rs],g=[];for(const x of n)for(const b of x){const D=[b.x+f[0],b.y+f[1]];Gs(D,e,i,u),g.push(D)}return g}function Hs(n,e,i,a){const u=Math.pow(2,a.z)*rs,f=[a.x*rs,a.y*rs],g=[];for(const b of n){const D=[];for(const A of b){const P=[A.x+f[0],A.y+f[1]];dl(e,P),D.push(P)}g.push(D)}if(e[2]-e[0]<=u/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const b of g)for(const D of b)Gs(D,e,i,u)}var x;return g}class Co{constructor(e,i){this.type=Wt,this.geojson=e,this.geometries=i}static parse(e,i){if(2!==e.length)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Hr(e[1])){const a=e[1];if("FeatureCollection"===a.type)for(let u=0;u<a.features.length;++u){const f=a.features[u].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new Co(a,a.features[u].geometry)}else if("Feature"===a.type){const u=a.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new Co(a,a.geometry)}else if("Polygon"===a.type||"MultiPolygon"===a.type)return new Co(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(i,a){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if("Polygon"===a.type){const x=Gi(a.coordinates,f,g),b=zo(i.geometry(),u,f,g);if(!Oa(u,f))return!1;for(const D of b)if(!$s(D,x))return!1}if("MultiPolygon"===a.type){const x=da(a.coordinates,f,g),b=zo(i.geometry(),u,f,g);if(!Oa(u,f))return!1;for(const D of b)if(!ha(D,x))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(i,a){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if("Polygon"===a.type){const x=Gi(a.coordinates,f,g),b=Hs(i.geometry(),u,f,g);if(!Oa(u,f))return!1;for(const D of b)if(!Na(D,x))return!1}if("MultiPolygon"===a.type){const x=da(a.coordinates,f,g),b=Hs(i.geometry(),u,f,g);if(!Oa(u,f))return!1;for(const D of b)if(!dc(D,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Zs(n){if(n instanceof di&&("get"===n.name&&1===n.args.length||"feature-state"===n.name||"has"===n.name&&1===n.args.length||"properties"===n.name||"geometry-type"===n.name||"id"===n.name||/^filter-/.test(n.name))||n instanceof Co)return!1;let e=!0;return n.eachChild(i=>{e&&!Zs(i)&&(e=!1)}),e}function ho(n){if(n instanceof di&&"feature-state"===n.name)return!1;let e=!0;return n.eachChild(i=>{e&&!ho(i)&&(e=!1)}),e}function zn(n,e){if(n instanceof di&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(a=>{i&&!zn(a,e)&&(i=!1)}),i}class qs{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(2!==e.length||"string"!=typeof e[1])return i.error("'var' expression requires exactly one string literal argument.");const a=e[1];return i.scope.has(a)?new qs(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class fa{constructor(e,i=[],a,u=new _r,f=[]){this.registry=e,this.path=i,this.key=i.map(g=>`[${g}]`).join(""),this.scope=u,this.errors=f,this.expectedType=a}parse(e,i,a,u,f={}){return i?this.concat(i,a,u)._parse(e,f):this._parse(e,f)}_parse(e,i){function a(u,f,g){return"assert"===g?new ji(f,[u]):"coerce"===g?new Oo(f,[u]):u}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if("string"!=typeof u)return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let g=f.parse(e,this);if(!g)return null;if(this.expectedType){const x=this.expectedType,b=g.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==b.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==b.kind&&"string"!==b.kind){if(this.checkSubtype(x,b))return null}else g=a(g,x,i.typeAnnotation||"coerce");else g=a(g,x,i.typeAnnotation||"assert")}if(!(g instanceof ws)&&"resolvedImage"!==g.type.kind&&fl(g)){const x=new js;try{g=new ws(g.type,g.evaluate(x))}catch(b){return this.error(b.message),null}}return g}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,a){const u="number"==typeof e?this.path.concat(e):this.path,f=a?this.scope.concat(a):this.scope;return new fa(this.registry,u,i||null,f,this.errors)}error(e,...i){const a=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new $t(a,e))}checkSubtype(e,i){const a=rr(e,i);return a&&this.error(a),a}}function fl(n){if(n instanceof qs)return fl(n.boundExpression);if(n instanceof di&&"error"===n.name||n instanceof ns||n instanceof Co)return!1;const e=n instanceof Oo||n instanceof ji;let i=!0;return n.eachChild(a=>{i=e?i&&fl(a):i&&a instanceof ws}),!!i&&Zs(n)&&zn(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Es(n,e){const i=n.length-1;let a,u,f=0,g=i,x=0;for(;f<=g;)if(x=Math.floor((f+g)/2),a=n[x],u=n[x+1],a<=e){if(x===i||e<u)return x;f=x+1}else{if(!(a>e))throw new Tn("Input is not a number.");g=x-1}return 0}class Ki{constructor(e,i,a){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,f]of a)this.labels.push(u),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(e[1],1,Dt);if(!a)return null;const u=[];let f=null;i.expectedType&&"value"!==i.expectedType.kind&&(f=i.expectedType);for(let g=1;g<e.length;g+=2){const x=1===g?-1/0:e[g],b=e[g+1],D=g,A=g+1;if("number"!=typeof x)return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(u.length&&u[u.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const P=i.parse(b,A,f);if(!P)return null;f=f||P.type,u.push([x,P])}return new Ki(f,a,u)}evaluate(e){const i=this.labels,a=this.outputs;if(1===i.length)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return a[0].evaluate(e);const f=i.length;return u>=i[f-1]?a[f-1].evaluate(e):a[Es(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}function Vn(n,e,i){return n*(1-i)+e*i}var fo=Object.freeze({__proto__:null,number:Vn,color:function(n,e,i){return new Ln(Vn(n.r,e.r,i),Vn(n.g,e.g,i),Vn(n.b,e.b,i),Vn(n.a,e.a,i))},array:function(n,e,i){return n.map((a,u)=>Vn(a,e[u],i))}});const Qi=4/29,os=6/29,O=3*os*os,K=Math.PI/180,B=180/Math.PI;function te(n){return n>.008856451679035631?Math.pow(n,1/3):n/O+Qi}function De(n){return n>os?n*n*n:O*(n-Qi)}function et(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function mt(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Kt(n){const e=mt(n.r),i=mt(n.g),a=mt(n.b),u=te((.4124564*e+.3575761*i+.1804375*a)/.95047),f=te((.2126729*e+.7151522*i+.072175*a)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-te((.0193339*e+.119192*i+.9503041*a)/1.08883)),alpha:n.a}}function xn(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,a=isNaN(n.b)?e:e-n.b/200;return e=1*De(e),i=.95047*De(i),a=1.08883*De(a),new Ln(et(3.2404542*i-1.5371385*e-.4985314*a),et(-.969266*i+1.8760108*e+.041556*a),et(.0556434*i-.2040259*e+1.0572252*a),n.alpha)}function yr(n,e,i){const a=e-n;return n+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const er={forward:Kt,reverse:xn,interpolate:function(n,e,i){return{l:Vn(n.l,e.l,i),a:Vn(n.a,e.a,i),b:Vn(n.b,e.b,i),alpha:Vn(n.alpha,e.alpha,i)}}},Zt={forward:function(n){const{l:e,a:i,b:a}=Kt(n),u=Math.atan2(a,i)*B;return{h:u<0?u+360:u,c:Math.sqrt(i*i+a*a),l:e,alpha:n.a}},reverse:function(n){const e=n.h*K,i=n.c;return xn({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:yr(n.h,e.h,i),c:Vn(n.c,e.c,i),l:Vn(n.l,e.l,i),alpha:Vn(n.alpha,e.alpha,i)}}};var Jr=Object.freeze({__proto__:null,lab:er,hcl:Zt});class jn{constructor(e,i,a,u,f){this.type=e,this.operator=i,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[g,x]of f)this.labels.push(g),this.outputs.push(x)}static interpolationFactor(e,i,a,u){let f=0;if("exponential"===e.name)f=Mr(i,e.base,a,u);else if("linear"===e.name)f=Mr(i,1,a,u);else if("cubic-bezier"===e.name){const g=e.controlPoints;f=new Jt(g[0],g[1],g[2],g[3]).solve(Mr(i,1,a,u))}return f}static parse(e,i){let[a,u,f,...g]=e;if(!Array.isArray(u)||0===u.length)return i.error("Expected an interpolation type expression.",1);if("linear"===u[0])u={name:"linear"};else if("exponential"===u[0]){const D=u[1];if("number"!=typeof D)return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:D}}else{if("cubic-bezier"!==u[0])return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const D=u.slice(1);if(4!==D.length||D.some(A=>"number"!=typeof A||A<0||A>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:D}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,Dt),!f)return null;const x=[];let b=null;"interpolate-hcl"===a||"interpolate-lab"===a?b=br:i.expectedType&&"value"!==i.expectedType.kind&&(b=i.expectedType);for(let D=0;D<g.length;D+=2){const A=g[D],P=g[D+1],F=D+3,$=D+4;if("number"!=typeof A)return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(x.length&&x[x.length-1][0]>=A)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const H=i.parse(P,$,b);if(!H)return null;b=b||H.type,x.push([A,H])}return"number"===b.kind||"color"===b.kind||"array"===b.kind&&"number"===b.itemType.kind&&"number"==typeof b.N?new jn(b,a,u,f,x):i.error(`Type ${Rn(b)} is not interpolatable.`)}evaluate(e){const i=this.labels,a=this.outputs;if(1===i.length)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return a[0].evaluate(e);const f=i.length;if(u>=i[f-1])return a[f-1].evaluate(e);const g=Es(i,u),x=jn.interpolationFactor(this.interpolation,u,i[g],i[g+1]),b=a[g].evaluate(e),D=a[g+1].evaluate(e);return"interpolate"===this.operator?fo[this.type.kind.toLowerCase()](b,D,x):"interpolate-hcl"===this.operator?Zt.reverse(Zt.interpolate(Zt.forward(b),Zt.forward(D),x)):er.reverse(er.interpolate(er.forward(b),er.forward(D),x))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)i.push(this.labels[a],this.outputs[a].serialize());return i}}function Mr(n,e,i,a){const u=a-i,f=n-i;return 0===u?0:1===e?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}class kr{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let a=null;const u=i.expectedType;u&&"value"!==u.kind&&(a=u);const f=[];for(const x of e.slice(1)){const b=i.parse(x,1+f.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,f.push(b)}const g=u&&f.some(x=>rr(u,x.type));return new kr(g?at:a,f)}evaluate(e){let i,a=null,u=0;for(const f of this.args)if(u++,a=f.evaluate(e),a&&a instanceof ii&&!a.available&&(i||(i=a.name),a=null,u===this.args.length&&(a=i)),null!==a)break;return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class po{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let f=1;f<e.length-1;f+=2){const g=e[f];if("string"!=typeof g)return i.error(`Expected string, but found ${typeof g} instead.`,f);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const x=i.parse(e[f+1],f+1);if(!x)return null;a.push([g,x])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,a);return u?new po(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,a]of this.bindings)e.push(i,a.serialize());return e.push(this.result.serialize()),e}}class Zo{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Dt),u=i.parse(e[2],2,Nr(i.expectedType||at));return a&&u?new Zo(u.type.itemType,a,u):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new Tn(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new Tn(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new Tn(`Array index must be an integer, but found ${i} instead.`);return a[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Hi{constructor(e,i){this.type=Wt,this.needle=e,this.haystack=i}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,at),u=i.parse(e[2],2,at);return a&&u?Fo(a.type,[Wt,fn,Dt,cr,at])?new Hi(a,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Rn(a.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!ui(i,["boolean","string","number","null"]))throw new Tn(`Expected first argument to be of type boolean, string, number or null, but found ${Rn(_n(i))} instead.`);if(!ui(a,["string","array"]))throw new Tn(`Expected second argument to be of type array or string, but found ${Rn(_n(a))} instead.`);return a.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class oi{constructor(e,i,a){this.type=Dt,this.needle=e,this.haystack=i,this.fromIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,at),u=i.parse(e[2],2,at);if(!a||!u)return null;if(!Fo(a.type,[Wt,fn,Dt,cr,at]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Rn(a.type)} instead`);if(4===e.length){const f=i.parse(e[3],3,Dt);return f?new oi(a,u,f):null}return new oi(a,u)}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!ui(i,["boolean","string","number","null"]))throw new Tn(`Expected first argument to be of type boolean, string, number or null, but found ${Rn(_n(i))} instead.`);if(!ui(a,["string","array"]))throw new Tn(`Expected second argument to be of type array or string, but found ${Rn(_n(a))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return a.indexOf(i,u)}return a.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class To{constructor(e,i,a,u,f,g){this.inputType=e,this.type=i,this.input=a,this.cases=u,this.outputs=f,this.otherwise=g}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let a,u;i.expectedType&&"value"!==i.expectedType.kind&&(u=i.expectedType);const f={},g=[];for(let D=2;D<e.length-1;D+=2){let A=e[D];const P=e[D+1];Array.isArray(A)||(A=[A]);const F=i.concat(D);if(0===A.length)return F.error("Expected at least one branch label.");for(const H of A){if("number"!=typeof H&&"string"!=typeof H)return F.error("Branch labels must be numbers or strings.");if("number"==typeof H&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof H&&Math.floor(H)!==H)return F.error("Numeric branch labels must be integer values.");if(a){if(F.checkSubtype(a,_n(H)))return null}else a=_n(H);if(void 0!==f[String(H)])return F.error("Branch labels must be unique.");f[String(H)]=g.length}const $=i.parse(P,D,u);if(!$)return null;u=u||$.type,g.push($)}const x=i.parse(e[1],1,at);if(!x)return null;const b=i.parse(e[e.length-1],e.length-1,u);return b?"value"!==x.type.kind&&i.concat(1).checkSubtype(a,x.type)?null:new To(a,u,x,f,g,b):null}evaluate(e){const i=this.input.evaluate(e);return(_n(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),a=[],u={};for(const g of i){const x=u[this.cases[g]];void 0===x?(u[this.cases[g]]=a.length,a.push([this.cases[g],[g]])):a[x][1].push(g)}const f=g=>"number"===this.inputType.kind?Number(g):g;for(const[g,x]of a)e.push(1===x.length?f(x[0]):x.map(f)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}class qo{constructor(e,i,a){this.type=e,this.branches=i,this.otherwise=a}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&"value"!==i.expectedType.kind&&(a=i.expectedType);const u=[];for(let g=1;g<e.length-1;g+=2){const x=i.parse(e[g],g,Wt);if(!x)return null;const b=i.parse(e[g+1],g+1,a);if(!b)return null;u.push([x,b]),a=a||b.type}const f=i.parse(e[e.length-1],e.length-1,a);return f?new qo(a,u,f):null}evaluate(e){for(const[i,a]of this.branches)if(i.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,a]of this.branches)e(i),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Va{constructor(e,i,a,u){this.type=e,this.input=i,this.beginIndex=a,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,at),u=i.parse(e[2],2,Dt);if(!a||!u)return null;if(!Fo(a.type,[Nr(at),fn,at]))return i.error(`Expected first argument to be of type array or string, but found ${Rn(a.type)} instead`);if(4===e.length){const f=i.parse(e[3],3,Dt);return f?new Va(a.type,a,u,f):null}return new Va(a.type,a,u)}evaluate(e){const i=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!ui(i,["string","array"]))throw new Tn(`Expected first argument to be of type array or string, but found ${Rn(_n(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(a,u)}return i.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Ji(n,e){return"=="===n||"!="===n?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function pl(n,e,i,a){return 0===a.compare(e,i)}function Bo(n,e,i){const a="=="!==n&&"!="!==n;return class m0{constructor(f,g,x){this.type=Wt,this.lhs=f,this.rhs=g,this.collator=x,this.hasUntypedArgument="value"===f.type.kind||"value"===g.type.kind}static parse(f,g){if(3!==f.length&&4!==f.length)return g.error("Expected two or three arguments.");const x=f[0];let b=g.parse(f[1],1,at);if(!b)return null;if(!Ji(x,b.type))return g.concat(1).error(`"${x}" comparisons are not supported for type '${Rn(b.type)}'.`);let D=g.parse(f[2],2,at);if(!D)return null;if(!Ji(x,D.type))return g.concat(2).error(`"${x}" comparisons are not supported for type '${Rn(D.type)}'.`);if(b.type.kind!==D.type.kind&&"value"!==b.type.kind&&"value"!==D.type.kind)return g.error(`Cannot compare types '${Rn(b.type)}' and '${Rn(D.type)}'.`);a&&("value"===b.type.kind&&"value"!==D.type.kind?b=new ji(D.type,[b]):"value"!==b.type.kind&&"value"===D.type.kind&&(D=new ji(b.type,[D])));let A=null;if(4===f.length){if("string"!==b.type.kind&&"string"!==D.type.kind&&"value"!==b.type.kind&&"value"!==D.type.kind)return g.error("Cannot use collator to compare non-string types.");if(A=g.parse(f[3],3,kn),!A)return null}return new m0(b,D,A)}evaluate(f){const g=this.lhs.evaluate(f),x=this.rhs.evaluate(f);if(a&&this.hasUntypedArgument){const b=_n(g),D=_n(x);if(b.kind!==D.kind||"string"!==b.kind&&"number"!==b.kind)throw new Tn(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${D.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=_n(g),D=_n(x);if("string"!==b.kind||"string"!==D.kind)return e(f,g,x)}return this.collator?i(f,g,x,this.collator.evaluate(f)):e(f,g,x)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[n];return this.eachChild(g=>{f.push(g.serialize())}),f}}}const bn=Bo("==",function(n,e,i){return e===i},pl),Hc=Bo("!=",function(n,e,i){return e!==i},function(n,e,i,a){return!pl(0,e,i,a)}),Zc=Bo("<",function(n,e,i){return e<i},function(n,e,i,a){return a.compare(e,i)<0}),qc=Bo(">",function(n,e,i){return e>i},function(n,e,i,a){return a.compare(e,i)>0}),Wc=Bo("<=",function(n,e,i){return e<=i},function(n,e,i,a){return a.compare(e,i)<=0}),fc=Bo(">=",function(n,e,i){return e>=i},function(n,e,i,a){return a.compare(e,i)>=0});class Ds{constructor(e,i,a,u,f){this.type=fn,this.number=e,this.locale=i,this.currency=a,this.minFractionDigits=u,this.maxFractionDigits=f}static parse(e,i){if(3!==e.length)return i.error("Expected two arguments.");const a=i.parse(e[1],1,Dt);if(!a)return null;const u=e[2];if("object"!=typeof u||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=i.parse(u.locale,1,fn),!f))return null;let g=null;if(u.currency&&(g=i.parse(u.currency,1,fn),!g))return null;let x=null;if(u["min-fraction-digits"]&&(x=i.parse(u["min-fraction-digits"],1,Dt),!x))return null;let b=null;return u["max-fraction-digits"]&&(b=i.parse(u["max-fraction-digits"],1,Dt),!b)?null:new Ds(a,f,g,x,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class ml{constructor(e){this.type=Dt,this.input=e}static parse(e,i){if(2!==e.length)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=i.parse(e[1],1);return a?"array"!==a.type.kind&&"string"!==a.type.kind&&"value"!==a.type.kind?i.error(`Expected argument of type string or array, but found ${Rn(a.type)} instead.`):new ml(a):null}evaluate(e){const i=this.input.evaluate(e);if("string"==typeof i||Array.isArray(i))return i.length;throw new Tn(`Expected value to be of type string or array, but found ${Rn(_n(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const ut={"==":bn,"!=":Hc,">":qc,"<":Zc,">=":fc,"<=":Wc,array:ji,at:Zo,boolean:ji,case:qo,coalesce:kr,collator:ns,format:uo,image:Ho,in:Hi,"index-of":oi,interpolate:jn,"interpolate-hcl":jn,"interpolate-lab":jn,length:ml,let:po,literal:ws,match:To,number:ji,"number-format":Ds,object:ji,slice:Va,step:Ki,string:ji,"to-boolean":Oo,"to-color":Oo,"to-number":Oo,"to-string":Oo,var:qs,within:Co};function Nn(n,[e,i,a,u]){e=e.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);const f=u?u.evaluate(n):1,g=hi(e,i,a,f);if(g)throw new Tn(g);return new Ln(e/255*f,i/255*f,a/255*f,f)}function jl(n,e){return n in e}function Zr(n,e){const i=e[n];return void 0===i?null:i}function So(n){return{type:n}}function Ws(n){return{result:"success",value:n}}function ei(n){return{result:"error",value:n}}function Wo(n){return"data-driven"===n["property-type"]||"cross-faded-data-driven"===n["property-type"]}function gl(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function pa(n){return!!n.expression&&n.expression.interpolated}function Qn(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n}function Xs(n){return"object"==typeof n&&null!==n&&!Array.isArray(n)}function _l(n){return n}function ki(n,e){const i="color"===e.type,a=n.stops&&"object"==typeof n.stops[0][0],u=a||!(a||void 0!==n.property),f=n.type||(pa(e)?"exponential":"interval");if(i&&((n=Ae({},n)).stops&&(n.stops=n.stops.map(D=>[D[0],Ln.parse(D[1])])),n.default=Ln.parse(n.default?n.default:e.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!Jr[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let g,x,b;if("exponential"===f)g=Xo;else if("interval"===f)g=ss;else if("categorical"===f){g=$l,x=Object.create(null);for(const D of n.stops)x[D[0]]=D[1];b=typeof n.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);g=Xc}if(a){const D={},A=[];for(let $=0;$<n.stops.length;$++){const H=n.stops[$],ee=H[0].zoom;void 0===D[ee]&&(D[ee]={zoom:ee,type:n.type,property:n.property,default:n.default,stops:[]},A.push(ee)),D[ee].stops.push([H[0].value,H[1]])}const P=[];for(const $ of A)P.push([D[$].zoom,ki(D[$],e)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:jn.interpolationFactor.bind(void 0,F),zoomStops:P.map($=>$[0]),evaluate:({zoom:$},H)=>Xo({stops:P,base:n.base},e,$).evaluate($,H)}}if(u){const D="exponential"===f?{name:"exponential",base:void 0!==n.base?n.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:jn.interpolationFactor.bind(void 0,D),zoomStops:n.stops.map(A=>A[0]),evaluate:({zoom:A})=>g(n,e,A,x,b)}}return{kind:"source",evaluate(D,A){const P=A&&A.properties?A.properties[n.property]:void 0;return void 0===P?eo(n.default,e.default):g(n,e,P,x,b)}}}function eo(n,e,i){return void 0!==n?n:void 0!==e?e:void 0!==i?i:void 0}function $l(n,e,i,a,u){return eo(typeof i===u?a[i]:void 0,n.default,e.default)}function ss(n,e,i){if("number"!==Qn(i))return eo(n.default,e.default);const a=n.stops.length;if(1===a||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[a-1][0])return n.stops[a-1][1];const u=Es(n.stops.map(f=>f[0]),i);return n.stops[u][1]}function Xo(n,e,i){const a=void 0!==n.base?n.base:1;if("number"!==Qn(i))return eo(n.default,e.default);const u=n.stops.length;if(1===u||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[u-1][0])return n.stops[u-1][1];const f=Es(n.stops.map(A=>A[0]),i),g=function(A,P,F,$){const H=$-F,ee=A-F;return 0===H?0:1===P?ee/H:(Math.pow(P,ee)-1)/(Math.pow(P,H)-1)}(i,a,n.stops[f][0],n.stops[f+1][0]),x=n.stops[f][1],b=n.stops[f+1][1];let D=fo[e.type]||_l;if(n.colorSpace&&"rgb"!==n.colorSpace){const A=Jr[n.colorSpace];D=(P,F)=>A.reverse(A.interpolate(A.forward(P),A.forward(F),g))}return"function"==typeof x.evaluate?{evaluate(...A){const P=x.evaluate.apply(void 0,A),F=b.evaluate.apply(void 0,A);if(void 0!==P&&void 0!==F)return D(P,F,g)}}:D(x,b,g)}function Xc(n,e,i){return"color"===e.type?i=Ln.parse(i):"formatted"===e.type?i=Jn.fromString(i.toString()):"resolvedImage"===e.type?i=ii.fromString(i.toString()):Qn(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),eo(i,n.default,e.default)}di.register(ut,{error:[{kind:"error"},[fn],(n,[e])=>{throw new Tn(e.evaluate(n))}],typeof:[fn,[at],(n,[e])=>Rn(_n(e.evaluate(n)))],"to-rgba":[Nr(Dt,4),[br],(n,[e])=>e.evaluate(n).toArray()],rgb:[br,[Dt,Dt,Dt],Nn],rgba:[br,[Dt,Dt,Dt,Dt],Nn],has:{type:Wt,overloads:[[[fn],(n,[e])=>jl(e.evaluate(n),n.properties())],[[fn,Pr],(n,[e,i])=>jl(e.evaluate(n),i.evaluate(n))]]},get:{type:at,overloads:[[[fn],(n,[e])=>Zr(e.evaluate(n),n.properties())],[[fn,Pr],(n,[e,i])=>Zr(e.evaluate(n),i.evaluate(n))]]},"feature-state":[at,[fn],(n,[e])=>Zr(e.evaluate(n),n.featureState||{})],properties:[Pr,[],n=>n.properties()],"geometry-type":[fn,[],n=>n.geometryType()],id:[at,[],n=>n.id()],zoom:[Dt,[],n=>n.globals.zoom],pitch:[Dt,[],n=>n.globals.pitch||0],"distance-from-center":[Dt,[],n=>n.distanceFromCenter()],"heatmap-density":[Dt,[],n=>n.globals.heatmapDensity||0],"line-progress":[Dt,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[Dt,[],n=>n.globals.skyRadialProgress||0],accumulated:[at,[],n=>void 0===n.globals.accumulated?null:n.globals.accumulated],"+":[Dt,So(Dt),(n,e)=>{let i=0;for(const a of e)i+=a.evaluate(n);return i}],"*":[Dt,So(Dt),(n,e)=>{let i=1;for(const a of e)i*=a.evaluate(n);return i}],"-":{type:Dt,overloads:[[[Dt,Dt],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[Dt],(n,[e])=>-e.evaluate(n)]]},"/":[Dt,[Dt,Dt],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[Dt,[Dt,Dt],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[Dt,[],()=>Math.LN2],pi:[Dt,[],()=>Math.PI],e:[Dt,[],()=>Math.E],"^":[Dt,[Dt,Dt],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[Dt,[Dt],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Dt,[Dt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Dt,[Dt],(n,[e])=>Math.log(e.evaluate(n))],log2:[Dt,[Dt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Dt,[Dt],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Dt,[Dt],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Dt,[Dt],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Dt,[Dt],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Dt,[Dt],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Dt,[Dt],(n,[e])=>Math.atan(e.evaluate(n))],min:[Dt,So(Dt),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[Dt,So(Dt),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[Dt,[Dt],(n,[e])=>Math.abs(e.evaluate(n))],round:[Dt,[Dt],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Dt,[Dt],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Dt,[Dt],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Wt,[fn,at],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Wt,[at],(n,[e])=>n.id()===e.value],"filter-type-==":[Wt,[fn],(n,[e])=>n.geometryType()===e.value],"filter-<":[Wt,[fn,at],(n,[e,i])=>{const a=n.properties()[e.value],u=i.value;return typeof a==typeof u&&a<u}],"filter-id-<":[Wt,[at],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i<a}],"filter->":[Wt,[fn,at],(n,[e,i])=>{const a=n.properties()[e.value],u=i.value;return typeof a==typeof u&&a>u}],"filter-id->":[Wt,[at],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i>a}],"filter-<=":[Wt,[fn,at],(n,[e,i])=>{const a=n.properties()[e.value],u=i.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[Wt,[at],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i<=a}],"filter->=":[Wt,[fn,at],(n,[e,i])=>{const a=n.properties()[e.value],u=i.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[Wt,[at],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i>=a}],"filter-has":[Wt,[at],(n,[e])=>e.value in n.properties()],"filter-has-id":[Wt,[],n=>null!==n.id()&&void 0!==n.id()],"filter-type-in":[Wt,[Nr(fn)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Wt,[Nr(at)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Wt,[fn,Nr(at)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Wt,[fn,Nr(at)],(n,[e,i])=>function(a,u,f,g){for(;f<=g;){const x=f+g>>1;if(u[x]===a)return!0;u[x]>a?g=x-1:f=x+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Wt,overloads:[[[Wt,Wt],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[So(Wt),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Wt,overloads:[[[Wt,Wt],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[So(Wt),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Wt,[Wt],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Wt,[fn],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[fn,[fn],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[fn,[fn],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[fn,So(at),(n,e)=>e.map(i=>Go(i.evaluate(n))).join("")],"resolved-locale":[fn,[kn],(n,[e])=>e.evaluate(n).resolvedLocale()]});class ja{constructor(e,i){var a;this.expression=e,this._warningHistory={},this._evaluator=new js,this._defaultValue=i?"color"===(a=i).type&&Xs(a.default)?new Ln(0,0,0,0):"color"===a.type?Ln.parse(a.default)||null:void 0===a.default?null:a.default:null,this._enumValues=i&&"enum"===i.type?i.values:null}evaluateWithoutErrorHandling(e,i,a,u,f,g,x,b){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,a,u,f,g,x,b){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=b||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Tn(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,"undefined"!=typeof console&&console.warn(D.message)),this._defaultValue}}}function No(n){return Array.isArray(n)&&n.length>0&&"string"==typeof n[0]&&n[0]in ut}function ma(n,e){const i=new fa(ut,[],e?function(u){const f={color:br,string:fn,number:Dt,enum:fn,boolean:Wt,formatted:Kn,resolvedImage:Gr};return"array"===u.type?Nr(f[u.value]||at,u.length):f[u.type]}(e):void 0),a=i.parse(n,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return a?Ws(new ja(a,e)):ei(i.errors)}class Yo{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent="constant"!==e&&!ho(i.expression)}evaluateWithoutErrorHandling(e,i,a,u,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,u,f,g)}evaluate(e,i,a,u,f,g){return this._styleExpression.evaluate(e,i,a,u,f,g)}}class ga{constructor(e,i,a,u){this.kind=e,this.zoomStops=a,this._styleExpression=i,this.isStateDependent="camera"!==e&&!ho(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,a,u,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,u,f,g)}evaluate(e,i,a,u,f,g){return this._styleExpression.evaluate(e,i,a,u,f,g)}interpolationFactor(e,i,a){return this.interpolationType?jn.interpolationFactor(this.interpolationType,e,i,a):0}}function Gl(n,e){if("error"===(n=ma(n,e)).result)return n;const i=n.value.expression,a=Zs(i);if(!a&&!Wo(e))return ei([new $t("","data expressions not supported")]);const u=zn(i,["zoom","pitch","distance-from-center"]);if(!u&&!gl(e))return ei([new $t("","zoom expressions not supported")]);const f=Ys(i);return f||u?f instanceof $t?ei([f]):f instanceof jn&&!pa(e)?ei([new $t("",'"interpolate" expressions cannot be used with this property')]):Ws(f?new ga(a?"camera":"composite",n.value,f.labels,f instanceof jn?f.interpolation:void 0):new Yo(a?"constant":"source",n.value)):ei([new $t("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class as{constructor(e,i){this._parameters=e,this._specification=i,Ae(this,ki(this._parameters,this._specification))}static deserialize(e){return new as(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ys(n){let e=null;if(n instanceof po)e=Ys(n.result);else if(n instanceof kr){for(const i of n.args)if(e=Ys(i),e)break}else(n instanceof Ki||n instanceof jn)&&n.input instanceof di&&"zoom"===n.input.name&&(e=n);return e instanceof $t||n.eachChild(i=>{const a=Ys(i);a instanceof $t?e=a:!e&&a?e=new $t("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new $t("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function to(n){const e=n.key,i=n.value,a=n.valueSpec||{},u=n.objectElementValidators||{},f=n.style,g=n.styleSpec;let x=[];const b=Qn(i);if("object"!==b)return[new J(e,i,`object expected, ${b} found`)];for(const D in i){const A=D.split(".")[0],P=a[A]||a["*"];let F;if(u[A])F=u[A];else if(a[A])F=Li;else if(u["*"])F=u["*"];else{if(!a["*"]){x.push(new J(e,i[D],`unknown property "${D}"`));continue}F=Li}x=x.concat(F({key:(e&&`${e}.`)+D,value:i[D],valueSpec:P,style:f,styleSpec:g,object:i,objectKey:D},i))}for(const D in a)u[D]||a[D].required&&void 0===a[D].default&&void 0===i[D]&&x.push(new J(e,i,`missing required property "${D}"`));return x}function Cs(n){const e=n.value,i=n.valueSpec,a=n.style,u=n.styleSpec,f=n.key,g=n.arrayElementValidator||Li;if("array"!==Qn(e))return[new J(f,e,`array expected, ${Qn(e)} found`)];if(i.length&&e.length!==i.length)return[new J(f,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new J(f,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let x={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum};u.$version<7&&(x.function=i.function),"object"===Qn(i.value)&&(x=i.value);let b=[];for(let D=0;D<e.length;D++)b=b.concat(g({array:e,arrayIndex:D,value:e[D],valueSpec:x,style:a,styleSpec:u,key:`${f}[${D}]`}));return b}function $a(n){const e=n.key,i=n.value,a=n.valueSpec;let u=Qn(i);if("number"===u&&i!=i&&(u="NaN"),"number"!==u)return[new J(e,i,`number expected, ${u} found`)];if("minimum"in a){let f=a.minimum;if("array"===Qn(a.minimum)&&(f=a.minimum[n.arrayIndex]),i<f)return[new J(e,i,`${i} is less than the minimum value ${f}`)]}if("maximum"in a){let f=a.maximum;if("array"===Qn(a.maximum)&&(f=a.maximum[n.arrayIndex]),i>f)return[new J(e,i,`${i} is greater than the maximum value ${f}`)]}return[]}function _a(n){const e=n.valueSpec,i=je(n.value.type);let a,u,f,g={};const x="categorical"!==i&&void 0===n.value.property,b=!x,D="array"===Qn(n.value.stops)&&"array"===Qn(n.value.stops[0])&&"object"===Qn(n.value.stops[0][0]),A=to({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function($){if("identity"===i)return[new J($.key,$.value,'identity function may not have a "stops" property')];let H=[];const ee=$.value;return H=H.concat(Cs({key:$.key,value:ee,valueSpec:$.valueSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:P})),"array"===Qn(ee)&&0===ee.length&&H.push(new J($.key,ee,"array must have at least one stop")),H},default:function($){return Li({key:$.key,value:$.value,valueSpec:e,style:$.style,styleSpec:$.styleSpec})}}});return"identity"===i&&x&&A.push(new J(n.key,n.value,'missing required property "property"')),"identity"===i||n.value.stops||A.push(new J(n.key,n.value,'missing required property "stops"')),"exponential"===i&&n.valueSpec.expression&&!pa(n.valueSpec)&&A.push(new J(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(b&&!Wo(n.valueSpec)?A.push(new J(n.key,n.value,"property functions not supported")):x&&!gl(n.valueSpec)&&A.push(new J(n.key,n.value,"zoom functions not supported"))),"categorical"!==i&&!D||void 0!==n.value.property||A.push(new J(n.key,n.value,'"property" property is required')),A;function P($){let H=[];const ee=$.value,ue=$.key;if("array"!==Qn(ee))return[new J(ue,ee,`array expected, ${Qn(ee)} found`)];if(2!==ee.length)return[new J(ue,ee,`array length 2 expected, length ${ee.length} found`)];if(D){if("object"!==Qn(ee[0]))return[new J(ue,ee,`object expected, ${Qn(ee[0])} found`)];if(void 0===ee[0].zoom)return[new J(ue,ee,"object stop key must have zoom")];if(void 0===ee[0].value)return[new J(ue,ee,"object stop key must have value")];if(f&&f>je(ee[0].zoom))return[new J(ue,ee[0].zoom,"stop zoom values must appear in ascending order")];je(ee[0].zoom)!==f&&(f=je(ee[0].zoom),u=void 0,g={}),H=H.concat(to({key:`${ue}[0]`,value:ee[0],valueSpec:{zoom:{}},style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:$a,value:F}}))}else H=H.concat(F({key:`${ue}[0]`,value:ee[0],valueSpec:{},style:$.style,styleSpec:$.styleSpec},ee));return No(yt(ee[1]))?H.concat([new J(`${ue}[1]`,ee[1],"expressions are not allowed in function stops.")]):H.concat(Li({key:`${ue}[1]`,value:ee[1],valueSpec:e,style:$.style,styleSpec:$.styleSpec}))}function F($,H){const ee=Qn($.value),ue=je($.value),fe=null!==$.value?$.value:H;if(a){if(ee!==a)return[new J($.key,fe,`${ee} stop domain type must match previous stop domain type ${a}`)]}else a=ee;if("number"!==ee&&"string"!==ee&&"boolean"!==ee)return[new J($.key,fe,"stop domain value must be a number, string, or boolean")];if("number"!==ee&&"categorical"!==i){let ve=`number expected, ${ee} found`;return Wo(e)&&void 0===i&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new J($.key,fe,ve)]}return"categorical"!==i||"number"!==ee||isFinite(ue)&&Math.floor(ue)===ue?"categorical"!==i&&"number"===ee&&void 0!==u&&ue<u?[new J($.key,fe,"stop domain values must appear in ascending order")]:(u=ue,"categorical"===i&&ue in g?[new J($.key,fe,"stop domain values must be unique")]:(g[ue]=!0,[])):[new J($.key,fe,`integer expected, found ${ue}`)]}}function ls(n){const e=("property"===n.expressionContext?Gl:ma)(yt(n.value),n.valueSpec);if("error"===e.result)return e.value.map(a=>new J(`${n.key}${a.key}`,n.value,a.message));const i=e.value.expression||e.value._styleExpression.expression;if("property"===n.expressionContext&&"text-font"===n.propertyKey&&!i.outputDefined())return[new J(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===n.expressionContext&&"layout"===n.propertyType&&!ho(i))return[new J(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===n.expressionContext)return yl(i,n);if(n.expressionContext&&0===n.expressionContext.indexOf("cluster")){if(!zn(i,["zoom","feature-state"]))return[new J(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===n.expressionContext&&!Zs(i))return[new J(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function yl(n,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const u of e.valueSpec.expression.parameters)i.delete(u);if(0===i.size)return[];const a=[];return n instanceof di&&i.has(n.name)?[new J(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(u=>{a.push(...yl(u,e))}),a)}function cs(n){const e=n.key,i=n.value,a=n.valueSpec,u=[];return Array.isArray(a.values)?-1===a.values.indexOf(je(i))&&u.push(new J(e,i,`expected one of [${a.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(a.values).indexOf(je(i))&&u.push(new J(e,i,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function vl(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!vl(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function ya(n,e="fill"){if(null==n)return{filter:()=>!0,needGeometry:!1,needFeature:!1};vl(n)||(n=Ha(n));const i=n;let a=!0;try{a=function(D){if(!vr(D))return D;let A=yt(D);return Ri(A),A=wi(A),A}(i)}catch(D){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const u=W[`filter_${e}`],f=ma(a,u);let g=null;if("error"===f.result)throw new Error(f.value.map(D=>`${D.key}: ${D.message}`).join(", "));g=(D,A,P)=>f.value.evaluate(D,A,{},P);let x=null,b=null;if(a!==i){const D=ma(i,u);if("error"===D.result)throw new Error(D.value.map(A=>`${A.key}: ${A.message}`).join(", "));x=(A,P,F,$,H)=>D.value.evaluate(A,P,{},F,void 0,void 0,$,H),b=!Zs(D.value.expression)}return g=g,{filter:g,dynamicFilter:x||void 0,needGeometry:Ga(a),needFeature:!!b}}function wi(n){if(!Array.isArray(n))return n;const e=function(i){if(pc.has(i[0]))for(let a=1;a<i.length;a++)if(vr(i[a]))return!0;return i}(n);return!0===e?e:e.map(i=>wi(i))}function Ri(n){let e=!1;const i=[];if("case"===n[0]){for(let a=1;a<n.length-1;a+=2)e=e||vr(n[a]),i.push(n[a+1]);i.push(n[n.length-1])}else if("match"===n[0]){e=e||vr(n[1]);for(let a=2;a<n.length-1;a+=2)i.push(n[a+1]);i.push(n[n.length-1])}else if("step"===n[0]){e=e||vr(n[1]);for(let a=1;a<n.length-1;a+=2)i.push(n[a+1])}e&&(n.length=0,n.push("any",...i));for(let a=1;a<n.length;a++)Ri(n[a])}function vr(n){if(!Array.isArray(n))return!1;if("pitch"===(e=n[0])||"distance-from-center"===e)return!0;var e;for(let i=1;i<n.length;i++)if(vr(n[i]))return!0;return!1}const pc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Hl(n,e){return n<e?-1:n>e?1:0}function Ga(n){if(!Array.isArray(n))return!1;if("within"===n[0])return!0;for(let e=1;e<n.length;e++)if(Ga(n[e]))return!0;return!1}function Ha(n){if(!n)return!0;const e=n[0];return n.length<=1?"any"!==e:"=="===e?va(n[1],n[2],"=="):"!="===e?Ks(va(n[1],n[2],"==")):"<"===e||">"===e||"<="===e||">="===e?va(n[1],n[2],e):"any"===e?(i=n.slice(1),["any"].concat(i.map(Ha))):"all"===e?["all"].concat(n.slice(1).map(Ha)):"none"===e?["all"].concat(n.slice(1).map(Ha).map(Ks)):"in"===e?mc(n[1],n.slice(2)):"!in"===e?Ks(mc(n[1],n.slice(2))):"has"===e?Za(n[1]):"!has"===e?Ks(Za(n[1])):"within"!==e||n;var i}function va(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function mc(n,e){if(0===e.length)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Hl)]]:["filter-in-small",n,["literal",e]]}}function Za(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Ks(n){return["!",n]}function Qs(n){if(vl(yt(n.value))){const e=yt(n.layerType);return ls(Ae({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${e||"fill"}`]}))}return xl(n)}function xl(n){const e=n.value,i=n.key;if("array"!==Qn(e))return[new J(i,e,`array expected, ${Qn(e)} found`)];const a=n.styleSpec;let u,f=[];if(e.length<1)return[new J(i,e,"filter array must have at least 1 element")];switch(f=f.concat(cs({key:`${i}[0]`,value:e[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),je(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===je(e[1])&&f.push(new J(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&f.push(new J(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Qn(e[1]),"string"!==u&&f.push(new J(`${i}[1]`,e[1],`string expected, ${u} found`)));for(let g=2;g<e.length;g++)u=Qn(e[g]),"$type"===je(e[1])?f=f.concat(cs({key:`${i}[${g}]`,value:e[g],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):"string"!==u&&"number"!==u&&"boolean"!==u&&f.push(new J(`${i}[${g}]`,e[g],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)f=f.concat(xl({key:`${i}[${g}]`,value:e[g],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=Qn(e[1]),2!==e.length?f.push(new J(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==u&&f.push(new J(`${i}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=Qn(e[1]),2!==e.length?f.push(new J(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==u&&f.push(new J(`${i}[1]`,e[1],`object expected, ${u} found`))}return f}function xa(n,e){const i=n.key,a=n.style,u=n.styleSpec,f=n.value,g=n.objectKey,x=u[`${e}_${n.layerType}`];if(!x)return[];const b=g.match(/^(.*)-transition$/);if("paint"===e&&b&&x[b[1]]&&x[b[1]].transition)return Li({key:i,value:f,valueSpec:u.transition,style:a,styleSpec:u});const D=n.valueSpec||x[g];if(!D)return[new J(i,f,`unknown property "${g}"`)];let A;if("string"===Qn(f)&&Wo(D)&&!D.tokens&&(A=/^{([^}]+)}$/.exec(f)))return[new J(i,f,`"${g}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const P=[];return"symbol"===n.layerType&&("text-field"===g&&a&&!a.glyphs&&P.push(new J(i,f,'use of "text-field" requires a style "glyphs" property')),"text-font"===g&&Xs(yt(f))&&"identity"===je(f.type)&&P.push(new J(i,f,'"text-font" does not support identity functions'))),P.concat(Li({key:n.key,value:f,valueSpec:D,style:a,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:g}))}function Ei(n){return xa(n,"paint")}function qr(n){return xa(n,"layout")}function Io(n){let e=[];const i=n.value,a=n.key,u=n.style,f=n.styleSpec;i.type||i.ref||e.push(new J(a,i,'either "type" or "ref" is required'));let g=je(i.type);const x=je(i.ref);if(i.id){const b=je(i.id);for(let D=0;D<n.arrayIndex;D++){const A=u.layers[D];je(A.id)===b&&e.push(new J(a,i.id,`duplicate layer id "${i.id}", previously used at line ${A.id.__line__}`))}}if("ref"in i){let b;["type","source","source-layer","filter","layout"].forEach(D=>{D in i&&e.push(new J(a,i[D],`"${D}" is prohibited for ref layers`))}),u.layers.forEach(D=>{je(D.id)===x&&(b=D)}),b?b.ref?e.push(new J(a,i.ref,"ref cannot reference another ref layer")):g=je(b.type):e.push(new J(a,i.ref,`ref layer "${x}" not found`))}else if("background"!==g&&"sky"!==g)if(i.source){const b=u.sources&&u.sources[i.source],D=b&&je(b.type);b?"vector"===D&&"raster"===g?e.push(new J(a,i.source,`layer "${i.id}" requires a raster source`)):"raster"===D&&"raster"!==g?e.push(new J(a,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==D||i["source-layer"]?"raster-dem"===D&&"hillshade"!==g?e.push(new J(a,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==g||!i.paint||!i.paint["line-gradient"]||"geojson"===D&&b.lineMetrics||e.push(new J(a,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new J(a,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new J(a,i.source,`source "${i.source}" not found`))}else e.push(new J(a,i,'missing required property "source"'));return e=e.concat(to({key:a,value:i,valueSpec:f.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Li({key:`${a}.type`,value:i.type,valueSpec:f.layer.type,style:n.style,styleSpec:n.styleSpec,object:i,objectKey:"type"}),filter:b=>Qs(Ae({layerType:g},b)),layout:b=>to({layer:i,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":D=>qr(Ae({layerType:g},D))}}),paint:b=>to({layer:i,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":D=>Ei(Ae({layerType:g},D))}})}})),e}function us(n){const e=n.value,i=n.key,a=Qn(e);return"string"!==a?[new J(i,e,`string expected, ${a} found`)]:[]}const bl={promoteId:function({key:n,value:e}){if("string"===Qn(e))return us({key:n,value:e});{const i=[];for(const a in e)i.push(...us({key:`${n}.${a}`,value:e[a]}));return i}}};function Uo(n){const e=n.value,i=n.key,a=n.styleSpec,u=n.style;if(!e.type)return[new J(i,e,'"type" is required')];const f=je(e.type);let g;switch(f){case"vector":case"raster":case"raster-dem":return g=to({key:i,value:e,valueSpec:a[`source_${f.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:bl}),g;case"geojson":if(g=to({key:i,value:e,valueSpec:a.source_geojson,style:u,styleSpec:a,objectElementValidators:bl}),e.cluster)for(const x in e.clusterProperties){const[b,D]=e.clusterProperties[x],A="string"==typeof b?[b,["accumulated"],["get",x]]:b;g.push(...ls({key:`${i}.${x}.map`,value:D,expressionContext:"cluster-map"})),g.push(...ls({key:`${i}.${x}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return g;case"video":return to({key:i,value:e,valueSpec:a.source_video,style:u,styleSpec:a});case"image":return to({key:i,value:e,valueSpec:a.source_image,style:u,styleSpec:a});case"canvas":return[new J(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return cs({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,styleSpec:a})}}function qa(n){const e=n.value,i=n.styleSpec,a=i.light,u=n.style;let f=[];const g=Qn(e);if(void 0===e)return f;if("object"!==g)return f=f.concat([new J("light",e,`object expected, ${g} found`)]),f;for(const x in e){const b=x.match(/^(.*)-transition$/);f=f.concat(b&&a[b[1]]&&a[b[1]].transition?Li({key:x,value:e[x],valueSpec:i.transition,style:u,styleSpec:i}):a[x]?Li({key:x,value:e[x],valueSpec:a[x],style:u,styleSpec:i}):[new J(x,e[x],`unknown property "${x}"`)])}return f}function wl(n){const e=n.value,i=n.key,a=n.style,u=n.styleSpec,f=u.terrain;let g=[];const x=Qn(e);if(void 0===e)return g;if("object"!==x)return g=g.concat([new J("terrain",e,`object expected, ${x} found`)]),g;for(const b in e){const D=b.match(/^(.*)-transition$/);g=g.concat(D&&f[D[1]]&&f[D[1]].transition?Li({key:b,value:e[b],valueSpec:u.transition,style:a,styleSpec:u}):f[b]?Li({key:b,value:e[b],valueSpec:f[b],style:a,styleSpec:u}):[new J(b,e[b],`unknown property "${b}"`)])}if(e.source){const b=a.sources&&a.sources[e.source],D=b&&je(b.type);b?"raster-dem"!==D&&g.push(new J(i,e.source,`terrain cannot be used with a source of type ${D}, it only be used with a "raster-dem" source type`)):g.push(new J(i,e.source,`source "${e.source}" not found`))}else g.push(new J(i,e,'terrain is missing required property "source"'));return g}function Zl(n){const e=n.value,i=n.style,a=n.styleSpec,u=a.fog;let f=[];const g=Qn(e);if(void 0===e)return f;if("object"!==g)return f=f.concat([new J("fog",e,`object expected, ${g} found`)]),f;for(const x in e){const b=x.match(/^(.*)-transition$/);f=f.concat(b&&u[b[1]]&&u[b[1]].transition?Li({key:x,value:e[x],valueSpec:a.transition,style:i,styleSpec:a}):u[x]?Li({key:x,value:e[x],valueSpec:u[x],style:i,styleSpec:a}):[new J(x,e[x],`unknown property "${x}"`)])}return f}const ql={"*":()=>[],array:Cs,boolean:function(n){const e=n.value,i=n.key,a=Qn(e);return"boolean"!==a?[new J(i,e,`boolean expected, ${a} found`)]:[]},number:$a,color:function(n){const e=n.key,i=n.value,a=Qn(i);return"string"!==a?[new J(e,i,`color expected, ${a} found`)]:null===bi.parseCSSColor(i)?[new J(e,i,`color expected, "${i}" found`)]:[]},constants:ne,enum:cs,filter:Qs,function:_a,layer:Io,object:to,source:Uo,light:qa,terrain:wl,fog:Zl,string:us,formatted:function(n){return 0===us(n).length?[]:ls(n)},resolvedImage:function(n){return 0===us(n).length?[]:ls(n)},projection:function(n){const e=n.value,i=n.styleSpec,a=i.projection,u=n.style;let f=[];const g=Qn(e);if("object"===g)for(const x in e)f=f.concat(Li({key:x,value:e[x],valueSpec:a[x],style:u,styleSpec:i}));else"string"!==g&&(f=f.concat([new J("projection",e,`object or string expected, ${g} found`)]));return f}};function Li(n){const e=n.value,i=n.valueSpec,a=n.styleSpec;return i.expression&&Xs(je(e))?_a(n):i.expression&&No(yt(e))?ls(n):i.type&&ql[i.type]?ql[i.type](n):to(Ae({},n,{valueSpec:i.type?a[i.type]:i}))}function Wa(n){const e=n.value,i=n.key,a=us(n);return a.length||(-1===e.indexOf("{fontstack}")&&a.push(new J(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&a.push(new J(i,e,'"glyphs" url must include a "{range}" token'))),a}function no(n,e=W){let i=[];return i=i.concat(Li({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:Wa,"*":()=>[]}})),n.constants&&(i=i.concat(ne({key:"constants",value:n.constants,style:n,styleSpec:e}))),Wl(i)}function Wl(n){return[].concat(n).sort((e,i)=>e.line-i.line)}function fi(n){return function(...e){return Wl(n.apply(this,e))}}no.source=fi(Uo),no.light=fi(qa),no.terrain=fi(wl),no.fog=fi(Zl),no.layer=fi(Io),no.filter=fi(Qs),no.paintProperty=fi(Ei),no.layoutProperty=fi(qr);const hs=no,gc=hs.light,Ts=hs.fog,El=hs.paintProperty,Js=hs.layoutProperty;function Dl(n,e){let i=!1;if(e&&e.length)for(const a of e)n.fire(new Ht(new Error(a.message))),i=!0;return i}var ds=Ko;function Ko(n,e,i){var a=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var u=new Int32Array(this.arrayBuffer);n=u[0],this.d=(e=u[1])+2*(i=u[2]);for(var f=0;f<this.d*this.d;f++){var g=u[3+f],x=u[3+f+1];a.push(g===x?null:u.subarray(g,x))}var b=u[3+a.length+1];this.keys=u.subarray(u[3+a.length],b),this.bboxes=u.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var D=0;D<this.d*this.d;D++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=i,this.scale=e/n,this.uid=0;var A=i/e*n;this.min=-A,this.max=n+A}Ko.prototype.insert=function(n,e,i,a,u){this._forEachCell(e,i,a,u,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(u)},Ko.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ko.prototype._insertCell=function(n,e,i,a,u,f){this.cells[u].push(f)},Ko.prototype.query=function(n,e,i,a,u){var f=this.min,g=this.max;if(n<=f&&e<=f&&g<=i&&g<=a&&!u)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(n,e,i,a,this._queryCell,x,{},u),x},Ko.prototype._queryCell=function(n,e,i,a,u,f,g,x){var b=this.cells[u];if(null!==b)for(var D=this.keys,A=this.bboxes,P=0;P<b.length;P++){var F=b[P];if(void 0===g[F]){var $=4*F;(x?x(A[$+0],A[$+1],A[$+2],A[$+3]):n<=A[$+2]&&e<=A[$+3]&&i>=A[$+0]&&a>=A[$+1])?(g[F]=!0,f.push(D[F])):g[F]=!1}}},Ko.prototype._forEachCell=function(n,e,i,a,u,f,g,x){for(var b=this._convertToCellCoord(n),D=this._convertToCellCoord(e),A=this._convertToCellCoord(i),P=this._convertToCellCoord(a),F=b;F<=A;F++)for(var $=D;$<=P;$++){var H=this.d*$+F;if((!x||x(this._convertFromCellCoord(F),this._convertFromCellCoord($),this._convertFromCellCoord(F+1),this._convertFromCellCoord($+1)))&&u.call(this,n,e,i,a,H,f,g,x))return}},Ko.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},Ko.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},Ko.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=3+this.cells.length+1+1,i=0,a=0;a<this.cells.length;a++)i+=this.cells[a].length;var u=new Int32Array(e+i+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var f=e,g=0;g<n.length;g++){var x=n[g];u[3+g]=f,u.set(x,f),f+=x.length}return u[3+n.length]=f,u.set(this.keys,f),u[3+n.length+1]=f+=this.keys.length,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer};const{ImageData:Xa,ImageBitmap:Xl}=qe,Ya={};function Bt(n,e,i={}){Object.defineProperty(e,"_classRegistryKey",{value:n,writeable:!1}),Ya[n]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}Bt("Object",Object),ds.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.push(i),{buffer:i}},ds.deserialize=function(n){return new ds(n.buffer)},Bt("Grid",ds),Bt("Color",Ln),Bt("Error",Error),Bt("ResolvedImage",ii),Bt("StylePropertyFunction",as),Bt("StyleExpression",ja,{omit:["_evaluator"]}),Bt("ZoomDependentExpression",ga),Bt("ZoomConstantExpression",Yo),Bt("CompoundExpression",di,{omit:["_evaluate"]});for(const n in ut)ut[n]._classRegistryKey||Bt(`Expression_${n}`,ut[n]);function ba(n){return n&&"undefined"!=typeof ArrayBuffer&&(n instanceof ArrayBuffer||n.constructor&&"ArrayBuffer"===n.constructor.name)}function Ka(n){return Xl&&n instanceof Xl}function Ss(n,e){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(ba(n)||Ka(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const i=n;return e&&e.push(i.buffer),i}if(n instanceof Xa)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const a of n)i.push(Ss(a,e));return i}if("object"==typeof n){const i=n.constructor,a=i._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class");const u=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const f in n){if(!n.hasOwnProperty(f)||Ya[a].omit.indexOf(f)>=0)continue;const g=n[f];u[f]=Ya[a].shallow.indexOf(f)>=0?g:Ss(g,e)}n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==a&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof n)}function Is(n){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||ba(n)||Ka(n)||ArrayBuffer.isView(n)||n instanceof Xa)return n;if(Array.isArray(n))return n.map(Is);if("object"==typeof n){const e=n.$name||"Object",{klass:i}=Ya[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const a=Object.create(i.prototype);for(const u of Object.keys(n)){if("$name"===u)continue;const f=n[u];a[u]=Ya[e].shallow.indexOf(u)>=0?f:Is(f)}return a}throw new Error("can't deserialize object of type "+typeof n)}class Cl{constructor(){this.first=!0}update(e,i){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const M=n=>n>=1536&&n<=1791,T=n=>n>=1872&&n<=1919,C=n=>n>=2208&&n<=2303,L=n=>n>=11904&&n<=12031,U=n=>n>=12032&&n<=12255,X=n=>n>=12272&&n<=12287,ge=n=>n>=12288&&n<=12351,be=n=>n>=12352&&n<=12447,Ue=n=>n>=12448&&n<=12543,Lt=n=>n>=12544&&n<=12591,Mn=n=>n>=12704&&n<=12735,Qt=n=>n>=12736&&n<=12783,Gn=n=>n>=12784&&n<=12799,ar=n=>n>=12800&&n<=13055,fs=n=>n>=13056&&n<=13311,ro=n=>n>=13312&&n<=19903,pi=n=>n>=19968&&n<=40959,io=n=>n>=40960&&n<=42127,Qo=n=>n>=42128&&n<=42191,oo=n=>n>=44032&&n<=55215,ps=n=>n>=63744&&n<=64255,mo=n=>n>=64336&&n<=65023,Mh=n=>n>=65040&&n<=65055,Yl=n=>n>=65072&&n<=65103,Wr=n=>n>=65104&&n<=65135,Yc=n=>n>=65136&&n<=65279,Fu=n=>n>=65280&&n<=65519;function Qa(n){for(const e of n)if(Ou(e.charCodeAt(0)))return!0;return!1}function Kc(n){for(const e of n)if(!_c(e.charCodeAt(0)))return!1;return!0}function _c(n){return!(M(n)||T(n)||C(n)||mo(n)||Yc(n))}function Ou(n){return!(746!==n&&747!==n&&(n<4352||!(Mn(n)||Lt(n)||Yl(n)&&!(n>=65097&&n<=65103)||ps(n)||fs(n)||L(n)||Qt(n)||!(!ge(n)||n>=12296&&n<=12305||n>=12308&&n<=12319||12336===n)||ro(n)||pi(n)||ar(n)||(e=n,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(n)||(e=>e>=55216&&e<=55295)(n)||(e=>e>=4352&&e<=4607)(n)||oo(n)||be(n)||X(n)||(e=>e>=12688&&e<=12703)(n)||U(n)||Gn(n)||Ue(n)&&12540!==n||!(!Fu(n)||65288===n||65289===n||65293===n||n>=65306&&n<=65310||65339===n||65341===n||65343===n||n>=65371&&n<=65503||65507===n||n>=65512&&n<=65519)||!(!Wr(n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||(e=>e>=5120&&e<=5759)(n)||(e=>e>=6320&&e<=6399)(n)||Mh(n)||(e=>e>=19904&&e<=19967)(n)||io(n)||Qo(n))));var e}function zu(n){return!(Ou(n)||(e=n,(i=e)>=128&&i<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(i=>i>=8192&&i<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&9251!==e||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ge(e)||Ue(e)||(i=>i>=57344&&i<=63743)(e)||Yl(e)||Wr(e)||Fu(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,i}function Ms(n){return n>=1424&&n<=2303||mo(n)||Yc(n)}function ef(n,e){return!(!e&&Ms(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||(i=n,i>=6016&&i<=6143));var i}function Di(n){for(const e of n)if(Ms(e.charCodeAt(0)))return!0;return!1}const wa="deferred",d="loading",t="loaded";let l=null,p="unavailable",_=null;const v=function(n){n&&"string"==typeof n&&n.indexOf("NetworkError")>-1&&(p="error"),l&&l(n)};function E(){S.fire(new it("pluginStateChange",{pluginStatus:p,pluginURL:_}))}const S=new vt,R=function(){return p},z=function(){if(p!==wa||!_)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");p=d,E(),_&&Z({url:_},n=>{n?v(n):(p=t,E())})},N={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>p===t||null!=N.applyArabicShaping,isLoading:()=>p===d,setState(n){p=n.pluginStatus,_=n.pluginURL},isParsed:()=>null!=N.applyArabicShaping&&null!=N.processBidirectionalText&&null!=N.processStyledBidirectionalText,getPluginURL:()=>_};class j{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Cl,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,a){for(const u of i)if(!ef(u.charCodeAt(0),a))return!1;return!0}(e,N.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*i}}}class Q{constructor(e,i){this.property=e,this.value=i,this.expression=function(a,u){if(Xs(a))return new as(a,u);if(No(a)){const f=Gl(a,u);if("error"===f.result)throw new Error(f.value.map(g=>`${g.key}: ${g.message}`).join(", "));return f.value}{let f=a;return"string"==typeof a&&"color"===u.type&&(f=Ln.parse(a)),{kind:"constant",evaluate:()=>f}}}(void 0===i?e.specification.default:i,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,i,a){return this.property.possiblyEvaluate(this,e,i,a)}}class oe{constructor(e){this.property=e,this.value=new Q(e,void 0)}transitioned(e,i){return new re(this.property,this.value,i,Gt({},e.transition,this.transition),e.now)}untransitioned(){return new re(this.property,this.value,null,{},0)}}class ie{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return wn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new oe(this._values[e].property)),this._values[e].value=new Q(this._values[e].property,null===i?void 0:wn(i))}getTransition(e){return wn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new oe(this._values[e].property)),this._values[e].transition=wn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);void 0!==a&&(e[i]=a);const u=this.getTransition(i);void 0!==u&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const a=new pe(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,i._values[u]);return a}untransitioned(){const e=new pe(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class re{constructor(e,i,a,u,f){const g=u.delay||0,x=u.duration||0;f=f||0,this.property=e,this.value=i,this.begin=f+g,this.end=this.begin+x,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,i,a){const u=e.now||0,f=this.value.possiblyEvaluate(e,i,a),g=this.prior;if(g){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return g.possiblyEvaluate(e,i,a);{const x=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,i,a),f,Ot(x))}}return f}}class pe{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,a){const u=new _e(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,a);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class se{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return wn(this._values[e].value)}setValue(e,i){this._values[e]=new Q(this._values[e].property,null===i?void 0:wn(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);void 0!==a&&(e[i]=a)}return e}possiblyEvaluate(e,i,a){const u=new _e(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,a);return u}}class me{constructor(e,i,a){this.property=e,this.value=i,this.parameters=a}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,i,a,u){return this.property.evaluate(this.value,this.parameters,e,i,a,u)}}class _e{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class le{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,a){const u=fo[this.specification.type];return u?u(e,i,a):e}}class ye{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,a,u){return new me(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(i,null,{},a,u)}:e.expression,i)}interpolate(e,i,a){if("constant"!==e.value.kind||"constant"!==i.value.kind)return e;if(void 0===e.value.value||void 0===i.value.value)return new me(this,{kind:"constant",value:void 0},e.parameters);const u=fo[this.specification.type];return u?new me(this,{kind:"constant",value:u(e.value.value,i.value.value,a)},e.parameters):e}evaluate(e,i,a,u,f,g){return"constant"===e.kind?e.value:e.evaluate(i,a,u,f,g)}}class Ee extends ye{possiblyEvaluate(e,i,a,u){if(void 0===e.value)return new me(this,{kind:"constant",value:void 0},i);if("constant"===e.expression.kind){const f=e.expression.evaluate(i,null,{},a,u),g="resolvedImage"===e.property.specification.type&&"string"!=typeof f?f.name:f,x=this._calculate(g,g,g,i);return new me(this,{kind:"constant",value:x},i)}if("camera"===e.expression.kind){const f=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new me(this,{kind:"constant",value:f},i)}return new me(this,e.expression,i)}evaluate(e,i,a,u,f,g){if("source"===e.kind){const x=e.evaluate(i,a,u,f,g);return this._calculate(x,x,x,i)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},a,u),e.evaluate({zoom:Math.floor(i.zoom)},a,u),e.evaluate({zoom:Math.floor(i.zoom)+1},a,u),i):e.value}_calculate(e,i,a,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i,other:a}:{from:a,to:i,other:e}}interpolate(e){return e}}class Ze{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,u){if(void 0!==e.value){if("constant"===e.expression.kind){const f=e.expression.evaluate(i,null,{},a,u);return this._calculate(f,f,f,i)}return this._calculate(e.expression.evaluate(new j(Math.floor(i.zoom-1),i)),e.expression.evaluate(new j(Math.floor(i.zoom),i)),e.expression.evaluate(new j(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,a,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:a,to:i}}interpolate(e){return e}}class Ge{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,u){return!!e.expression.evaluate(i,null,{},a,u)}interpolate(){return!1}}class tt{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const a=e[i];a.specification.overridable&&this.overridableProperties.push(i);const u=this.defaultPropertyValues[i]=new Q(a,void 0),f=this.defaultTransitionablePropertyValues[i]=new oe(a);this.defaultTransitioningPropertyValues[i]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=u.possiblyEvaluate({})}}}function nt(n,e){return 256*(n=At(Math.floor(n),0,255))+At(Math.floor(e),0,255)}Bt("DataDrivenProperty",ye),Bt("DataConstantProperty",le),Bt("CrossFadedDataDrivenProperty",Ee),Bt("CrossFadedProperty",Ze),Bt("ColorRampProperty",Ge);const xt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Xe{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Et{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ne(n,e=1){let i=0,a=0;return{members:n.map(u=>{const f=xt[u.type].BYTES_PER_ELEMENT,g=i=St(i,Math.max(e,f)),x=u.components||1;return a=Math.max(a,f),i+=f*x,{name:u.name,type:u.type,components:x,offset:g}}),size:St(i,Math.max(a,e)),alignment:e}}function St(n,e){return Math.ceil(n/e)*e}class jt extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=a,e}}jt.prototype.bytesPerElement=4,Bt("StructArrayLayout2i4",jt);class un extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,u)}emplace(e,i,a,u,f){const g=4*e;return this.int16[g+0]=i,this.int16[g+1]=a,this.int16[g+2]=u,this.int16[g+3]=f,e}}un.prototype.bytesPerElement=8,Bt("StructArrayLayout4i8",un);class mn extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,a,u,f,g,x)}emplace(e,i,a,u,f,g,x,b){const D=6*e,A=12*e,P=3*e;return this.int16[D+0]=i,this.int16[D+1]=a,this.uint8[A+4]=u,this.uint8[A+5]=f,this.uint8[A+6]=g,this.uint8[A+7]=x,this.float32[P+2]=b,e}}mn.prototype.bytesPerElement=12,Bt("StructArrayLayout2i4ub1f12",mn);class yn extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,a)}emplace(e,i,a,u){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=a,this.float32[f+2]=u,e}}yn.prototype.bytesPerElement=12,Bt("StructArrayLayout3f12",yn);class hn extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,g,x,b,D,A){const P=this.length;return this.resize(P+1),this.emplace(P,e,i,a,u,f,g,x,b,D,A)}emplace(e,i,a,u,f,g,x,b,D,A,P){const F=10*e;return this.uint16[F+0]=i,this.uint16[F+1]=a,this.uint16[F+2]=u,this.uint16[F+3]=f,this.uint16[F+4]=g,this.uint16[F+5]=x,this.uint16[F+6]=b,this.uint16[F+7]=D,this.uint16[F+8]=A,this.uint16[F+9]=P,e}}hn.prototype.bytesPerElement=20,Bt("StructArrayLayout10ui20",hn);class nn extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,g,x,b){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,a,u,f,g,x,b)}emplace(e,i,a,u,f,g,x,b,D){const A=8*e;return this.uint16[A+0]=i,this.uint16[A+1]=a,this.uint16[A+2]=u,this.uint16[A+3]=f,this.uint16[A+4]=g,this.uint16[A+5]=x,this.uint16[A+6]=b,this.uint16[A+7]=D,e}}nn.prototype.bytesPerElement=16,Bt("StructArrayLayout8ui16",nn);class An extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,g,x,b,D,A,P,F,$,H,ee,ue){const fe=this.length;return this.resize(fe+1),this.emplace(fe,e,i,a,u,f,g,x,b,D,A,P,F,$,H,ee,ue)}emplace(e,i,a,u,f,g,x,b,D,A,P,F,$,H,ee,ue,fe){const ve=16*e;return this.int16[ve+0]=i,this.int16[ve+1]=a,this.int16[ve+2]=u,this.int16[ve+3]=f,this.uint16[ve+4]=g,this.uint16[ve+5]=x,this.uint16[ve+6]=b,this.uint16[ve+7]=D,this.int16[ve+8]=A,this.int16[ve+9]=P,this.int16[ve+10]=F,this.int16[ve+11]=$,this.int16[ve+12]=H,this.int16[ve+13]=ee,this.int16[ve+14]=ue,this.int16[ve+15]=fe,e}}An.prototype.bytesPerElement=32,Bt("StructArrayLayout4i4ui4i4i32",An);class Dn extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Dn.prototype.bytesPerElement=4,Bt("StructArrayLayout1ul4",Dn);class si extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,g,x,b,D,A,P,F,$){const H=this.length;return this.resize(H+1),this.emplace(H,e,i,a,u,f,g,x,b,D,A,P,F,$)}emplace(e,i,a,u,f,g,x,b,D,A,P,F,$,H){const ee=20*e,ue=10*e;return this.int16[ee+0]=i,this.int16[ee+1]=a,this.int16[ee+2]=u,this.int16[ee+3]=f,this.int16[ee+4]=g,this.float32[ue+3]=x,this.float32[ue+4]=b,this.float32[ue+5]=D,this.float32[ue+6]=A,this.int16[ee+14]=P,this.uint32[ue+8]=F,this.uint16[ee+18]=$,this.uint16[ee+19]=H,e}}si.prototype.bytesPerElement=40,Bt("StructArrayLayout5i4f1i1ul2ui40",si);class so extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,a,u,f,g,x)}emplace(e,i,a,u,f,g,x,b){const D=8*e;return this.int16[D+0]=i,this.int16[D+1]=a,this.int16[D+2]=u,this.int16[D+4]=f,this.int16[D+5]=g,this.int16[D+6]=x,this.int16[D+7]=b,e}}so.prototype.bytesPerElement=16,Bt("StructArrayLayout3i2i2i16",so);class Fi extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,a,u,f)}emplace(e,i,a,u,f,g){const x=4*e,b=8*e;return this.float32[x+0]=i,this.float32[x+1]=a,this.float32[x+2]=u,this.int16[b+6]=f,this.int16[b+7]=g,e}}Fi.prototype.bytesPerElement=16,Bt("StructArrayLayout2f1f2i16",Fi);class Ci extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,u)}emplace(e,i,a,u,f){const g=12*e,x=3*e;return this.uint8[g+0]=i,this.uint8[g+1]=a,this.float32[x+1]=u,this.float32[x+2]=f,e}}Ci.prototype.bytesPerElement=12,Bt("StructArrayLayout2ub2f12",Ci);class mi extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,a)}emplace(e,i,a,u){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=a,this.uint16[f+2]=u,e}}mi.prototype.bytesPerElement=6,Bt("StructArrayLayout3ui6",mi);class ea extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,g,x,b,D,A,P,F,$,H,ee,ue,fe,ve,Te,Se,Ie){const Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,e,i,a,u,f,g,x,b,D,A,P,F,$,H,ee,ue,fe,ve,Te,Se,Ie)}emplace(e,i,a,u,f,g,x,b,D,A,P,F,$,H,ee,ue,fe,ve,Te,Se,Ie,Pe){const Ye=30*e,We=15*e,It=60*e;return this.int16[Ye+0]=i,this.int16[Ye+1]=a,this.int16[Ye+2]=u,this.float32[We+2]=f,this.float32[We+3]=g,this.uint16[Ye+8]=x,this.uint16[Ye+9]=b,this.uint32[We+5]=D,this.uint32[We+6]=A,this.uint32[We+7]=P,this.uint16[Ye+16]=F,this.uint16[Ye+17]=$,this.uint16[Ye+18]=H,this.float32[We+10]=ee,this.float32[We+11]=ue,this.uint8[It+48]=fe,this.uint8[It+49]=ve,this.uint8[It+50]=Te,this.uint32[We+13]=Se,this.int16[Ye+28]=Ie,this.uint8[It+58]=Pe,e}}ea.prototype.bytesPerElement=60,Bt("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",ea);class As extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,g,x,b,D,A,P,F,$,H,ee,ue,fe,ve,Te,Se,Ie,Pe,Ye,We,It,ct,Qe,ht,pt,ot){const kt=this.length;return this.resize(kt+1),this.emplace(kt,e,i,a,u,f,g,x,b,D,A,P,F,$,H,ee,ue,fe,ve,Te,Se,Ie,Pe,Ye,We,It,ct,Qe,ht,pt,ot)}emplace(e,i,a,u,f,g,x,b,D,A,P,F,$,H,ee,ue,fe,ve,Te,Se,Ie,Pe,Ye,We,It,ct,Qe,ht,pt,ot,kt){const Nt=38*e,Sn=19*e;return this.int16[Nt+0]=i,this.int16[Nt+1]=a,this.int16[Nt+2]=u,this.float32[Sn+2]=f,this.float32[Sn+3]=g,this.int16[Nt+8]=x,this.int16[Nt+9]=b,this.int16[Nt+10]=D,this.int16[Nt+11]=A,this.int16[Nt+12]=P,this.int16[Nt+13]=F,this.uint16[Nt+14]=$,this.uint16[Nt+15]=H,this.uint16[Nt+16]=ee,this.uint16[Nt+17]=ue,this.uint16[Nt+18]=fe,this.uint16[Nt+19]=ve,this.uint16[Nt+20]=Te,this.uint16[Nt+21]=Se,this.uint16[Nt+22]=Ie,this.uint16[Nt+23]=Pe,this.uint16[Nt+24]=Ye,this.uint16[Nt+25]=We,this.uint16[Nt+26]=It,this.uint16[Nt+27]=ct,this.uint16[Nt+28]=Qe,this.uint32[Sn+15]=ht,this.float32[Sn+16]=pt,this.float32[Sn+17]=ot,this.float32[Sn+18]=kt,e}}As.prototype.bytesPerElement=76,Bt("StructArrayLayout3i2f6i15ui1ul3f76",As);class ur extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}ur.prototype.bytesPerElement=4,Bt("StructArrayLayout1f4",ur);class Cr extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,a)}emplace(e,i,a,u){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=a,this.int16[f+2]=u,e}}Cr.prototype.bytesPerElement=6,Bt("StructArrayLayout3i6",Cr);class Xn extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,u)}emplace(e,i,a,u,f){const g=6*e;return this.uint32[3*e+0]=i,this.uint16[g+2]=a,this.uint16[g+3]=u,this.uint16[g+4]=f,e}}Xn.prototype.bytesPerElement=12,Bt("StructArrayLayout1ul3ui12",Xn);class hr extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=a,e}}hr.prototype.bytesPerElement=4,Bt("StructArrayLayout2ui4",hr);class Zi extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Zi.prototype.bytesPerElement=2,Bt("StructArrayLayout1ui2",Zi);class Tr extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=a,e}}Tr.prototype.bytesPerElement=8,Bt("StructArrayLayout2f8",Tr);class go extends Et{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,u)}emplace(e,i,a,u,f){const g=4*e;return this.float32[g+0]=i,this.float32[g+1]=a,this.float32[g+2]=u,this.float32[g+3]=f,e}}go.prototype.bytesPerElement=16,Bt("StructArrayLayout4f16",go);class Ea extends Xe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ea.prototype.size=40;class _o extends si{get(e){return new Ea(this,e)}}Bt("CollisionBoxArray",_o);class Da extends Xe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Da.prototype.size=60;class Bu extends ea{get(e){return new Da(this,e)}}Bt("PlacedSymbolArray",Bu);class ta extends Xe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ta.prototype.size=76;class Ps extends As{get(e){return new ta(this,e)}}Bt("SymbolInstanceArray",Ps);class Nu extends ur{getoffsetX(e){return this.float32[1*e+0]}}Bt("GlyphOffsetArray",Nu);class yc extends Cr{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Bt("SymbolLineVertexArray",yc);class Kl extends Xe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Kl.prototype.size=12;class tf extends Xn{get(e){return new Kl(this,e)}}Bt("FeatureIndexArray",tf);class Kp extends Xe{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Kp.prototype.size=4;class nf extends hr{get(e){return new Kp(this,e)}}Bt("FillExtrusionCentroidArray",nf);const Qp=Ne([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Jp=Ne([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Qc=Cn(function(n){n.exports=function(e,i){var a,u,f,g,x,b,D,A;for(u=e.length-(a=3&e.length),f=i,x=3432918353,b=461845907,A=0;A<u;)D=255&e.charCodeAt(A)|(255&e.charCodeAt(++A))<<8|(255&e.charCodeAt(++A))<<16|(255&e.charCodeAt(++A))<<24,++A,f=27492+(65535&(g=5*(65535&(f=(f^=D=(65535&(D=(D=(65535&D)*x+(((D>>>16)*x&65535)<<16)&4294967295)<<15|D>>>17))*b+(((D>>>16)*b&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(D=0,a){case 3:D^=(255&e.charCodeAt(A+2))<<16;case 2:D^=(255&e.charCodeAt(A+1))<<8;case 1:f^=D=(65535&(D=(D=(65535&(D^=255&e.charCodeAt(A)))*x+(((D>>>16)*x&65535)<<16)&4294967295)<<15|D>>>17))*b+(((D>>>16)*b&65535)<<16)&4294967295}return f^=e.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}}),Ah=Cn(function(n){n.exports=function(e,i){for(var a,u=e.length,f=i^u,g=0;u>=4;)a=1540483477*(65535&(a=255&e.charCodeAt(g)|(255&e.charCodeAt(++g))<<8|(255&e.charCodeAt(++g))<<16|(255&e.charCodeAt(++g))<<24))+((1540483477*(a>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++g;switch(u){case 3:f^=(255&e.charCodeAt(g+2))<<16;case 2:f^=(255&e.charCodeAt(g+1))<<8;case 1:f=1540483477*(65535&(f^=255&e.charCodeAt(g)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}}),Ca=Qc,em=Ah;Ca.murmur3=Qc,Ca.murmur2=em;class Uu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,a,u){this.ids.push(tm(e)),this.positions.push(i,a,u)}getPositions(e){const i=tm(e);let a=0,u=this.ids.length-1;for(;a<u;){const g=a+u>>1;this.ids[g]>=i?u=g:a=g+1}const f=[];for(;this.ids[a]===i;)f.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return f}static serialize(e,i){const a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return vc(a,u,0,a.length-1),i&&i.push(a.buffer,u.buffer),{ids:a,positions:u}}static deserialize(e){const i=new Uu;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function tm(n){const e=+n;return!isNaN(e)&&e<=lt?e:Ca(String(n))}function vc(n,e,i,a){for(;i<a;){const u=n[i+a>>1];let f=i-1,g=a+1;for(;;){do{f++}while(n[f]<u);do{g--}while(n[g]>u);if(f>=g)break;xc(n,f,g),xc(e,3*f,3*g),xc(e,3*f+1,3*g+1),xc(e,3*f+2,3*g+2)}g-i<a-g?(vc(n,e,i,g),i=g+1):(vc(n,e,g+1,a),a=g)}}function xc(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}Bt("FeaturePositionMap",Uu);class Ta{constructor(e,i){this.gl=e.gl,this.location=i}}class Jc extends Ta{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Ph extends Ta{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class kh extends Ta{constructor(e,i){super(e,i),this.current=Ln.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const nm=new Float32Array(16),rm=new Float32Array(9),im=new Float32Array(4);function Rh(n){return[nt(255*n.r,255*n.g),nt(255*n.b,255*n.a)]}class eu{constructor(e,i,a){this.value=e,this.uniformNames=i.map(u=>`u_${u}`),this.type=a}setUniform(e,i,a){e.set(a.constantOr(this.value))}getBinding(e,i,a){return"color"===this.type?new kh(e,i):new Jc(e,i)}}class ms{constructor(e,i){this.uniformNames=i.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tl.concat(i.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,i,a,u){const f="u_pattern_to"===u||"u_dash_to"===u?this.patternTo:"u_pattern_from"===u||"u_dash_from"===u?this.patternFrom:"u_pixel_ratio_to"===u?this.pixelRatioTo:"u_pixel_ratio_from"===u?this.pixelRatioFrom:null;f&&e.set(f)}getBinding(e,i,a){return"u_pattern_from"===a||"u_pattern_to"===a||"u_dash_from"===a||"u_dash_to"===a?new Ph(e,i):new Jc(e,i)}}class gs{constructor(e,i,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===a?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,i,a,u,f,g){const x=this.paintVertexArray.length,b=this.expression.evaluate(new j(0),i,{},f,u,g);this.paintVertexArray.resize(e),this._setPaintValue(x,e,b)}updatePaintArray(e,i,a,u,f){const g=this.expression.evaluate({zoom:0},a,u,void 0,f);this._setPaintValue(e,i,g)}_setPaintValue(e,i,a){if("color"===this.type){const u=Rh(a);for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class na{constructor(e,i,a,u,f,g){this.expression=e,this.uniformNames=i.map(x=>`u_${x}_t`),this.type=a,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===a?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,i,a,u,f,g){const x=this.expression.evaluate(new j(this.zoom),i,{},f,u,g),b=this.expression.evaluate(new j(this.zoom+1),i,{},f,u,g),D=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(D,e,x,b)}updatePaintArray(e,i,a,u,f){const g=this.expression.evaluate({zoom:this.zoom},a,u,void 0,f),x=this.expression.evaluate({zoom:this.zoom+1},a,u,void 0,f);this._setPaintValue(e,i,g,x)}_setPaintValue(e,i,a,u){if("color"===this.type){const f=Rh(a),g=Rh(u);for(let x=e;x<i;x++)this.paintVertexArray.emplace(x,f[0],f[1],g[0],g[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const a=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,u=At(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,i,a){return new Jc(e,i)}}class Ql{constructor(e,i,a,u,f,g,x){this.expression=e,this.type=a,this.useIntegerZoom=u,this.zoom=f,this.layerId=x,this.paintVertexAttributes=("array"===a?Jp:Qp).members;for(let b=0;b<i.length;++b);this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(e,i,a){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(e,i,a,u,f,g){this._setPaintValues(e,i,a.patterns&&a.patterns[this.layerId],g)}_setPaintValues(e,i,a,u){if(!u||!a)return;const{min:f,mid:g,max:x}=a,b=u[f],D=u[g],A=u[x];if(b&&D&&A)for(let P=e;P<i;P++)this._setPaintValue(this.zoomInPaintVertexArray,P,D,b),this._setPaintValue(this.zoomOutPaintVertexArray,P,D,A)}_setPaintValue(e,i,a,u){e.emplace(i,a.tl[0],a.tl[1],a.br[0],a.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],a.pixelRatio,u.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Tl{constructor(e,i,a=(()=>!0)){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){if(!a(f))continue;const g=e.paint.get(f);if(!(g instanceof me&&Wo(g.property.specification)))continue;const x=t_(f,e.type),b=g.value,D=g.property.specification.type,A=g.property.useIntegerZoom,P=g.property.specification["property-type"],F="cross-faded"===P||"cross-faded-data-driven"===P,$="line-dasharray"===String(f)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==b.kind||$)if("source"===b.kind||$||F){const H=of(f,D,"source");this.binders[f]=F?new Ql(b,x,D,A,i,H,e.id):new gs(b,x,D,H),u.push(`/a_${f}`)}else{const H=of(f,D,"composite");this.binders[f]=new na(b,x,D,A,i,H),u.push(`/z_${f}`)}else this.binders[f]=F?new ms(b.value,x):new eu(b.value,x,D),u.push(`/u_${f}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof gs||i instanceof na?i.maxValue:0}populatePaintArrays(e,i,a,u,f,g){for(const x in this.binders){const b=this.binders[x];(b instanceof gs||b instanceof na||b instanceof Ql)&&b.populatePaintArray(e,i,a,u,f,g)}}setConstantPatternPositions(e,i){for(const a in this.binders){const u=this.binders[a];u instanceof ms&&u.setConstantPatternPositions(e,i)}}updatePaintArrays(e,i,a,u,f,g){let x=!1;for(const b in e){const D=i.getPositions(b);for(const A of D){const P=a.feature(A.index);for(const F in this.binders){const $=this.binders[F];if(($ instanceof gs||$ instanceof na||$ instanceof Ql)&&!0===$.expression.isStateDependent){const H=u.paint.get(F);$.expression=H.value,$.updatePaintArray(A.start,A.end,P,e[b],f,g),x=!0}}}}return x}defines(){const e=[];for(const i in this.binders){const a=this.binders[i];(a instanceof eu||a instanceof ms)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof gs||a instanceof na||a instanceof Ql)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof eu||a instanceof ms||a instanceof na)for(const u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const a=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof eu||f instanceof ms||f instanceof na)for(const g of f.uniformNames)if(i[g]){const x=f.getBinding(e,i[g],g);a.push({name:g,property:u,binding:x})}}return a}setUniforms(e,i,a,u){for(const{name:f,property:g,binding:x}of i)this.binders[g].setUniform(x,u,a.get(g),f)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const a=this.binders[i];if(e&&a instanceof Ql){const u=2===e.fromScale?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(a instanceof gs||a instanceof na)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const i in this.binders){const a=this.binders[i];(a instanceof gs||a instanceof na||a instanceof Ql)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof gs||i instanceof na||i instanceof Ql)&&i.destroy()}}}class bc{constructor(e,i,a=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Tl(u,i,a);this.needsUpload=!1,this._featureMap=new Uu,this._bufferOffset=0}populatePaintArrays(e,i,a,u,f,g,x){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,i,u,f,g,x);void 0!==i.id&&this._featureMap.add(i.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,a,u,f){for(const g of a)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,i,g,u,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const e_={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function t_(n,e){return e_[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const rf={"line-pattern":{source:hn,composite:hn},"fill-pattern":{source:hn,composite:hn},"fill-extrusion-pattern":{source:hn,composite:hn},"line-dasharray":{source:nn,composite:nn}},om={color:{source:Tr,composite:go},number:{source:ur,composite:Tr}};function of(n,e,i){const a=rf[n];return a&&a[i]||om[e][i]}Bt("ConstantBinder",eu),Bt("CrossFadedConstantBinder",ms),Bt("SourceExpressionBinder",gs),Bt("CrossFadedCompositeBinder",Ql),Bt("CompositeExpressionBinder",na),Bt("ProgramConfiguration",Tl,{omit:["_buffers"]}),Bt("ProgramConfigurationSet",bc);const Vu="-transition";class ra extends vt{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new se(i.layout)),i.paint)){this._transitionablePaint=new ie(i.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _e(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,a={}){null!=i&&this._validate(Js,`layers.${this.id}.layout.${e}`,e,i,a)||("visibility"!==e?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return _t(e,Vu)?this._transitionablePaint.getTransition(e.slice(0,-Vu.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,a={}){if(null!=i&&this._validate(El,`layers.${this.id}.paint.${e}`,e,i,a))return!1;if(_t(e,Vu))return this._transitionablePaint.setTransition(e.slice(0,-Vu.length),i||void 0),!1;{const u=this._transitionablePaint._values[e],f="cross-faded-data-driven"===u.property.specification["property-type"],g=u.value.isDataDriven(),x=u.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value;return b.isDataDriven()||g||f||this._handleOverridablePaintPropertyUpdate(e,x,b)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),tn(e,(i,a)=>!(void 0===i||"layout"===a&&!Object.keys(i).length||"paint"===a&&!Object.keys(i).length))}_validate(e,i,a,u,f={}){return(!f||!1!==f.validate)&&Dl(this,e.call(hs,{key:i,layerType:this.type,objectKey:a,value:u,styleSpec:W,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof me&&Wo(i.property.specification)&&("source"===i.value.kind||"composite"===i.value.kind)&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ya(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const n_=Ne([{name:"a_pos",components:2,type:"Int16"}],4),{members:sm}=n_;class gi{constructor(e=[]){this.segments=e}prepareSegment(e,i,a,u){let f=this.segments[this.segments.length-1];return e>gi.MAX_VERTEX_ARRAY_LENGTH&&zt(`Max vertices per segment is ${gi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>gi.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:i.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},void 0!==u&&(f.sortKey=u),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,a,u){return new gi([{vertexOffset:e,primitiveOffset:i,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}gi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Bt("SegmentVector",gi);var Yn=8192;class Mo{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof dr?new dr(e.lng,e.lat):dr.convert(e),this}setSouthWest(e){return this._sw=e instanceof dr?new dr(e.lng,e.lat):dr.convert(e),this}extend(e){const i=this._sw,a=this._ne;let u,f;if(e instanceof dr)u=e,f=e;else{if(!(e instanceof Mo))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Mo.convert(e)):this.extend(dr.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return i||a?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),a.lng=Math.max(f.lng,a.lng),a.lat=Math.max(f.lat,a.lat)):(this._sw=new dr(u.lng,u.lat),this._ne=new dr(f.lng,f.lat)),this}getCenter(){return new dr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new dr(this.getWest(),this.getNorth())}getSouthEast(){return new dr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=dr.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(e){return!e||e instanceof Mo?e:new Mo(e)}}const wc=6371008.8;class dr{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new dr(ft(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,a=this.lat*i,u=e.lat*i,f=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return wc*Math.acos(Math.min(f,1))}toBounds(e=0){const i=360*e/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new Mo(new dr(this.lng-a,this.lat-i),new dr(this.lng+a,this.lat+i))}static convert(e){if(e instanceof dr)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new dr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new dr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Lh=2*Math.PI*wc;function Fh(n){return Lh*Math.cos(n*Math.PI/180)}function sf(n){return(180+n)/360}function af(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function lf(n,e){return n/Fh(e)}function Ja(n){return 360*n-180}function ks(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function tu(n,e){return n*Fh(ks(e))}const Jl=85.051129;class Oh{constructor(e,i,a=0){this.x=+e,this.y=+i,this.z=+a}static fromLngLat(e,i=0){const a=dr.convert(e);return new Oh(sf(a.lng),af(a.lat),lf(i,a.lat))}toLngLat(){return new dr(Ja(this.x),ks(this.y))}toAltitude(){return tu(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Lh*(e=ks(this.y),1/Math.cos(e*Math.PI/180));var e}}function ju(n,e,i,a,u,f,g,x,b){const D=(e+a)/2,A=(i+u)/2,P=new Ve(D,A);x(P),function(F,$,H,ee,ue,fe){const ve=H-ue,Te=ee-fe;return Math.abs((ee-$)*ve-(H-F)*Te)/Math.hypot(ve,Te)}(P.x,P.y,f.x,f.y,g.x,g.y)>=b?(ju(n,e,i,D,A,f,P,x,b),ju(n,D,A,a,u,P,g,x,b)):n.push(g)}function am(n,e,i){const a=[];let u,f,g;for(const x of n){const{x:b,y:D}=x;e(x),g?ju(a,u,f,b,D,g,x,e,i):a.push(x),u=b,f=D,g=x}return a}const zh=Math.pow(2,14)-1,cf=-zh-1;function lm(n,e){const i=Math.round(n.x*e),a=Math.round(n.y*e);return n.x=At(i,cf,zh),n.y=At(a,cf,zh),(i<n.x||i>n.x+1||a<n.y||a>n.y+1)&&zt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Sa(n,e,i){const a=n.loadGeometry(),u=n.extent,f=Yn/u;if(e&&i&&"mercator"!==i.projection.name){const g=1<<e.z,{scale:x,x:b,y:D,projection:A}=i,P=F=>{const $=Ja((e.x+F.x/u)/g),H=ks((e.y+F.y/u)/g),ee=A.project($,H);F.x=(ee.x*x-b)*u,F.y=(ee.y*x-D)*u};for(let F=0;F<a.length;F++)if(1!==n.type)a[F]=am(a[F],P,1);else{const $=[];for(const H of a[F])H.x<0||H.x>=u||H.y<0||H.y>=u||(P(H),$.push(H));a[F]=$}}for(const g of a)for(const x of g)lm(x,f);return a}function Ia(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Sa(n):[]}}function $u(n,e,i,a,u){n.emplaceBack(2*e+(a+1)/2,2*i+(u+1)/2)}class nu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new jt,this.indexArray=new mi,this.segments=new gi,this.programConfigurations=new bc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a,u){const f=this.layers[0],g=[];let x=null;"circle"===f.type&&(x=f.layout.get("circle-sort-key"));for(const{feature:b,id:D,index:A,sourceLayerIndex:P}of e){const F=this.layers[0]._featureFilter.needGeometry,$=Ia(b,F);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),$,a))continue;const H=x?x.evaluate($,{},a):void 0,ee={id:D,properties:b.properties,type:b.type,sourceLayerIndex:P,index:A,geometry:F?$.geometry:Sa(b,a,u),patterns:{},sortKey:H};g.push(ee)}x&&g.sort((b,D)=>b.sortKey-D.sortKey);for(const b of g){const{geometry:D,index:A,sourceLayerIndex:P}=b,F=e[A].feature;this.addFeature(b,D,A,i.availableImages,a),i.featureIndex.insert(F,D,A,P,this.index)}}update(e,i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sm),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,u,f){for(const g of i)for(const x of g){const b=x.x,D=x.y;if(b<0||b>=Yn||D<0||D>=Yn)continue;const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=A.vertexLength;$u(this.layoutVertexArray,b,D,-1,-1),$u(this.layoutVertexArray,b,D,1,-1),$u(this.layoutVertexArray,b,D,1,1),$u(this.layoutVertexArray,b,D,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u,f)}}function uf(n,e){for(let i=0;i<n.length;i++)if(Ec(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Ec(n,e[i]))return!0;return!!ru(n,e)}function Oi(n,e,i){return!!Ec(n,e)||!!Bh(e,n,i)}function hf(n,e){if(1===n.length)return pf(e,n[0]);for(let i=0;i<e.length;i++){const a=e[i];for(let u=0;u<a.length;u++)if(Ec(n,a[u]))return!0}for(let i=0;i<n.length;i++)if(pf(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(ru(n,e[i]))return!0;return!1}function cm(n,e,i){if(n.length>1){if(ru(n,e))return!0;for(let a=0;a<e.length;a++)if(Bh(e[a],n,i))return!0}for(let a=0;a<n.length;a++)if(Bh(n[a],e,i))return!0;return!1}function ru(n,e){if(0===n.length||0===e.length)return!1;for(let i=0;i<n.length-1;i++){const a=n[i],u=n[i+1];for(let f=0;f<e.length-1;f++)if(df(a,u,e[f],e[f+1]))return!0}return!1}function df(n,e,i,a){return Zn(n,i,a)!==Zn(e,i,a)&&Zn(n,e,i)!==Zn(n,e,a)}function Bh(n,e,i){const a=i*i;if(1===e.length)return n.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if(ff(n,e[u-1],e[u])<a)return!0;return!1}function ff(n,e,i){const a=e.distSqr(i);if(0===a)return n.distSqr(e);const u=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/a;return n.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function pf(n,e){let i,a,u,f=!1;for(let g=0;g<n.length;g++){i=n[g];for(let x=0,b=i.length-1;x<i.length;b=x++)a=i[x],u=i[b],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(f=!f)}return f}function Ec(n,e){let i=!1;for(let a=0,u=n.length-1;a<n.length;u=a++){const f=n[a],g=n[u];f.y>e.y!=g.y>e.y&&e.x<(g.x-f.x)*(e.y-f.y)/(g.y-f.y)+f.x&&(i=!i)}return i}function mf(n,e,i,a,u){for(const g of n)if(e<=g.x&&i<=g.y&&a>=g.x&&u>=g.y)return!0;const f=[new Ve(e,i),new Ve(e,u),new Ve(a,u),new Ve(a,i)];if(n.length>2)for(const g of f)if(Ec(n,g))return!0;for(let g=0;g<n.length-1;g++)if(r_(n[g],n[g+1],f))return!0;return!1}function r_(n,e,i){const a=i[0],u=i[2];if(n.x<a.x&&e.x<a.x||n.x>u.x&&e.x>u.x||n.y<a.y&&e.y<a.y||n.y>u.y&&e.y>u.y)return!1;const f=Zn(n,e,i[0]);return f!==Zn(n,e,i[1])||f!==Zn(n,e,i[2])||f!==Zn(n,e,i[3])}function iu(n,e,i){const a=e.paint.get(n).value;return"constant"===a.kind?a.value:i.programConfigurations.get(e.id).getMaxValue(n)}function Sl(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Ao(n,e,i,a,u){if(!e[0]&&!e[1])return n;const f=Ve.convert(e)._mult(u);"viewport"===i&&f._rotate(-a);const g=[];for(let x=0;x<n.length;x++)g.push(n[x].sub(f));return g}function Gu(n,e,i,a){const u=Ve.convert(n)._mult(a);return"viewport"===e&&u._rotate(-i),u}Bt("CircleBucket",nu,{omit:["layers"]});const gf=new tt({"circle-sort-key":new ye(W.layout_circle["circle-sort-key"])});var _f={paint:new tt({"circle-radius":new ye(W.paint_circle["circle-radius"]),"circle-color":new ye(W.paint_circle["circle-color"]),"circle-blur":new ye(W.paint_circle["circle-blur"]),"circle-opacity":new ye(W.paint_circle["circle-opacity"]),"circle-translate":new le(W.paint_circle["circle-translate"]),"circle-translate-anchor":new le(W.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new le(W.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new le(W.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ye(W.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ye(W.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ye(W.paint_circle["circle-stroke-opacity"])}),layout:gf},wr="undefined"!=typeof Float32Array?Float32Array:Array;function Dc(){var n=new wr(9);return wr!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function ou(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function yf(n,e,i){var a=e[0],u=e[1],f=e[2],g=e[3],x=e[4],b=e[5],D=e[6],A=e[7],P=e[8],F=e[9],$=e[10],H=e[11],ee=e[12],ue=e[13],fe=e[14],ve=e[15],Te=i[0],Se=i[1],Ie=i[2],Pe=i[3];return n[0]=Te*a+Se*x+Ie*P+Pe*ee,n[1]=Te*u+Se*b+Ie*F+Pe*ue,n[2]=Te*f+Se*D+Ie*$+Pe*fe,n[3]=Te*g+Se*A+Ie*H+Pe*ve,n[4]=(Te=i[4])*a+(Se=i[5])*x+(Ie=i[6])*P+(Pe=i[7])*ee,n[5]=Te*u+Se*b+Ie*F+Pe*ue,n[6]=Te*f+Se*D+Ie*$+Pe*fe,n[7]=Te*g+Se*A+Ie*H+Pe*ve,n[8]=(Te=i[8])*a+(Se=i[9])*x+(Ie=i[10])*P+(Pe=i[11])*ee,n[9]=Te*u+Se*b+Ie*F+Pe*ue,n[10]=Te*f+Se*D+Ie*$+Pe*fe,n[11]=Te*g+Se*A+Ie*H+Pe*ve,n[12]=(Te=i[12])*a+(Se=i[13])*x+(Ie=i[14])*P+(Pe=i[15])*ee,n[13]=Te*u+Se*b+Ie*F+Pe*ue,n[14]=Te*f+Se*D+Ie*$+Pe*fe,n[15]=Te*g+Se*A+Ie*H+Pe*ve,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var um=yf;function su(){var n=new wr(3);return wr!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function vf(n){return Math.hypot(n[0],n[1],n[2])}function ec(n,e,i){var a=new wr(3);return a[0]=n,a[1]=e,a[2]=i,a}function xf(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function Nh(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function bf(n,e,i,a){return n[0]=e[0]+i[0]*a,n[1]=e[1]+i[1]*a,n[2]=e[2]+i[2]*a,n}function wf(n,e){var i=e[0],a=e[1],u=e[2],f=i*i+a*a+u*u;return f>0&&(f=1/Math.sqrt(f)),n[0]=e[0]*f,n[1]=e[1]*f,n[2]=e[2]*f,n}function Hu(n,e,i){var a=i[0],u=i[1],f=i[2],g=e[0],x=e[1],b=e[2],D=u*b-f*x,A=f*g-a*b,P=a*x-u*g,F=u*P-f*A,$=f*D-a*P,H=a*A-u*D,ee=2*i[3];return A*=ee,P*=ee,$*=2,H*=2,n[0]=g+(D*=ee)+(F*=2),n[1]=x+A+$,n[2]=b+P+H,n}var au,n,hm=xf,Uh=Nh,dm=vf;function lu(n,e,i){var a=e[0],u=e[1],f=e[2],g=e[3];return n[0]=i[0]*a+i[4]*u+i[8]*f+i[12]*g,n[1]=i[1]*a+i[5]*u+i[9]*f+i[13]*g,n[2]=i[2]*a+i[6]*u+i[10]*f+i[14]*g,n[3]=i[3]*a+i[7]*u+i[11]*f+i[15]*g,n}function tc(){var n=new wr(4);return wr!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Ef(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Df(n,e,i){i*=.5;var a=e[0],u=e[1],f=e[2],g=e[3],x=Math.sin(i),b=Math.cos(i);return n[0]=a*b+g*x,n[1]=u*b+f*x,n[2]=f*b-u*x,n[3]=g*b-a*x,n}function Cf(n,e){return n[0]===e[0]&&n[1]===e[1]}function Tf(n,e,i,a,u,f,g,x,b){if(f&&n.queryGeometry.isAboveHorizon)return!1;f&&(b*=n.pixelToTileUnitsFactor);for(const D of e)for(const A of D){const P=A.add(x),F=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(P.x,P.y,!0):0,$=f?P:fm(P,F,a),H=f?n.tilespaceRays.map(ue=>mm(ue,F)):n.queryGeometry.screenGeometry,ee=lu([],[A.x,A.y,F,1],a);if(!g&&f?b*=ee[3]/i.cameraToCenterDistance:g&&!f&&(b*=i.cameraToCenterDistance/ee[3]),Oi(H,$,b))return!0}return!1}function fm(n,e,i){const a=lu([],[n.x,n.y,e,1],i);return new Ve(a[0]/a[3],a[1]/a[3])}su(),au=new wr(4),wr!=Float32Array&&(au[0]=0,au[1]=0,au[2]=0,au[3]=0),su(),ec(1,0,0),ec(0,1,0),tc(),tc(),Dc(),n=new wr(2),wr!=Float32Array&&(n[0]=0,n[1]=0);const Vh=ec(0,0,0),pm=ec(0,0,1);function mm(n,e){const i=su();return Vh[2]=e,n.intersectsPlane(Vh,pm,i),new Ve(i[0],i[1])}class Sf extends nu{}function jh(n,{width:e,height:i},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*a);return n.width=e,n.height=i,n.data=u,n}function $h(n,{width:e,height:i},a){if(e===n.width&&i===n.height)return;const u=jh({},{width:e,height:i},a);Gh(n,u,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,e),height:Math.min(n.height,i)},a),n.width=e,n.height=i,n.data=u.data}function Gh(n,e,i,a,u,f){if(0===u.width||0===u.height)return e;if(u.width>n.width||u.height>n.height||i.x>n.width-u.width||i.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const g=n.data,x=e.data;for(let b=0;b<u.height;b++){const D=((i.y+b)*n.width+i.x)*f,A=((a.y+b)*e.width+a.x)*f;for(let P=0;P<u.width*f;P++)x[A+P]=g[D+P]}return e}Bt("HeatmapBucket",Sf,{omit:["layers"]});class Il{constructor(e,i){jh(this,e,1,i)}resize(e){$h(this,e,1)}clone(){return new Il({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,u,f){Gh(e,i,a,u,f,1)}}class _s{constructor(e,i){jh(this,e,4,i)}resize(e){$h(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new _s({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,u,f){Gh(e,i,a,u,f,4)}}Bt("AlphaImage",Il),Bt("RGBAImage",_s);var Cc={paint:new tt({"heatmap-radius":new ye(W.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ye(W.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new le(W.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ge(W.paint_heatmap["heatmap-color"]),"heatmap-opacity":new le(W.paint_heatmap["heatmap-opacity"])})};function Rs(n){const e={},i=n.resolution||256,a=n.clips?n.clips.length:1,u=n.image||new _s({width:i,height:a}),f=(g,x,b)=>{e[n.evaluationKey]=b;const D=n.expression.evaluate(e);u.data[g+x+0]=Math.floor(255*D.r/D.a),u.data[g+x+1]=Math.floor(255*D.g/D.a),u.data[g+x+2]=Math.floor(255*D.b/D.a),u.data[g+x+3]=Math.floor(255*D.a)};if(n.clips)for(let g=0,x=0;g<a;++g,x+=4*i)for(let b=0,D=0;b<i;b++,D+=4){const A=b/(i-1),{start:P,end:F}=n.clips[g];f(x,D,P*(1-A)+F*A)}else for(let g=0,x=0;g<i;g++,x+=4)f(0,x,g/(i-1));return u}var i_={paint:new tt({"hillshade-illumination-direction":new le(W.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new le(W.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new le(W.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new le(W.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new le(W.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new le(W.paint_hillshade["hillshade-accent-color"])})};const o_=Ne([{name:"a_pos",components:2,type:"Int16"}],4),{members:If}=o_;var Hh=Tc,Ma=Tc;function Tc(n,e,i){i=i||2;var a,u,f,g,x,b,D,A=e&&e.length,P=A?e[0]*i:n.length,F=Zu(n,0,P,i,!0),$=[];if(!F||F.next===F.prev)return $;if(A&&(F=function(ee,ue,fe,ve){var Te,Se,Ie,Pe=[];for(Te=0,Se=ue.length;Te<Se;Te++)(Ie=Zu(ee,ue[Te]*ve,Te<Se-1?ue[Te+1]*ve:ee.length,ve,!1))===Ie.next&&(Ie.steiner=!0),Pe.push(Wh(Ie));for(Pe.sort(qh),Te=0;Te<Pe.length;Te++)fe=Ml(fe=Pf(Pe[Te],fe),fe.next);return fe}(n,e,F,i)),n.length>80*i){a=f=n[0],u=g=n[1];for(var H=i;H<P;H+=i)(x=n[H])<a&&(a=x),(b=n[H+1])<u&&(u=b),x>f&&(f=x),b>g&&(g=b);D=0!==(D=Math.max(f-a,g-u))?1/D:0}return Sc(F,$,i,a,u,D),$}function Zu(n,e,i,a,u){var f,g;if(u===hu(n,e,i,a)>0)for(f=e;f<i;f+=a)g=Xh(f,n[f],n[f+1],g);else for(f=i-a;f>=e;f-=a)g=Xh(f,n[f],n[f+1],g);return g&&qu(g,g.next)&&(rc(g),g=g.next),g}function Ml(n,e){if(!n)return n;e||(e=n);var i,a=n;do{if(i=!1,a.steiner||!qu(a,a.next)&&0!==Xr(a.prev,a,a.next))a=a.next;else{if(rc(a),(a=e=a.prev)===a.next)break;i=!0}}while(i||a!==e);return e}function Sc(n,e,i,a,u,f,g){if(n){!g&&f&&function(A,P,F,$){var H=A;do{null===H.z&&(H.z=Al(H.x,H.y,P,F,$)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next}while(H!==A);H.prevZ.nextZ=null,H.prevZ=null,function(ee){var ue,fe,ve,Te,Se,Ie,Pe,Ye,We=1;do{for(fe=ee,ee=null,Se=null,Ie=0;fe;){for(Ie++,ve=fe,Pe=0,ue=0;ue<We&&(Pe++,ve=ve.nextZ);ue++);for(Ye=We;Pe>0||Ye>0&&ve;)0!==Pe&&(0===Ye||!ve||fe.z<=ve.z)?(Te=fe,fe=fe.nextZ,Pe--):(Te=ve,ve=ve.nextZ,Ye--),Se?Se.nextZ=Te:ee=Te,Te.prevZ=Se,Se=Te;fe=ve}Se.nextZ=null,We*=2}while(Ie>1)}(H)}(n,a,u,f);for(var x,b,D=n;n.prev!==n.next;)if(x=n.prev,b=n.next,f?Mf(n,a,u,f):cu(n))e.push(x.i/i),e.push(n.i/i),e.push(b.i/i),rc(n),n=b.next,D=b.next;else if((n=b)===D){g?1===g?Sc(n=Af(Ml(n),e,i),e,i,a,u,f,2):2===g&&Zh(n,e,i,a,u,f):Sc(Ml(n),e,i,a,u,f,1);break}}}function cu(n){var e=n.prev,i=n,a=n.next;if(Xr(e,i,a)>=0)return!1;for(var u=n.next.next;u!==n.prev;){if(nc(e.x,e.y,i.x,i.y,a.x,a.y,u.x,u.y)&&Xr(u.prev,u,u.next)>=0)return!1;u=u.next}return!0}function Mf(n,e,i,a){var u=n.prev,f=n,g=n.next;if(Xr(u,f,g)>=0)return!1;for(var x=u.x>f.x?u.x>g.x?u.x:g.x:f.x>g.x?f.x:g.x,b=u.y>f.y?u.y>g.y?u.y:g.y:f.y>g.y?f.y:g.y,D=Al(u.x<f.x?u.x<g.x?u.x:g.x:f.x<g.x?f.x:g.x,u.y<f.y?u.y<g.y?u.y:g.y:f.y<g.y?f.y:g.y,e,i,a),A=Al(x,b,e,i,a),P=n.prevZ,F=n.nextZ;P&&P.z>=D&&F&&F.z<=A;){if(P!==n.prev&&P!==n.next&&nc(u.x,u.y,f.x,f.y,g.x,g.y,P.x,P.y)&&Xr(P.prev,P,P.next)>=0||(P=P.prevZ,F!==n.prev&&F!==n.next&&nc(u.x,u.y,f.x,f.y,g.x,g.y,F.x,F.y)&&Xr(F.prev,F,F.next)>=0))return!1;F=F.nextZ}for(;P&&P.z>=D;){if(P!==n.prev&&P!==n.next&&nc(u.x,u.y,f.x,f.y,g.x,g.y,P.x,P.y)&&Xr(P.prev,P,P.next)>=0)return!1;P=P.prevZ}for(;F&&F.z<=A;){if(F!==n.prev&&F!==n.next&&nc(u.x,u.y,f.x,f.y,g.x,g.y,F.x,F.y)&&Xr(F.prev,F,F.next)>=0)return!1;F=F.nextZ}return!0}function Af(n,e,i){var a=n;do{var u=a.prev,f=a.next.next;!qu(u,f)&&kf(u,a,a.next,f)&&uu(u,f)&&uu(f,u)&&(e.push(u.i/i),e.push(a.i/i),e.push(f.i/i),rc(a),rc(a.next),a=n=f),a=a.next}while(a!==n);return Ml(a)}function Zh(n,e,i,a,u,f){var g=n;do{for(var x=g.next.next;x!==g.prev;){if(g.i!==x.i&&gm(g,x)){var b=Rf(g,x);return g=Ml(g,g.next),b=Ml(b,b.next),Sc(g,e,i,a,u,f),void Sc(b,e,i,a,u,f)}x=x.next}g=g.next}while(g!==n)}function qh(n,e){return n.x-e.x}function Pf(n,e){var i=function(f,g){var x,b=g,D=f.x,A=f.y,P=-1/0;do{if(A<=b.y&&A>=b.next.y&&b.next.y!==b.y){var F=b.x+(A-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(F<=D&&F>P){if(P=F,F===D){if(A===b.y)return b;if(A===b.next.y)return b.next}x=b.x<b.next.x?b:b.next}}b=b.next}while(b!==g);if(!x)return null;if(D===P)return x;var $,H=x,ee=x.x,ue=x.y,fe=1/0;b=x;do{D>=b.x&&b.x>=ee&&D!==b.x&&nc(A<ue?D:P,A,ee,ue,A<ue?P:D,A,b.x,b.y)&&($=Math.abs(A-b.y)/(D-b.x),uu(b,f)&&($<fe||$===fe&&(b.x>x.x||b.x===x.x&&s_(x,b)))&&(x=b,fe=$)),b=b.next}while(b!==H);return x}(n,e);if(!i)return e;var a=Rf(i,n),u=Ml(i,i.next);return Ml(a,a.next),e===i?u:e}function s_(n,e){return Xr(n.prev,n,e.prev)<0&&Xr(e.next,n,n.next)<0}function Al(n,e,i,a,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-i)*u)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-a)*u)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Wh(n){var e=n,i=n;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==n);return i}function nc(n,e,i,a,u,f,g,x){return(u-g)*(e-x)-(n-g)*(f-x)>=0&&(n-g)*(a-x)-(i-g)*(e-x)>=0&&(i-g)*(f-x)-(u-g)*(a-x)>=0}function gm(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,a){var u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==a.i&&u.next.i!==a.i&&kf(u,u.next,i,a))return!0;u=u.next}while(u!==i);return!1}(n,e)&&(uu(n,e)&&uu(e,n)&&function(i,a){var u=i,f=!1,g=(i.x+a.x)/2,x=(i.y+a.y)/2;do{u.y>x!=u.next.y>x&&u.next.y!==u.y&&g<(u.next.x-u.x)*(x-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next}while(u!==i);return f}(n,e)&&(Xr(n.prev,n,e.prev)||Xr(n,e.prev,e))||qu(n,e)&&Xr(n.prev,n,n.next)>0&&Xr(e.prev,e,e.next)>0)}function Xr(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function qu(n,e){return n.x===e.x&&n.y===e.y}function kf(n,e,i,a){var u=Xu(Xr(n,e,i)),f=Xu(Xr(n,e,a)),g=Xu(Xr(i,a,n)),x=Xu(Xr(i,a,e));return u!==f&&g!==x||!(0!==u||!Wu(n,i,e))||!(0!==f||!Wu(n,a,e))||!(0!==g||!Wu(i,n,a))||!(0!==x||!Wu(i,e,a))}function Wu(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function Xu(n){return n>0?1:n<0?-1:0}function uu(n,e){return Xr(n.prev,n,n.next)<0?Xr(n,e,n.next)>=0&&Xr(n,n.prev,e)>=0:Xr(n,e,n.prev)<0||Xr(n,n.next,e)<0}function Rf(n,e){var i=new Yu(n.i,n.x,n.y),a=new Yu(e.i,e.x,e.y),u=n.next,f=e.prev;return n.next=e,e.prev=n,i.next=u,u.prev=i,a.next=i,i.prev=a,f.next=a,a.prev=f,a}function Xh(n,e,i,a){var u=new Yu(n,e,i);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function rc(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Yu(n,e,i){this.i=n,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function hu(n,e,i,a){for(var u=0,f=e,g=i-a;f<i;f+=a)u+=(n[g]-n[f])*(n[f+1]+n[g+1]),g=f;return u}function _m(n,e,i,a,u){Lf(n,e,i||0,a||n.length-1,u||Ff)}function Lf(n,e,i,a,u){for(;a>i;){if(a-i>600){var f=a-i+1,g=e-i+1,x=Math.log(f),b=.5*Math.exp(2*x/3),D=.5*Math.sqrt(x*b*(f-b)/f)*(g-f/2<0?-1:1);Lf(n,e,Math.max(i,Math.floor(e-g*b/f+D)),Math.min(a,Math.floor(e+(f-g)*b/f+D)),u)}var A=n[e],P=i,F=a;for(Ic(n,i,e),u(n[a],A)>0&&Ic(n,i,a);P<F;){for(Ic(n,P,F),P++,F--;u(n[P],A)<0;)P++;for(;u(n[F],A)>0;)F--}0===u(n[i],A)?Ic(n,i,F):Ic(n,++F,a),F<=e&&(i=F+1),e<=F&&(a=F-1)}}function Ic(n,e,i){var a=n[e];n[e]=n[i],n[i]=a}function Ff(n,e){return n<e?-1:n>e?1:0}function el(n,e){const i=n.length;if(i<=1)return[n];const a=[];let u,f;for(let g=0;g<i;g++){const x=Ui(n[g]);0!==x&&(n[g].area=Math.abs(x),void 0===f&&(f=x<0),f===x<0?(u&&a.push(u),u=[n[g]]):u.push(n[g]))}if(u&&a.push(u),e>1)for(let g=0;g<a.length;g++)a[g].length<=e||(_m(a[g],e,1,a[g].length-1,Of),a[g]=a[g].slice(0,e));return a}function Of(n,e){return e.area-n.area}function Ku(n,e,i){const a=i.patternDependencies;let u=!1;for(const f of e){const g=f.paint.get(`${n}-pattern`);g.isConstant()||(u=!0);const x=g.constantOr(null);x&&(u=!0,a[x.to]=!0,a[x.from]=!0)}return u}function Yh(n,e,i,a,u){const f=u.patternDependencies;for(const g of e){const x=g.paint.get(`${n}-pattern`).value;if("constant"!==x.kind){let b=x.evaluate({zoom:a-1},i,{},u.availableImages),D=x.evaluate({zoom:a},i,{},u.availableImages),A=x.evaluate({zoom:a+1},i,{},u.availableImages);b=b&&b.name?b.name:b,D=D&&D.name?D.name:D,A=A&&A.name?A.name:A,f[b]=!0,f[D]=!0,f[A]=!0,i.patterns[g.id]={min:b,mid:D,max:A}}}return i}Tc.deviation=function(n,e,i,a){var u=e&&e.length,f=Math.abs(hu(n,0,u?e[0]*i:n.length,i));if(u)for(var g=0,x=e.length;g<x;g++)f-=Math.abs(hu(n,e[g]*i,g<x-1?e[g+1]*i:n.length,i));var b=0;for(g=0;g<a.length;g+=3){var D=a[g]*i,A=a[g+1]*i,P=a[g+2]*i;b+=Math.abs((n[D]-n[P])*(n[A+1]-n[D+1])-(n[D]-n[A])*(n[P+1]-n[D+1]))}return 0===f&&0===b?0:Math.abs((b-f)/f)},Tc.flatten=function(n){for(var e=n[0][0].length,i={vertices:[],holes:[],dimensions:e},a=0,u=0;u<n.length;u++){for(var f=0;f<n[u].length;f++)for(var g=0;g<e;g++)i.vertices.push(n[u][f][g]);u>0&&i.holes.push(a+=n[u-1].length)}return i},Hh.default=Ma;class ic{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new jt,this.indexArray=new mi,this.indexArray2=new hr,this.programConfigurations=new bc(e.layers,e.zoom),this.segments=new gi,this.segments2=new gi,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a,u){this.hasPattern=Ku("fill",this.layers,i);const f=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:x,id:b,index:D,sourceLayerIndex:A}of e){const P=this.layers[0]._featureFilter.needGeometry,F=Ia(x,P);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),F,a))continue;const $=f?f.evaluate(F,{},a,i.availableImages):void 0,H={id:b,properties:x.properties,type:x.type,sourceLayerIndex:A,index:D,geometry:P?F.geometry:Sa(x,a,u),patterns:{},sortKey:$};g.push(H)}f&&g.sort((x,b)=>x.sortKey-b.sortKey);for(const x of g){const{geometry:b,index:D,sourceLayerIndex:A}=x;if(this.hasPattern){const P=Yh("fill",this.layers,x,this.zoom,i);this.patternFeatures.push(P)}else this.addFeature(x,b,D,a,{},i.availableImages);i.featureIndex.insert(e[D].feature,b,D,A,this.index)}}update(e,i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a,u)}addFeatures(e,i,a,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,If),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,a,u,f,g=[]){for(const x of el(i,500)){let b=0;for(const H of x)b+=H.length;const D=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),A=D.vertexLength,P=[],F=[];for(const H of x){if(0===H.length)continue;H!==x[0]&&F.push(P.length/2);const ee=this.segments2.prepareSegment(H.length,this.layoutVertexArray,this.indexArray2),ue=ee.vertexLength;this.layoutVertexArray.emplaceBack(H[0].x,H[0].y),this.indexArray2.emplaceBack(ue+H.length-1,ue),P.push(H[0].x),P.push(H[0].y);for(let fe=1;fe<H.length;fe++)this.layoutVertexArray.emplaceBack(H[fe].x,H[fe].y),this.indexArray2.emplaceBack(ue+fe-1,ue+fe),P.push(H[fe].x),P.push(H[fe].y);ee.vertexLength+=H.length,ee.primitiveLength+=H.length}const $=Hh(P,F);for(let H=0;H<$.length;H+=3)this.indexArray.emplaceBack(A+$[H],A+$[H+1],A+$[H+2]);D.vertexLength+=b,D.primitiveLength+=$.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,g,u)}}Bt("FillBucket",ic,{omit:["layers","patternFeatures"]});const ym=new tt({"fill-sort-key":new ye(W.layout_fill["fill-sort-key"])});var zf={paint:new tt({"fill-antialias":new le(W.paint_fill["fill-antialias"]),"fill-opacity":new ye(W.paint_fill["fill-opacity"]),"fill-color":new ye(W.paint_fill["fill-color"]),"fill-outline-color":new ye(W.paint_fill["fill-outline-color"]),"fill-translate":new le(W.paint_fill["fill-translate"]),"fill-translate-anchor":new le(W.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ee(W.paint_fill["fill-pattern"])}),layout:ym};const Bf=Ne([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Nf=Ne([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Kh}=Bf;var Qh=tl;function tl(n,e,i,a,u){this.properties={},this.extent=i,this.type=0,this._pbf=n,this._geometry=-1,this._keys=a,this._values=u,n.readFields(Qu,this,e)}function Qu(n,e,i){1==n?e.id=i.readVarint():2==n?function(a,u){for(var f=a.readVarint()+a.pos;a.pos<f;){var g=u._keys[a.readVarint()],x=u._values[a.readVarint()];u.properties[g]=x}}(i,e):3==n?e.type=i.readVarint():4==n&&(e._geometry=i.pos)}function Uf(n){for(var e,i,a=0,u=0,f=n.length,g=f-1;u<f;g=u++)a+=((i=n[g]).x-(e=n[u]).x)*(e.y+i.y);return a}tl.types=["Unknown","Point","LineString","Polygon"],tl.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,i=n.readVarint()+n.pos,a=1,u=0,f=0,g=0,x=[];n.pos<i;){if(u<=0){var b=n.readVarint();a=7&b,u=b>>3}if(u--,1===a||2===a)f+=n.readSVarint(),g+=n.readSVarint(),1===a&&(e&&x.push(e),e=[]),e.push(new Ve(f,g));else{if(7!==a)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&x.push(e),x},tl.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,i=1,a=0,u=0,f=0,g=1/0,x=-1/0,b=1/0,D=-1/0;n.pos<e;){if(a<=0){var A=n.readVarint();i=7&A,a=A>>3}if(a--,1===i||2===i)(u+=n.readSVarint())<g&&(g=u),u>x&&(x=u),(f+=n.readSVarint())<b&&(b=f),f>D&&(D=f);else if(7!==i)throw new Error("unknown command "+i)}return[g,b,x,D]},tl.prototype.toGeoJSON=function(n,e,i){var a,u,f=this.extent*Math.pow(2,i),g=this.extent*n,x=this.extent*e,b=this.loadGeometry(),D=tl.types[this.type];function A($){for(var H=0;H<$.length;H++){var ee=$[H];$[H]=[360*(ee.x+g)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(ee.y+x)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(a=0;a<b.length;a++)P[a]=b[a][0];A(b=P);break;case 2:for(a=0;a<b.length;a++)A(b[a]);break;case 3:for(b=function($){var H=$.length;if(H<=1)return[$];for(var ee,ue,fe=[],ve=0;ve<H;ve++){var Te=Uf($[ve]);0!==Te&&(void 0===ue&&(ue=Te<0),ue===Te<0?(ee&&fe.push(ee),ee=[$[ve]]):ee.push($[ve]))}return ee&&fe.push(ee),fe}(b),a=0;a<b.length;a++)for(u=0;u<b[a].length;u++)A(b[a][u])}1===b.length?b=b[0]:D="Multi"+D;var F={type:"Feature",geometry:{type:D,coordinates:b},properties:this.properties};return"id"in this&&(F.id=this.id),F};var Ju=Jh;function Jh(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(ed,this,e),this.length=this._features.length}function ed(n,e,i){15===n?e.version=i.readVarint():1===n?e.name=i.readString():5===n?e.extent=i.readVarint():2===n?e._features.push(i.pos):3===n?e._keys.push(i.readString()):4===n&&e._values.push(function(a){for(var u=null,f=a.readVarint()+a.pos;a.pos<f;){var g=a.readVarint()>>3;u=1===g?a.readString():2===g?a.readFloat():3===g?a.readDouble():4===g?a.readVarint64():5===g?a.readVarint():6===g?a.readSVarint():7===g?a.readBoolean():null}return u}(i))}function du(n,e,i){if(3===n){var a=new Ju(i,i.readVarint()+i.pos);a.length&&(e[a.name]=a)}}Jh.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new Qh(this._pbf,e,this.extent,this._keys,this._values)};var oc={VectorTile:function(n,e){this.layers=n.readFields(du,{},e)},VectorTileFeature:Qh,VectorTileLayer:Ju};const Vf=oc.VectorTileFeature.types,vm=Math.pow(2,13);function fu(n,e,i,a,u,f,g,x){n.emplaceBack((e<<1)+g,(i<<1)+f,(Math.floor(a*vm)<<1)+u,Math.round(x))}class td{constructor(){this.acc=new Ve(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ve(e.x,e.y),this.max=new Ve(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);let a=!!this.borders;const u=this.min,f=this.max;e.x<u.x?(u.x=e.x,a=!0):e.x>f.x&&(f.x=e.x,a=!0),e.y<u.y?(u.y=e.y,a=!0):e.y>f.y&&(f.y=e.y,a=!0),((0===e.x||e.x===Yn)&&e.x===i.x)!=((0===e.y||e.y===Yn)&&e.y===i.y)&&this.processBorderOverlap(e,i),a&&this.checkBorderIntersection(e,i)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Vn(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Yn!=e.x>Yn&&this.addBorderIntersection(1,Vn(i.y,e.y,(Yn-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Vn(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Yn!=e.y>Yn&&this.addBorderIntersection(3,Vn(i.x,e.x,(Yn-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];i<a[0]&&(a[0]=i),i>a[1]&&(a[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const a=0===e.x?0:1;this.addBorderIntersection(a,i.y),this.addBorderIntersection(a,e.y)}else{const a=0===e.y?2:3;this.addBorderIntersection(a,i.x),this.addBorderIntersection(a,e.x)}}centroid(){const e=this.polyCount.reduce((i,a)=>i+a.edges,0);return 0!==e?this.acc.div(e)._round():new Ve(0,0)}span(){return new Ve(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class pu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new un,this.centroidVertexArray=new nf,this.indexArray=new mi,this.programConfigurations=new bc(e.layers,e.zoom),this.segments=new gi,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,a,u){this.features=[],this.hasPattern=Ku("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(f){const g=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*g/(g*g+1)/Yn/(1<<f.z)}(a);for(const{feature:f,id:g,index:x,sourceLayerIndex:b}of e){const D=this.layers[0]._featureFilter.needGeometry,A=Ia(f,D);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),A,a))continue;const P={id:g,sourceLayerIndex:b,index:x,geometry:D?A.geometry:Sa(f,a,u),properties:f.properties,type:f.type,patterns:{}},F=this.layoutVertexArray.length;this.hasPattern?this.features.push(Yh("fill-extrusion",this.layers,P,this.zoom,i)):this.addFeature(P,P.geometry,x,a,{},i.availableImages),i.featureIndex.insert(f,P.geometry,x,b,this.index,F)}this.sortBorders()}addFeatures(e,i,a,u){for(const f of this.features){const{geometry:g}=f;this.addFeature(f,g,f.index,i,a,u)}this.sortBorders()}update(e,i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Kh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Nf.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,u,f,g){const x=this.enableTerrain?new td:null;for(const D of el(i,500)){let A=0,P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===D.length||(b=D[0]).every(ue=>ue.x<=0)||b.every(ue=>ue.x>=Yn)||b.every(ue=>ue.y<=0)||b.every(ue=>ue.y>=Yn))continue;for(let ue=0;ue<D.length;ue++){const fe=D[ue];if(0===fe.length)continue;A+=fe.length;let ve=0;x&&x.startRing(fe[0]);for(let Te=0;Te<fe.length;Te++){const Se=fe[Te];if(Te>=1){const Ie=fe[Te-1];if(!jf(Se,Ie)){x&&x.append(Se,Ie),P.vertexLength+4>gi.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Pe=Se.sub(Ie)._perp(),Ye=Pe.x/(Math.abs(Pe.x)+Math.abs(Pe.y)),We=Pe.y>0?1:0,It=Ie.dist(Se);ve+It>32768&&(ve=0),fu(this.layoutVertexArray,Se.x,Se.y,Ye,We,0,0,ve),fu(this.layoutVertexArray,Se.x,Se.y,Ye,We,0,1,ve),ve+=It,fu(this.layoutVertexArray,Ie.x,Ie.y,Ye,We,0,0,ve),fu(this.layoutVertexArray,Ie.x,Ie.y,Ye,We,0,1,ve);const ct=P.vertexLength;this.indexArray.emplaceBack(ct,ct+2,ct+1),this.indexArray.emplaceBack(ct+1,ct+2,ct+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+A>gi.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray)),"Polygon"!==Vf[e.type])continue;const F=[],$=[],H=P.vertexLength;for(let ue=0;ue<D.length;ue++){const fe=D[ue];if(0!==fe.length){fe!==D[0]&&$.push(F.length/2);for(let ve=0;ve<fe.length;ve++){const Te=fe[ve];fu(this.layoutVertexArray,Te.x,Te.y,0,0,1,1,0),F.push(Te.x),F.push(Te.y),x&&x.currentPolyCount.top++}}}const ee=Hh(F,$);for(let ue=0;ue<ee.length;ue+=3)this.indexArray.emplaceBack(H+ee[ue],H+ee[ue+2],H+ee[ue+1]);P.primitiveLength+=ee.length/3,P.vertexLength+=A}var b;if(x&&x.polyCount.length>0){if(x.borders){x.vertexArrayOffset=this.centroidVertexArray.length;const D=x.borders,A=this.featuresOnBorder.push(x)-1;for(let P=0;P<4;P++)D[P][0]!==Number.MAX_VALUE&&this.borders[P].push(A)}this.encodeCentroid(x.borders?void 0:x.centroid(),x)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,g,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,a)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}encodeCentroid(e,i,a=!0){let u,f;if(e)if(0!==e.y){const x=i.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(x.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else u=Math.ceil(7*(e.x+450)),f=0;else u=0,f=+a;let g=a?this.centroidVertexArray.length:i.vertexArrayOffset;for(const x of i.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let b=0;b<2*x.edges;b++)this.centroidVertexArray.emplace(g++,0,f),this.centroidVertexArray.emplace(g++,u,f);for(let b=0;b<x.top;b++)this.centroidVertexArray.emplace(g++,u,f)}}}function jf(n,e){return n.x===e.x&&(n.x<0||n.x>Yn)||n.y===e.y&&(n.y<0||n.y>Yn)}Bt("FillExtrusionBucket",pu,{omit:["layers","features"]}),Bt("PartMetadata",td);var a_={paint:new tt({"fill-extrusion-opacity":new le(W["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ye(W["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new le(W["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new le(W["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ee(W["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ye(W["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ye(W["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new le(W["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Mc(n,e){return n.x*e.x+n.y*e.y}function $f(n,e){if(1===n.length){let i=0;const a=e[i++];let u;for(;!u||a.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const f=e[i],g=n[0],x=u.sub(a),b=f.sub(a),D=g.sub(a),A=Mc(x,x),P=Mc(x,b),F=Mc(b,b),$=Mc(D,x),H=Mc(D,b),ee=A*F-P*P,ue=(F*$-P*H)/ee,fe=(A*H-P*$)/ee,ve=a.z*(1-ue-fe)+u.z*ue+f.z*fe;if(isFinite(ve))return ve}return 1/0}{let i=1/0;for(const a of e)i=Math.min(i,a.z);return i}}function nd(n){const e=new Ve(n[0],n[1]);return e.z=n[2],e}function xm(n,e,i,a,u,f,g,x){const b=g*u.getElevationAt(n,e,!0,!0),D=0!==f[0],A=D?0===f[1]?g*(f[0]/7-450):g*function(P,F,$){const H=Math.floor(F[0]/8),ee=Math.floor(F[1]/8),ue=10*(F[0]-8*H),fe=10*(F[1]-8*ee),ve=P.getElevationAt(H,ee,!0,!0),Te=P.getMeterToDEM($),Se=Math.floor(.5*(ue*Te-1)),Ie=Math.floor(.5*(fe*Te-1)),Pe=P.tileCoordToPixel(H,ee),Ye=2*Se+1,We=2*Ie+1,It=(Er=Ye,gn=We,[(kt=P).getElevationAtPixel(Nt=Pe.x-Se,Sn=Pe.y-Ie,!0),kt.getElevationAtPixel(Nt+gn,Sn,!0),kt.getElevationAtPixel(Nt,Sn+gn,!0),kt.getElevationAtPixel(Nt+Er,Sn+gn,!0)]),ct=Math.abs(It[0]-It[1]),Qe=Math.abs(It[2]-It[3]),ht=Math.abs(It[0]-It[2])+Math.abs(It[1]-It[3]),pt=Math.min(.25,.5*Te*(ct+Qe)/Ye),ot=Math.min(.25,.5*Te*ht/We);var kt,Nt,Sn,Er,gn;return ve+Math.max(pt*ue,ot*fe)}(u,f,x):b;return{base:b+(0===i)?-1:i,top:D?Math.max(A+a,b+i+2):b+a}}const bm=Ne([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:ia}=bm,wm=Ne([{name:"a_packed",components:3,type:"Float32"}]),{members:Gf}=wm,Em=oc.VectorTileFeature.types,Dm=Math.cos(Math.PI/180*37.5);class eh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new mn,this.layoutVertexArray2=new yn,this.indexArray=new mi,this.programConfigurations=new bc(e.layers,e.zoom),this.segments=new gi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a,u){this.hasPattern=Ku("line",this.layers,i);const f=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:A,id:P,index:F,sourceLayerIndex:$}of e){const H=this.layers[0]._featureFilter.needGeometry,ee=Ia(A,H);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),ee,a))continue;const ue=f?f.evaluate(ee,{},a):void 0,fe={id:P,properties:A.properties,type:A.type,sourceLayerIndex:$,index:F,geometry:H?ee.geometry:Sa(A,a,u),patterns:{},sortKey:ue};g.push(fe)}f&&g.sort((A,P)=>A.sortKey-P.sortKey);const{lineAtlas:x,featureIndex:b}=i,D=this.addConstantDashes(x);for(const A of g){const{geometry:P,index:F,sourceLayerIndex:$}=A;if(D&&this.addFeatureDashes(A,x),this.hasPattern){const H=Yh("line",this.layers,A,this.zoom,i);this.patternFeatures.push(H)}else this.addFeature(A,P,F,a,x.positions,i.availableImages);b.insert(e[F].feature,P,F,$,this.index)}}addConstantDashes(e){let i=!1;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,f=a.layout.get("line-cap").value;if("constant"!==u.kind||"constant"!==f.kind)i=!0;else{const g=f.value,x=u.value;if(!x)continue;e.addDash(x.from,g),e.addDash(x.to,g),x.other&&e.addDash(x.other,g)}}return i}addFeatureDashes(e,i){const a=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===g.kind)continue;let x,b,D,A,P,F;if("constant"===f.kind){const ue=f.value;if(!ue)continue;x=ue.other||ue.to,b=ue.to,D=ue.from}else x=f.evaluate({zoom:a-1},e),b=f.evaluate({zoom:a},e),D=f.evaluate({zoom:a+1},e);"constant"===g.kind?A=P=F=g.value:(A=g.evaluate({zoom:a-1},e),P=g.evaluate({zoom:a},e),F=g.evaluate({zoom:a+1},e)),i.addDash(x,A),i.addDash(b,P),i.addDash(D,F);const $=i.getKey(x,A),H=i.getKey(b,P),ee=i.getKey(D,F);e.patterns[u.id]={min:$,mid:H,max:ee}}}update(e,i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a,u)}addFeatures(e,i,a,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Gf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ia),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,a,u,f,g){const x=this.layers[0].layout,b=x.get("line-join").evaluate(e,{}),D=x.get("line-cap").evaluate(e,{}),A=x.get("line-miter-limit"),P=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const F of i)this.addLine(F,e,b,D,A,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,g,u)}addLine(e,i,a,u,f,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let fe=0;fe<e.length-1;fe++)this.totalDistance+=e[fe].dist(e[fe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===Em[i.type];let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let D=0;for(;D<b-1&&e[D].equals(e[D+1]);)D++;if(b<(x?3:2))return;"bevel"===a&&(f=1.05);const A=this.overscaling<=16?122880/(512*this.overscaling):0,P=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let F,$,H,ee,ue;this.e1=this.e2=-1,x&&(F=e[b-2],ue=e[D].sub(F)._unit()._perp());for(let fe=D;fe<b;fe++){if(H=fe===b-1?x?e[D+1]:void 0:e[fe+1],H&&e[fe].equals(H))continue;ue&&(ee=ue),F&&($=F),F=e[fe],ue=H?H.sub(F)._unit()._perp():ee,ee=ee||ue;let ve=ee.add(ue);0===ve.x&&0===ve.y||ve._unit();const Te=ee.x*ue.x+ee.y*ue.y,Se=ve.x*ue.x+ve.y*ue.y,Ie=0!==Se?1/Se:1/0,Pe=2*Math.sqrt(2-2*Se),Ye=Se<Dm&&$&&H,We=ee.x*ue.y-ee.y*ue.x>0;if(Ye&&fe>D){const Qe=F.dist($);if(Qe>2*A){const ht=F.sub(F.sub($)._mult(A/Qe)._round());this.updateDistance($,ht),this.addCurrentVertex(ht,ee,0,0,P),$=ht}}const It=$&&H;let ct=It?a:x?"butt":u;if(It&&"round"===ct&&(Ie<g?ct="miter":Ie<=2&&(ct="fakeround")),"miter"===ct&&Ie>f&&(ct="bevel"),"bevel"===ct&&(Ie>2&&(ct="flipbevel"),Ie<f&&(ct="miter")),$&&this.updateDistance($,F),"miter"===ct)ve._mult(Ie),this.addCurrentVertex(F,ve,0,0,P);else if("flipbevel"===ct){if(Ie>100)ve=ue.mult(-1);else{const Qe=Ie*ee.add(ue).mag()/ee.sub(ue).mag();ve._perp()._mult(Qe*(We?-1:1))}this.addCurrentVertex(F,ve,0,0,P),this.addCurrentVertex(F,ve.mult(-1),0,0,P)}else if("bevel"===ct||"fakeround"===ct){const Qe=-Math.sqrt(Ie*Ie-1),ht=We?Qe:0,pt=We?0:Qe;if($&&this.addCurrentVertex(F,ee,ht,pt,P),"fakeround"===ct){const ot=Math.round(180*Pe/Math.PI/20);for(let kt=1;kt<ot;kt++){let Nt=kt/ot;if(.5!==Nt){const Er=Nt-.5;Nt+=Nt*Er*(Nt-1)*((1.0904+Te*(Te*(3.55645-1.43519*Te)-3.2452))*Er*Er+(.848013+Te*(.215638*Te-1.06021)))}const Sn=ue.sub(ee)._mult(Nt)._add(ee)._unit()._mult(We?-1:1);this.addHalfVertex(F,Sn.x,Sn.y,!1,We,0,P)}}H&&this.addCurrentVertex(F,ue,-ht,-pt,P)}else if("butt"===ct)this.addCurrentVertex(F,ve,0,0,P);else if("square"===ct){const Qe=$?1:-1;$||this.addCurrentVertex(F,ve,Qe,Qe,P),this.addCurrentVertex(F,ve,0,0,P),$&&this.addCurrentVertex(F,ve,Qe,Qe,P)}else"round"===ct&&($&&(this.addCurrentVertex(F,ee,0,0,P),this.addCurrentVertex(F,ee,1,1,P,!0)),H&&(this.addCurrentVertex(F,ue,-1,-1,P,!0),this.addCurrentVertex(F,ue,0,0,P)));if(Ye&&fe<b-1){const Qe=F.dist(H);if(Qe>2*A){const ht=F.add(H.sub(F)._mult(A/Qe)._round());this.updateDistance(F,ht),this.addCurrentVertex(ht,ue,0,0,P),F=ht}}}}addCurrentVertex(e,i,a,u,f,g=!1){const x=i.y*u-i.x,b=-i.y-i.x*u;this.addHalfVertex(e,i.x+i.y*a,i.y-i.x*a,g,!1,a,f),this.addHalfVertex(e,x,b,g,!0,-u,f)}addHalfVertex({x:e,y:i},a,u,f,g,x,b){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(g?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const D=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),b.primitiveLength++),g?this.e2=D:this.e1=D}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Bt("LineBucket",eh,{omit:["layers","patternFeatures"]});const Cm=new tt({"line-cap":new ye(W.layout_line["line-cap"]),"line-join":new ye(W.layout_line["line-join"]),"line-miter-limit":new le(W.layout_line["line-miter-limit"]),"line-round-limit":new le(W.layout_line["line-round-limit"]),"line-sort-key":new ye(W.layout_line["line-sort-key"])});var rd={paint:new tt({"line-opacity":new ye(W.paint_line["line-opacity"]),"line-color":new ye(W.paint_line["line-color"]),"line-translate":new le(W.paint_line["line-translate"]),"line-translate-anchor":new le(W.paint_line["line-translate-anchor"]),"line-width":new ye(W.paint_line["line-width"]),"line-gap-width":new ye(W.paint_line["line-gap-width"]),"line-offset":new ye(W.paint_line["line-offset"]),"line-blur":new ye(W.paint_line["line-blur"]),"line-dasharray":new Ee(W.paint_line["line-dasharray"]),"line-pattern":new Ee(W.paint_line["line-pattern"]),"line-gradient":new Ge(W.paint_line["line-gradient"])}),layout:Cm};const Hf=new class extends ye{possiblyEvaluate(n,e){return e=new j(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,i,a){return e=Gt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,i,a)}}(rd.paint.properties["line-width"].specification);function Zf(n,e){return e>0?e+2*n:n}Hf.useIntegerZoom=!0;const Tm=Ne([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),Bn=Ne([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ne([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const qf=Ne([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Wf=Ne([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ne([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const id=Ne([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),th=Ne([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ne([{name:"triangle",components:3,type:"Uint16"}]),Ne([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ne([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ne([{type:"Float32",name:"offsetX"}]),Ne([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const oa=128;function od(n,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new j(n+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:a,interpolationType:u}=i;let f=0;for(;f<a.length&&a[f]<=n;)f++;f=Math.max(0,f-1);let g=f;for(;g<a.length&&a[g]<n+1;)g++;g=Math.min(a.length-1,g);const x=a[f],b=a[g];return"composite"===i.kind?{kind:"composite",minZoom:x,maxZoom:b,interpolationType:u}:{kind:"camera",minZoom:x,maxZoom:b,minSize:i.evaluate(new j(x)),maxSize:i.evaluate(new j(b)),interpolationType:u}}}function Ac(n,{uSize:e,uSizeT:i},{lowerSize:a,upperSize:u}){return"source"===n.kind?a/oa:"composite"===n.kind?Vn(a/oa,u/oa,i):e}function Jo(n,e){let i=0,a=0;if("constant"===n.kind)a=n.layoutSize;else if("source"!==n.kind){const{interpolationType:u,minZoom:f,maxZoom:g}=n,x=u?At(jn.interpolationFactor(u,e,f,g),0,1):0;"camera"===n.kind?a=Vn(n.minSize,n.maxSize,x):i=x}return{uSizeT:i,uSize:a}}var sd=Object.freeze({__proto__:null,getSizeData:od,evaluateSizeForFeature:Ac,evaluateSizeForZoom:Jo,SIZE_PACK_FACTOR:oa});function Xf(n,e,i){return n.sections.forEach(a=>{a.text=function(u,f,g){const x=f.layout.get("text-transform").evaluate(g,{});return"uppercase"===x?u=u.toLocaleUpperCase():"lowercase"===x&&(u=u.toLocaleLowerCase()),N.applyArabicShaping&&(u=N.applyArabicShaping(u)),u}(a.text,e,i)}),n}const sc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function l_(n){return"\ufe36"===n||"\ufe48"===n||"\ufe38"===n||"\ufe44"===n||"\ufe42"===n||"\ufe3e"===n||"\ufe3c"===n||"\ufe3a"===n||"\ufe18"===n||"\ufe40"===n||"\ufe10"===n||"\ufe13"===n||"\ufe14"===n||"\uff40"===n||"\uffe3"===n||"\ufe11"===n||"\ufe12"===n}function Yf(n){return"\ufe35"===n||"\ufe47"===n||"\ufe37"===n||"\ufe43"===n||"\ufe41"===n||"\ufe3d"===n||"\ufe3b"===n||"\ufe39"===n||"\ufe17"===n||"\ufe3f"===n}var Sm=function(n,e,i,a,u){var f,g,x=8*u-a-1,b=(1<<x)-1,D=b>>1,A=-7,P=i?u-1:0,F=i?-1:1,$=n[e+P];for(P+=F,f=$&(1<<-A)-1,$>>=-A,A+=x;A>0;f=256*f+n[e+P],P+=F,A-=8);for(g=f&(1<<-A)-1,f>>=-A,A+=a;A>0;g=256*g+n[e+P],P+=F,A-=8);if(0===f)f=1-D;else{if(f===b)return g?NaN:1/0*($?-1:1);g+=Math.pow(2,a),f-=D}return($?-1:1)*g*Math.pow(2,f-a)},mu=function(n,e,i,a,u,f){var g,x,b,D=8*f-u-1,A=(1<<D)-1,P=A>>1,F=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,$=a?0:f-1,H=a?1:-1,ee=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,g=A):(g=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-g))<1&&(g--,b*=2),(e+=g+P>=1?F/b:F*Math.pow(2,1-P))*b>=2&&(g++,b/=2),g+P>=A?(x=0,g=A):g+P>=1?(x=(e*b-1)*Math.pow(2,u),g+=P):(x=e*Math.pow(2,P-1)*Math.pow(2,u),g=0));u>=8;n[i+$]=255&x,$+=H,x/=256,u-=8);for(g=g<<u|x,D+=u;D>0;n[i+$]=255&g,$+=H,g/=256,D-=8);n[i+$-H]|=128*ee},Pl=fr;function fr(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}fr.Varint=0,fr.Fixed64=1,fr.Bytes=2,fr.Fixed32=5;var gu=4294967296,nh=1/gu,Im="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function nl(n){return n.type===fr.Bytes?n.readVarint()+n.pos:n.pos+1}function Kf(n,e,i){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(a);for(var u=i.pos-1;u>=n;u--)i.buf[u+a]=i.buf[u]}function Mm(n,e){for(var i=0;i<n.length;i++)e.writeVarint(n[i])}function Qf(n,e){for(var i=0;i<n.length;i++)e.writeSVarint(n[i])}function c_(n,e){for(var i=0;i<n.length;i++)e.writeFloat(n[i])}function Am(n,e){for(var i=0;i<n.length;i++)e.writeDouble(n[i])}function u_(n,e){for(var i=0;i<n.length;i++)e.writeBoolean(n[i])}function Jf(n,e){for(var i=0;i<n.length;i++)e.writeFixed32(n[i])}function ep(n,e){for(var i=0;i<n.length;i++)e.writeSFixed32(n[i])}function Pm(n,e){for(var i=0;i<n.length;i++)e.writeFixed64(n[i])}function ad(n,e){for(var i=0;i<n.length;i++)e.writeSFixed64(n[i])}function ld(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function _u(n,e,i){n[i]=e,n[i+1]=e>>>8,n[i+2]=e>>>16,n[i+3]=e>>>24}function km(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}function h_(n,e,i){e.glyphs=[],1===n&&i.readMessage(d_,e)}function d_(n,e,i){if(3===n){const{id:a,bitmap:u,width:f,height:g,left:x,top:b,advance:D}=i.readMessage(f_,{});e.glyphs.push({id:a,bitmap:new Il({width:f+6,height:g+6},u),metrics:{width:f,height:g,left:x,top:b,advance:D}})}else 4===n?e.ascender=i.readSVarint():5===n&&(e.descender=i.readSVarint())}function f_(n,e,i){1===n?e.id=i.readVarint():2===n?e.bitmap=i.readBytes():3===n?e.width=i.readVarint():4===n?e.height=i.readVarint():5===n?e.left=i.readSVarint():6===n?e.top=i.readSVarint():7===n&&(e.advance=i.readVarint())}function tp(n){let e=0,i=0;for(const g of n)e+=g.w*g.h,i=Math.max(i,g.w);n.sort((g,x)=>x.h-g.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,f=0;for(const g of n)for(let x=a.length-1;x>=0;x--){const b=a[x];if(!(g.w>b.w||g.h>b.h)){if(g.x=b.x,g.y=b.y,f=Math.max(f,g.y+g.h),u=Math.max(u,g.x+g.w),g.w===b.w&&g.h===b.h){const D=a.pop();x<a.length&&(a[x]=D)}else g.h===b.h?(b.x+=g.w,b.w-=g.w):g.w===b.w?(b.y+=g.h,b.h-=g.h):(a.push({x:b.x+g.w,y:b.y,w:b.w-g.w,h:g.h}),b.y+=g.h,b.h-=g.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}fr.prototype={destroy:function(){this.buf=null},readFields:function(n,e,i){for(i=i||this.length;this.pos<i;){var a=this.readVarint(),u=a>>3,f=this.pos;this.type=7&a,n(u,e,this),this.pos===f&&this.skip(a)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=ld(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=km(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=ld(this.buf,this.pos)+ld(this.buf,this.pos+4)*gu;return this.pos+=8,n},readSFixed64:function(){var n=ld(this.buf,this.pos)+km(this.buf,this.pos+4)*gu;return this.pos+=8,n},readFloat:function(){var n=Sm(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Sm(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,i,a=this.buf;return e=127&(i=a[this.pos++]),i<128?e:(e|=(127&(i=a[this.pos++]))<<7,i<128?e:(e|=(127&(i=a[this.pos++]))<<14,i<128?e:(e|=(127&(i=a[this.pos++]))<<21,i<128?e:function(u,f,g){var x,b,D=g.buf;if(x=(112&(b=D[g.pos++]))>>4,b<128||(x|=(127&(b=D[g.pos++]))<<3,b<128)||(x|=(127&(b=D[g.pos++]))<<10,b<128)||(x|=(127&(b=D[g.pos++]))<<17,b<128)||(x|=(127&(b=D[g.pos++]))<<24,b<128)||(x|=(1&(b=D[g.pos++]))<<31,b<128))return function Pc(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}(u,x,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=a[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&Im?Im.decode(this.buf.subarray(e,n)):function(i,a,u){for(var f="",g=a;g<u;){var x,b,D,A=i[g],P=null,F=A>239?4:A>223?3:A>191?2:1;if(g+F>u)break;1===F?A<128&&(P=A):2===F?128==(192&(x=i[g+1]))&&(P=(31&A)<<6|63&x)<=127&&(P=null):3===F?(b=i[g+2],128==(192&(x=i[g+1]))&&128==(192&b)&&((P=(15&A)<<12|(63&x)<<6|63&b)<=2047||P>=55296&&P<=57343)&&(P=null)):4===F&&(b=i[g+2],D=i[g+3],128==(192&(x=i[g+1]))&&128==(192&b)&&128==(192&D)&&((P=(15&A)<<18|(63&x)<<12|(63&b)<<6|63&D)<=65535||P>=1114112)&&(P=null)),null===P?(P=65533,F=1):P>65535&&(P-=65536,f+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),f+=String.fromCharCode(P),g+=F}return f}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==fr.Bytes)return n.push(this.readVarint(e));var i=nl(this);for(n=n||[];this.pos<i;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==fr.Bytes)return n.push(this.readSVarint());var e=nl(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==fr.Bytes)return n.push(this.readBoolean());var e=nl(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==fr.Bytes)return n.push(this.readFloat());var e=nl(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==fr.Bytes)return n.push(this.readDouble());var e=nl(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==fr.Bytes)return n.push(this.readFixed32());var e=nl(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==fr.Bytes)return n.push(this.readSFixed32());var e=nl(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==fr.Bytes)return n.push(this.readFixed64());var e=nl(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==fr.Bytes)return n.push(this.readSFixed64());var e=nl(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===fr.Varint)for(;this.buf[this.pos++]>127;);else if(e===fr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===fr.Fixed32)this.pos+=4;else{if(e!==fr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),_u(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),_u(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),_u(this.buf,-1&n,this.pos),_u(this.buf,Math.floor(n*nh),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),_u(this.buf,-1&n,this.pos),_u(this.buf,Math.floor(n*nh),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,i){var a,u,f,x;if(e>=0?(a=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,u=u+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),f=a,(x=i).buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,x.buf[x.pos]=127&(f>>>=7),function(f,g){var x=(7&f)<<4;g.buf[g.pos++]|=x|((f>>>=3)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f)))))}(u,i)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(a,u,f){for(var g,x,b=0;b<u.length;b++){if((g=u.charCodeAt(b))>55295&&g<57344){if(!x){g>56319||b+1===u.length?(a[f++]=239,a[f++]=191,a[f++]=189):x=g;continue}if(g<56320){a[f++]=239,a[f++]=191,a[f++]=189,x=g;continue}g=x-55296<<10|g-56320|65536,x=null}else x&&(a[f++]=239,a[f++]=191,a[f++]=189,x=null);g<128?a[f++]=g:(g<2048?a[f++]=g>>6|192:(g<65536?a[f++]=g>>12|224:(a[f++]=g>>18|240,a[f++]=g>>12&63|128),a[f++]=g>>6&63|128),a[f++]=63&g|128)}return f}(this.buf,n,this.pos);var i=this.pos-e;i>=128&&Kf(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(n){this.realloc(4),mu(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),mu(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=n[i]},writeRawMessage:function(n,e){this.pos++;var i=this.pos;n(e,this);var a=this.pos-i;a>=128&&Kf(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeMessage:function(n,e,i){this.writeTag(n,fr.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,Mm,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,Qf,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,u_,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,c_,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,Am,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,Jf,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,ep,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,Pm,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,ad,e)},writeBytesField:function(n,e){this.writeTag(n,fr.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,fr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,fr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,fr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,fr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,fr.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,fr.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,fr.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,fr.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,fr.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,Boolean(e))}};class np{constructor(e,{pixelRatio:i,version:a,stretchX:u,stretchY:f,content:g}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=f,this.content=g,this.version=a}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Rm{constructor(e,i){const a={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,a,f),this.addImages(i,u,f);const{w:g,h:x}=tp(f),b=new _s({width:g||1,height:x||1});for(const D in e){const A=e[D],P=a[D].paddedRect;_s.copy(A.data,b,{x:0,y:0},{x:P.x+1,y:P.y+1},A.data)}for(const D in i){const A=i[D],P=u[D].paddedRect,F=P.x+1,$=P.y+1,H=A.data.width,ee=A.data.height;_s.copy(A.data,b,{x:0,y:0},{x:F,y:$},A.data),_s.copy(A.data,b,{x:0,y:ee-1},{x:F,y:$-1},{width:H,height:1}),_s.copy(A.data,b,{x:0,y:0},{x:F,y:$+ee},{width:H,height:1}),_s.copy(A.data,b,{x:H-1,y:0},{x:F-1,y:$},{width:1,height:ee}),_s.copy(A.data,b,{x:0,y:0},{x:F+H,y:$},{width:1,height:ee})}this.image=b,this.iconPositions=a,this.patternPositions=u}addImages(e,i,a){for(const u in e){const f=e[u],g={x:0,y:0,w:f.data.width+2,h:f.data.height+2};a.push(g),i[u]=new np(g,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),i),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),i)}patchUpdatedImage(e,i,a){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,f]=e.tl;a.update(i.data,void 0,{x:u,y:f})}}Bt("ImagePosition",np),Bt("ImageAtlas",Rm);const Ls={horizontal:1,vertical:2,horizontalOnly:3};class Fs{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const a=new Fs;return a.scale=e||1,a.fontStack=i,a}static forImage(e){const i=new Fs;return i.imageName=e,i}}class kl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const a=new kl;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?a.addImageSection(f):a.addTextSection(f,i)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,a){let u="";for(let f=0;f<i.length;f++){const g=i.charCodeAt(f+1)||null,x=i.charCodeAt(f-1)||null;u+=!a&&(g&&zu(g)&&!sc[i[f+1]]||x&&zu(x)&&!sc[i[f-1]])||!sc[i[f]]?i[f]:sc[i[f]]}return u}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&yu[this.text.charCodeAt(a)];a++)e++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&yu[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const a=new kl;return a.text=this.text.substring(e,i),a.sectionIndex=this.sectionIndex.slice(e,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Fs.forText(e.scale,e.fontStack||i));const a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e){const i=e.image?e.image.name:"";if(0===i.length)return void zt("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Fs.forImage(i)),this.sectionIndex.push(this.sections.length-1)):zt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function cd(n,e,i,a,u,f,g,x,b,D,A,P,F,$,H,ee){const ue=kl.fromFeature(n,u);let fe;P===Ls.vertical&&ue.verticalizePunctuation(F);const{processBidirectionalText:ve,processStyledBidirectionalText:Te}=N;if(ve&&1===ue.sections.length){fe=[];const Pe=ve(ue.toString(),fd(ue,D,f,e,a,$,H));for(const Ye of Pe){const We=new kl;We.text=Ye,We.sections=ue.sections;for(let It=0;It<Ye.length;It++)We.sectionIndex.push(0);fe.push(We)}}else if(Te){fe=[];const Pe=Te(ue.text,ue.sectionIndex,fd(ue,D,f,e,a,$,H));for(const Ye of Pe){const We=new kl;We.text=Ye[0],We.sectionIndex=Ye[1],We.sections=ue.sections,fe.push(We)}}else fe=function(Pe,Ye){const We=[],It=Pe.text;let ct=0;for(const Qe of Ye)We.push(Pe.substring(ct,Qe)),ct=Qe;return ct<It.length&&We.push(Pe.substring(ct,It.length)),We}(ue,fd(ue,D,f,e,a,$,H));const Se=[],Ie={positionedLines:Se,text:ue.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Pe,Ye,We,It,ct,Qe,ht,pt,ot,kt,Nt,Sn){let Er=0,gn=0,nr=0;const Rt="right"===pt?1:"left"===pt?0:.5;let Dr=!1;for(const pr of ct){const ir=pr.getSections();for(const Br of ir){if(Br.imageName)continue;const qi=Ye[Br.fontStack];if(qi&&(Dr=void 0!==qi.ascender&&void 0!==qi.descender,!Dr))break}if(!Dr)break}let tr=0;for(const pr of ct){pr.trim();const ir=pr.getMaxScale(),Br=24*(ir-1),qi={positionedGlyphs:[],lineOffset:0};Pe.positionedLines[tr]=qi;const yi=qi.positionedGlyphs;let Ii=0;if(!pr.length()){gn+=Qe,++tr;continue}let ao=0,Yr=0;for(let Sr=0;Sr<pr.length();Sr++){const ti=pr.getSection(Sr),ni=pr.getSectionIndex(Sr),li=pr.getCharCode(Sr);let ci=ti.scale,Bi=null,Ar=null,vo=null,Bs=24,Ns=0;const Us=!(ot===Ls.horizontal||!Nt&&!Ou(li)||Nt&&(yu[li]||(_i=li,M(_i)||T(_i)||C(_i)||mo(_i)||Yc(_i))));if(ti.imageName){const lo=It[ti.imageName];if(!lo)continue;vo=ti.imageName,Pe.iconsInText=Pe.iconsInText||!0,Ar=lo.paddedRect;const xo=lo.displaySize;ci=24*ci/Sn,Bi={width:xo[0],height:xo[1],left:1,top:-3,advance:Us?xo[1]:xo[0],localGlyph:!1},Ns=Dr?-Bi.height*ci:24*ir-17-xo[1]*ci,Bs=Bi.advance;const La=(Us?xo[0]:xo[1])*ci-24*ir;La>0&&La>Ii&&(Ii=La)}else{const lo=We[ti.fontStack];if(!lo)continue;lo[li]&&(Ar=lo[li]);const xo=Ye[ti.fontStack];if(!xo)continue;const La=xo.glyphs[li];if(!La)continue;if(Bi=La.metrics,Bs=8203!==li?24:0,Dr){const jc=void 0!==xo.ascender?Math.abs(xo.ascender):0,hc=void 0!==xo.descender?Math.abs(xo.descender):0,al=(jc+hc)*ci;ao<al&&(ao=al,Yr=(jc-hc)/2*ci),Ns=-jc*ci}else Ns=24*(ir-ci)-17}Us?(Pe.verticalizable=!0,yi.push({glyph:li,imageName:vo,x:Er,y:gn+Ns,vertical:Us,scale:ci,localGlyph:Bi.localGlyph,fontStack:ti.fontStack,sectionIndex:ni,metrics:Bi,rect:Ar}),Er+=Bs*ci+kt):(yi.push({glyph:li,imageName:vo,x:Er,y:gn+Ns,vertical:Us,scale:ci,localGlyph:Bi.localGlyph,fontStack:ti.fontStack,sectionIndex:ni,metrics:Bi,rect:Ar}),Er+=Bi.advance*ci+kt)}0!==yi.length&&(nr=Math.max(Er-kt,nr),Dr?rp(yi,Rt,Ii,Yr,Qe*ir/2):rp(yi,Rt,Ii,0,Qe/2)),Er=0;const es=Qe*ir+Ii;qi.lineOffset=Math.max(Ii,Br),gn+=es,++tr}var _i;const ai=gn,{horizontalAlign:Si,verticalAlign:zi}=vu(ht);(function(pr,ir,Br,qi,yi,Ii){const ao=(ir-Br)*yi,Yr=-Ii*qi;for(const es of pr)for(const Sr of es.positionedGlyphs)Sr.x+=ao,Sr.y+=Yr})(Pe.positionedLines,Rt,Si,zi,nr,ai),Pe.top+=-zi*ai,Pe.bottom=Pe.top+ai,Pe.left+=-Si*nr,Pe.right=Pe.left+nr,Pe.hasBaseline=Dr}(Ie,e,i,a,fe,g,x,b,P,D,F,ee),!function(Pe){for(const Ye of Pe)if(0!==Ye.positionedGlyphs.length)return!1;return!0}(Se)&&Ie}const yu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ud={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function hd(n,e,i,a,u,f){if(e.imageName){const g=a[e.imageName];return g?g.displaySize[0]*e.scale*24/f+u:0}{const g=i[e.fontStack],x=g&&g.glyphs[n];return x?x.metrics.advance*e.scale+u:0}}function rh(n,e,i,a){const u=Math.pow(n-e,2);return a?n<e?u/2:2*u:u+Math.abs(i)*i}function Lm(n,e,i){let a=0;return 10===n&&(a-=1e4),i&&(a+=150),40!==n&&65288!==n||(a+=50),41!==e&&65289!==e||(a+=50),a}function rl(n,e,i,a,u,f){let g=null,x=rh(e,i,u,f);for(const b of a){const D=rh(e-b.x,i,u,f)+b.badness;D<=x&&(g=b,x=D)}return{index:n,x:e,priorBreak:g,badness:x}}function dd(n){return n?dd(n.priorBreak).concat(n.index):[]}function fd(n,e,i,a,u,f,g){if("point"!==f)return[];if(!n)return[];const x=[],b=function(F,$,H,ee,ue,fe){let ve=0;for(let Te=0;Te<F.length();Te++){const Se=F.getSection(Te);ve+=hd(F.getCharCode(Te),Se,ee,ue,$,fe)}return ve/Math.max(1,Math.ceil(ve/H))}(n,e,i,a,u,g),D=n.text.indexOf("\u200b")>=0;let A=0;for(let F=0;F<n.length();F++){const $=n.getSection(F),H=n.getCharCode(F);if(yu[H]||(A+=hd(H,$,a,u,e,g)),F<n.length()-1){const ee=!((P=H)<11904||!(Mn(P)||Lt(P)||Yl(P)||ps(P)||fs(P)||L(P)||Qt(P)||ge(P)||ro(P)||pi(P)||ar(P)||Fu(P)||be(P)||X(P)||U(P)||Gn(P)||Ue(P)||Mh(P)||Qo(P)||io(P)));(ud[H]||ee||$.imageName)&&x.push(rl(F+1,A,b,x,Lm(H,n.getCharCode(F+1),ee&&D),!1))}}var P;return dd(rl(n.length(),A,b,x,0,!0))}function vu(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function rp(n,e,i,a,u){if(!(e||i||a||u))return;const f=n.length-1,g=n[f],x=(g.x+g.metrics.advance*g.scale)*e;for(let b=0;b<=f;b++)n[b].x-=x,n[b].y+=i+a+u}function ip(n,e,i){const{horizontalAlign:a,verticalAlign:u}=vu(i),f=e[0]-n.displaySize[0]*a,g=e[1]-n.displaySize[1]*u;return{image:n,top:g,bottom:g+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function op(n,e,i,a,u,f){const g=n.image;let x;if(g.content){const ue=g.content,fe=g.pixelRatio||1;x=[ue[0]/fe,ue[1]/fe,g.displaySize[0]-ue[2]/fe,g.displaySize[1]-ue[3]/fe]}const b=e.left*f,D=e.right*f;let A,P,F,$;"width"===i||"both"===i?($=u[0]+b-a[3],P=u[0]+D+a[1]):($=u[0]+(b+D-g.displaySize[0])/2,P=$+g.displaySize[0]);const H=e.top*f,ee=e.bottom*f;return"height"===i||"both"===i?(A=u[1]+H-a[0],F=u[1]+ee+a[2]):(A=u[1]+(H+ee-g.displaySize[1])/2,F=A+g.displaySize[1]),{image:g,top:A,right:P,bottom:F,left:$,collisionPadding:x}}class Rl extends Ve{constructor(e,i,a,u,f){super(e,i),this.angle=u,this.z=a,void 0!==f&&(this.segment=f)}clone(){return new Rl(this.x,this.y,this.z,this.angle,this.segment)}}function kc(n,e,i,a,u){if(void 0===e.segment)return!0;let f=e,g=e.segment+1,x=0;for(;x>-i/2;){if(g--,g<0)return!1;x-=n[g].dist(f),f=n[g]}x+=n[g].dist(n[g+1]),g++;const b=[];let D=0;for(;x<i/2;){const A=n[g],P=n[g+1];if(!P)return!1;let F=n[g-1].angleTo(A)-A.angleTo(P);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:x,angleDelta:F}),D+=F;x-b[0].distance>a;)D-=b.shift().angleDelta;if(D>u)return!1;g++,x+=A.dist(P)}return!0}function ac(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function ih(n,e,i){return n?.6*e*i:0}function lc(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function xu(n,e,i,a,u,f){const g=ih(i,u,f),x=lc(i,a)*f;let b=0;const D=ac(n)/2;for(let A=0;A<n.length-1;A++){const P=n[A],F=n[A+1],$=P.dist(F);if(b+$>D){const H=(D-b)/$,ee=Vn(P.x,F.x,H),ue=Vn(P.y,F.y,H),fe=new Rl(ee,ue,0,F.angleTo(P),A);return!g||kc(n,fe,x,g,e)?fe:void 0}b+=$}}function Rc(n,e,i,a,u,f,g,x,b){const D=ih(a,f,g),A=lc(a,u),P=A*g,F=0===n[0].x||n[0].x===b||0===n[0].y||n[0].y===b;return e-P<e/4&&(e=P+e/4),sp(n,F?e/2*x%e:(A/2+2*f)*g*x%e,e,D,i,P,F,!1,b)}function sp(n,e,i,a,u,f,g,x,b){const D=f/2,A=ac(n);let P=0,F=e-i,$=[];for(let H=0;H<n.length-1;H++){const ee=n[H],ue=n[H+1],fe=ee.dist(ue),ve=ue.angleTo(ee);for(;F+i<P+fe;){F+=i;const Te=(F-P)/fe,Se=Vn(ee.x,ue.x,Te),Ie=Vn(ee.y,ue.y,Te);if(Se>=0&&Se<b&&Ie>=0&&Ie<b&&F-D>=0&&F+D<=A){const Pe=new Rl(Se,Ie,0,ve,H);Pe._round(),a&&!kc(n,Pe,f,a,u)||$.push(Pe)}}P+=fe}return x||$.length||g||($=sp(n,P/2,i,a,u,f,g,!0,b)),$}function pd(n,e,i,a,u){const f=[];for(let g=0;g<n.length;g++){const x=n[g];let b;for(let D=0;D<x.length-1;D++){let A=x[D],P=x[D+1];A.x<e&&P.x<e||(A.x<e?A=new Ve(e,A.y+(e-A.x)/(P.x-A.x)*(P.y-A.y))._round():P.x<e&&(P=new Ve(e,A.y+(e-A.x)/(P.x-A.x)*(P.y-A.y))._round()),A.y<i&&P.y<i||(A.y<i?A=new Ve(A.x+(i-A.y)/(P.y-A.y)*(P.x-A.x),i)._round():P.y<i&&(P=new Ve(A.x+(i-A.y)/(P.y-A.y)*(P.x-A.x),i)._round()),A.x>=a&&P.x>=a||(A.x>=a?A=new Ve(a,A.y+(a-A.x)/(P.x-A.x)*(P.y-A.y))._round():P.x>=a&&(P=new Ve(a,A.y+(a-A.x)/(P.x-A.x)*(P.y-A.y))._round()),A.y>=u&&P.y>=u||(A.y>=u?A=new Ve(A.x+(u-A.y)/(P.y-A.y)*(P.x-A.x),u)._round():P.y>=u&&(P=new Ve(A.x+(u-A.y)/(P.y-A.y)*(P.x-A.x),u)._round()),b&&A.equals(b[b.length-1])||(b=[A],f.push(b)),b.push(P)))))}}return f}Bt("Anchor",Rl);const Lc=1e20;function oh(n,e,i,a,u,f,g,x,b){for(let D=e;D<e+a;D++)sh(n,i*f+D,f,u,g,x,b);for(let D=i;D<i+u;D++)sh(n,D*f+e,1,a,g,x,b)}function sh(n,e,i,a,u,f,g){f[0]=0,g[0]=-Lc,g[1]=Lc,u[0]=n[e];for(let x=1,b=0,D=0;x<a;x++){u[x]=n[e+x*i];const A=x*x;do{const P=f[b];D=(u[x]-u[P]+A-P*P)/(x-P)/2}while(D<=g[b]&&--b>-1);b++,f[b]=x,g[b]=D,g[b+1]=Lc}for(let x=0,b=0;x<a;x++){for(;g[b+1]<x;)b++;const D=f[b],A=x-D;n[e+x*i]=u[D]+A*A}}const ah={none:0,ideographs:1,all:2};class il{constructor(e,i,a){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const a=[];for(const u in e)for(const f of e[u])a.push({stack:u,id:f});cn(a,({stack:u,id:f},g)=>{let x=this.entries[u];x||(x=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=x.glyphs[f];if(void 0!==b)return void g(null,{stack:u,id:f,glyph:b});if(b=this._tinySDF(x,u,f),b)return x.glyphs[f]=b,void g(null,{stack:u,id:f,glyph:b});const D=Math.floor(f/256);if(256*D>65535)return void g(new Error("glyphs > 65535 not supported"));if(x.ranges[D])return void g(null,{stack:u,id:f,glyph:b});let A=x.requests[D];A||(A=x.requests[D]=[],il.loadGlyphRange(u,D,this.url,this.requestManager,(P,F)=>{if(F){x.ascender=F.ascender,x.descender=F.descender;for(const $ in F.glyphs)this._doesCharSupportLocalGlyph(+$)||(x.glyphs[+$]=F.glyphs[+$]);x.ranges[D]=!0}for(const $ of A)$(P,F);delete x.requests[D]})),A.push((P,F)=>{P?g(P):F&&g(null,{stack:u,id:f,glyph:F.glyphs[f]||null})})},(u,f)=>{if(u)i(u);else if(f){const g={};for(const{stack:x,id:b,glyph:D}of f)void 0===g[x]&&(g[x]={}),void 0===g[x].glyphs&&(g[x].glyphs={}),g[x].glyphs[b]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},g[x].ascender=this.entries[x].ascender,g[x].descender=this.entries[x].descender;i(null,g)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==ah.none&&(this.localGlyphMode===ah.all?!!this.localFontFamily:!!this.localFontFamily&&(pi(e)||oo(e)||be(e)||Ue(e))||ge(e))}_tinySDF(e,i,a){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let f=e.tinySDF;if(!f){let ee="400";/bold/i.test(i)?ee="900":/medium/i.test(i)?ee="500":/light/i.test(i)&&(ee="200"),f=e.tinySDF=new il.TinySDF({fontFamily:u,fontWeight:ee,fontSize:48,buffer:6,radius:16}),f.fontWeight=ee}if(this.localGlyphs[f.fontWeight][a])return this.localGlyphs[f.fontWeight][a];const g=String.fromCharCode(a),{data:x,width:b,height:D,glyphWidth:A,glyphHeight:P,glyphLeft:F,glyphTop:$,glyphAdvance:H}=f.draw(g);return this.localGlyphs[f.fontWeight][a]={id:a,bitmap:new Il({width:b,height:D},x),metrics:{width:A/2,height:P/2,left:F/2,top:$/2-27,advance:H/2,localGlyph:!0}}}}function ap(n,e,i,a){const u=[],f=n.image,g=f.pixelRatio,x=f.paddedRect.w-2,b=f.paddedRect.h-2,D=n.right-n.left,A=n.bottom-n.top,P=f.stretchX||[[0,x]],F=f.stretchY||[[0,b]],$=(Qe,ht)=>Qe+ht[1]-ht[0],H=P.reduce($,0),ee=F.reduce($,0),ue=x-H,fe=b-ee;let ve=0,Te=H,Se=0,Ie=ee,Pe=0,Ye=ue,We=0,It=fe;if(f.content&&a){const Qe=f.content;ve=bu(P,0,Qe[0]),Se=bu(F,0,Qe[1]),Te=bu(P,Qe[0],Qe[2]),Ie=bu(F,Qe[1],Qe[3]),Pe=Qe[0]-ve,We=Qe[1]-Se,Ye=Qe[2]-Qe[0]-Te,It=Qe[3]-Qe[1]-Ie}const ct=(Qe,ht,pt,ot)=>{const kt=wu(Qe.stretch-ve,Te,D,n.left),Nt=Eu(Qe.fixed-Pe,Ye,Qe.stretch,H),Sn=wu(ht.stretch-Se,Ie,A,n.top),Er=Eu(ht.fixed-We,It,ht.stretch,ee),gn=wu(pt.stretch-ve,Te,D,n.left),nr=Eu(pt.fixed-Pe,Ye,pt.stretch,H),Rt=wu(ot.stretch-Se,Ie,A,n.top),Dr=Eu(ot.fixed-We,It,ot.stretch,ee),tr=new Ve(kt,Sn),_i=new Ve(gn,Sn),ai=new Ve(gn,Rt),Si=new Ve(kt,Rt),zi=new Ve(Nt/g,Er/g),pr=new Ve(nr/g,Dr/g),ir=e*Math.PI/180;if(ir){const yi=Math.sin(ir),Ii=Math.cos(ir),ao=[Ii,-yi,yi,Ii];tr._matMult(ao),_i._matMult(ao),Si._matMult(ao),ai._matMult(ao)}const Br=Qe.stretch+Qe.fixed,qi=ht.stretch+ht.fixed;return{tl:tr,tr:_i,bl:Si,br:ai,tex:{x:f.paddedRect.x+1+Br,y:f.paddedRect.y+1+qi,w:pt.stretch+pt.fixed-Br,h:ot.stretch+ot.fixed-qi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:zi,pixelOffsetBR:pr,minFontScaleX:Ye/g/D,minFontScaleY:It/g/A,isSDF:i}};if(a&&(f.stretchX||f.stretchY)){const Qe=Fm(P,ue,H),ht=Fm(F,fe,ee);for(let pt=0;pt<Qe.length-1;pt++){const ot=Qe[pt],kt=Qe[pt+1];for(let Nt=0;Nt<ht.length-1;Nt++)u.push(ct(ot,ht[Nt],kt,ht[Nt+1]))}}else u.push(ct({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:b+1}));return u}function bu(n,e,i){let a=0;for(const u of n)a+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return a}function Fm(n,e,i){const a=[{fixed:-1,stretch:0}];for(const[u,f]of n){const g=a[a.length-1];a.push({fixed:u-g.stretch,stretch:g.stretch}),a.push({fixed:u-g.stretch,stretch:g.stretch+(f-u)})}return a.push({fixed:e+1,stretch:i}),a}function wu(n,e,i,a){return n/e*i+a}function Eu(n,e,i,a){return n-e*i/a}function Om(n,e,i,a){const u=e+n.positionedLines[a].lineOffset;return 0===a?i+u/2:i+(u+(e+n.positionedLines[a-1].lineOffset))/2}il.loadGlyphRange=function(n,e,i,a,u){const f=256*e,g=f+255,x=a.transformRequest(a.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${f}-${g}`),Ai.Glyphs);Z(x,(b,D)=>{if(b)u(b);else if(D){const A={},P=new Pl(D).readFields(h_,{});for(const F of P.glyphs)A[F.id]=F;u(null,{glyphs:A,ascender:P.ascender,descender:P.descender})}})},il.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:g="normal"}){this.buffer=e,this.cutoff=a,this.radius=i;const x=this.size=n+4*e,b=this._createCanvas(x),D=this.ctx=b.getContext("2d",{willReadFrequently:!0});D.font=`${g} ${f} ${n}px ${u}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(n),g=Math.floor(i),x=Math.min(this.size-this.buffer,Math.ceil(f-u)),b=Math.min(this.size-this.buffer,Math.ceil(i)+Math.ceil(a)),D=x+2*this.buffer,A=b+2*this.buffer,P=D*A,F=new Uint8ClampedArray(P),$={data:F,width:D,height:A,glyphWidth:x,glyphHeight:b,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(0===x||0===b)return $;const{ctx:H,buffer:ee,gridInner:ue,gridOuter:fe}=this;H.clearRect(ee,ee,x,b),H.fillText(n,ee,ee+g+1);const ve=H.getImageData(ee,ee,x,b);fe.fill(Lc,0,P),ue.fill(0,0,P);for(let Te=0;Te<b;Te++)for(let Se=0;Se<x;Se++){const Ie=ve.data[4*(Te*x+Se)+3]/255;if(0===Ie)continue;const Pe=(Te+ee)*D+Se+ee;if(1===Ie)fe[Pe]=0,ue[Pe]=Lc;else{const Ye=.5-Ie;fe[Pe]=Ye>0?Ye*Ye:0,ue[Pe]=Ye<0?Ye*Ye:0}}oh(fe,0,0,D,A,D,this.f,this.v,this.z),oh(ue,ee,ee,x,b,D,this.f,this.v,this.z);for(let Te=0;Te<P;Te++){const Se=Math.sqrt(fe[Te])-Math.sqrt(ue[Te]);F[Te]=Math.round(255-255*(Se/this.radius+this.cutoff))}return $}};class lp{constructor(e=[],i=zm){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:a}=this,u=i[e];for(;e>0;){const f=e-1>>1,g=i[f];if(a(u,g)>=0)break;i[e]=g,e=f}i[e]=u}_down(e){const{data:i,compare:a}=this,u=this.length>>1,f=i[e];for(;e<u;){let g=1+(e<<1),x=i[g];const b=g+1;if(b<this.length&&a(i[b],x)<0&&(g=b,x=i[b]),a(x,f)>=0)break;i[e]=x,e=g}i[e]=f}}function zm(n,e){return n<e?-1:n>e?1:0}function Bm(n,e=1,i=!1){let a=1/0,u=1/0,f=-1/0,g=-1/0;const x=n[0];for(let $=0;$<x.length;$++){const H=x[$];(!$||H.x<a)&&(a=H.x),(!$||H.y<u)&&(u=H.y),(!$||H.x>f)&&(f=H.x),(!$||H.y>g)&&(g=H.y)}const b=Math.min(f-a,g-u);let D=b/2;const A=new lp([],ys);if(0===b)return new Ve(a,u);for(let $=a;$<f;$+=b)for(let H=u;H<g;H+=b)A.push(new Fc($+D,H+D,D,n));let P=function($){let H=0,ee=0,ue=0;const fe=$[0];for(let ve=0,Te=fe.length,Se=Te-1;ve<Te;Se=ve++){const Ie=fe[ve],Pe=fe[Se],Ye=Ie.x*Pe.y-Pe.x*Ie.y;ee+=(Ie.x+Pe.x)*Ye,ue+=(Ie.y+Pe.y)*Ye,H+=3*Ye}return new Fc(ee/H,ue/H,0,$)}(n),F=A.length;for(;A.length;){const $=A.pop();($.d>P.d||!P.d)&&(P=$,i&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,F)),$.max-P.d<=e||(D=$.h/2,A.push(new Fc($.p.x-D,$.p.y-D,D,n)),A.push(new Fc($.p.x+D,$.p.y-D,D,n)),A.push(new Fc($.p.x-D,$.p.y+D,D,n)),A.push(new Fc($.p.x+D,$.p.y+D,D,n)),F+=4)}return i&&(console.log(`num probes: ${F}`),console.log(`best distance: ${P.d}`)),P.p}function ys(n,e){return e.max-n.max}function Fc(n,e,i,a){this.p=new Ve(n,e),this.h=i,this.d=function(u,f){let g=!1,x=1/0;for(let b=0;b<f.length;b++){const D=f[b];for(let A=0,P=D.length,F=P-1;A<P;F=A++){const $=D[A],H=D[F];$.y>u.y!=H.y>u.y&&u.x<(H.x-$.x)*(u.y-$.y)/(H.y-$.y)+$.x&&(g=!g),x=Math.min(x,ff(u,$,H))}}return(g?1:-1)*Math.sqrt(x)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}const md=Number.POSITIVE_INFINITY,p_=Math.sqrt(2);function Nm(n,e){return e[1]!==md?function(i,a,u){let f=0,g=0;switch(a=Math.abs(a),u=Math.abs(u),i){case"top-right":case"top-left":case"top":g=u-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-u}switch(i){case"top-right":case"bottom-right":case"right":f=-a;break;case"top-left":case"bottom-left":case"left":f=a}return[f,g]}(n,e[0],e[1]):function(i,a){let u=0,f=0;a<0&&(a=0);const g=a/p_;switch(i){case"top-right":case"top-left":f=g-7;break;case"bottom-right":case"bottom-left":f=7-g;break;case"bottom":f=7-a;break;case"top":f=a-7}switch(i){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=a;break;case"right":u=-a}return[u,f]}(n,e[0])}function cp(n,e,i,a,u,f,g,x,b){n.createArrays(),n.tilePixelRatio=Yn/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const D=n.layers[0].layout,A=n.layers[0]._unevaluatedLayout._values,P={};if("composite"===n.textSizeData.kind){const{minZoom:H,maxZoom:ee}=n.textSizeData;P.compositeTextSizes=[A["text-size"].possiblyEvaluate(new j(H),x),A["text-size"].possiblyEvaluate(new j(ee),x)]}if("composite"===n.iconSizeData.kind){const{minZoom:H,maxZoom:ee}=n.iconSizeData;P.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new j(H),x),A["icon-size"].possiblyEvaluate(new j(ee),x)]}P.layoutTextSize=A["text-size"].possiblyEvaluate(new j(b+1),x),P.layoutIconSize=A["icon-size"].possiblyEvaluate(new j(b+1),x),P.textMaxSize=A["text-size"].possiblyEvaluate(new j(18),x);const F="map"===D.get("text-rotation-alignment")&&"point"!==D.get("symbol-placement"),$=D.get("text-size");for(const H of n.features){const ee=D.get("text-font").evaluate(H,{},x).join(","),ue=$.evaluate(H,{},x),fe=P.layoutTextSize.evaluate(H,{},x),ve=(P.layoutIconSize.evaluate(H,{},x),{horizontal:{},vertical:void 0}),Te=H.text;let Se,Ie=[0,0];if(Te){const We=Te.toString(),It=24*D.get("text-letter-spacing").evaluate(H,{},x),ct=24*D.get("text-line-height").evaluate(H,{},x),Qe=Kc(We)?It:0,ht=D.get("text-anchor").evaluate(H,{},x),pt=D.get("text-variable-anchor");if(!pt){const gn=D.get("text-radial-offset").evaluate(H,{},x);Ie=gn?Nm(ht,[24*gn,md]):D.get("text-offset").evaluate(H,{},x).map(nr=>24*nr)}let ot=F?"center":D.get("text-justify").evaluate(H,{},x);const kt=D.get("symbol-placement"),Nt="point"===kt,Sn="point"===kt?24*D.get("text-max-width").evaluate(H,{},x):0,Er=gn=>{n.allowVerticalPlacement&&Qa(We)&&(ve.vertical=cd(Te,e,i,u,ee,Sn,ct,ht,gn,Qe,Ie,Ls.vertical,!0,kt,fe,ue))};if(!F&&pt){const gn="auto"===ot?pt.map(Rt=>up(Rt)):[ot];let nr=!1;for(let Rt=0;Rt<gn.length;Rt++){const Dr=gn[Rt];if(!ve.horizontal[Dr])if(nr)ve.horizontal[Dr]=ve.horizontal[0];else{const tr=cd(Te,e,i,u,ee,Sn,ct,"center",Dr,Qe,Ie,Ls.horizontal,!1,kt,fe,ue);tr&&(ve.horizontal[Dr]=tr,nr=1===tr.positionedLines.length)}}Er("left")}else{if("auto"===ot&&(ot=up(ht)),Nt||D.get("text-writing-mode").indexOf("horizontal")>=0||!Qa(We)){const gn=cd(Te,e,i,u,ee,Sn,ct,ht,ot,Qe,Ie,Ls.horizontal,!1,kt,fe,ue);gn&&(ve.horizontal[ot]=gn)}Er("point"===kt?"left":ot)}}let Pe=!1;if(H.icon&&H.icon.name){const We=a[H.icon.name];We&&(Se=ip(u[H.icon.name],D.get("icon-offset").evaluate(H,{},x),D.get("icon-anchor").evaluate(H,{},x)),Pe=We.sdf,void 0===n.sdfIcons?n.sdfIcons=We.sdf:n.sdfIcons!==We.sdf&&zt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(We.pixelRatio!==n.pixelRatio||0!==D.get("icon-rotate").constantOr(1))&&(n.iconsNeedLinear=!0))}const Ye=hp(ve.horizontal)||ve.vertical;n.iconsInText||(n.iconsInText=!!Ye&&Ye.iconsInText),(Ye||Se)&&Um(n,H,ve,Se,a,P,fe,0,Ie,Pe,g,x)}f&&n.generateCollisionDebugBuffers(b,n.collisionBoxArray)}function up(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Um(n,e,i,a,u,f,g,x,b,D,A,P){let F=f.textMaxSize.evaluate(e,{},P);void 0===F&&(F=g);const $=n.layers[0].layout,H=$.get("icon-offset").evaluate(e,{},P),ee=hp(i.horizontal)||i.vertical,ue=g/24,fe=n.tilePixelRatio*F/24,ve=n.tilePixelRatio*$.get("symbol-spacing"),Te=$.get("text-padding")*n.tilePixelRatio,Se=$.get("icon-padding")*n.tilePixelRatio,Ie=bt($.get("text-max-angle")),Pe="map"===$.get("text-rotation-alignment")&&"point"!==$.get("symbol-placement"),Ye="map"===$.get("icon-rotation-alignment")&&"point"!==$.get("symbol-placement"),We=$.get("symbol-placement"),It=ve/2,ct=$.get("icon-text-fit");let Qe;a&&"none"!==ct&&(n.allowVerticalPlacement&&i.vertical&&(Qe=op(a,i.vertical,ct,$.get("icon-text-fit-padding"),H,ue)),ee&&(a=op(a,ee,ct,$.get("icon-text-fit-padding"),H,ue)));const ht=(pt,ot)=>{ot.x<0||ot.x>=Yn||ot.y<0||ot.y>=Yn||function(kt,Nt,Sn,Er,gn,nr,Rt,Dr,tr,_i,ai,Si,zi,pr,ir,Br,qi,yi,Ii,ao,Yr,es,Sr,ti,ni){const li=kt.addToLineVertexArray(Nt,Er);let ci,Bi,Ar,vo,Bs,Ns,Us,lo=0,xo=0,La=0,jc=0,hc=-1,al=-1;const Fa={};let Od=Ca(""),zd=0,Bd=0;if(void 0===tr._unevaluatedLayout.getValue("text-radial-offset")?[zd,Bd]=tr.layout.get("text-offset").evaluate(Yr,{},ni).map(Vo=>24*Vo):(zd=24*tr.layout.get("text-radial-offset").evaluate(Yr,{},ni),Bd=md),kt.allowVerticalPlacement&&gn.vertical){const Vo=gn.vertical;if(ir)Ns=_d(Vo),Dr&&(Us=_d(Dr));else{const ts=tr.layout.get("text-rotate").evaluate(Yr,{},ni)+90;Ar=lh(_i,Sn,Nt,ai,Si,zi,Vo,pr,ts,Br),Dr&&(vo=lh(_i,Sn,Nt,ai,Si,zi,Dr,yi,ts))}}if(nr){const Vo=tr.layout.get("icon-rotate").evaluate(Yr,{},ni),ts="none"!==tr.layout.get("icon-text-fit"),$c=ap(nr,Vo,Sr,ts),vh=Dr?ap(Dr,Vo,Sr,ts):void 0;Bi=lh(_i,Sn,Nt,ai,Si,zi,nr,yi,Vo),lo=4*$c.length;const xh=kt.iconSizeData;let Gc=null;"source"===xh.kind?(Gc=[oa*tr.layout.get("icon-size").evaluate(Yr,{},ni)],Gc[0]>Aa&&zt(`${kt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===xh.kind&&(Gc=[oa*es.compositeIconSizes[0].evaluate(Yr,{},ni),oa*es.compositeIconSizes[1].evaluate(Yr,{},ni)],(Gc[0]>Aa||Gc[1]>Aa)&&zt(`${kt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),kt.addSymbols(kt.icon,$c,Gc,ao,Ii,Yr,!1,Sn,Nt,li.lineStartIndex,li.lineLength,-1,ti,ni),hc=kt.icon.placedSymbolArray.length-1,vh&&(xo=4*vh.length,kt.addSymbols(kt.icon,vh,Gc,ao,Ii,Yr,Ls.vertical,Sn,Nt,li.lineStartIndex,li.lineLength,-1,ti,ni),al=kt.icon.placedSymbolArray.length-1)}for(const Vo in gn.horizontal){const ts=gn.horizontal[Vo];ci||(Od=Ca(ts.text),ir?Bs=_d(ts):ci=lh(_i,Sn,Nt,ai,Si,zi,ts,pr,tr.layout.get("text-rotate").evaluate(Yr,{},ni),Br));const $c=1===ts.positionedLines.length;if(La+=gd(kt,Sn,Nt,ts,Rt,tr,ir,Yr,Br,li,gn.vertical?Ls.horizontal:Ls.horizontalOnly,$c?Object.keys(gn.horizontal):[Vo],Fa,hc,es,ti,ni),$c)break}gn.vertical&&(jc+=gd(kt,Sn,Nt,gn.vertical,Rt,tr,ir,Yr,Br,li,Ls.vertical,["vertical"],Fa,al,es,ti,ni));let zl=-1;const Nd=(Vo,ts)=>Vo?Math.max(Vo,ts):ts;zl=Nd(Bs,zl),zl=Nd(Ns,zl),zl=Nd(Us,zl);const Qm=zl>-1?1:0;kt.glyphOffsetArray.length>=yo.MAX_GLYPHS&&zt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Yr.sortKey&&kt.addToSortKeyRanges(kt.symbolInstances.length,Yr.sortKey),kt.symbolInstances.emplaceBack(Sn.x,Sn.y,Sn.z,Nt.x,Nt.y,Fa.right>=0?Fa.right:-1,Fa.center>=0?Fa.center:-1,Fa.left>=0?Fa.left:-1,Fa.vertical>=0?Fa.vertical:-1,hc,al,Od,void 0!==ci?ci:kt.collisionBoxArray.length,void 0!==ci?ci+1:kt.collisionBoxArray.length,void 0!==Ar?Ar:kt.collisionBoxArray.length,void 0!==Ar?Ar+1:kt.collisionBoxArray.length,void 0!==Bi?Bi:kt.collisionBoxArray.length,void 0!==Bi?Bi+1:kt.collisionBoxArray.length,vo||kt.collisionBoxArray.length,vo?vo+1:kt.collisionBoxArray.length,ai,La,jc,lo,xo,Qm,0,zd,Bd,zl)}(n,ot,ot,pt,i,a,u,Qe,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,Te,Pe,b,0,Se,Ye,H,e,f,D,A,P)};if("line"===We)for(const pt of pd(e.geometry,0,0,Yn,Yn)){const ot=Rc(pt,ve,Ie,i.vertical||ee,a,24,fe,n.overscaling,Yn);for(const kt of ot){const Nt=ee;Nt&&dp(n,Nt.text,It,kt)||ht(pt,kt)}}else if("line-center"===We){for(const pt of e.geometry)if(pt.length>1){const ot=xu(pt,Ie,i.vertical||ee,a,24,fe);ot&&ht(pt,ot)}}else if("Polygon"===e.type)for(const pt of el(e.geometry,0)){const ot=Bm(pt,16);ht(pt[0],new Rl(ot.x,ot.y,0,0,void 0))}else if("LineString"===e.type)for(const pt of e.geometry)ht(pt,new Rl(pt[0].x,pt[0].y,0,0,void 0));else if("Point"===e.type)for(const pt of e.geometry)for(const ot of pt)ht([ot],new Rl(ot.x,ot.y,0,0,void 0))}const Aa=32640;function gd(n,e,i,a,u,f,g,x,b,D,A,P,F,$,H,ee,ue){const fe=function(Se,Ie,Pe,Ye,We,It,ct,Qe){const ht=[];if(0===Ie.positionedLines.length)return ht;const pt=Ye.layout.get("text-rotate").evaluate(It,{})*Math.PI/180,ot=function(gn){const nr=gn[0],Rt=gn[1],Dr=nr*Rt;return Dr>0?[nr,-Rt]:Dr<0?[-nr,Rt]:0===nr?[Rt,nr]:[Rt,-nr]}(Pe);let kt=Math.abs(Ie.top-Ie.bottom);for(const gn of Ie.positionedLines)kt-=gn.lineOffset;const Nt=Ie.positionedLines.length,Sn=kt/Nt;let Er=Ie.top-Pe[1];for(let gn=0;gn<Nt;++gn){const nr=Ie.positionedLines[gn];Er=Om(Ie,Sn,Er,gn);for(const Rt of nr.positionedGlyphs){if(!Rt.rect)continue;const Dr=Rt.rect||{};let tr=4,_i=!0,ai=1,Si=0;if(Rt.imageName){const Ar=ct[Rt.imageName];if(!Ar)continue;if(Ar.sdf){zt("SDF images are not supported in formatted text and will be ignored.");continue}_i=!1,ai=Ar.pixelRatio,tr=1/ai}const zi=(We||Qe)&&Rt.vertical,pr=Rt.metrics.advance*Rt.scale/2,ir=Rt.metrics,Br=Rt.rect;if(null===Br)continue;Qe&&Ie.verticalizable&&(Si=Rt.imageName?pr-Rt.metrics.width*Rt.scale/2:0);const qi=We?[Rt.x+pr,Rt.y]:[0,0];let yi=[0,0],Ii=[0,0],ao=!1;We||(zi?(Ii=[Rt.x+pr+ot[0],Rt.y+ot[1]-Si],ao=!0):yi=[Rt.x+pr+Pe[0],Rt.y+Pe[1]-Si]);const Yr=Br.w*Rt.scale/(ai*(Rt.localGlyph?2:1)),es=Br.h*Rt.scale/(ai*(Rt.localGlyph?2:1));let Sr,ti,ni,li;if(zi){const Ar=Rt.y-Er,vo=new Ve(-pr,pr-Ar),Bs=-Math.PI/2,Ns=new Ve(...Ii);Sr=new Ve(-pr+yi[0],yi[1]),Sr._rotateAround(Bs,vo)._add(Ns),Sr.x+=-Ar+pr,Sr.y-=(ir.left-tr)*Rt.scale;const Us=Rt.imageName?ir.advance*Rt.scale:24*Rt.scale,lo=String.fromCharCode(Rt.glyph);l_(lo)?Sr.x+=(1-tr)*Rt.scale:Yf(lo)?Sr.x+=Us-ir.height*Rt.scale+(-tr-1)*Rt.scale:Sr.x+=Rt.imageName||ir.width+2*tr===Br.w&&ir.height+2*tr===Br.h?(Us-es)/2:(Us-(ir.height+2*tr)*Rt.scale)/2,ti=new Ve(Sr.x,Sr.y-Yr),ni=new Ve(Sr.x+es,Sr.y),li=new Ve(Sr.x+es,Sr.y-Yr)}else{const Ar=(ir.left-tr)*Rt.scale-pr+yi[0],vo=(-ir.top-tr)*Rt.scale+yi[1],Bs=Ar+Yr,Ns=vo+es;Sr=new Ve(Ar,vo),ti=new Ve(Bs,vo),ni=new Ve(Ar,Ns),li=new Ve(Bs,Ns)}if(pt){let Ar;Ar=We?new Ve(0,0):ao?new Ve(ot[0],ot[1]):new Ve(Pe[0],Pe[1]),Sr._rotateAround(pt,Ar),ti._rotateAround(pt,Ar),ni._rotateAround(pt,Ar),li._rotateAround(pt,Ar)}const ci=new Ve(0,0),Bi=new Ve(0,0);ht.push({tl:Sr,tr:ti,bl:ni,br:li,tex:Dr,writingMode:Ie.writingMode,glyphOffset:qi,sectionIndex:Rt.sectionIndex,isSDF:_i,pixelOffsetTL:ci,pixelOffsetBR:Bi,minFontScaleX:0,minFontScaleY:0})}}return ht}(0,a,b,f,g,x,u,n.allowVerticalPlacement),ve=n.textSizeData;let Te=null;"source"===ve.kind?(Te=[oa*f.layout.get("text-size").evaluate(x,{},ue)],Te[0]>Aa&&zt(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ve.kind&&(Te=[oa*H.compositeTextSizes[0].evaluate(x,{},ue),oa*H.compositeTextSizes[1].evaluate(x,{},ue)],(Te[0]>Aa||Te[1]>Aa)&&zt(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,fe,Te,b,g,x,A,e,i,D.lineStartIndex,D.lineLength,$,ee,ue);for(const Se of P)F[Se]=n.text.placedSymbolArray.length-1;return 4*fe.length}function hp(n){for(const e in n)return n[e];return null}function lh(n,e,i,a,u,f,g,x,b,D){let A=g.top,P=g.bottom,F=g.left,$=g.right;const H=g.collisionPadding;if(H&&(F-=H[0],A-=H[1],$+=H[2],P+=H[3]),b){const ee=new Ve(F,A),ue=new Ve($,A),fe=new Ve(F,P),ve=new Ve($,P),Te=bt(b);let Se=new Ve(0,0);D&&(Se=new Ve(D[0],D[1])),ee._rotateAround(Te,Se),ue._rotateAround(Te,Se),fe._rotateAround(Te,Se),ve._rotateAround(Te,Se),F=Math.min(ee.x,ue.x,fe.x,ve.x),$=Math.max(ee.x,ue.x,fe.x,ve.x),A=Math.min(ee.y,ue.y,fe.y,ve.y),P=Math.max(ee.y,ue.y,fe.y,ve.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,F,A,$,P,x,a,u,f),n.length-1}function _d(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function dp(n,e,i,a){const u=n.compareText;if(e in u){const f=u[e];for(let g=f.length-1;g>=0;g--)if(a.dist(f[g])<i)return!0}else u[e]=[];return u[e].push(a),!1}const Vm=oc.VectorTileFeature.types,fp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ch(n,e,i,a,u,f,g,x,b,D,A,P,F,$,H,ee){const ue=A?Math.min(Aa,Math.round(A[0])):0,fe=A?Math.min(Aa,Math.round(A[1])):0;n.emplaceBack(e,i,Math.round(32*g),Math.round(32*x),b,D,(ue<<1)+(P?1:0),fe,16*F,16*$,256*H,256*ee,a,u,f,0)}function yd(n,e,i){n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i)}function pp(n){for(const e of n.sections)if(Di(e.text))return!0;return!1}class uh{constructor(e){this.layoutVertexArray=new An,this.indexArray=new mi,this.programConfigurations=e,this.segments=new gi,this.dynamicLayoutVertexArray=new yn,this.opacityVertexArray=new Dn,this.placedSymbolArray=new Bu}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,i,a,u){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Tm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Bn.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,fp,!0),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Bt("SymbolBuffers",uh);class vd{constructor(e,i,a){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new a,this.segments=new gi,this.collisionVertexArray=new Ci,this.collisionVertexArrayExt=new yn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,qf.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Wf.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Bt("CollisionBuffers",vd);class yo{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ou([]),this.placementViewportMatrix=ou([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=od(this.zoom,i["text-size"]),this.iconSizeData=od(this.zoom,i["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),f=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==u.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(g=>Ls[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID}createArrays(){this.text=new uh(new bc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new uh(new bc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Nu,this.lineVertexArray=new yc,this.symbolInstances=new Ps}calculateGlyphDependencies(e,i,a,u,f){for(let g=0;g<e.length;g++)if(i[e.charCodeAt(g)]=!0,u&&f){const x=sc[e.charAt(g)];x&&(i[x.charCodeAt(0)]=!0)}}populate(e,i,a,u){const f=this.layers[0],g=f.layout,x=g.get("text-font"),b=g.get("text-field"),D=g.get("icon-image"),A=("constant"!==b.value.kind||b.value.value instanceof Jn&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),P="constant"!==D.value.kind||!!D.value.value||Object.keys(D.parameters).length>0,F=g.get("symbol-sort-key");if(this.features=[],!A&&!P)return;const $=i.iconDependencies,H=i.glyphDependencies,ee=i.availableImages,ue=new j(this.zoom);for(const{feature:fe,id:ve,index:Te,sourceLayerIndex:Se}of e){const Ie=f._featureFilter.needGeometry,Pe=Ia(fe,Ie);if(!f._featureFilter.filter(ue,Pe,a))continue;let Ye,We;if(Ie||(Pe.geometry=Sa(fe,a,u)),A){const ct=f.getValueAndResolveTokens("text-field",Pe,a,ee),Qe=Jn.factory(ct);pp(Qe)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===R()||this.hasRTLText&&N.isParsed())&&(Ye=Xf(Qe,f,Pe))}if(P){const ct=f.getValueAndResolveTokens("icon-image",Pe,a,ee);We=ct instanceof ii?ct:ii.fromString(ct)}if(!Ye&&!We)continue;const It=this.sortFeaturesByKey?F.evaluate(Pe,{},a):void 0;if(this.features.push({id:ve,text:Ye,icon:We,index:Te,sourceLayerIndex:Se,geometry:Pe.geometry,properties:fe.properties,type:Vm[fe.type],sortKey:It}),We&&($[We.name]=!0),Ye){const ct=x.evaluate(Pe,{},a).join(","),Qe="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ls.vertical)>=0;for(const ht of Ye.sections)if(ht.image)$[ht.image.name]=!0;else{const pt=Qa(Ye.toString()),ot=ht.fontStack||ct,kt=H[ot]=H[ot]||{};this.calculateGlyphDependencies(ht.text,kt,Qe,this.allowVerticalPlacement,pt)}}}"line"===g.get("symbol-placement")&&(this.features=function(fe){const ve={},Te={},Se=[];let Ie=0;function Pe(ct){Se.push(fe[ct]),Ie++}function Ye(ct,Qe,ht){const pt=Te[ct];return delete Te[ct],Te[Qe]=pt,Se[pt].geometry[0].pop(),Se[pt].geometry[0]=Se[pt].geometry[0].concat(ht[0]),pt}function We(ct,Qe,ht){const pt=ve[Qe];return delete ve[Qe],ve[ct]=pt,Se[pt].geometry[0].shift(),Se[pt].geometry[0]=ht[0].concat(Se[pt].geometry[0]),pt}function It(ct,Qe,ht){const pt=ht?Qe[0][Qe[0].length-1]:Qe[0][0];return`${ct}:${pt.x}:${pt.y}`}for(let ct=0;ct<fe.length;ct++){const Qe=fe[ct],ht=Qe.geometry,pt=Qe.text?Qe.text.toString():null;if(!pt){Pe(ct);continue}const ot=It(pt,ht),kt=It(pt,ht,!0);if(ot in Te&&kt in ve&&Te[ot]!==ve[kt]){const Nt=We(ot,kt,ht),Sn=Ye(ot,kt,Se[Nt].geometry);delete ve[ot],delete Te[kt],Te[It(pt,Se[Sn].geometry,!0)]=Sn,Se[Nt].geometry=null}else ot in Te?Ye(ot,kt,ht):kt in ve?We(ot,kt,ht):(Pe(ct),ve[ot]=Ie-1,Te[kt]=Ie-1)}return Se.filter(ct=>ct.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((fe,ve)=>fe.sortKey-ve.sortKey)}update(e,i,a,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,a,u),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,a,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const a=this.lineVertexArray.length;if(void 0!==e.segment){let u=e.dist(i[e.segment+1]),f=e.dist(i[e.segment]);const g={};for(let x=e.segment+1;x<i.length;x++)g[x]={x:i[x].x,y:i[x].y,tileUnitDistanceFromAnchor:u},x<i.length-1&&(u+=i[x+1].dist(i[x]));for(let x=e.segment||0;x>=0;x--)g[x]={x:i[x].x,y:i[x].y,tileUnitDistanceFromAnchor:f},x>0&&(f+=i[x-1].dist(i[x]));for(let x=0;x<i.length;x++){const b=g[x];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,i,a,u,f,g,x,b,D,A,P,F,$,H){const ee=e.indexArray,ue=e.layoutVertexArray,fe=e.segments.prepareSegment(4*i.length,ue,ee,this.canOverlap?g.sortKey:void 0),ve=this.glyphOffsetArray.length,Te=fe.vertexLength,Se=this.allowVerticalPlacement&&x===Ls.vertical?Math.PI/2:0,Ie=g.text&&g.text.sections;for(let Pe=0;Pe<i.length;Pe++){const{tl:Ye,tr:We,bl:It,br:ct,tex:Qe,pixelOffsetTL:ht,pixelOffsetBR:pt,minFontScaleX:ot,minFontScaleY:kt,glyphOffset:Nt,isSDF:Sn,sectionIndex:Er}=i[Pe],gn=fe.vertexLength,nr=Nt[1];ch(ue,b.x,b.y,b.z,D.x,D.y,Ye.x,nr+Ye.y,Qe.x,Qe.y,a,Sn,ht.x,ht.y,ot,kt),ch(ue,b.x,b.y,b.z,D.x,D.y,We.x,nr+We.y,Qe.x+Qe.w,Qe.y,a,Sn,pt.x,ht.y,ot,kt),ch(ue,b.x,b.y,b.z,D.x,D.y,It.x,nr+It.y,Qe.x,Qe.y+Qe.h,a,Sn,ht.x,pt.y,ot,kt),ch(ue,b.x,b.y,b.z,D.x,D.y,ct.x,nr+ct.y,Qe.x+Qe.w,Qe.y+Qe.h,a,Sn,pt.x,pt.y,ot,kt),yd(e.dynamicLayoutVertexArray,b,Se),ee.emplaceBack(gn,gn+1,gn+2),ee.emplaceBack(gn+1,gn+2,gn+3),fe.vertexLength+=4,fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Nt[0]),Pe!==i.length-1&&Er===i[Pe+1].sectionIndex||e.programConfigurations.populatePaintArrays(ue.length,g,g.index,{},$,H,Ie&&Ie[Er])}e.placedSymbolArray.emplaceBack(b.x,b.y,b.z,D.x,D.y,ve,this.glyphOffsetArray.length-ve,Te,A,P,D.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],x,0,!1,0,F,0)}_commitLayoutVertex(e,i,a,u,f,g,x){e.emplaceBack(i,a,u,f,g,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,i,a,u,f,g,x){const b=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),D=b.vertexLength,A=x.tileAnchorX,P=x.tileAnchorY;for(let $=0;$<4;$++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),a.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(a.layoutVertexArray,u,f,g,A,P,new Ve(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,f,g,A,P,new Ve(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,f,g,A,P,new Ve(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,f,g,A,P,new Ve(e.x1,e.y2)),b.vertexLength+=4;const F=a.indexArray;F.emplaceBack(D,D+1),F.emplaceBack(D+1,D+2),F.emplaceBack(D+2,D+3),F.emplaceBack(D+3,D),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,a,u,f,g){for(let x=u;x<f;x++){const b=a.get(x),D=this.getSymbolInstanceTextSize(e,g,i,x);this._addCollisionDebugVertices(b,D,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,i,a,u,f,g){for(let x=u;x<f;x++){const b=a.get(x),D=this.getSymbolInstanceIconSize(e,i,x);this._addCollisionDebugVertices(b,D,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vd(so,id.members,hr),this.iconCollisionBox=new vd(so,id.members,hr);const a=Jo(this.iconSizeData,e),u=Jo(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(u,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(u,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,i,a,u){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),g=Ac(this.textSizeData,e,f)/24;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,i,a){const u=this.icon.placedSymbolArray.get(a),f=Ac(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,i,a){e.emplaceBack(i,-a,-a),e.emplaceBack(i,a,-a),e.emplaceBack(i,a,a),e.emplaceBack(i,-a,a)}_updateTextDebugCollisionBoxes(e,i,a,u,f,g){for(let x=u;x<f;x++){const b=a.get(x),D=this.getSymbolInstanceTextSize(e,g,i,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,b.padding)}}_updateIconDebugCollisionBoxes(e,i,a,u,f){for(let g=u;g<f;g++){const x=a.get(g),b=this.getSymbolInstanceIconSize(e,i,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,x.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=Jo(this.iconSizeData,e),u=Jo(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(u,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(u,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(a,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(a,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,a,u,f,g,x,b,D){const A={};for(let P=i;P<a;P++){const F=e.get(P);A.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,padding:F.padding,projectedAnchorX:F.projectedAnchorX,projectedAnchorY:F.projectedAnchorY,projectedAnchorZ:F.projectedAnchorZ,tileAnchorX:F.tileAnchorX,tileAnchorY:F.tileAnchorY},A.textFeatureIndex=F.featureIndex;break}for(let P=u;P<f;P++){const F=e.get(P);A.verticalTextBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,padding:F.padding,projectedAnchorX:F.projectedAnchorX,projectedAnchorY:F.projectedAnchorY,projectedAnchorZ:F.projectedAnchorZ,tileAnchorX:F.tileAnchorX,tileAnchorY:F.tileAnchorY},A.verticalTextFeatureIndex=F.featureIndex;break}for(let P=g;P<x;P++){const F=e.get(P);A.iconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,padding:F.padding,projectedAnchorX:F.projectedAnchorX,projectedAnchorY:F.projectedAnchorY,projectedAnchorZ:F.projectedAnchorZ,tileAnchorX:F.tileAnchorX,tileAnchorY:F.tileAnchorY},A.iconFeatureIndex=F.featureIndex;break}for(let P=b;P<D;P++){const F=e.get(P);A.verticalIconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,padding:F.padding,projectedAnchorX:F.projectedAnchorX,projectedAnchorY:F.projectedAnchorY,projectedAnchorZ:F.projectedAnchorZ,tileAnchorX:F.tileAnchorX,tileAnchorY:F.tileAnchorY},A.verticalIconFeatureIndex=F.featureIndex;break}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const a=e.placedSymbolArray.get(i),u=a.vertexStartIndex+4*a.numGlyphs;for(let f=a.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const i=Math.sin(e),a=Math.cos(e),u=[],f=[],g=[];for(let x=0;x<this.symbolInstances.length;++x){g.push(x);const b=this.symbolInstances.get(x);u.push(0|Math.round(i*b.tileAnchorX+a*b.tileAnchorY)),f.push(b.featureIndex)}return g.sort((x,b)=>u[x]-u[b]||f[b]-f[x]),g}addToSortKeyRanges(e,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((u,f,g)=>{u>=0&&g.indexOf(u)===f&&this.addIndicesForPlacedSymbol(this.text,u)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Bt("SymbolBucket",yo,{omit:["layers","collisionBoxArray","features","compareText"]}),yo.MAX_GLYPHS=65535,yo.addDynamicAttributes=yd;const xd=new tt({"symbol-placement":new le(W.layout_symbol["symbol-placement"]),"symbol-spacing":new le(W.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new le(W.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ye(W.layout_symbol["symbol-sort-key"]),"symbol-z-order":new le(W.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new le(W.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new le(W.layout_symbol["icon-ignore-placement"]),"icon-optional":new le(W.layout_symbol["icon-optional"]),"icon-rotation-alignment":new le(W.layout_symbol["icon-rotation-alignment"]),"icon-size":new ye(W.layout_symbol["icon-size"]),"icon-text-fit":new le(W.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new le(W.layout_symbol["icon-text-fit-padding"]),"icon-image":new ye(W.layout_symbol["icon-image"]),"icon-rotate":new ye(W.layout_symbol["icon-rotate"]),"icon-padding":new le(W.layout_symbol["icon-padding"]),"icon-keep-upright":new le(W.layout_symbol["icon-keep-upright"]),"icon-offset":new ye(W.layout_symbol["icon-offset"]),"icon-anchor":new ye(W.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new le(W.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new le(W.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new le(W.layout_symbol["text-rotation-alignment"]),"text-field":new ye(W.layout_symbol["text-field"]),"text-font":new ye(W.layout_symbol["text-font"]),"text-size":new ye(W.layout_symbol["text-size"]),"text-max-width":new ye(W.layout_symbol["text-max-width"]),"text-line-height":new ye(W.layout_symbol["text-line-height"]),"text-letter-spacing":new ye(W.layout_symbol["text-letter-spacing"]),"text-justify":new ye(W.layout_symbol["text-justify"]),"text-radial-offset":new ye(W.layout_symbol["text-radial-offset"]),"text-variable-anchor":new le(W.layout_symbol["text-variable-anchor"]),"text-anchor":new ye(W.layout_symbol["text-anchor"]),"text-max-angle":new le(W.layout_symbol["text-max-angle"]),"text-writing-mode":new le(W.layout_symbol["text-writing-mode"]),"text-rotate":new ye(W.layout_symbol["text-rotate"]),"text-padding":new le(W.layout_symbol["text-padding"]),"text-keep-upright":new le(W.layout_symbol["text-keep-upright"]),"text-transform":new ye(W.layout_symbol["text-transform"]),"text-offset":new ye(W.layout_symbol["text-offset"]),"text-allow-overlap":new le(W.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new le(W.layout_symbol["text-ignore-placement"]),"text-optional":new le(W.layout_symbol["text-optional"])});var bd={paint:new tt({"icon-opacity":new ye(W.paint_symbol["icon-opacity"]),"icon-color":new ye(W.paint_symbol["icon-color"]),"icon-halo-color":new ye(W.paint_symbol["icon-halo-color"]),"icon-halo-width":new ye(W.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ye(W.paint_symbol["icon-halo-blur"]),"icon-translate":new le(W.paint_symbol["icon-translate"]),"icon-translate-anchor":new le(W.paint_symbol["icon-translate-anchor"]),"text-opacity":new ye(W.paint_symbol["text-opacity"]),"text-color":new ye(W.paint_symbol["text-color"],{runtimeType:br,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new ye(W.paint_symbol["text-halo-color"]),"text-halo-width":new ye(W.paint_symbol["text-halo-width"]),"text-halo-blur":new ye(W.paint_symbol["text-halo-blur"]),"text-translate":new le(W.paint_symbol["text-translate"]),"text-translate-anchor":new le(W.paint_symbol["text-translate-anchor"])}),layout:xd};class mp{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:cr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Bt("FormatSectionOverride",mp,{omit:["defaultValue"]});class wd extends ra{constructor(e){super(e,bd)}recalculate(e,i){super.recalculate(e,i),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const f of a)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,a,u){const f=this.layout.get(e).evaluate(i,{},a,u),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||No(g.value)||!f?f:(x=i.properties,f.replace(/{([^{}]+)}/g,(D,A)=>A in x?String(x[A]):""));var x}createBucket(e){return new yo(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of bd.paint.overridableProperties){if(!wd.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),a=new mp(i),u=new ja(a,i.property.specification);let f=null;f="constant"===i.value.kind||"source"===i.value.kind?new Yo("source",u):new ga("composite",u,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new me(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&wd.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const a=e.get("text-field"),u=bd.paint.properties[i];let f=!1;const g=x=>{for(const b of x)if(u.overrides&&u.overrides.hasOverride(b))return void(f=!0)};if("constant"===a.value.kind&&a.value.value instanceof Jn)g(a.value.value.sections);else if("source"===a.value.kind){const x=D=>{f||(D instanceof ws&&_n(D.value)===Kn?g(D.value.sections):D instanceof uo?g(D.sections):D.eachChild(x))},b=a.value;b._styleExpression&&x(b._styleExpression.expression)}return f}getProgramConfiguration(e){return new Tl(this,e)}}var gp={paint:new tt({"background-color":new le(W.paint_background["background-color"]),"background-pattern":new Ze(W.paint_background["background-pattern"]),"background-opacity":new le(W.paint_background["background-opacity"])})},jm={paint:new tt({"raster-opacity":new le(W.paint_raster["raster-opacity"]),"raster-hue-rotate":new le(W.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new le(W.paint_raster["raster-brightness-min"]),"raster-brightness-max":new le(W.paint_raster["raster-brightness-max"]),"raster-saturation":new le(W.paint_raster["raster-saturation"]),"raster-contrast":new le(W.paint_raster["raster-contrast"]),"raster-resampling":new le(W.paint_raster["raster-resampling"]),"raster-fade-duration":new le(W.paint_raster["raster-fade-duration"])})};class $m extends ra{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Gm={paint:new tt({"sky-type":new le(W.paint_sky["sky-type"]),"sky-atmosphere-sun":new le(W.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new le(W.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new le(W.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new le(W.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ge(W.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new le(W.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new le(W.paint_sky["sky-atmosphere-color"]),"sky-opacity":new le(W.paint_sky["sky-opacity"])})};function Du(n,e,i){const a=ec(0,0,1),u=Ef(tc());return function(f,g,x){x*=.5;var b=g[0],D=g[1],A=g[2],P=g[3],F=Math.sin(x),$=Math.cos(x);f[0]=b*$-A*F,f[1]=D*$+P*F,f[2]=A*$+b*F,f[3]=P*$-D*F}(u,u,i?-bt(n)+Math.PI:bt(n)),Df(u,u,-bt(e)),Hu(a,a,u),wf(a,a)}const Hm={circle:class extends ra{constructor(n){super(n,_f)}createBucket(n){return new nu(n)}queryRadius(n){const e=n;return iu("circle-radius",this,e)+iu("circle-stroke-width",this,e)+Sl(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,a,u,f,g,x){const b=Gu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Tf(n,a,f,g,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),b,D)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new Tl(this,n)}},heatmap:class extends ra{createBucket(n){return new Sf(n)}constructor(n){super(n,Cc),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"heatmap-color"===n&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Rs({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return iu("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,a,u,f,g,x){const b=this.paint.get("heatmap-radius").evaluate(e,i);return Tf(n,a,f,g,x,!0,!0,new Ve(0,0),b)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new Tl(this,n)}},hillshade:class extends ra{constructor(n){super(n,i_)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(n){return new Tl(this,n)}},fill:class extends ra{constructor(n){super(n,zf)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(n){return new Tl(this,n)}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new ic(n)}queryRadius(){return Sl(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,a,u,f){return!n.queryGeometry.isAboveHorizon&&hf(Ao(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends ra{constructor(n){super(n,a_)}createBucket(n){return new pu(n)}queryRadius(){return Sl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new Tl(this,n)}queryIntersectsFeature(n,e,i,a,u,f,g,x,b){const D=Gu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(e,i),P=this.paint.get("fill-extrusion-base").evaluate(e,i),F=[0,0],$=x&&f.elevation,H=f.elevation?f.elevation.exaggeration():1;if($){const fe=n.tile.getBucket(this).centroidVertexArray,ve=b+1;if(ve<fe.length){const Te=fe.get(ve);F[0]=Te.a_centroid_pos0,F[1]=Te.a_centroid_pos1}}if(0===F[0]&&1===F[1])return!1;const ee=(fe=a,ve=P,Te=A,Se=D,Ie=g,(Pe=$?x:null)?function(ct,Qe,ht,pt,ot,kt,Nt,Sn,Er){const gn=[],nr=[],Rt=[0,0,0,1];for(const Dr of ct){const tr=[],_i=[];for(const ai of Dr){const Si=ai.x+pt.x,zi=ai.y+pt.y,pr=xm(Si,zi,Qe,ht,kt,Nt,Sn,Er);Rt[0]=Si,Rt[1]=zi,Rt[2]=pr.base,Rt[3]=1,lu(Rt,Rt,ot),Rt[3]=Math.max(Rt[3],1e-5);const ir=nd([Rt[0]/Rt[3],Rt[1]/Rt[3],Rt[2]/Rt[3]]);Rt[0]=Si,Rt[1]=zi,Rt[2]=pr.top,Rt[3]=1,lu(Rt,Rt,ot),Rt[3]=Math.max(Rt[3],1e-5);const Br=nd([Rt[0]/Rt[3],Rt[1]/Rt[3],Rt[2]/Rt[3]]);tr.push(ir),_i.push(Br)}gn.push(tr),nr.push(_i)}return[gn,nr]}(fe,ve,Te,Se,Ie,Pe,F,H,f.center.lat):function(ct,Qe,ht,pt,ot){const kt=[],Nt=[],Sn=ot[8]*Qe,Er=ot[9]*Qe,gn=ot[10]*Qe,nr=ot[11]*Qe,Rt=ot[8]*ht,Dr=ot[9]*ht,tr=ot[10]*ht,_i=ot[11]*ht;for(const ai of ct){const Si=[],zi=[];for(const pr of ai){const ir=pr.x+pt.x,Br=pr.y+pt.y,qi=ot[0]*ir+ot[4]*Br+ot[12],yi=ot[1]*ir+ot[5]*Br+ot[13],Ii=ot[2]*ir+ot[6]*Br+ot[14],ao=ot[3]*ir+ot[7]*Br+ot[15],Yr=qi+Sn,es=yi+Er,Sr=Ii+gn,ti=Math.max(ao+nr,1e-5),ni=qi+Rt,li=yi+Dr,ci=Ii+tr,Bi=Math.max(ao+_i,1e-5),Ar=new Ve(Yr/ti,es/ti);Ar.z=Sr/ti,Si.push(Ar);const vo=new Ve(ni/Bi,li/Bi);vo.z=ci/Bi,zi.push(vo)}kt.push(Si),Nt.push(zi)}return[kt,Nt]}(fe,ve,Te,Se,Ie)),ue=n.queryGeometry;var fe,ve,Te,Se,Ie,Pe;return function(fe,ve,Te){let Se=1/0;hf(Te,ve)&&(Se=$f(Te,ve[0]));for(let Ie=0;Ie<ve.length;Ie++){const Pe=ve[Ie],Ye=fe[Ie];for(let We=0;We<Pe.length-1;We++){const It=Pe[We],ct=[It,Pe[We+1],Ye[We+1],Ye[We],It];uf(Te,ct)&&(Se=Math.min(Se,$f(Te,ct)))}}return Se!==1/0&&Se}(ee[0],ee[1],ue.isPointQuery()?ue.screenBounds:ue.screenGeometry)}},line:class extends ra{constructor(n){super(n,rd),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if("line-gradient"===n){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ki,this.gradientVersion=(this.gradientVersion+1)%lt}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=Hf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new eh(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new Tl(this,n)}queryRadius(n){const e=n,i=Zf(iu("line-width",this,e),iu("line-gap-width",this,e)),a=iu("line-offset",this,e);return i/2+Math.abs(a)+Sl(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,a,u,f){if(n.queryGeometry.isAboveHorizon)return!1;const g=Ao(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),x=n.pixelToTileUnitsFactor/2*Zf(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),b=this.paint.get("line-offset").evaluate(e,i);return b&&(a=function(D,A){const P=[],F=new Ve(0,0);for(let $=0;$<D.length;$++){const H=D[$],ee=[];for(let ue=0;ue<H.length;ue++){const fe=H[ue-1],ve=H[ue],Te=H[ue+1],Se=0===ue?F:ve.sub(fe)._unit()._perp(),Ie=ue===H.length-1?F:Te.sub(ve)._unit()._perp(),Pe=Se._add(Ie)._unit();Pe._mult(1/(Pe.x*Ie.x+Pe.y*Ie.y)),ee.push(Pe._mult(A)._add(ve))}P.push(ee)}return P}(a,b*n.pixelToTileUnitsFactor)),function(D,A,P){for(let F=0;F<A.length;F++){const $=A[F];if(D.length>=3)for(let H=0;H<$.length;H++)if(Ec(D,$[H]))return!0;if(cm(D,$,P))return!0}return!1}(g,a,x)}isTileClipped(){return!0}},symbol:wd,background:class extends ra{constructor(n){super(n,gp)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ra{constructor(n){super(n,jm)}getProgramIds(){return["raster"]}},sky:class extends ra{constructor(n){super(n,Gm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"sky-gradient"===n?this._updateColorRamp():"sky-atmosphere-sun"!==n&&"sky-atmosphere-halo-color"!==n&&"sky-atmosphere-color"!==n&&"sky-atmosphere-sun-intensity"!==n||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Rs({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(n,e){const i=this.paint.get("sky-type");if("atmosphere"===i){const a=this.paint.get("sky-atmosphere-sun"),u=!a,f=n.style.light,g=f.properties.get("position");return u&&"viewport"===f.properties.get("anchor")&&zt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Du(g.azimuthal,90-g.polar,e):Du(a[0],90-a[1],e)}if("gradient"===i){const a=this.paint.get("sky-gradient-center");return Du(a[0],90-a[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return"atmosphere"===n?["skyboxCapture","skybox"]:"gradient"===n?["skyboxGradient"]:null}}},{HTMLImageElement:_p,HTMLCanvasElement:Cu,HTMLVideoElement:hh,ImageData:yp,ImageBitmap:Oc}=qe;class zc{constructor(e,i,a,u){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(i,u)}update(e,i,a){const{width:u,height:f}=e,{context:g}=this,{gl:x}=g;if(x.bindTexture(x.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||!1!==i.premultiply)),a||this.size&&this.size[0]===u&&this.size[1]===f){const{x:b,y:D}=a||{x:0,y:0};e instanceof _p||e instanceof Cu||e instanceof hh||e instanceof yp||Oc&&e instanceof Oc?x.texSubImage2D(x.TEXTURE_2D,0,b,D,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,b,D,u,f,x.RGBA,x.UNSIGNED_BYTE,e.data)}else this.size=[u,f],e instanceof _p||e instanceof Cu||e instanceof hh||e instanceof yp||Oc&&e instanceof Oc?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,u,f,0,this.format,x.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(e,i){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class dh{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Il({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const a=this.getKey(e,i);return this.positions[a]}trim(){const e=this.width,i=this.height=He(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,a){const u=[];let f=e.length%2==1?-e[e.length-1]*a:0,g=e[0]*a,x=!0;u.push({left:f,right:g,isDash:x,zeroLength:0===e[0]});let b=e[0];for(let D=1;D<e.length;D++){x=!x;const A=e[D];f=b*a,b+=A,g=b*a,u.push({left:f,right:g,isDash:x,zeroLength:0===A})}return u}addRoundDash(e,i,a){const u=i/2;for(let f=-a;f<=a;f++){const g=this.width*(this.nextRow+a+f);let x=0,b=e[x];for(let D=0;D<this.width;D++){D/b.right>1&&(b=e[++x]);const A=Math.abs(D-b.left),P=Math.abs(D-b.right),F=Math.min(A,P);let $;const H=f/a*(u+1);if(b.isDash){const ee=u-Math.abs(H);$=Math.sqrt(F*F+ee*ee)}else $=u-Math.sqrt(F*F+H*H);this.image.data[g+D]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(e,i){for(let b=e.length-1;b>=0;--b){const D=e[b],A=e[b+1];D.zeroLength?e.splice(b,1):A&&A.isDash===D.isDash&&(A.left=D.left,e.splice(b,1))}const a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const f=this.width*this.nextRow;let g=0,x=e[g];for(let b=0;b<this.width;b++){b/x.right>1&&(x=e[++g]);const D=Math.abs(b-x.left),A=Math.abs(b-x.right),P=Math.min(D,A);this.image.data[f+b]=Math.max(0,Math.min(255,(x.isDash?P:-P)+i+128))}}addDash(e,i){const a=this.getKey(e,i);if(this.positions[a])return this.positions[a];const u="round"===i,f=u?7:0,g=2*f+1;if(this.nextRow+g>this.height)return zt("LineAtlas out of space"),null;0===e.length&&e.push(1);let x=0;for(let A=0;A<e.length;A++)e[A]<0&&(zt("Negative value is found in line dasharray, replacing values with 0"),e[A]=0),x+=e[A];if(0!==x){const A=this.width/x,P=this.getDashRanges(e,this.width,A);u?this.addRoundDash(P,A,f):this.addRegularDash(P,"square"===i?.5*A:0)}const b=this.nextRow+f;this.nextRow+=g;const D={tl:[b,f],br:[x,0]};return this.positions[a]=D,D}}Bt("LineAtlas",dh);class Zm{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const qm=qe.performance;function fh(n){const e=n?n.url.toString():void 0;return qm.getEntriesByName(e)}class m_{constructor(){this.tasks={},this.taskQueue=[],Ke(["process"],this),this.invoker=new Zm(this.process),this.nextId=0}add(e,i){const a=this.nextId++,u=function({type:f,isSymbolTile:g,zoom:x}){return x=x||0,"message"===f?0:"maybePrepare"!==f||g?"parseTile"!==f||g?"parseTile"===f&&g?300-x:"maybePrepare"===f&&g?400-x:500:200-x:100-x}(i);if(0===u){sr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:e,metadata:i,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){sr();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<i&&(i=f.priority,e=u)}if(null===e)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}function ph(n,e){const i=Math.pow(2,-n.z),a=n.x*i,u=(n.x+1)*i,f=n.y*i,g=(n.y+1)*i;if("mercator"===e.name)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const x=Ja(a),b=Ja(u),D=ks(f),A=ks(g),P=e.project(x,D),F=e.project(b,D),$=e.project(b,A),H=e.project(x,A);let ee=Math.min(P.x,F.x,$.x,H.x),ue=Math.min(P.y,F.y,$.y,H.y),fe=Math.max(P.x,F.x,$.x,H.x),ve=Math.max(P.y,F.y,$.y,H.y);const Te=i/16;function Se(Pe,Ye,We,It,ct,Qe){const ht=(We+ct)/2,pt=(It+Qe)/2,ot=e.project(Ja(ht),ks(pt)),kt=Math.max(0,ee-ot.x,ue-ot.y,ot.x-fe,ot.y-ve);ee=Math.min(ee,ot.x),fe=Math.max(fe,ot.x),ue=Math.min(ue,ot.y),ve=Math.max(ve,ot.y),kt>Te&&(Se(Pe,ot,We,It,ht,pt),Se(ot,Ye,ht,pt,ct,Qe))}Se(P,F,a,f,u,f),Se(F,$,u,f,u,g),Se($,H,u,g,a,g),Se(H,P,a,g,a,f),ee-=Te,ue-=Te,fe+=Te,ve+=Te;const Ie=1/Math.max(fe-ee,ve-ue);return{scale:Ie,x:ee*Ie,y:ue*Ie,x2:fe*Ie,y2:ve*Ie,projection:e}}function Ed(n,e,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[n*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class mh{constructor(e,i,a){this.z=e,this.x=i,this.y=a,this.key=Bc(0,e,e,i,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const a=(f=this.y,g=this.z,x=Ed(256*(u=this.x),256*(f=Math.pow(2,g)-f-1),g),b=Ed(256*(u+1),256*(f+1),g),x[0]+","+x[1]+","+b[0]+","+b[1]);var u,f,g,x,b;const D=function(A,P,F){let $,H="";for(let ee=A;ee>0;ee--)$=1<<ee-1,H+=(P&$?1:0)+(F&$?2:0);return H}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Dd{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Bc(e,i.z,i.z,i.x,i.y)}}class Po{constructor(e,i,a,u,f){this.overscaledZ=e,this.wrap=i,this.canonical=new mh(a,+u,+f),this.key=0===i&&e===a?this.canonical.key:Bc(i,e,a,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Po(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Po(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Bc(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Bc(this.wrap*+i,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Po(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new Po(i,this.wrap,i,a,u),new Po(i,this.wrap,i,a+1,u),new Po(i,this.wrap,i,a,u+1),new Po(i,this.wrap,i,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Po(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Po(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Dd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Bc(n,e,i,a,u){const f=1<<Math.min(i,22);let g=f*(u%f)+a%f;return n&&i<22&&(g+=f*f*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*g+i)+(e-i)}Bt("CanonicalTileID",mh),Bt("OverscaledTileID",Po,{omit:["projMatrix"]});class Pa{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const a=e[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Tu{constructor(e,i,a,u,f){this.type="Feature",this._vectorTileFeature=e,e._z=i,e._x=a,e._y=u,this.properties=e.properties,this.id=f}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)"_geometry"!==i&&"_vectorTileFeature"!==i&&(e[i]=this[i]);return e}}var Wm=Ne([{name:"a_pos",type:"Int16",components:2}]);const ka=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,i=0,a=0,u=0,f=0,g=0,x=0;for(1&e?u=f=g=32:i=a=x=32;(e>>=1)>1;){const D=i+u>>1,A=a+f>>1;1&e?(u=i,f=a,i=g,a=x):(i=u,a=f,u=g,f=x),g=D,x=A}const b=4*n;ka[b+0]=i,ka[b+1]=a,ka[b+2]=u,ka[b+3]=f}const sa=new Uint16Array(2178),Ra=new Uint8Array(1089),Ll=new Uint16Array(1089);function vp(n){return 0===n?-.03125:32===n?.03125:0}var Su=Ne([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Cd={type:2,extent:Yn,loadGeometry:()=>[[new Ve(0,0),new Ve(8193,0),new Ve(8193,8193),new Ve(0,8193),new Ve(0,0)]]};class Td{constructor(e,i,a,u,f){this.tileID=e,this.uid=gt(),this.uses=0,this.tileSize=i,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<Mi.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=ph(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,f){const g={};if(!f)return g;for(const x of u){const b=x.layerIds.map(D=>f.getLayer(D)).filter(Boolean);if(0!==b.length){x.layers=b,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(D=>b.filter(A=>A.id===D)[0]));for(const D of b)g[D.id]=x}}return g}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const f=this.buckets[u];if(f instanceof yo){if(this.hasSymbolBuckets=!0,!a)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const f=this.buckets[u];if(f instanceof yo&&f.hasRTLText){this.hasRTLText=!0,N.isLoading()||N.isLoaded()||"deferred"!==R()||z();break}}this.queryPadding=0;for(const u in this.buckets){const f=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(u).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new _o}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const u=this.buckets[a];u.uploadPending()&&u.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new zc(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new zc(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new zc(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,a,u,f,g,x,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:x,transform:g,params:f,tileTransform:this.tileTransform},e,i,a):{}}querySourceFeatures(e,i){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const u=a.loadVTLayers(),f=i?i.sourceLayer:"",g=u._geojsonTileLayer||u[f];if(!g)return;const x=ya(i&&i.filter),{z:b,x:D,y:A}=this.tileID.canonical,P={z:b,x:D,y:A};for(let F=0;F<g.length;F++){const $=g.feature(F);if(x.needGeometry){const ue=Ia($,!0);if(!x.filter(new j(this.tileID.overscaledZ),ue,this.tileID.canonical))continue}else if(!x.filter(new j(this.tileID.overscaledZ),$))continue;const H=a.getId($,f),ee=new Tu($,b,D,A,H);ee.tile=P,e.push(ee)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const a=vi(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let u=!1;if(this.expirationTime>a)u=!1;else if(i)if(this.expirationTime<i)u=!0;else{const f=this.expirationTime-i;f?this.expirationTime=a+Math.max(f,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!i)return;const a=this.latestFeatureIndex.loadVTLayers(),u=i.style.listImages();for(const f in this.buckets){if(!i.style.hasLayer(f))continue;const g=this.buckets[f],x=g.layers[0].sourceLayer||"_geojsonTileLayer",b=a[x],D=e[x];if(!b||!D||0===Object.keys(D).length)continue;if(g.update(D,b,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof eh||g instanceof ic){const P=i.style._getSourceCache(g.layers[0].source);i._terrain&&i._terrain.enabled&&P&&g.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(P.id,this.tileID)}const A=i&&i.style&&i.style.getLayer(f);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(g)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Mi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Mi.now()+e}setDependencies(e,i){const a={};for(const u of i)a[u]=!0;this.dependencies[e]=a}hasDependency(e,i){for(const a of e){const u=this.dependencies[a];if(u)for(const f of i)if(u[f])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const a=Sa(Cd,this.tileID.canonical,this.tileTransform)[0],u=new jt,f=new Zi;for(let g=0;g<a.length;g++){const{x,y:b}=a[g];u.emplaceBack(x,b),f.emplaceBack(g)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(u,Su.members),this._tileDebugSegments=gi.simpleSegment(0,0,u.length,f.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const a=Sa(Cd,this.tileID.canonical,this.tileTransform)[0];let u,f;if(this.isRaster){const g=function(x,b){const D=ph(x,b),A=Math.pow(2,x.z);for(let ue=0;ue<33;ue++)for(let fe=0;fe<33;fe++){const ve=Ja((x.x+(fe+vp(fe))/32)/A),Te=ks((x.y+(ue+vp(ue))/32)/A),Se=b.project(ve,Te),Ie=33*ue+fe;sa[2*Ie+0]=Math.round((Se.x*D.scale-D.x)*Yn),sa[2*Ie+1]=Math.round((Se.y*D.scale-D.y)*Yn)}Ra.fill(0),Ll.fill(0);for(let ue=2045;ue>=0;ue--){const fe=4*ue,ve=ka[fe+0],Te=ka[fe+1],Se=ka[fe+2],Ie=ka[fe+3],Pe=ve+Se>>1,Ye=Te+Ie>>1,We=Pe+Ye-Te,It=Ye+ve-Pe,ct=33*Te+ve,Qe=33*Ie+Se,ht=33*Ye+Pe,pt=Math.hypot((sa[2*ct+0]+sa[2*Qe+0])/2-sa[2*ht+0],(sa[2*ct+1]+sa[2*Qe+1])/2-sa[2*ht+1])>=16;if(Ra[ht]=Ra[ht]||(pt?1:0),ue<1022){const ot=33*(Te+It>>1)+(ve+We>>1),kt=33*(Ie+It>>1)+(Se+We>>1);Ra[ht]=Ra[ht]||Ra[ot]||Ra[kt]}}const P=new un,F=new mi;let $=0;function H(ue,fe){const ve=33*fe+ue;return 0===Ll[ve]&&(P.emplaceBack(sa[2*ve+0],sa[2*ve+1],ue*Yn/32,fe*Yn/32),Ll[ve]=++$),Ll[ve]-1}function ee(ue,fe,ve,Te,Se,Ie){const Pe=ue+ve>>1,Ye=fe+Te>>1;if(Math.abs(ue-Se)+Math.abs(fe-Ie)>1&&Ra[33*Ye+Pe])ee(Se,Ie,ue,fe,Pe,Ye),ee(ve,Te,Se,Ie,Pe,Ye);else{const We=H(ue,fe),It=H(ve,Te),ct=H(Se,Ie);F.emplaceBack(We,It,ct)}}return ee(0,0,32,32,32,0),ee(32,32,0,0,0,32),{vertices:P,indices:F}}(this.tileID.canonical,i);u=g.vertices,f=g.indices}else{u=new un,f=new mi;for(const{x,y:b}of a)u.emplaceBack(x,b,0,0);const g=Hh(u.int16,void 0,4);for(let x=0;x<g.length;x+=3)f.emplaceBack(g[x],g[x+1],g[x+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,Su.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=gi.simpleSegment(0,0,u.length,f.length)}}class xp{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,a){const u=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Gt(this.stateChanges[e][u],a),null===this.deletedStates[e]){this.deletedStates[e]={};for(const f in this.state[e])f!==u&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][u]){this.deletedStates[e][u]={};for(const f in this.state[e][u])a[f]||(this.deletedStates[e][u][f]=null)}else for(const f in a)this.deletedStates[e]&&this.deletedStates[e][u]&&null===this.deletedStates[e][u][f]&&delete this.deletedStates[e][u][f]}removeFeatureState(e,i,a){if(null===this.deletedStates[e])return;const u=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&void 0!==i)null!==this.deletedStates[e][u]&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][a]=null);else if(void 0!==i)if(this.stateChanges[e]&&this.stateChanges[e][u])for(a in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][a]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,i){const a=String(i),u=Gt({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const f=this.deletedStates[e][i];if(null===f)return{};for(const g in f)delete u[g]}return u}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const a={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const f={};for(const g in this.stateChanges[u])this.state[u][g]||(this.state[u][g]={}),Gt(this.state[u][g],this.stateChanges[u][g]),f[g]=this.state[u][g];a[u]=f}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const f={};if(null===this.deletedStates[u])for(const g in this.state[u])f[g]={},this.state[u][g]={};else for(const g in this.deletedStates[u]){if(null===this.deletedStates[u][g])this.state[u][g]={};else for(const x of Object.keys(this.deletedStates[u][g]))delete this.state[u][g][x];f[g]=this.state[u][g]}a[u]=a[u]||{},Gt(a[u],f)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(a).length)for(const u in e)e[u].setFeatureState(a,i)}}class bp{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const a=this.toIdx(e,i);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function gh(n,e,i,a){let u=0,f=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(a[g])<1e-15){if(i[g]<n[g]||i[g]>e[g])return null}else{const x=1/a[g];let b=(n[g]-i[g])*x,D=(e[g]-i[g])*x;if(b>D){const A=b;b=D,D=A}if(b>u&&(u=b),D<f&&(f=D),u>f)return null}return u}function wp(n,e,i,a,u,f,g,x,b,D,A){const P=a-n,F=u-e,$=f-i,H=g-n,ee=x-e,ue=b-i,fe=A[1]*ue-A[2]*ee,ve=A[2]*H-A[0]*ue,Te=A[0]*ee-A[1]*H,Se=P*fe+F*ve+$*Te;if(Math.abs(Se)<1e-15)return null;const Ie=1/Se,Pe=D[0]-n,Ye=D[1]-e,We=D[2]-i,It=(Pe*fe+Ye*ve+We*Te)*Ie;if(It<0||It>1)return null;const ct=Ye*$-We*F,Qe=We*P-Pe*$,ht=Pe*F-Ye*P,pt=(A[0]*ct+A[1]*Qe+A[2]*ht)*Ie;return pt<0||It+pt>1?null:(H*ct+ee*Qe+ue*ht)*Ie}function Ep(n,e,i){return(n-e)/(i-e)}function Sd(n,e,i,a,u,f,g,x,b){const D=1<<i,A=f-a,P=g-u,F=(n+1)/D*A+a,$=(e+0)/D*P+u,H=(e+1)/D*P+u;x[0]=(n+0)/D*A+a,x[1]=$,b[0]=F,b[1]=H}class cc{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(f){const g=Math.ceil(Math.log2(f.dim/8)),x=[];let b=Math.ceil(Math.pow(2,g));const D=1/b,A=($,H,ee,ue,fe)=>{const ve=ue?1:0,Te=($+1)*ee-ve,Se=H*ee,Ie=(H+1)*ee-ve;fe[0]=$*ee,fe[1]=Se,fe[2]=Te,fe[3]=Ie};let P=new bp(b);const F=[];for(let $=0;$<b*b;$++){A($%b,Math.floor($/b),D,!1,F);const H=Fl(F[0],F[1],f),ee=Fl(F[2],F[1],f),ue=Fl(F[2],F[3],f),fe=Fl(F[0],F[3],f);P.minimums.push(Math.min(H,ee,ue,fe)),P.maximums.push(Math.max(H,ee,ue,fe)),P.leaves.push(1)}for(x.push(P),b/=2;b>=1;b/=2){const $=x[x.length-1];P=new bp(b);for(let H=0;H<b*b;H++){A(H%b,Math.floor(H/b),2,!0,F);const ee=$.getElevation(F[0],F[1]),ue=$.getElevation(F[2],F[1]),fe=$.getElevation(F[2],F[3]),ve=$.getElevation(F[0],F[3]),Te=$.isLeaf(F[0],F[1]),Se=$.isLeaf(F[2],F[1]),Ie=$.isLeaf(F[2],F[3]),Pe=$.isLeaf(F[0],F[3]),Ye=Math.min(ee.min,ue.min,fe.min,ve.min),We=Math.max(ee.max,ue.max,fe.max,ve.max),It=Te&&Se&&Ie&&Pe;P.maximums.push(We),P.minimums.push(Ye),P.leaves.push(We-Ye<=5&&It?1:0)}x.push(P)}return x}(this.dem),a=i.length-1,u=i[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,a,0)}raycastRoot(e,i,a,u,f,g,x=1){return gh([e,i,-100],[a,u,this.maximums[0]*x],f,g)}raycast(e,i,a,u,f,g,x=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,i,a,u,f,g,x);if(null==b)return null;const D=[],A=[],P=[],F=[],$=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;$.length>0;){const{idx:H,t:ee,nodex:ue,nodey:fe,depth:ve}=$.pop();if(this.leaves[H]){Sd(ue,fe,ve,e,i,a,u,P,F);const Se=1<<ve,Ie=(ue+0)/Se,Pe=(ue+1)/Se,Ye=(fe+0)/Se,We=(fe+1)/Se,It=Fl(Ie,Ye,this.dem)*x,ct=Fl(Pe,Ye,this.dem)*x,Qe=Fl(Pe,We,this.dem)*x,ht=Fl(Ie,We,this.dem)*x,pt=wp(P[0],P[1],It,F[0],P[1],ct,F[0],F[1],Qe,f,g),ot=wp(F[0],F[1],Qe,P[0],F[1],ht,P[0],P[1],It,f,g),kt=Math.min(null!==pt?pt:Number.MAX_VALUE,null!==ot?ot:Number.MAX_VALUE);if(kt!==Number.MAX_VALUE)return kt;{const Nt=bf([],f,g,ee);if(Id(It,ct,ht,Qe,Ep(Nt[0],P[0],F[0]),Ep(Nt[1],P[1],F[1]))>=Nt[2])return ee}continue}let Te=0;for(let Se=0;Se<this._siblingOffset.length;Se++){Sd((ue<<1)+this._siblingOffset[Se][0],(fe<<1)+this._siblingOffset[Se][1],ve+1,e,i,a,u,P,F),P[2]=-100,F[2]=this.maximums[this.childOffsets[H]+Se]*x;const Ie=gh(P,F,f,g);if(null!=Ie){const Pe=Ie;D[Se]=Pe;let Ye=!1;for(let We=0;We<Te&&!Ye;We++)Pe>=D[A[We]]&&(A.splice(We,0,Se),Ye=!0);Ye||(A[Te]=Se),Te++}}for(let Se=0;Se<Te;Se++){const Ie=A[Se];$.push({idx:this.childOffsets[H]+Ie,t:D[Ie],nodex:(ue<<1)+this._siblingOffset[Ie][0],nodey:(fe<<1)+this._siblingOffset[Ie][1],depth:ve+1})}}return null}_addNode(e,i,a){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,a,u,f){if(1===e[u].isLeaf(i,a))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const g=u-1,x=e[g];let b,D=0;for(let A=0;A<this._siblingOffset.length;A++){const P=2*i+this._siblingOffset[A][0],F=2*a+this._siblingOffset[A][1],$=x.getElevation(P,F),H=x.isLeaf(P,F),ee=this._addNode($.min,$.max,H);H&&(D|=1<<A),b||(b=ee)}for(let A=0;A<this._siblingOffset.length;A++)D&1<<A||this._construct(e,2*i+this._siblingOffset[A][0],2*a+this._siblingOffset[A][1],g,b+A)}}function Id(n,e,i,a,u,f){return Vn(Vn(n,i,f),Vn(e,a,f),u)}function Fl(n,e,i){const a=i.dim,u=At(n*a-.5,0,a-1),f=At(e*a-.5,0,a-1),g=Math.floor(u),x=Math.floor(f),b=Math.min(g+1,a-1),D=Math.min(x+1,a-1);return Id(i.get(g,x),i.get(b,x),i.get(g,D),i.get(b,D),u-g,f-x)}const Dp={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class sl{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,a,u=!1,f=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&"mapbox"!==a&&"terrarium"!==a)return zt(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const g=this.dim=i.height-2;if(this.data=new Uint32Array(i.data.buffer),this.encoding=a||"mapbox",this.borderReady=u,!u){for(let x=0;x<g;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(g,x)]=this.data[this._idx(g-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,g)]=this.data[this._idx(x,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new cc(this)}get(e,i,a=!1){const u=new Uint8Array(this.data.buffer);a&&(e=At(e,-1,this.dim),i=At(i,-1,this.dim));const f=4*this._idx(e,i);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(u[f],u[f+1],u[f+2])}static getUnpackVector(e){return Dp[e]}get unpackVector(){return Dp[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,a){return(256*e*256+256*i+a)/10-1e4}_unpackTerrarium(e,i,a){return 256*e+i+a/256-32768}static pack(e,i){const a=[0,0,0,0],u=sl.getUnpackVector(i);let f=Math.floor((e+u[3])/u[2]);return a[2]=f%256,f=Math.floor(f/256),a[1]=f%256,f=Math.floor(f/256),a[0]=f,a}getPixels(){return new _s({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,f=i*this.dim+this.dim,g=a*this.dim,x=a*this.dim+this.dim;switch(i){case-1:u=f-1;break;case 1:f=u+1}switch(a){case-1:g=x-1;break;case 1:x=g+1}const b=-i*this.dim,D=-a*this.dim;for(let A=g;A<x;A++)for(let P=u;P<f;P++)this.data[this._idx(P,A)]=e.data[this._idx(P+b,A+D)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Bt("DEMData",sl),Bt("DemMinMaxQuadTree",cc,{omit:["dem"]});class Xm{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,a){const u=e.wrapped().key;void 0===this.data[u]&&(this.data[u]=[]);const f={value:i,timeout:void 0};if(void 0!==a&&(f.timeout=setTimeout(()=>{this.remove(e,f)},a)),this.data[u].push(f),this.order.push(u),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const a=e.wrapped().key,u=void 0===i?0:this.data[a].indexOf(i),f=this.data[a][u];return this.data[a].splice(u,1),f.timeout&&clearTimeout(f.timeout),0===this.data[a].length&&delete this.data[a],this.onRemove(f.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const a in this.data)for(const u of this.data[a])e(u.value)||i.push(u);for(const a of i)this.remove(a.value.tileID,a)}}class Nc{constructor(e,i,a){this.func=e,this.mask=i,this.range=a}}Nc.ReadOnly=!1,Nc.ReadWrite=!0,Nc.disabled=new Nc(519,Nc.ReadOnly,[0,1]);class Ad{constructor(e,i,a,u,f,g){this.test=e,this.ref=i,this.mask=a,this.fail=u,this.depthFail=f,this.pass=g}}Ad.disabled=new Ad({func:519,mask:0},0,0,7680,7680,7680);class Ti{constructor(e,i,a){this.blendFunction=e,this.blendColor=i,this.mask=a}}Ti.Replace=[1,0],Ti.disabled=new Ti(Ti.Replace,Ln.transparent,[!1,!1,!1,!1]),Ti.unblended=new Ti(Ti.Replace,Ln.transparent,[!0,!0,!0,!0]),Ti.alphaBlended=new Ti([1,771],Ln.transparent,[!0,!0,!0,!0]);class zs{constructor(e,i,a){this.enable=e,this.mode=i,this.frontFace=a}}zs.disabled=new zs(!1,1029,2305),zs.backCCW=new zs(!0,1029,2305),zs.backCW=new zs(!0,1029,2304),zs.frontCW=new zs(!0,1028,2304),zs.frontCCW=new zs(!0,1028,2305);class Ol extends vt{constructor(e,i,a){super(),this.id=e,this._onlySymbols=a,i.on("data",u=>{"source"===u.dataType&&"metadata"===u.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===u.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new Xm(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new xp}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if("loaded"!==i.state&&"errored"!==i.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const a=this._tiles[i];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Pn(this._tiles).map(e=>e.tileID).sort(Pd).map(e=>e.key)}getRenderableIds(e){const i=[];for(const a in this._tiles)this._isIdRenderable(+a,e)&&i.push(this._tiles[a]);return e?i.sort((a,u)=>{const f=a.tileID,g=u.tileID,x=new Ve(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),b=new Ve(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-g.overscaledZ||b.y-x.y||b.x-x.x}).map(a=>a.tileID.key):i.map(a=>a.tileID).sort(Pd).map(a=>a.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const a=this._tiles[e];a&&("loading"!==a.state&&(a.state=i),this._loadTile(a,this._tileLoaded.bind(this,a,e,i)))}_tileLoaded(e,i,a,u){if(u)return e.state="errored",void(404!==u.status?this._source.fire(new Ht(u,{tile:e})):this.update(this.transform));e.timeAdded=Mi.now(),"expired"===a&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new it("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let u=0;u<i.length;u++){const f=i[u];if(e.neighboringTiles&&e.neighboringTiles[f]){const g=this.getTileByID(f);a(e,g),a(g,e)}}function a(u,f){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let g=f.tileID.canonical.x-u.tileID.canonical.x;const x=f.tileID.canonical.y-u.tileID.canonical.y,b=Math.pow(2,u.tileID.canonical.z),D=f.tileID.key;0===g&&0===x||Math.abs(x)>1||(Math.abs(g)>1&&(1===Math.abs(g+b)?g+=b:1===Math.abs(g-b)&&(g-=b)),f.dem&&u.dem&&(u.dem.backfillBorder(f.dem,g,x),u.neighboringTiles&&u.neighboringTiles[D]&&(u.neighboringTiles[D].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,a,u){for(const f in this._tiles){let g=this._tiles[f];if(u[f]||!g.hasData()||g.tileID.overscaledZ<=i||g.tileID.overscaledZ>a)continue;let x=g.tileID;for(;g&&g.tileID.overscaledZ>i+1;){const D=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[D.key],g&&g.hasData()&&(x=D)}let b=x;for(;b.overscaledZ>i;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){u[x.key]=x;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=i?a:null}for(let a=e.overscaledZ-1;a>=i;a--){const u=e.scaledTo(a),f=this._getLoadedTile(u);if(f)return f}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const a=Math.ceil(e.width/i)+1,u=Math.ceil(e.height/i)+1,f=Math.floor(a*u*5),g="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(g)}handleWrapJump(e){const i=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,i){const a={};for(const u in this._tiles){const f=this._tiles[u];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+i),a[f.tileID.key]=f}this._tiles=a;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,i,a){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let u;this.updateCacheSize(e,i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new Po(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(u=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(x=>this._source.hasTile(x)))):u=[];const f=this._updateRetainedTiles(u);if(Cp(this._source.type)&&0!==u.length){const x={},b={},D=Object.keys(f);for(const P of D){const F=f[P],$=this._tiles[P];if(!$||$.fadeEndTime&&$.fadeEndTime<=Mi.now())continue;const H=this.findLoadedParent(F,Math.max(F.overscaledZ-Ol.maxOverzooming,this._source.minzoom));H&&(this._addTile(H.tileID),x[H.tileID.key]=H.tileID),b[P]=F}const A=u[u.length-1].overscaledZ;for(const P in this._tiles){const F=this._tiles[P];if(f[P]||!F.hasData())continue;let $=F.tileID;for(;$.overscaledZ>A;){$=$.scaledTo($.overscaledZ-1);const H=this._tiles[$.key];if(H&&H.hasData()&&b[$.key]){f[P]=F.tileID;break}}}for(const P in x)f[P]||(this._coveredTiles[P]=!0,f[P]=x[P])}for(const x in f)this._tiles[x].clearFadeHold();const g=function(x,b){const D=[];for(const A in x)A in b||D.push(A);return D}(this._tiles,f);for(const x of g){const b=this._tiles[x];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(0===e.length)return i;const a={},u=e.reduce((D,A)=>Math.min(D,A.overscaledZ),1/0),f=e[0].overscaledZ,g=Math.max(f-Ol.maxOverzooming,this._source.minzoom),x=Math.max(f+Ol.maxUnderzooming,this._source.minzoom),b={};for(const D of e){const A=this._addTile(D);i[D.key]=D,A.hasData()||u<this._source.maxzoom&&(b[D.key]=D)}this._retainLoadedChildren(b,u,x,i);for(const D of e){let A=this._tiles[D.key];if(A.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const F=D.children(this._source.maxzoom)[0],$=this.getTile(F);if($&&$.hasData()){i[F.key]=F;continue}}else{const F=D.children(this._source.maxzoom);if(i[F[0].key]&&i[F[1].key]&&i[F[2].key]&&i[F[3].key])continue}let P=A.wasRequested();for(let F=D.overscaledZ-1;F>=g;--F){const $=D.scaledTo(F);if(a[$.key]||(a[$.key]=!0,A=this.getTile($),!A&&P&&(A=this._addTile($)),A&&(i[$.key]=$,P=A.wasRequested(),A.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let a,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}i.push(u.key);const f=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(f),a)break;u=f}for(const f of i)this._loadedParentTiles[f]=a}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const a=Boolean(i);if(!a){const u=this.map?this.map.painter:null;i=new Td(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,"raster"===this._source.type||"raster-dem"===this._source.type),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,a||this._source.fire(new it("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=i.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&"reloading"!==i.state?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,i,a){const u=[],f=this.transform;if(!f)return u;for(const g in this._tiles){const x=this._tiles[g];if(a&&x.clearQueryDebugViz(),x.holdingForFade())continue;const b=e.containsTile(x,f,i);b&&u.push(b)}return u}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of i)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(Cp(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=Mi.now())return!0}return!1}setFeatureState(e,i,a){this._state.updateState(e=e||"_geojsonTileLayer",i,a)}removeFeatureState(e,i,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,a)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,a){const u=this._tiles[e];u&&u.setDependencies(i,a)}reloadTilesForDependencies(e,i){for(const a in this._tiles)this._tiles[a].hasDependency(e,i)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,i))}}function Pd(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||a-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function Cp(n){return"raster"===n||"image"===n||"video"===n}Ol.maxOverzooming=10,Ol.maxUnderzooming=3;class yh{constructor(e,i,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=a}static create(e,i,a){const u=a||e.findDEMTileFor(i);if(!u||!u.dem)return;const f=u.dem,g=u.tileID,x=1<<i.canonical.z-g.canonical.z;return new yh(u,u.tileSize/Yn/x,[(i.canonical.x/x-g.canonical.x)*f.dim,(i.canonical.y/x-g.canonical.y)*f.dim])}tileCoordToPixel(e,i){const a=i*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(a);return new Ve(u,f)}getElevationAt(e,i,a,u){const f=e*this._scale+this._offset[0],g=i*this._scale+this._offset[1],x=Math.floor(f),b=Math.floor(g),D=this._dem;return u=!!u,a?Vn(Vn(D.get(x,b,u),D.get(x,b+1,u),g-b),Vn(D.get(x+1,b,u),D.get(x+1,b+1,u),g-b),f-x):D.get(x,b,u)}getElevationAtPixel(e,i,a){return this._dem.get(e,i,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*lf(1,e)*this._dem.stride}}class Tp{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ds(Yn,16,0),this.featureIndexArray=new tf,this.promoteId=i}insert(e,i,a,u,f,g=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,f,g);const b=this.grid;for(let D=0;D<i.length;D++){const A=i[D],P=[1/0,1/0,-1/0,-1/0];for(let F=0;F<A.length;F++){const $=A[F];P[0]=Math.min(P[0],$.x),P[1]=Math.min(P[1],$.y),P[2]=Math.max(P[2],$.x),P[3]=Math.max(P[3],$.y)}P[0]<Yn&&P[1]<Yn&&P[2]>=0&&P[3]>=0&&b.insert(x,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new oc.VectorTile(new Pl(this.rawTileData)).layers,this.sourceLayerCoder=new Pa(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,a,u){this.loadVTLayers();const f=e.params||{},g=ya(f.filter),x=e.tileResult,b=e.transform,D=x.bufferedTilespaceBounds,A=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(H,ee,ue,fe)=>mf(x.bufferedTilespaceGeometry,H,ee,ue,fe));A.sort(Ip);let P=null;b.elevation&&A.length>0&&(P=yh.create(b.elevation,this.tileID));const F={};let $;for(let H=0;H<A.length;H++){const ee=A[H];if(ee===$)continue;$=ee;const ue=this.featureIndexArray.get(ee);let fe=null;this.loadMatchingFeature(F,ue,g,f.layers,f.availableImages,i,a,u,(ve,Te,Se,Ie=0)=>(fe||(fe=Sa(ve,this.tileID.canonical,e.tileTransform)),Te.queryIntersectsFeature(x,ve,Se,fe,this.z,e.transform,e.pixelPosMatrix,P,Ie)))}return F}loadMatchingFeature(e,i,a,u,f,g,x,b,D){const{featureIndex:A,bucketIndex:P,sourceLayerIndex:F,layoutVertexArrayOffset:$}=i,H=this.bucketLayerIDs[P];if(u&&!function(ve,Te){for(let Se=0;Se<ve.length;Se++)if(Te.indexOf(ve[Se])>=0)return!0;return!1}(u,H))return;const ee=this.sourceLayerCoder.decode(F),ue=this.vtLayers[ee].feature(A);if(a.needGeometry){const ve=Ia(ue,!0);if(!a.filter(new j(this.tileID.overscaledZ),ve,this.tileID.canonical))return}else if(!a.filter(new j(this.tileID.overscaledZ),ue))return;const fe=this.getId(ue,ee);for(let ve=0;ve<H.length;ve++){const Te=H[ve];if(u&&u.indexOf(Te)<0)continue;const Se=g[Te];if(!Se)continue;let Ie={};void 0!==fe&&b&&(Ie=b.getState(Se.sourceLayer||"_geojsonTileLayer",fe));const Pe=Gt({},x[Te]);Pe.paint=Sp(Pe.paint,Se.paint,ue,Ie,f),Pe.layout=Sp(Pe.layout,Se.layout,ue,Ie,f);const Ye=!D||D(ue,Se,Ie,$);if(!Ye)continue;const We=new Tu(ue,this.z,this.x,this.y,fe);We.layer=Pe;let It=e[Te];void 0===It&&(It=e[Te]=[]),It.push({featureIndex:A,feature:We,intersectionZ:Ye})}}lookupSymbolFeatures(e,i,a,u,f,g,x,b){const D={};this.loadVTLayers();const A=ya(f);for(const P of e)this.loadMatchingFeature(D,{bucketIndex:a,sourceLayerIndex:u,featureIndex:P,layoutVertexArrayOffset:0},A,g,x,b,i);return D}loadFeature(e){const{featureIndex:i,sourceLayerIndex:a}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(a),f=this.vtFeatures[u];if(f[i])return f[i];const g=this.vtLayers[u].feature(i);return f[i]=g,g}hasLayer(e){for(const i of this.bucketLayerIDs)for(const a of i)if(e===a)return!0;return!1}getId(e,i){let a=e.id;return this.promoteId&&(a=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[i]],"boolean"==typeof a&&(a=Number(a))),a}}function Sp(n,e,i,a,u){return $e(n,(f,g)=>{const x=e instanceof _e?e.get(g):null;return x&&x.evaluate?x.evaluate(i,a,u):x})}function Ip(n,e){return e-n}Bt("FeatureIndex",Tp,{omit:["rawTileData","sourceLayerCoder"]});class Ym{constructor(e){const i={},a=[];for(const x in e){const b=e[x],D=i[x]={};for(const A in b.glyphs){const P=b.glyphs[+A];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const F=P.metrics.localGlyph?2:1,$={x:0,y:0,w:P.bitmap.width+2*F,h:P.bitmap.height+2*F};a.push($),D[A]=$}}const{w:u,h:f}=tp(a),g=new Il({width:u||1,height:f||1});for(const x in e){const b=e[x];for(const D in b.glyphs){const A=b.glyphs[+D];if(!A||0===A.bitmap.width||0===A.bitmap.height)continue;const P=i[x][D],F=A.metrics.localGlyph?2:1;Il.copy(A.bitmap,g,{x:0,y:0},{x:P.x+F,y:P.y+F},A.bitmap)}}this.image=g,this.positions=i}}Bt("GlyphAtlas",Ym);class Mp{constructor(e){this.tileID=new Po(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,e.projection&&(this.tileTransform=ph(e.tileID.canonical,e.projection))}parse(e,i,a,u,f){this.status="parsing",this.data=e,this.collisionBoxArray=new _o;const g=new Pa(Object.keys(e.layers).sort()),x=new Tp(this.tileID,this.promoteId);x.bucketLayerIDs=[];const b={},D=new dh(256,256),A={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:D,availableImages:a},P=i.familiesBySource[this.source];for(const Ie in P){const Pe=e.layers[Ie];if(!Pe)continue;let Ye=!1,We=!1;for(const Qe of P[Ie])"symbol"===Qe[0].type?Ye=!0:We=!0;if(!0===this.isSymbolTile&&!Ye||!1===this.isSymbolTile&&!We)continue;1===Pe.version&&zt(`Vector tile source "${this.source}" layer "${Ie}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const It=g.encode(Ie),ct=[];for(let Qe=0;Qe<Pe.length;Qe++){const ht=Pe.feature(Qe),pt=x.getId(ht,Ie);ct.push({feature:ht,id:pt,index:Qe,sourceLayerIndex:It})}for(const Qe of P[Ie]){const ht=Qe[0];void 0!==this.isSymbolTile&&"symbol"===ht.type!==this.isSymbolTile||ht.minzoom&&this.zoom<Math.floor(ht.minzoom)||ht.maxzoom&&this.zoom>=ht.maxzoom||"none"!==ht.visibility&&(kd(Qe,this.zoom,a),(b[ht.id]=ht.createBucket({index:x.bucketLayerIDs.length,layers:Qe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:It,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:a})).populate(ct,A,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Qe.map(pt=>pt.id)))}}let F,$,H,ee;D.trim();const ue={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},fe=$e(A.glyphDependencies,Ie=>Object.keys(Ie).map(Number));Object.keys(fe).length?u.send("getGlyphs",{uid:this.uid,stacks:fe},(Ie,Pe)=>{F||(F=Ie,$=Pe,Se.call(this))},void 0,!1,ue):$={};const ve=Object.keys(A.iconDependencies);ve.length?u.send("getImages",{icons:ve,source:this.source,tileID:this.tileID,type:"icons"},(Ie,Pe)=>{F||(F=Ie,H=Pe,Se.call(this))},void 0,!1,ue):H={};const Te=Object.keys(A.patternDependencies);function Se(){if(F)return f(F);if($&&H&&ee){const Ie=new Ym($),Pe=new Rm(H,ee);for(const Ye in b){const We=b[Ye];We instanceof yo?(kd(We.layers,this.zoom,a),cp(We,$,Ie.positions,H,Pe.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom)):We.hasPattern&&(We instanceof eh||We instanceof ic||We instanceof pu)&&(kd(We.layers,this.zoom,a),We.addFeatures(A,this.tileID.canonical,Pe.patternPositions,a))}this.status="done",f(null,{buckets:Pn(b).filter(Ye=>!Ye.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ie.image,lineAtlas:D,imageAtlas:Pe,glyphMap:this.returnDependencies?$:null,iconMap:this.returnDependencies?H:null,glyphPositions:this.returnDependencies?Ie.positions:null})}}Te.length?u.send("getImages",{icons:Te,source:this.source,tileID:this.tileID,type:"patterns"},(Ie,Pe)=>{F||(F=Ie,ee=Pe,Se.call(this))},void 0,!1,ue):ee={},Se.call(this)}}function kd(n,e,i){const a=new j(e);for(const u of n)u.recalculate(a,i)}class Ap{constructor(e){this.entries={},this.scheduler=e}request(e,i,a,u){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[g,x]=f.result;return this.scheduler?this.scheduler.add(()=>{u(g,x)},i):u(g,x),()=>{}}return f.callbacks.push(u),f.cancel||(f.cancel=a((g,x)=>{f.result=[g,x];for(const b of f.callbacks)this.scheduler?this.scheduler.add(()=>{b(g,x)},i):b(g,x);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(g=>g!==u),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function Km(n,e,i){const a=JSON.stringify(n.request);return n.data&&(this.deduped.entries[a]={result:[null,n.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},u=>{const f=Z(n.request,(g,x,b,D)=>{g?u(g):x&&u(null,{vectorTile:i?void 0:new oc.VectorTile(new Pl(x)),rawData:x,cacheControl:b,expires:D})});return()=>{f.cancel(),u()}},e)}var g_={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],conic:!0,initializeConstants(){if(this.constants&&Cf(this.parallels,this.constants.parallels))return;const n=Math.sin(bt(this.parallels[0])),e=(n+Math.sin(bt(this.parallels[1])))/2,i=1+n*(2*e-n),a=Math.sqrt(i)/e;this.constants={n:e,c:i,r0:a,parallels:this.parallels}},project(n,e){this.initializeConstants();const i=bt(n-this.center[0]),a=bt(e),{n:u,c:f,r0:g}=this.constants,x=Math.sqrt(f-2*u*Math.sin(a))/u;return{x:x*Math.sin(i*u),y:x*Math.cos(i*u)-g}},unproject(n,e){this.initializeConstants();const{n:i,c:a,r0:u}=this.constants,f=u+e;let g=Math.atan2(n,Math.abs(f))*Math.sign(f);f*i<0&&(g-=Math.PI*Math.sign(n)*Math.sign(f));const x=bt(this.center[0])*i;g=ft(g,-Math.PI-x,Math.PI-x);const b=Ct(g/i)+this.center[0],D=Math.asin(At((a-(n*n+f*f)*i*i)/(2*i),-1,1)),A=At(Ct(D),-85.051129,Jl);return new dr(b,A)}};const uc=1.340264,Mu=-.081106,Uc=893e-6,Vc=.003796,Rd=Math.sqrt(3)/2;var aa={name:"equalEarth",center:[0,0],range:[3.5,7],project(n,e){e=e/180*Math.PI,n=n/180*Math.PI;const i=Math.asin(Rd*Math.sin(e)),a=i*i,u=a*a*a;return{x:.5*(n*Math.cos(i)/(Rd*(uc+3*Mu*a+u*(7*Uc+9*Vc*a)))/Math.PI+.5),y:1-.5*(i*(uc+Mu*a+u*(Uc+Vc*a))/Math.PI+1)}},unproject(n,e){n=(2*n-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,a=i*i,u=a*a*a;for(let D,A,P,F=0;F<12&&(A=i*(uc+Mu*a+u*(Uc+Vc*a))-e,P=uc+3*Mu*a+u*(7*Uc+9*Vc*a),D=A/P,i=At(i-D,-Math.PI/3,Math.PI/3),a=i*i,u=a*a*a,!(Math.abs(D)<1e-12));++F);const f=Rd*n*(uc+3*Mu*a+u*(7*Uc+9*Vc*a))/Math.cos(i),g=Math.asin(Math.sin(i)/Rd),x=At(180*f/Math.PI,-180,180),b=At(180*g/Math.PI,-85.051129,Jl);return new dr(x,b)}},__={name:"equirectangular",wrap:!0,center:[0,0],range:[3.5,7],project:(n,e)=>({x:.5+n/360,y:.5-e/360}),unproject(n,e){const i=360*(n-.5),a=At(360*(.5-e),-85.051129,Jl);return new dr(i,a)}};const Au=Math.PI/2;function Pu(n){return Math.tan((Au+n)/2)}var Pp={name:"lambertConformalConic",range:[3.5,7],center:[0,30],parallels:[30,30],conic:!0,initializeConstants(){if(this.constants&&Cf(this.parallels,this.constants.parallels))return;const n=bt(this.parallels[0]),e=bt(this.parallels[1]),i=Math.cos(n),a=n===e?Math.sin(n):Math.log(i/Math.cos(e))/Math.log(Pu(e)/Pu(n)),u=i*Math.pow(Pu(n),a)/a;this.constants={n:a,f:u,parallels:this.parallels}},project(n,e){this.initializeConstants(),e=bt(e),n=bt(n-this.center[0]);const i=1e-6,{n:a,f:u}=this.constants;u>0?e<-Au+i&&(e=-Au+i):e>Au-i&&(e=Au-i);const f=u/Math.pow(Pu(e),a),g=f*Math.sin(a*n),x=u-f*Math.cos(a*n);return{x:.5*(g/Math.PI+.5),y:1-.5*(x/Math.PI+.5)}},unproject(n,e){this.initializeConstants(),n=(2*n-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:i,f:a}=this.constants,u=a-e,f=Math.sign(u),g=Math.sign(i)*Math.sqrt(n*n+u*u);let x=Math.atan2(n,Math.abs(u))*f;u*i<0&&(x-=Math.PI*Math.sign(n)*f);const b=At(Ct(x/i)+this.center[0],-180,180),D=At(Ct(2*Math.atan(Math.pow(a/g,1/i))-Au),-85.051129,Jl);return new dr(b,D)}},kp={name:"mercator",wrap:!0,center:[0,0],project:(n,e)=>({x:sf(n),y:af(e)}),unproject(n,e){const i=Ja(n),a=ks(e);return new dr(i,a)}};const Rp=bt(Jl);var y_={name:"naturalEarth",center:[0,0],range:[3.5,7],project(n,e){const i=(e=bt(e))*e,a=i*i;return{x:.5*((n=bt(n))*(.8707-.131979*i+a*(a*(.003971*i-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+i*(.015085+a*(.028874*i-.044475-.005916*a)))/Math.PI+1)}},unproject(n,e){n=(2*n-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,a=25,u=0,f=i*i;do{f=i*i;const b=f*f;u=(i*(1.007226+f*(.015085+b*(.028874*f-.044475-.005916*b)))-e)/(1.007226+f*(.045255+b*(.259866*f-.311325-.005916*11*b))),i=At(i-u,-Rp,Rp)}while(Math.abs(u)>1e-6&&--a>0);f=i*i;const g=At(Ct(n/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),x=Ct(i);return new dr(g,x)}};const Ld=bt(Jl),Fd={albers:g_,equalEarth:aa,equirectangular:__,lambertConformalConic:Pp,mercator:kp,naturalEarth:y_,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],project(n,e){e=bt(e),n=bt(n);const i=Math.cos(e),a=2/Math.PI,u=Math.acos(i*Math.cos(n/2)),f=Math.sin(u)/u,g=.5*(n*a+2*i*Math.sin(n/2)/f)||0,x=.5*(e+Math.sin(e)/f)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(x/Math.PI+1)}},unproject(n,e){let i=n=(2*n-.5)*Math.PI,a=e=(2*(1-e)-1)*Math.PI,u=25;const f=1e-6;let g=0,x=0;do{const b=Math.cos(a),D=Math.sin(a),A=2*D*b,P=D*D,F=b*b,$=Math.cos(i/2),H=Math.sin(i/2),ee=2*$*H,ue=H*H,fe=1-F*$*$,ve=fe?1/fe:0,Te=fe?Math.acos(b*$)*Math.sqrt(1/fe):0,Se=.5*(2*Te*b*H+2*i/Math.PI)-n,Ie=.5*(Te*D+a)-e,Pe=.5*ve*(F*ue+Te*b*$*P)+1/Math.PI,Ye=ve*(ee*A/4-Te*D*H),We=.125*ve*(A*H-Te*D*F*ee),It=.5*ve*(P*$+Te*ue*b)+.5,ct=Ye*We-It*Pe;g=(Ie*Ye-Se*It)/ct,x=(Se*We-Ie*Pe)/ct,i=At(i-g,-Math.PI,Math.PI),a=At(a-x,-Ld,Ld)}while((Math.abs(g)>f||Math.abs(x)>f)&&--u>0);return new dr(Ct(i),Ct(a))}}};c.ARRAY_TYPE=wr,c.AUTH_ERR_MSG=co,c.Actor=class{constructor(n,e,i){this.target=n,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},Ke(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=sr()?n:qe,this.scheduler=new m_}send(n,e,i,a,u=!1,f){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=f,this.callbacks[g]=i);const x=xr(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:n,hasCallback:!!i,targetMapId:a,mustQueue:u,sourceMapId:this.mapId,data:Ss(e,x)},x),{cancel:()=>{i&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(n){const e=n.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const a=this.cancelCallbacks[i];delete this.cancelCallbacks[i],a&&a.cancel()}else if(e.mustQueue||sr()){const a=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),a&&a.metadata||{type:"message"})}else this.processTask(i,e)}processTask(n,e){if("<response>"===e.type){const i=this.callbacks[n];delete this.callbacks[n],i&&(e.error?i(Is(e.error)):i(null,Is(e.data)))}else{const i=xr(this.globalScope)?void 0:[],a=e.hasCallback?(f,g)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:f?Ss(f):null,data:Ss(g,i)},i)}:f=>{},u=Is(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,a);else if(this.parent.getWorkerSource){const f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],u.source)[f[1]](u,a)}else a(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},c.CanonicalTileID=mh,c.Color=Ln,c.ColorMode=Ti,c.CullFaceMode=zs,c.DEMData=sl,c.DataConstantProperty=le,c.DedupedRequest=Ap,c.DepthMode=Nc,c.EXTENT=Yn,c.Elevation=class{getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){null==e&&(e=null);const a=this._source();if(!a||n.y<0||n.y>1)return e;const u=a.getSource().maxzoom,f=1<<u,g=Math.floor(n.x),x=n.x-g,b=new Po(u,g,u,Math.floor(x*f),Math.floor(n.y*f)),D=this.findDEMTileFor(b);if(!D||!D.dem)return e;const A=D.dem,P=1<<D.tileID.canonical.z,F=(x*P-D.tileID.canonical.x)*A.dim,$=(n.y*P-D.tileID.canonical.y)*A.dim,H=Math.floor(F),ee=Math.floor($);return(i?this.exaggeration():1)*Vn(Vn(A.get(H,ee),A.get(H,ee+1),$-ee),Vn(A.get(H+1,ee),A.get(H+1,ee+1),$-ee),F-H)}getAtTileOffset(n,e,i){const a=1<<n.canonical.z;return this.getAtPointOrZero(new Oh(n.wrap+(n.canonical.x+e/Yn)/a,(n.canonical.y+i/Yn)/a))}getForTilePoints(n,e,i,a){const u=yh.create(this,n,a);return!!u&&(e.forEach(f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],i)}),!0)}getMinMaxForTile(n){const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,a=e.tileID,u=1<<n.canonical.z-a.canonical.z;let f=n.canonical.x/u-a.canonical.x,g=n.canonical.y/u-a.canonical.y,x=0;for(let b=0;b<n.canonical.z-a.canonical.z&&!i.leaves[x];b++){f*=2,g*=2;const D=2*Math.floor(g)+Math.floor(f);x=i.childOffsets[x]+D,f%=1,g%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},c.ErrorEvent=Ht,c.EvaluationParameters=j,c.Event=it,c.Evented=vt,c.GlyphManager=il,c.ImagePosition=np,c.LineAtlas=dh,c.LngLat=dr,c.LngLatBounds=Mo,c.LocalGlyphMode=ah,c.MAX_MERCATOR_LATITUDE=Jl,c.MAX_SAFE_INTEGER=lt,c.MercatorCoordinate=Oh,c.ONE_EM=24,c.OverscaledTileID=Po,c.Properties=tt,c.RGBAImage=_s,c.RequestManager=class{constructor(n,e,i){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Kr,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!zr(n))return n;const i=jr(n);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!zr(n))return n;const i=jr(n);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(n,e){if(!zr(n))return n;const i=jr(n);return i.path=`/v4/${i.authority}.json`,i.params.push("secure"),this._makeAPIURL(i,this._customAccessToken||e)}normalizeSpriteURL(n,e,i,a){const u=jr(n);return zr(n)?(u.path=`/styles/v1${u.path}/sprite${e}${i}`,this._makeAPIURL(u,this._customAccessToken||a)):(u.path+=`${e}${i}`,qt(u))}normalizeTileURL(n,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!zr(n))return n;const a=jr(n);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==a.authority&&512===i?"@2x":""}${Ir.supported?".webp":"$1"}`),"raster"===a.authority?a.path=`/${Fn.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${Fn.TILE_URL_VERSION}${a.path}`);const u=this._customAccessToken||function(f){for(const g of f){const x=g.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(a.params)||Fn.ACCESS_TOKEN;return Fn.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,u)}canonicalizeTileURL(n,e){const i=jr(n);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return n;let a="mapbox://";i.path.match(/^\/raster\/v1\//)?a+=`raster/${i.path.replace(`/${Fn.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${i.path.replace(`/${Fn.TILE_URL_VERSION}/`,"")}`;let u=i.params;return e&&(u=u.filter(f=>!f.match(/^access_token=/))),u.length&&(a+=`?${u.join("&")}`),a}canonicalizeTileset(n,e){const i=!!e&&zr(e),a=[];for(const u of n.tiles||[])Xi(u)?a.push(this.canonicalizeTileURL(u,i)):a.push(u);return a}_makeAPIURL(n,e){const i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",a=jr(Fn.API_URL);if(n.protocol=a.protocol,n.authority=a.authority,"http"===n.protocol){const u=n.params.indexOf("secure");u>=0&&n.params.splice(u,1)}if("/"!==a.path&&(n.path=`${a.path}${n.path}`),!Fn.REQUIRE_ACCESS_TOKEN)return qt(n);if(e=e||Fn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return n.params=n.params.filter(u=>-1===u.indexOf("access_token")),n.params.push(`access_token=${e||""}`),qt(n)}},c.ResourceType=Ai,c.SegmentVector=gi,c.SourceCache=Ol,c.StencilMode=Ad,c.StructArrayLayout1ui2=Zi,c.StructArrayLayout2f1f2i16=Fi,c.StructArrayLayout2i4=jt,c.StructArrayLayout2ui4=hr,c.StructArrayLayout3f12=yn,c.StructArrayLayout3ui6=mi,c.StructArrayLayout4i8=un,c.Texture=zc,c.Tile=Td,c.Transitionable=ie,c.Uniform1f=Jc,c.Uniform1i=class extends Ta{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},c.Uniform2f=class extends Ta{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},c.Uniform3f=class extends Ta{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},c.Uniform4f=Ph,c.UniformColor=kh,c.UniformMatrix2f=class extends Ta{constructor(n,e){super(n,e),this.current=im}set(n){for(let e=0;e<4;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}},c.UniformMatrix3f=class extends Ta{constructor(n,e){super(n,e),this.current=rm}set(n){for(let e=0;e<9;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},c.UniformMatrix4f=class extends Ta{constructor(n,e){super(n,e),this.current=nm}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},c.UnwrappedTileID=Dd,c.ValidationError=J,c.VectorTileWorkerSource=class extends vt{constructor(n,e,i,a,u){super(),this.actor=n,this.layerIndex=e,this.availableImages=i,this.loadVectorData=u||Km,this.loading={},this.loaded={},this.deduped=new Ap(n.scheduler),this.isSpriteLoaded=a,this.scheduler=n.scheduler}loadTile(n,e){const i=n.uid,a=n&&n.request,u=a&&a.collectResourceTiming,f=this.loading[i]=new Mp(n);f.abort=this.loadVectorData(n,(g,x)=>{const b=!this.loading[i];if(delete this.loading[i],b||g||!x)return f.status="done",b||(this.loaded[i]=f),e(g);const D=x.rawData,A={};x.expires&&(A.expires=x.expires),x.cacheControl&&(A.cacheControl=x.cacheControl),f.vectorTile=x.vectorTile||new oc.VectorTile(new Pl(D));const P=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(F,$)=>{if(F||!$)return e(F);const H={};if(u){const ee=fh(a);ee.length>0&&(H.resourceTiming=JSON.parse(JSON.stringify(ee)))}e(null,Gt({rawTileData:D.slice(0)},$,A,H))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[i]=f})}reloadTile(n,e){const i=this.loaded,a=n.uid,u=this;if(i&&i[a]){const f=i[a];f.showCollisionBoxes=n.showCollisionBoxes,f.enableTerrain=!!n.enableTerrain;const g=(x,b)=>{const D=f.reloadCallback;D&&(delete f.reloadCallback,f.parse(f.vectorTile,u.layerIndex,this.availableImages,u.actor,D)),e(x,b)};"parsing"===f.status?f.reloadCallback=g:"done"===f.status&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(n,e){const i=n.uid,a=this.loading[i];a&&(a.abort&&a.abort(),delete this.loading[i]),e()}removeTile(n,e){const i=this.loaded,a=n.uid;i&&i[a]&&delete i[a],e()}},c.WritingMode=Ls,c.ZoomHistory=Cl,c.add=function(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n},c.addDynamicAttributes=yd,c.altitudeFromMercatorZ=tu,c.asyncAll=cn,c.bezier=ln,c.bindAll=Ke,c.boundsAttributes=Su,c.bufferConvexPolygon=function(n,e){const i=[];for(let a=0;a<n.length;a++){const u=ft(a-1,-1,n.length-1),f=ft(a+1,-1,n.length-1),g=n[a],x=n[f],b=n[u].sub(g).unit(),D=x.sub(g).unit(),A=D.angleWithSep(b.x,b.y),P=b.add(D).unit().mult(-1*e/Math.sin(A/2));i.push(g.add(P))}return i},c.cacheEntryPossiblyAdded=function(n){Vs++,Vs>Yi&&(n.getActor().send("enforceCacheSizeLimit",Do),Vs=0)},c.clamp=At,c.clearTileCache=function(n){const e=qe.caches.delete(Un);n&&e.catch(n).then(()=>n())},c.clipLine=pd,c.clone=function(n){var e=new wr(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},c.clone$1=function(n){var e=new wr(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},c.clone$2=wn,c.collisionCircleLayout=th,c.config=Fn,c.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},c.copy=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n},c.create=su,c.create$1=function(){var n=new wr(16);return wr!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},c.create$2=Dc,c.createExpression=ma,c.createLayout=Ne,c.createStyleLayer=function(n){return"custom"===n.type?new $m(n):new Hm[n.type](n)},c.cross=function(n,e,i){var a=e[0],u=e[1],f=e[2],g=i[0],x=i[1],b=i[2];return n[0]=u*b-f*x,n[1]=f*g-a*b,n[2]=a*x-u*g,n},c.degToRad=bt,c.div=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},c.dot=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]},c.dot$1=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]},c.ease=Yt,c.easeCubicInOut=Ot,c.emitValidationErrors=Dl,c.endsWith=_t,c.enforceCacheSizeLimit=function(n){Wn(),dn&&dn.then(e=>{e.keys().then(i=>{for(let a=0;a<i.length-n;a++)e.delete(i[a])})})},c.evaluateSizeForFeature=Ac,c.evaluateSizeForZoom=Jo,c.evaluateVariableOffset=Nm,c.evented=S,c.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},c.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},c.exported=Mi,c.exported$1=Ir,c.extend=Gt,c.filterObject=tn,c.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},c.fromQuat=function(n,e){var i=e[0],a=e[1],u=e[2],f=e[3],g=i+i,x=a+a,b=u+u,D=i*g,A=a*g,P=a*x,F=u*g,$=u*x,H=u*b,ee=f*g,ue=f*x,fe=f*b;return n[0]=1-P-H,n[1]=A+fe,n[2]=F-ue,n[3]=0,n[4]=A-fe,n[5]=1-D-H,n[6]=$+ee,n[7]=0,n[8]=F+ue,n[9]=$-ee,n[10]=1-D-P,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},c.fromRotation=function(n,e){var i=Math.sin(e),a=Math.cos(e);return n[0]=a,n[1]=i,n[2]=0,n[3]=-i,n[4]=a,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},c.fromScaling=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},c.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return sn[e]},c.getAABBPointSquareDist=function(n,e,i){let a=0;for(let u=0;u<2;++u){const f=i?i[u]:0;n[u]>f&&(a+=(n[u]-f)*(n[u]-f)),e[u]<f&&(a+=(f-e[u])*(f-e[u]))}return a},c.getAnchorAlignment=vu,c.getAnchorJustification=up,c.getBounds=function(n){let e=1/0,i=1/0,a=-1/0,u=-1/0;for(const f of n)e=Math.min(e,f.x),i=Math.min(i,f.y),a=Math.max(a,f.x),u=Math.max(u,f.y);return{min:new Ve(e,i),max:new Ve(a,u)}},c.getImage=Le,c.getJSON=function(n,e){return V(Gt(n,{type:"json"}),e)},c.getMapSessionAPI=xi,c.getPerformanceMeasurement=fh,c.getProjection=function(n){const e=Fd[n.name];if(!e)throw new Error(`Invalid projection name: ${n.name}`);return e.conic?function(i,a){if(a.parallels&&Math.abs(a.parallels[0]+a.parallels[1])<.01){let u=function(f){const g=Math.max(.01,Math.cos(bt(f))),x=1/(2*Math.max(Math.PI*g,1/g));return{wrap:!0,project(b,D){const A=bt(b)*g,P=Math.sin(bt(D))/g;return{x:A*x+.5,y:-P*x+.5}},unproject(b,D){const A=-(D-.5)/x,P=At(Ct((b-.5)/x)/g,-180,180),F=Math.asin(At(A*g,-1,1)),$=At(Ct(F),-85.051129,Jl);return new dr(P,$)}}}(a.parallels[0]);if("lambertConformalConic"===a.name){const{project:f,unproject:g}=Fd.mercator;u={wrap:!0,project:f,unproject:g}}return Gt({},i,a,u)}return Gt({},i,a)}(e,n):e},c.getRTLTextPluginStatus=R,c.getReferrer=ae,c.getTilePoint=function(n,{x:e,y:i},a=0){return new Ve(((e-a)*n.scale-n.x)*Yn,(i*n.scale-n.y)*Yn)},c.getTileVec3=function(n,e,i=0){return ec(((e.x-i)*n.scale-n.x)*Yn,(e.y*n.scale-n.y)*Yn,tu(e.z,e.y))},c.getVideo=function(n,e){const i=qe.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let a=0;a<n.length;a++){const u=qe.document.createElement("source");xe(n[a])||(i.crossOrigin="Anonymous"),u.src=n[a],i.appendChild(u)}return{cancel:()=>{}}},c.identity=ou,c.identity$1=Ef,c.invert=function(n,e){var i=e[0],a=e[1],u=e[2],f=e[3],g=e[4],x=e[5],b=e[6],D=e[7],A=e[8],P=e[9],F=e[10],$=e[11],H=e[12],ee=e[13],ue=e[14],fe=e[15],ve=i*x-a*g,Te=i*b-u*g,Se=i*D-f*g,Ie=a*b-u*x,Pe=a*D-f*x,Ye=u*D-f*b,We=A*ee-P*H,It=A*ue-F*H,ct=A*fe-$*H,Qe=P*ue-F*ee,ht=P*fe-$*ee,pt=F*fe-$*ue,ot=ve*pt-Te*ht+Se*Qe+Ie*ct-Pe*It+Ye*We;return ot?(n[0]=(x*pt-b*ht+D*Qe)*(ot=1/ot),n[1]=(u*ht-a*pt-f*Qe)*ot,n[2]=(ee*Ye-ue*Pe+fe*Ie)*ot,n[3]=(F*Pe-P*Ye-$*Ie)*ot,n[4]=(b*ct-g*pt-D*It)*ot,n[5]=(i*pt-u*ct+f*It)*ot,n[6]=(ue*Se-H*Ye-fe*Te)*ot,n[7]=(A*Ye-F*Se+$*Te)*ot,n[8]=(g*ht-x*ct+D*We)*ot,n[9]=(a*ct-i*ht-f*We)*ot,n[10]=(H*Pe-ee*Se+fe*ve)*ot,n[11]=(P*Se-A*Pe-$*ve)*ot,n[12]=(x*It-g*Qe-b*We)*ot,n[13]=(i*Qe-a*It+u*We)*ot,n[14]=(ee*Te-H*Ie-ue*ve)*ot,n[15]=(A*Ie-P*Te+F*ve)*ot,n):null},c.isMapAuthenticated=function(n){return jo.has(n)},c.isMapboxURL=zr,c.latFromMercatorY=ks,c.len=dm,c.length=vf,c.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},c.loadVectorTile=Km,c.makeRequest=V,c.mercatorXfromLng=sf,c.mercatorYfromLat=af,c.mercatorZfromAltitude=lf,c.mul=function(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n[3]=e[3]*i[3],n},c.mul$1=um,c.mul$2=Uh,c.multiply=yf,c.multiply$1=Nh,c.nextPowerOfTwo=He,c.normalize=wf,c.normalize$1=function(n,e){var i=e[0],a=e[1],u=e[2],f=e[3],g=i*i+a*a+u*u+f*f;return g>0&&(g=1/Math.sqrt(g)),n[0]=i*g,n[1]=a*g,n[2]=u*g,n[3]=f*g,n},c.number=Vn,c.ortho=function(n,e,i,a,u,f,g){var x=1/(e-i),b=1/(a-u),D=1/(f-g);return n[0]=-2*x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*D,n[11]=0,n[12]=(e+i)*x,n[13]=(u+a)*b,n[14]=(g+f)*D,n[15]=1,n},c.pbf=Pl,c.perspective=function(n,e,i,a,u){var f,g=1/Math.tan(e/2);return n[0]=g/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=g,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=u&&u!==1/0?(n[10]=(u+a)*(f=1/(a-u)),n[14]=2*u*a*f):(n[10]=-1,n[14]=-2*a),n},c.pick=function(n,e){const i={};for(let a=0;a<e.length;a++){const u=e[a];u in n&&(i[u]=n[u])}return i},c.plugin=N,c.pointGeometry=Ve,c.polygonIntersectsBox=mf,c.polygonIntersectsPolygon=uf,c.polygonizeBounds=function(n,e,i=0,a=!0){const u=new Ve(i,i),f=n.sub(u),g=e.add(u),x=[f,new Ve(g.x,f.y),g,new Ve(f.x,g.y)];return a&&x.push(f),x},c.posAttributes=Wm,c.postMapLoadEvent=$r,c.postTurnstileEvent=wo,c.potpack=tp,c.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},c.radToDeg=Ct,c.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],c.registerForPluginStateChange=function(n){return n({pluginStatus:p,pluginURL:_}),S.on("pluginStateChange",n),n},c.removeAuthState=function(n){jo.delete(n)},c.renderColorRamp=Rs,c.rotateX=function(n,e,i){var a=Math.sin(i),u=Math.cos(i),f=e[4],g=e[5],x=e[6],b=e[7],D=e[8],A=e[9],P=e[10],F=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=f*u+D*a,n[5]=g*u+A*a,n[6]=x*u+P*a,n[7]=b*u+F*a,n[8]=D*u-f*a,n[9]=A*u-g*a,n[10]=P*u-x*a,n[11]=F*u-b*a,n},c.rotateX$1=Df,c.rotateY=function(n,e,i){var a=Math.sin(i),u=Math.cos(i),f=e[0],g=e[1],x=e[2],b=e[3],D=e[8],A=e[9],P=e[10],F=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u-D*a,n[1]=g*u-A*a,n[2]=x*u-P*a,n[3]=b*u-F*a,n[8]=f*a+D*u,n[9]=g*a+A*u,n[10]=x*a+P*u,n[11]=b*a+F*u,n},c.rotateZ=function(n,e,i){var a=Math.sin(i),u=Math.cos(i),f=e[0],g=e[1],x=e[2],b=e[3],D=e[4],A=e[5],P=e[6],F=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u+D*a,n[1]=g*u+A*a,n[2]=x*u+P*a,n[3]=b*u+F*a,n[4]=D*u-f*a,n[5]=A*u-g*a,n[6]=P*u-x*a,n[7]=F*u-b*a,n},c.rotateZ$1=function(n,e,i){i*=.5;var a=e[0],u=e[1],f=e[2],g=e[3],x=Math.sin(i),b=Math.cos(i);return n[0]=a*b+u*x,n[1]=u*b-a*x,n[2]=f*b+g*x,n[3]=g*b-f*x,n},c.scale=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n},c.scale$1=function(n,e,i){var a=i[0],u=i[1],f=i[2];return n[0]=e[0]*a,n[1]=e[1]*a,n[2]=e[2]*a,n[3]=e[3]*a,n[4]=e[4]*u,n[5]=e[5]*u,n[6]=e[6]*u,n[7]=e[7]*u,n[8]=e[8]*f,n[9]=e[9]*f,n[10]=e[10]*f,n[11]=e[11]*f,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},c.scale$2=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n},c.scaleAndAdd=bf,c.setCacheLimits=function(n,e){Do=n,Yi=e},c.setRTLTextPlugin=function(n,e,i=!1){if(p===wa||p===d||p===t)throw new Error("setRTLTextPlugin cannot be called multiple times.");_=Mi.resolveURL(n),p=wa,l=e,E(),i||z()},c.smoothstep=function(n,e,i){return(i=At((i-n)/(e-n),0,1))*i*(3-2*i)},c.spec=W,c.storeAuthState=function(n,e){e?jo.add(n):jo.delete(n)},c.sub=hm,c.subtract=xf,c.symbolSize=sd,c.tileTransform=ph,c.transformMat3=function(n,e,i){var a=e[0],u=e[1],f=e[2];return n[0]=a*i[0]+u*i[3]+f*i[6],n[1]=a*i[1]+u*i[4]+f*i[7],n[2]=a*i[2]+u*i[5]+f*i[8],n},c.transformMat4=lu,c.transformMat4$1=function(n,e,i){var a=e[0],u=e[1],f=e[2],g=i[3]*a+i[7]*u+i[11]*f+i[15];return n[0]=(i[0]*a+i[4]*u+i[8]*f+i[12])/(g=g||1),n[1]=(i[1]*a+i[5]*u+i[9]*f+i[13])/g,n[2]=(i[2]*a+i[6]*u+i[10]*f+i[14])/g,n},c.transformQuat=Hu,c.translate=function(n,e,i){var a,u,f,g,x,b,D,A,P,F,$,H,ee=i[0],ue=i[1],fe=i[2];return e===n?(n[12]=e[0]*ee+e[4]*ue+e[8]*fe+e[12],n[13]=e[1]*ee+e[5]*ue+e[9]*fe+e[13],n[14]=e[2]*ee+e[6]*ue+e[10]*fe+e[14],n[15]=e[3]*ee+e[7]*ue+e[11]*fe+e[15]):(u=e[1],f=e[2],g=e[3],x=e[4],b=e[5],D=e[6],A=e[7],P=e[8],F=e[9],$=e[10],H=e[11],n[0]=a=e[0],n[1]=u,n[2]=f,n[3]=g,n[4]=x,n[5]=b,n[6]=D,n[7]=A,n[8]=P,n[9]=F,n[10]=$,n[11]=H,n[12]=a*ee+x*ue+P*fe+e[12],n[13]=u*ee+b*ue+F*fe+e[13],n[14]=f*ee+D*ue+$*fe+e[14],n[15]=g*ee+A*ue+H*fe+e[15]),n},c.triggerPluginCompletionEvent=v,c.uniqueId=gt,c.validateCustomStyleLayer=function(n){const e=[],i=n.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===n.render&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&"2d"!==n.renderingMode&&"3d"!==n.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},c.validateFog=Ts,c.validateLight=gc,c.validateStyle=hs,c.values=Pn,c.vectorTile=oc,c.version="2.6.1",c.warnOnce=zt,c.window=qe,c.wrap=ft}),Fe(0,function(c){function Tt(ae){const V=typeof ae;if("number"===V||"boolean"===V||"string"===V||null==ae)return JSON.stringify(ae);if(Array.isArray(ae)){let he="[";for(const xe of ae)he+=`${Tt(xe)},`;return`${he}]`}const Z=Object.keys(ae).sort();let ce="{";for(let he=0;he<Z.length;he++)ce+=`${JSON.stringify(Z[he])}:${Tt(ae[Z[he]])},`;return`${ce}}`}function Jt(ae){let V="";for(const Z of c.refProperties)V+=`/${Tt(ae[Z])}`;return V}class Ft{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,Z){for(const he of V)this._layerConfigs[he.id]=he,(this._layers[he.id]=c.createStyleLayer(he)).compileFilter(),this.keyCache[he.id]&&delete this.keyCache[he.id];for(const he of Z)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const ce=function(he,xe){const ke={};for(let we=0;we<he.length;we++){const Le=xe&&xe[he[we].id]||Jt(he[we]);xe&&(xe[he[we].id]=Le);let rt=ke[Le];rt||(rt=ke[Le]=[]),rt.push(he[we])}const Me=[];for(const we in ke)Me.push(ke[we]);return Me}(c.values(this._layerConfigs),this.keyCache);for(const he of ce){const xe=he.map(wt=>this._layers[wt.id]),ke=xe[0];if("none"===ke.visibility)continue;const Me=ke.source||"";let we=this.familiesBySource[Me];we||(we=this.familiesBySource[Me]={});const Le=ke.sourceLayer||"_geojsonTileLayer";let rt=we[Le];rt||(rt=we[Le]=[]),rt.push(xe)}}}const{ImageBitmap:Ve}=c.window;class ze{loadTile(V,Z){const{uid:ce,encoding:he,rawImageData:xe,padding:ke,buildQuadTree:Me}=V,we=Ve&&xe instanceof Ve?this.getImageData(xe,ke):xe;Z(null,new c.DEMData(ce,we,he,ke<1,Me))}getImageData(V,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const ce=this.offscreenCanvasContext.getImageData(-Z,-Z,V.width+2*Z,V.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new c.RGBAImage({width:ce.width,height:ce.height},ce.data)}}var qe=function ae(V,Z){var ce,he=V&&V.type;if("FeatureCollection"===he)for(ce=0;ce<V.features.length;ce++)ae(V.features[ce],Z);else if("GeometryCollection"===he)for(ce=0;ce<V.geometries.length;ce++)ae(V.geometries[ce],Z);else if("Feature"===he)ae(V.geometry,Z);else if("Polygon"===he)lt(V.coordinates,Z);else if("MultiPolygon"===he)for(ce=0;ce<V.coordinates.length;ce++)lt(V.coordinates[ce],Z);return V};function lt(ae,V){if(0!==ae.length){en(ae[0],V);for(var Z=1;Z<ae.length;Z++)en(ae[Z],!V)}}function en(ae,V){for(var Z=0,ce=0,he=0,xe=ae.length,ke=xe-1;he<xe;ke=he++){var Me=(ae[he][0]-ae[ke][0])*(ae[ke][1]+ae[he][1]),we=Z+Me;ce+=Math.abs(Z)>=Math.abs(Me)?Z-we+Me:Me-we+Z,Z=we}Z+ce>=0!=!!V&&ae.reverse()}const On=c.vectorTile.VectorTileFeature.prototype.toGeoJSON;class bt{constructor(V){this._feature=V,this.extent=c.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))}loadGeometry(){if(1===this._feature.type){const V=[];for(const Z of this._feature.geometry)V.push([new c.pointGeometry(Z[0],Z[1])]);return V}{const V=[];for(const Z of this._feature.geometry){const ce=[];for(const he of Z)ce.push(new c.pointGeometry(he[0],he[1]));V.push(ce)}return V}}toGeoJSON(V,Z,ce){return On.call(this,V,Z,ce)}}class Ct{constructor(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.EXTENT,this.length=V.length,this._features=V}feature(V){return new bt(this._features[V])}}var sn=c.vectorTile.VectorTileFeature,Ot=ln;function ln(ae,V){this.options=V||{},this.features=ae,this.length=ae.length}function Yt(ae,V){this.id="number"==typeof ae.id?ae.id:void 0,this.type=ae.type,this.rawGeometry=1===ae.type?[ae.geometry]:ae.geometry,this.properties=ae.tags,this.extent=V||4096}ln.prototype.feature=function(ae){return new Yt(this.features[ae],this.options.extent)},Yt.prototype.loadGeometry=function(){var ae=this.rawGeometry;this.geometry=[];for(var V=0;V<ae.length;V++){for(var Z=ae[V],ce=[],he=0;he<Z.length;he++)ce.push(new c.pointGeometry(Z[he][0],Z[he][1]));this.geometry.push(ce)}return this.geometry},Yt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ae=this.geometry,V=1/0,Z=-1/0,ce=1/0,he=-1/0,xe=0;xe<ae.length;xe++)for(var ke=ae[xe],Me=0;Me<ke.length;Me++){var we=ke[Me];V=Math.min(V,we.x),Z=Math.max(Z,we.x),ce=Math.min(ce,we.y),he=Math.max(he,we.y)}return[V,ce,Z,he]},Yt.prototype.toGeoJSON=sn.prototype.toGeoJSON;var At=cn,ft=Ot;function cn(ae){var V=new c.pbf;return function(Z,ce){for(var he in Z.layers)ce.writeMessage(3,Pn,Z.layers[he])}(ae,V),V.finish()}function Pn(ae,V){var Z;V.writeVarintField(15,ae.version||1),V.writeStringField(1,ae.name||""),V.writeVarintField(5,ae.extent||4096);var ce={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<ae.length;Z++)ce.feature=ae.feature(Z),V.writeMessage(2,Gt,ce);var he=ce.keys;for(Z=0;Z<he.length;Z++)V.writeStringField(3,he[Z]);var xe=ce.values;for(Z=0;Z<xe.length;Z++)V.writeMessage(4,Je,xe[Z])}function Gt(ae,V){var Z=ae.feature;void 0!==Z.id&&V.writeVarintField(1,Z.id),V.writeMessage(2,an,ae),V.writeVarintField(3,Z.type),V.writeMessage(4,He,Z)}function an(ae,V){var Z=ae.feature,ce=ae.keys,he=ae.values,xe=ae.keycache,ke=ae.valuecache;for(var Me in Z.properties){var we=Z.properties[Me],Le=xe[Me];if(null!==we){void 0===Le&&(ce.push(Me),xe[Me]=Le=ce.length-1),V.writeVarint(Le);var rt=typeof we;"string"!==rt&&"boolean"!==rt&&"number"!==rt&&(we=JSON.stringify(we));var wt=rt+":"+we,it=ke[wt];void 0===it&&(he.push(we),ke[wt]=it=he.length-1),V.writeVarint(it)}}}function gt(ae,V){return(V<<3)+(7&ae)}function Be(ae){return ae<<1^ae>>31}function He(ae,V){for(var Z=ae.loadGeometry(),ce=ae.type,he=0,xe=0,ke=Z.length,Me=0;Me<ke;Me++){var we=Z[Me],Le=1;1===ce&&(Le=we.length),V.writeVarint(gt(1,Le));for(var rt=3===ce?we.length-1:we.length,wt=0;wt<rt;wt++){1===wt&&1!==ce&&V.writeVarint(gt(2,rt-1));var it=we[wt].x-he,Ht=we[wt].y-xe;V.writeVarint(Be(it)),V.writeVarint(Be(Ht)),he+=it,xe+=Ht}3===ce&&V.writeVarint(gt(7,1))}}function Je(ae,V){var Z=typeof ae;"string"===Z?V.writeStringField(1,ae):"boolean"===Z?V.writeBooleanField(7,ae):"number"===Z&&(ae%1!=0?V.writeDoubleField(3,ae):ae<0?V.writeSVarintField(6,ae):V.writeVarintField(5,ae))}function Ke(ae,V,Z,ce,he,xe){if(he-ce<=Z)return;const ke=ce+he>>1;_t(ae,V,ke,ce,he,xe%2),Ke(ae,V,Z,ce,ke-1,xe+1),Ke(ae,V,Z,ke+1,he,xe+1)}function _t(ae,V,Z,ce,he,xe){for(;he>ce;){if(he-ce>600){const Le=he-ce+1,rt=Z-ce+1,wt=Math.log(Le),it=.5*Math.exp(2*wt/3),Ht=.5*Math.sqrt(wt*it*(Le-it)/Le)*(rt-Le/2<0?-1:1);_t(ae,V,Z,Math.max(ce,Math.floor(Z-rt*it/Le+Ht)),Math.min(he,Math.floor(Z+(Le-rt)*it/Le+Ht)),xe)}const ke=V[2*Z+xe];let Me=ce,we=he;for($e(ae,V,ce,Z),V[2*he+xe]>ke&&$e(ae,V,ce,he);Me<we;){for($e(ae,V,Me,we),Me++,we--;V[2*Me+xe]<ke;)Me++;for(;V[2*we+xe]>ke;)we--}V[2*ce+xe]===ke?$e(ae,V,ce,we):(we++,$e(ae,V,we,he)),we<=Z&&(ce=we+1),Z<=we&&(he=we-1)}}function $e(ae,V,Z,ce){tn(ae,Z,ce),tn(V,2*Z,2*ce),tn(V,2*Z+1,2*ce+1)}function tn(ae,V,Z){const ce=ae[V];ae[V]=ae[Z],ae[Z]=ce}function wn(ae,V,Z,ce){const he=ae-Z,xe=V-ce;return he*he+xe*xe}At.fromVectorTileJs=cn,At.fromGeojsonVt=function(ae,V){V=V||{};var Z={};for(var ce in ae)Z[ce]=new Ot(ae[ce].features,V),Z[ce].name=ce,Z[ce].version=V.version,Z[ce].extent=V.extent;return cn({layers:Z})},At.GeoJSONWrapper=ft;const ri=ae=>ae[0],zt=ae=>ae[1];class Zn{constructor(V,Z=ri,ce=zt,he=64,xe=Float64Array){this.nodeSize=he,this.points=V;const ke=V.length<65536?Uint16Array:Uint32Array,Me=this.ids=new ke(V.length),we=this.coords=new xe(2*V.length);for(let Le=0;Le<V.length;Le++)Me[Le]=Le,we[2*Le]=Z(V[Le]),we[2*Le+1]=ce(V[Le]);Ke(Me,we,he,0,Me.length-1,0)}range(V,Z,ce,he){return function(xe,ke,Me,we,Le,rt,wt){const it=[0,xe.length-1,0],Ht=[];let vt,W;for(;it.length;){const J=it.pop(),ne=it.pop(),Ae=it.pop();if(ne-Ae<=wt){for(let $t=Ae;$t<=ne;$t++)vt=ke[2*$t],W=ke[2*$t+1],vt>=Me&&vt<=Le&&W>=we&&W<=rt&&Ht.push(xe[$t]);continue}const je=Math.floor((Ae+ne)/2);vt=ke[2*je],W=ke[2*je+1],vt>=Me&&vt<=Le&&W>=we&&W<=rt&&Ht.push(xe[je]);const yt=(J+1)%2;(0===J?Me<=vt:we<=W)&&(it.push(Ae),it.push(je-1),it.push(yt)),(0===J?Le>=vt:rt>=W)&&(it.push(je+1),it.push(ne),it.push(yt))}return Ht}(this.ids,this.coords,V,Z,ce,he,this.nodeSize)}within(V,Z,ce){return function(he,xe,ke,Me,we,Le){const rt=[0,he.length-1,0],wt=[],it=we*we;for(;rt.length;){const Ht=rt.pop(),vt=rt.pop(),W=rt.pop();if(vt-W<=Le){for(let yt=W;yt<=vt;yt++)wn(xe[2*yt],xe[2*yt+1],ke,Me)<=it&&wt.push(he[yt]);continue}const J=Math.floor((W+vt)/2),ne=xe[2*J],Ae=xe[2*J+1];wn(ne,Ae,ke,Me)<=it&&wt.push(he[J]);const je=(Ht+1)%2;(0===Ht?ke-we<=ne:Me-we<=Ae)&&(rt.push(W),rt.push(J-1),rt.push(je)),(0===Ht?ke+we>=ne:Me+we>=Ae)&&(rt.push(J+1),rt.push(vt),rt.push(je))}return wt}(this.ids,this.coords,V,Z,ce,this.nodeSize)}}const Ui={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ae=>ae},sr=Math.fround||(vi=new Float32Array(1),ae=>(vi[0]=+ae,vi[0]));var vi;class Fr{constructor(V){this.options=Fn(Object.create(Ui),V),this.trees=new Array(this.options.maxZoom+1)}load(V){const{log:Z,minZoom:ce,maxZoom:he,nodeSize:xe}=this.options;Z&&console.time("total time");const ke=`prepare ${V.length} points`;Z&&console.time(ke),this.points=V;let Me=[];for(let we=0;we<V.length;we++)V[we].geometry&&Me.push(mr(V[we],we));this.trees[he+1]=new Zn(Me,Ir,Wi,xe,Float32Array),Z&&console.timeEnd(ke);for(let we=he;we>=ce;we--){const Le=+Date.now();Me=this._cluster(Me,we),this.trees[we]=new Zn(Me,Ir,Wi,xe,Float32Array),Z&&console.log("z%d: %d clusters in %dms",we,Me.length,+Date.now()-Le)}return Z&&console.timeEnd("total time"),this}getClusters(V,Z){let ce=((V[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,V[1]));let xe=180===V[2]?180:((V[2]+180)%360+360)%360-180;const ke=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)ce=-180,xe=180;else if(ce>xe){const rt=this.getClusters([ce,he,180,ke],Z),wt=this.getClusters([-180,he,xe,ke],Z);return rt.concat(wt)}const Me=this.trees[this._limitZoom(Z)],we=Me.range($n(ce),Mi(ke),$n(xe),Mi(he)),Le=[];for(const rt of we){const wt=Me.points[rt];Le.push(wt.numPoints?Ur(wt):this.points[wt.index])}return Le}getChildren(V){const Z=this._getOriginId(V),ce=this._getOriginZoom(V),he="No cluster with the specified id.",xe=this.trees[ce];if(!xe)throw new Error(he);const ke=xe.points[Z];if(!ke)throw new Error(he);const Me=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),we=xe.within(ke.x,ke.y,Me),Le=[];for(const rt of we){const wt=xe.points[rt];wt.parentId===V&&Le.push(wt.numPoints?Ur(wt):this.points[wt.index])}if(0===Le.length)throw new Error(he);return Le}getLeaves(V,Z,ce){const he=[];return this._appendLeaves(he,V,Z=Z||10,ce=ce||0,0),he}getTile(V,Z,ce){const he=this.trees[this._limitZoom(V)],xe=Math.pow(2,V),{extent:ke,radius:Me}=this.options,we=Me/ke,Le=(ce-we)/xe,rt=(ce+1+we)/xe,wt={features:[]};return this._addTileFeatures(he.range((Z-we)/xe,Le,(Z+1+we)/xe,rt),he.points,Z,ce,xe,wt),0===Z&&this._addTileFeatures(he.range(1-we/xe,Le,1,rt),he.points,xe,ce,xe,wt),Z===xe-1&&this._addTileFeatures(he.range(0,Le,we/xe,rt),he.points,-1,ce,xe,wt),wt.features.length?wt:null}getClusterExpansionZoom(V){let Z=this._getOriginZoom(V)-1;for(;Z<=this.options.maxZoom;){const ce=this.getChildren(V);if(Z++,1!==ce.length)break;V=ce[0].properties.cluster_id}return Z}_appendLeaves(V,Z,ce,he,xe){const ke=this.getChildren(Z);for(const Me of ke){const we=Me.properties;if(we&&we.cluster?xe+we.point_count<=he?xe+=we.point_count:xe=this._appendLeaves(V,we.cluster_id,ce,he,xe):xe<he?xe++:V.push(Me),V.length===ce)break}return xe}_addTileFeatures(V,Z,ce,he,xe,ke){for(const Me of V){const we=Z[Me],Le=we.numPoints;let rt,wt,it;if(Le)rt=xr(we),wt=we.x,it=we.y;else{const W=this.points[we.index];rt=W.properties,wt=$n(W.geometry.coordinates[0]),it=Mi(W.geometry.coordinates[1])}const Ht={type:1,geometry:[[Math.round(this.options.extent*(wt*xe-ce)),Math.round(this.options.extent*(it*xe-he))]],tags:rt};let vt;Le?vt=we.id:this.options.generateId?vt=we.index:this.points[we.index].id&&(vt=this.points[we.index].id),void 0!==vt&&(Ht.id=vt),ke.features.push(Ht)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(+V,this.options.maxZoom+1))}_cluster(V,Z){const ce=[],{radius:he,extent:xe,reduce:ke,minPoints:Me}=this.options,we=he/(xe*Math.pow(2,Z));for(let Le=0;Le<V.length;Le++){const rt=V[Le];if(rt.zoom<=Z)continue;rt.zoom=Z;const wt=this.trees[Z+1],it=wt.within(rt.x,rt.y,we),Ht=rt.numPoints||1;let vt=Ht;for(const W of it){const J=wt.points[W];J.zoom>Z&&(vt+=J.numPoints||1)}if(vt>Ht&&vt>=Me){let W=rt.x*Ht,J=rt.y*Ht,ne=ke&&Ht>1?this._map(rt,!0):null;const Ae=(Le<<5)+(Z+1)+this.points.length;for(const je of it){const yt=wt.points[je];if(yt.zoom<=Z)continue;yt.zoom=Z;const $t=yt.numPoints||1;W+=yt.x*$t,J+=yt.y*$t,yt.parentId=Ae,ke&&(ne||(ne=this._map(rt,!0)),ke(ne,this._map(yt)))}rt.parentId=Ae,ce.push(pn(W/vt,J/vt,Ae,vt,ne))}else if(ce.push(rt),vt>1)for(const W of it){const J=wt.points[W];J.zoom<=Z||(J.zoom=Z,ce.push(J))}}return ce}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,Z){if(V.numPoints)return Z?Fn({},V.properties):V.properties;const ce=this.points[V.index].properties,he=this.options.map(ce);return Z&&he===ce?Fn({},he):he}}function pn(ae,V,Z,ce,he){return{x:sr(ae),y:sr(V),zoom:1/0,id:Z,parentId:-1,numPoints:ce,properties:he}}function mr(ae,V){const[Z,ce]=ae.geometry.coordinates;return{x:sr($n(Z)),y:sr(Mi(ce)),zoom:1/0,index:V,parentId:-1}}function Ur(ae){return{type:"Feature",id:ae.id,properties:xr(ae),geometry:{type:"Point",coordinates:[(V=ae.x,360*(V-.5)),xs(ae.y)]}};var V}function xr(ae){const V=ae.numPoints,Z=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V;return Fn(Fn({},ae.properties),{cluster:!0,cluster_id:ae.id,point_count:V,point_count_abbreviated:Z})}function $n(ae){return ae/360+.5}function Mi(ae){const V=Math.sin(ae*Math.PI/180),Z=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return Z<0?0:Z>1?1:Z}function xs(ae){const V=(180-360*ae)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function Fn(ae,V){for(const Z in V)ae[Z]=V[Z];return ae}function Ir(ae){return ae.x}function Wi(ae){return ae.y}function Vr(ae,V,Z,ce){for(var he,xe=ce,ke=Z-V>>1,Me=Z-V,we=ae[V],Le=ae[V+1],rt=ae[Z],wt=ae[Z+1],it=V+3;it<Z;it+=3){var Ht=Or(ae[it],ae[it+1],we,Le,rt,wt);if(Ht>xe)he=it,xe=Ht;else if(Ht===xe){var vt=Math.abs(it-ke);vt<Me&&(he=it,Me=vt)}}xe>ce&&(he-V>3&&Vr(ae,V,he,ce),ae[he+2]=xe,Z-he>3&&Vr(ae,he,Z,ce))}function Or(ae,V,Z,ce,he,xe){var ke=he-Z,Me=xe-ce;if(0!==ke||0!==Me){var we=((ae-Z)*ke+(V-ce)*Me)/(ke*ke+Me*Me);we>1?(Z=he,ce=xe):we>0&&(Z+=ke*we,ce+=Me*we)}return(ke=ae-Z)*ke+(Me=V-ce)*Me}function ko(ae,V,Z,ce){var he={id:void 0===ae?null:ae,type:V,geometry:Z,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(xe){var ke=xe.geometry,Me=xe.type;if("Point"===Me||"MultiPoint"===Me||"LineString"===Me)lr(xe,ke);else if("Polygon"===Me||"MultiLineString"===Me)for(var we=0;we<ke.length;we++)lr(xe,ke[we]);else if("MultiPolygon"===Me)for(we=0;we<ke.length;we++)for(var Le=0;Le<ke[we].length;Le++)lr(xe,ke[we][Le])}(he),he}function lr(ae,V){for(var Z=0;Z<V.length;Z+=3)ae.minX=Math.min(ae.minX,V[Z]),ae.minY=Math.min(ae.minY,V[Z+1]),ae.maxX=Math.max(ae.maxX,V[Z]),ae.maxY=Math.max(ae.maxY,V[Z+1])}function Kr(ae,V,Z,ce){if(V.geometry){var he=V.geometry.coordinates,xe=V.geometry.type,ke=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),Me=[],we=V.id;if(Z.promoteId?we=V.properties[Z.promoteId]:Z.generateId&&(we=ce||0),"Point"===xe)co(he,Me);else if("MultiPoint"===xe)for(var Le=0;Le<he.length;Le++)co(he[Le],Me);else if("LineString"===xe)zr(he,Me,ke,!1);else if("MultiLineString"===xe){if(Z.lineMetrics){for(Le=0;Le<he.length;Le++)zr(he[Le],Me=[],ke,!1),ae.push(ko(we,"LineString",Me,V.properties));return}Xi(he,Me,ke,!1)}else if("Polygon"===xe)Xi(he,Me,ke,!0);else{if("MultiPolygon"!==xe){if("GeometryCollection"===xe){for(Le=0;Le<V.geometry.geometries.length;Le++)Kr(ae,{id:we,geometry:V.geometry.geometries[Le],properties:V.properties},Z,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Le=0;Le<he.length;Le++){var rt=[];Xi(he[Le],rt,ke,!0),Me.push(rt)}}ae.push(ko(we,xe,Me,V.properties))}}function co(ae,V){V.push(bs(ae[0])),V.push(jr(ae[1])),V.push(0)}function zr(ae,V,Z,ce){for(var he,xe,ke=0,Me=0;Me<ae.length;Me++){var we=bs(ae[Me][0]),Le=jr(ae[Me][1]);V.push(we),V.push(Le),V.push(0),Me>0&&(ke+=ce?(he*Le-we*xe)/2:Math.sqrt(Math.pow(we-he,2)+Math.pow(Le-xe,2))),he=we,xe=Le}var rt=V.length-3;V[2]=1,Vr(V,0,rt,Z),V[rt+2]=1,V.size=Math.abs(ke),V.start=0,V.end=V.size}function Xi(ae,V,Z,ce){for(var he=0;he<ae.length;he++){var xe=[];zr(ae[he],xe,Z,ce),V.push(xe)}}function bs(ae){return ae/360+.5}function jr(ae){var V=Math.sin(ae*Math.PI/180),Z=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return Z<0?0:Z>1?1:Z}function qt(ae,V,Z,ce,he,xe,ke,Me){if(ce/=V,xe>=(Z/=V)&&ke<ce)return ae;if(ke<Z||xe>=ce)return null;for(var we=[],Le=0;Le<ae.length;Le++){var rt=ae[Le],wt=rt.geometry,it=rt.type,Ht=0===he?rt.minX:rt.minY,vt=0===he?rt.maxX:rt.maxY;if(Ht>=Z&&vt<ce)we.push(rt);else if(!(vt<Z||Ht>=ce)){var W=[];if("Point"===it||"MultiPoint"===it)gr(wt,W,Z,ce,he);else if("LineString"===it)rn(wt,W,Z,ce,he,!1,Me.lineMetrics);else if("MultiLineString"===it)wo(wt,W,Z,ce,he,!1);else if("Polygon"===it)wo(wt,W,Z,ce,he,!0);else if("MultiPolygon"===it)for(var J=0;J<wt.length;J++){var ne=[];wo(wt[J],ne,Z,ce,he,!0),ne.length&&W.push(ne)}if(W.length){if(Me.lineMetrics&&"LineString"===it){for(J=0;J<W.length;J++)we.push(ko(rt.id,it,W[J],rt.tags));continue}"LineString"!==it&&"MultiLineString"!==it||(1===W.length?(it="LineString",W=W[0]):it="MultiLineString"),"Point"!==it&&"MultiPoint"!==it||(it=3===W.length?"Point":"MultiPoint"),we.push(ko(rt.id,it,W,rt.tags))}}}return we.length?we:null}function gr(ae,V,Z,ce,he){for(var xe=0;xe<ae.length;xe+=3){var ke=ae[xe+he];ke>=Z&&ke<=ce&&(V.push(ae[xe]),V.push(ae[xe+1]),V.push(ae[xe+2]))}}function rn(ae,V,Z,ce,he,xe,ke){for(var Me,we,Le=on(ae),rt=0===he?$r:Qr,wt=ae.start,it=0;it<ae.length-3;it+=3){var Ht=ae[it],vt=ae[it+1],W=ae[it+2],J=ae[it+3],ne=ae[it+4],Ae=0===he?Ht:vt,je=0===he?J:ne,yt=!1;ke&&(Me=Math.sqrt(Math.pow(Ht-J,2)+Math.pow(vt-ne,2))),Ae<Z?je>Z&&(we=rt(Le,Ht,vt,J,ne,Z),ke&&(Le.start=wt+Me*we)):Ae>ce?je<ce&&(we=rt(Le,Ht,vt,J,ne,ce),ke&&(Le.start=wt+Me*we)):Eo(Le,Ht,vt,W),je<Z&&Ae>=Z&&(we=rt(Le,Ht,vt,J,ne,Z),yt=!0),je>ce&&Ae<=ce&&(we=rt(Le,Ht,vt,J,ne,ce),yt=!0),!xe&&yt&&(ke&&(Le.end=wt+Me*we),V.push(Le),Le=on(ae)),ke&&(wt+=Me)}var $t=ae.length-3;Ht=ae[$t],vt=ae[$t+1],W=ae[$t+2],(Ae=0===he?Ht:vt)>=Z&&Ae<=ce&&Eo(Le,Ht,vt,W),$t=Le.length-3,xe&&$t>=3&&(Le[$t]!==Le[0]||Le[$t+1]!==Le[1])&&Eo(Le,Le[0],Le[1],Le[2]),Le.length&&V.push(Le)}function on(ae){var V=[];return V.size=ae.size,V.start=ae.start,V.end=ae.end,V}function wo(ae,V,Z,ce,he,xe){for(var ke=0;ke<ae.length;ke++)rn(ae[ke],V,Z,ce,he,xe,!1)}function Eo(ae,V,Z,ce){ae.push(V),ae.push(Z),ae.push(ce)}function $r(ae,V,Z,ce,he,xe){var ke=(xe-V)/(ce-V);return ae.push(xe),ae.push(Z+(he-Z)*ke),ae.push(1),ke}function Qr(ae,V,Z,ce,he,xe){var ke=(xe-Z)/(he-Z);return ae.push(V+(ce-V)*ke),ae.push(xe),ae.push(1),ke}function xi(ae,V){for(var Z=[],ce=0;ce<ae.length;ce++){var he,xe=ae[ce],ke=xe.type;if("Point"===ke||"MultiPoint"===ke||"LineString"===ke)he=jo(xe.geometry,V);else if("MultiLineString"===ke||"Polygon"===ke){he=[];for(var Me=0;Me<xe.geometry.length;Me++)he.push(jo(xe.geometry[Me],V))}else if("MultiPolygon"===ke)for(he=[],Me=0;Me<xe.geometry.length;Me++){for(var we=[],Le=0;Le<xe.geometry[Me].length;Le++)we.push(jo(xe.geometry[Me][Le],V));he.push(we)}Z.push(ko(xe.id,ke,he,xe.tags))}return Z}function jo(ae,V){var Z=[];Z.size=ae.size,void 0!==ae.start&&(Z.start=ae.start,Z.end=ae.end);for(var ce=0;ce<ae.length;ce+=3)Z.push(ae[ce]+V,ae[ce+1],ae[ce+2]);return Z}function Un(ae,V){if(ae.transformed)return ae;var Z,ce,he,xe=1<<ae.z,ke=ae.x,Me=ae.y;for(Z=0;Z<ae.features.length;Z++){var we=ae.features[Z],Le=we.geometry,rt=we.type;if(we.geometry=[],1===rt)for(ce=0;ce<Le.length;ce+=2)we.geometry.push(dn(Le[ce],Le[ce+1],V,xe,ke,Me));else for(ce=0;ce<Le.length;ce++){var wt=[];for(he=0;he<Le[ce].length;he+=2)wt.push(dn(Le[ce][he],Le[ce][he+1],V,xe,ke,Me));we.geometry.push(wt)}}return ae.transformed=!0,ae}function dn(ae,V,Z,ce,he,xe){return[Math.round(Z*(ae*ce-he)),Math.round(Z*(V*ce-xe))]}function qn(ae,V,Z,ce,he){for(var xe=V===he.maxZoom?0:he.tolerance/((1<<V)*he.extent),ke={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:ce,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Me=0;Me<ae.length;Me++){ke.numFeatures++,Do(ke,ae[Me],xe,he);var we=ae[Me].minX,Le=ae[Me].minY,rt=ae[Me].maxX,wt=ae[Me].maxY;we<ke.minX&&(ke.minX=we),Le<ke.minY&&(ke.minY=Le),rt>ke.maxX&&(ke.maxX=rt),wt>ke.maxY&&(ke.maxY=wt)}return ke}function Do(ae,V,Z,ce){var he=V.geometry,xe=V.type,ke=[];if("Point"===xe||"MultiPoint"===xe)for(var Me=0;Me<he.length;Me+=3)ke.push(he[Me]),ke.push(he[Me+1]),ae.numPoints++,ae.numSimplified++;else if("LineString"===xe)Yi(ke,he,ae,Z,!1,!1);else if("MultiLineString"===xe||"Polygon"===xe)for(Me=0;Me<he.length;Me++)Yi(ke,he[Me],ae,Z,"Polygon"===xe,0===Me);else if("MultiPolygon"===xe)for(var we=0;we<he.length;we++){var Le=he[we];for(Me=0;Me<Le.length;Me++)Yi(ke,Le[Me],ae,Z,!0,0===Me)}if(ke.length){var rt=V.tags||null;if("LineString"===xe&&ce.lineMetrics){for(var wt in rt={},V.tags)rt[wt]=V.tags[wt];rt.mapbox_clip_start=he.start/he.size,rt.mapbox_clip_end=he.end/he.size}var it={geometry:ke,type:"Polygon"===xe||"MultiPolygon"===xe?3:"LineString"===xe||"MultiLineString"===xe?2:1,tags:rt};null!==V.id&&(it.id=V.id),ae.features.push(it)}}function Yi(ae,V,Z,ce,he,xe){var ke=ce*ce;if(ce>0&&V.size<(he?ke:ce))Z.numPoints+=V.length/3;else{for(var Me=[],we=0;we<V.length;we+=3)(0===ce||V[we+2]>ke)&&(Z.numSimplified++,Me.push(V[we]),Me.push(V[we+1])),Z.numPoints++;he&&function(Le,rt){for(var wt=0,it=0,Ht=Le.length,vt=Ht-2;it<Ht;vt=it,it+=2)wt+=(Le[it]-Le[vt])*(Le[it+1]+Le[vt+1]);if(wt>0===rt)for(it=0,Ht=Le.length;it<Ht/2;it+=2){var W=Le[it],J=Le[it+1];Le[it]=Le[Ht-2-it],Le[it+1]=Le[Ht-1-it],Le[Ht-2-it]=W,Le[Ht-1-it]=J}}(Me,xe),ae.push(Me)}}function Wn(ae,V){var Z=(V=this.options=function(he,xe){for(var ke in xe)he[ke]=xe[ke];return he}(Object.create(this.options),V)).debug;if(Z&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var he,xe,ke,Me,we,Le,ce=function(he,xe){var ke=[];if("FeatureCollection"===he.type)for(var Me=0;Me<he.features.length;Me++)Kr(ke,he.features[Me],xe,Me);else Kr(ke,"Feature"===he.type?he:{geometry:he},xe);return ke}(ae,V);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(he=ce,xe=V,ke=xe.buffer/xe.extent,Me=he,we=qt(he,1,-1-ke,ke,0,-1,2,xe),Le=qt(he,1,1-ke,2+ke,0,-1,2,xe),(we||Le)&&(Me=qt(he,1,-ke,1+ke,0,-1,2,xe)||[],we&&(Me=xi(we,1).concat(Me)),Le&&(Me=Me.concat(xi(Le,-1)))),ce=Me).length&&this.splitTile(ce,0,0,0),Z&&(ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ro(ae,V,Z){return 32*((1<<ae)*Z+V)+ae}function Vs(ae,V){const Z=ae.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);const ce=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!ce)return V(null,null);const he=new Ct(ce.features);let xe=At(he);0===xe.byteOffset&&xe.byteLength===xe.buffer.byteLength||(xe=new Uint8Array(xe)),V(null,{vectorTile:he,rawData:xe.buffer})}Wn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Wn.prototype.splitTile=function(ae,V,Z,ce,he,xe,ke){for(var Me=[ae,V,Z,ce],we=this.options,Le=we.debug;Me.length;){ce=Me.pop(),Z=Me.pop(),V=Me.pop(),ae=Me.pop();var rt=1<<V,wt=Ro(V,Z,ce),it=this.tiles[wt];if(!it&&(Le>1&&console.time("creation"),it=this.tiles[wt]=qn(ae,V,Z,ce,we),this.tileCoords.push({z:V,x:Z,y:ce}),Le)){Le>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,Z,ce,it.numFeatures,it.numPoints,it.numSimplified),console.timeEnd("creation"));var Ht="z"+V;this.stats[Ht]=(this.stats[Ht]||0)+1,this.total++}if(it.source=ae,he){if(V===we.maxZoom||V===he)continue;var vt=1<<he-V;if(Z!==Math.floor(xe/vt)||ce!==Math.floor(ke/vt))continue}else if(V===we.indexMaxZoom||it.numPoints<=we.indexMaxPoints)continue;if(it.source=null,0!==ae.length){Le>1&&console.time("clipping");var W,J,ne,Ae,je,yt,$t=.5*we.buffer/we.extent,_r=.5-$t,cr=.5+$t,Dt=1+$t;W=J=ne=Ae=null,je=qt(ae,rt,Z-$t,Z+cr,0,it.minX,it.maxX,we),yt=qt(ae,rt,Z+_r,Z+Dt,0,it.minX,it.maxX,we),ae=null,je&&(W=qt(je,rt,ce-$t,ce+cr,1,it.minY,it.maxY,we),J=qt(je,rt,ce+_r,ce+Dt,1,it.minY,it.maxY,we),je=null),yt&&(ne=qt(yt,rt,ce-$t,ce+cr,1,it.minY,it.maxY,we),Ae=qt(yt,rt,ce+_r,ce+Dt,1,it.minY,it.maxY,we),yt=null),Le>1&&console.timeEnd("clipping"),Me.push(W||[],V+1,2*Z,2*ce),Me.push(J||[],V+1,2*Z,2*ce+1),Me.push(ne||[],V+1,2*Z+1,2*ce),Me.push(Ae||[],V+1,2*Z+1,2*ce+1)}}},Wn.prototype.getTile=function(ae,V,Z){var ce=this.options,he=ce.extent,xe=ce.debug;if(ae<0||ae>24)return null;var ke=1<<ae,Me=Ro(ae,V=(V%ke+ke)%ke,Z);if(this.tiles[Me])return Un(this.tiles[Me],he);xe>1&&console.log("drilling down to z%d-%d-%d",ae,V,Z);for(var we,Le=ae,rt=V,wt=Z;!we&&Le>0;)Le--,rt=Math.floor(rt/2),wt=Math.floor(wt/2),we=this.tiles[Ro(Le,rt,wt)];return we&&we.source?(xe>1&&console.log("found parent tile z%d-%d-%d",Le,rt,wt),xe>1&&console.time("drilling down"),this.splitTile(we.source,Le,rt,wt,ae,V,Z),xe>1&&console.timeEnd("drilling down"),this.tiles[Me]?Un(this.tiles[Me],he):null):null};class Ai extends c.VectorTileWorkerSource{constructor(V,Z,ce,he,xe){super(V,Z,ce,he,Vs),xe&&(this.loadGeoJSON=xe)}loadData(V,Z){const ce=V&&V.request,he=ce&&ce.collectResourceTiming;this.loadGeoJSON(V,(xe,ke)=>{if(xe||!ke)return Z(xe);if("object"!=typeof ke)return Z(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{qe(ke,!0);try{if(V.filter){const we=c.createExpression(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===we.result)throw new Error(we.value.map(rt=>`${rt.key}: ${rt.message}`).join(", "));const Le=ke.features.filter(rt=>we.value.evaluate({zoom:0},rt));ke={type:"FeatureCollection",features:Le}}this._geoJSONIndex=V.cluster?new Fr(function({superclusterOptions:we,clusterProperties:Le}){if(!Le||!we)return we;const rt={},wt={},it={accumulated:null,zoom:0},Ht={properties:null},vt=Object.keys(Le);for(const W of vt){const[J,ne]=Le[W],Ae=c.createExpression(ne),je=c.createExpression("string"==typeof J?[J,["accumulated"],["get",W]]:J);rt[W]=Ae.value,wt[W]=je.value}return we.map=W=>{Ht.properties=W;const J={};for(const ne of vt)J[ne]=rt[ne].evaluate(it,Ht);return J},we.reduce=(W,J)=>{Ht.properties=J;for(const ne of vt)it.accumulated=W[ne],W[ne]=wt[ne].evaluate(it,Ht)},we}(V)).load(ke.features):new Wn(we=ke,V.geojsonVtOptions)}catch(we){return Z(we)}this.loaded={};const Me={};if(he){const we=c.getPerformanceMeasurement(ce);we&&(Me.resourceTiming={},Me.resourceTiming[V.source]=JSON.parse(JSON.stringify(we)))}Z(null,Me)}var we})}reloadTile(V,Z){const ce=this.loaded;return ce&&ce[V.uid]?super.reloadTile(V,Z):this.loadTile(V,Z)}loadGeoJSON(V,Z){if(V.request)c.getJSON(V.request,Z);else{if("string"!=typeof V.data)return Z(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse(V.data))}catch(ce){return Z(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(V,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(ce){Z(ce)}}getClusterChildren(V,Z){try{Z(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(ce){Z(ce)}}getClusterLeaves(V,Z){try{Z(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(ce){Z(ce)}}}class En{constructor(V){this.self=V,this.actor=new c.Actor(V,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=c.getProjection({name:"mercator"}),this.workerSourceTypes={vector:c.VectorTileWorkerSource,geojson:Ai},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,ce)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=ce},this.self.registerRTLTextPlugin=Z=>{if(c.plugin.isParsed())throw new Error("RTL text plugin already registered.");c.plugin.applyArabicShaping=Z.applyArabicShaping,c.plugin.processBidirectionalText=Z.processBidirectionalText,c.plugin.processStyledBidirectionalText=Z.processStyledBidirectionalText}}clearCaches(V,Z,ce){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V],ce()}checkIfReady(V,Z,ce){ce()}setReferrer(V,Z){this.referrer=Z}spriteLoaded(V,Z){this.isSpriteLoaded[V]=Z;for(const ce in this.workerSources[V]){const he=this.workerSources[V][ce];for(const xe in he)he[xe]instanceof c.VectorTileWorkerSource&&(he[xe].isSpriteLoaded=Z,he[xe].fire(new c.Event("isSpriteLoaded")))}}setImages(V,Z,ce){this.availableImages[V]=Z;for(const he in this.workerSources[V]){const xe=this.workerSources[V][he];for(const ke in xe)xe[ke].availableImages=Z}ce()}enableTerrain(V,Z,ce){this.terrain=Z,ce()}setProjection(V,Z){this.projections[V]=c.getProjection(Z)}setLayers(V,Z,ce){this.getLayerIndex(V).replace(Z),ce()}updateLayers(V,Z,ce){this.getLayerIndex(V).update(Z.layers,Z.removedIds),ce()}loadTile(V,Z,ce){const he=this.enableTerrain?c.extend({enableTerrain:this.terrain},Z):Z;he.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,Z.type,Z.source).loadTile(he,ce)}loadDEMTile(V,Z,ce){const he=this.enableTerrain?c.extend({buildQuadTree:this.terrain},Z):Z;this.getDEMWorkerSource(V,Z.source).loadTile(he,ce)}reloadTile(V,Z,ce){const he=this.enableTerrain?c.extend({enableTerrain:this.terrain},Z):Z;he.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,Z.type,Z.source).reloadTile(he,ce)}abortTile(V,Z,ce){this.getWorkerSource(V,Z.type,Z.source).abortTile(Z,ce)}removeTile(V,Z,ce){this.getWorkerSource(V,Z.type,Z.source).removeTile(Z,ce)}removeSource(V,Z,ce){if(!this.workerSources[V]||!this.workerSources[V][Z.type]||!this.workerSources[V][Z.type][Z.source])return;const he=this.workerSources[V][Z.type][Z.source];delete this.workerSources[V][Z.type][Z.source],void 0!==he.removeSource?he.removeSource(Z,ce):ce()}loadWorkerSource(V,Z,ce){try{this.self.importScripts(Z.url),ce()}catch(he){ce(he.toString())}}syncRTLPluginState(V,Z,ce){try{c.plugin.setState(Z);const he=c.plugin.getPluginURL();if(c.plugin.isLoaded()&&!c.plugin.isParsed()&&null!=he){this.self.importScripts(he);const xe=c.plugin.isParsed();ce(xe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${he}`),xe)}}catch(he){ce(he.toString())}}getAvailableImages(V){let Z=this.availableImages[V];return Z||(Z=[]),Z}getLayerIndex(V){let Z=this.layerIndexes[V];return Z||(Z=this.layerIndexes[V]=new Ft),Z}getWorkerSource(V,Z,ce){return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][Z]||(this.workerSources[V][Z]={}),this.workerSources[V][Z][ce]||(this.workerSources[V][Z][ce]=new this.workerSourceTypes[Z]({send:(he,xe,ke,Me,we,Le)=>{this.actor.send(he,xe,ke,V,we,Le)},scheduler:this.actor.scheduler},this.getLayerIndex(V),this.getAvailableImages(V),this.isSpriteLoaded[V])),this.workerSources[V][Z][ce]}getDEMWorkerSource(V,Z){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][Z]||(this.demWorkerSources[V][Z]=new ze),this.demWorkerSources[V][Z]}enforceCacheSizeLimit(V,Z){c.enforceCacheSizeLimit(Z)}getWorkerPerformanceMetrics(V,Z,ce){ce(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new En(self)),En}),Fe(0,function(c){var Tt=Jt;function Jt(d){return t=d,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,v=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(v);try{_=new Worker(E),p=!0}catch(S){p=!1}return _&&_.terminate(),URL.revokeObjectURL(E),p}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var v=_.getImageData(0,0,1,1);return v&&v.width===p.width}()||(void 0===Ft[l=t&&t.failIfMajorPerformanceCaveat]&&(Ft[l]=function(p){var _,E,S,R,v=(E=p,S=document.createElement("canvas"),(R=Object.create(Jt.webGLContextAttributes)).failIfMajorPerformanceCaveat=E,S.getContext("webgl",R)||S.getContext("experimental-webgl",R));if(!v)return!1;try{_=v.createShader(v.VERTEX_SHADER)}catch(E){return!1}return!(!_||v.isContextLost())&&(v.shaderSource(_,"void main() {}"),v.compileShader(_),!0===v.getShaderParameter(_,v.COMPILE_STATUS))}(l)),!Ft[l]||document.documentMode));var t,l}var Ft={};function Ve(d,t){if(Array.isArray(d)){if(!Array.isArray(t)||d.length!==t.length)return!1;for(let l=0;l<d.length;l++)if(!Ve(d[l],t[l]))return!1;return!0}if("object"==typeof d&&null!==d&&null!==t){if("object"!=typeof t||Object.keys(d).length!==Object.keys(t).length)return!1;for(const l in d)if(!Ve(d[l],t[l]))return!1;return!0}return d===t}Jt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ze={create:function(d,t,l){const p=c.window.document.createElement(d);return void 0!==t&&(p.className=t),l&&l.appendChild(p),p},createNS:function(d,t){return c.window.document.createElementNS(d,t)}},qe=c.window.document&&c.window.document.documentElement.style,lt=qe&&void 0!==qe.userSelect?"userSelect":"WebkitUserSelect";let en;ze.disableDrag=function(){qe&&lt&&(en=qe[lt],qe[lt]="none")},ze.enableDrag=function(){qe&&lt&&(qe[lt]=en)},ze.setTransform=function(d,t){d.style.transform=t};let On=!1;try{const d=Object.defineProperty({},"passive",{get(){On=!0}});c.window.addEventListener("test",d,d),c.window.removeEventListener("test",d,d)}catch(d){On=!1}ze.addEventListener=function(d,t,l,p={}){d.addEventListener(t,l,"passive"in p&&On?p:p.capture)},ze.removeEventListener=function(d,t,l,p={}){d.removeEventListener(t,l,"passive"in p&&On?p:p.capture)};const bt=function(d){d.preventDefault(),d.stopPropagation(),c.window.removeEventListener("click",bt,!0)};function Ct(d,t,l){const p=d.offsetWidth===t.width?1:d.offsetWidth/t.width;return new c.pointGeometry((l.clientX-t.left)*p,(l.clientY-t.top)*p)}function sn(d,t){var l=t[0],p=t[1],_=t[2],v=t[3],E=l*v-_*p;return E?(d[0]=v*(E=1/E),d[1]=-p*E,d[2]=-_*E,d[3]=l*E,d):null}ze.suppressClick=function(){c.window.addEventListener("click",bt,!0),c.window.setTimeout(()=>{c.window.removeEventListener("click",bt,!0)},0)},ze.mousePos=function(d,t){const l=d.getBoundingClientRect();return Ct(d,l,t)},ze.touchPos=function(d,t){const l=d.getBoundingClientRect(),p=[];for(let _=0;_<t.length;_++)p.push(Ct(d,l,t[_]));return p},ze.mouseButton=function(d){return void 0!==c.window.InstallTrigger&&2===d.button&&d.ctrlKey&&c.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button},ze.remove=function(d){d.parentNode&&d.parentNode.removeChild(d)};class Ot{constructor(t,l){this.pos=t,this.dir=l}intersectsPlane(t,l,p){const _=c.dot(l,this.dir);if(Math.abs(_)<1e-6)return!1;const v=c.dot(c.sub(c.create(),t,this.pos),l)/_,E=c.scaleAndAdd(c.create(),this.pos,this.dir,v);return c.copy(p,E),!0}}class ln{constructor(t,l){this.points=t,this.planes=l}static fromInvProjectionMatrix(t,l,p){const _=Math.pow(2,p),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const R=c.transformMat4([],S,t),z=1/R[3]/l*_;return c.mul(R,R,[z,z,1/R[3],z])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const R=c.sub([],v[S[0]],v[S[1]]),z=c.sub([],v[S[2]],v[S[1]]),N=c.normalize([],c.cross([],R,z)),j=-c.dot(N,v[S[1]]);return N.concat(j)});return new ln(v,E)}}class Yt{constructor(t,l){this.min=t,this.max=l,this.center=c.scale([],c.add([],this.min,this.max),.5)}quadrant(t){const l=[t%2==0,t<2],p=c.clone(this.min),_=c.clone(this.max);for(let v=0;v<l.length;v++)p[v]=l[v]?this.min[v]:this.center[v],_[v]=l[v]?this.center[v]:this.max[v];return _[2]=this.max[2],new Yt(p,_)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}intersects(t){const l=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let _=0;_<t.planes.length;_++){const v=t.planes[_];let E=0;for(let S=0;S<l.length;S++)E+=c.dot$1(v,l[S])>=0;if(0===E)return 0;E!==l.length&&(p=!1)}if(p)return 2;for(let _=0;_<3;_++){let v=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let S=0;S<t.points.length;S++){const R=t.points[S][_]-this.min[_];v=Math.min(v,R),E=Math.max(E,R)}if(E<0||v>this.max[_]-this.min[_])return 0}return 1}}function At(d){const{userImage:t}=d;return!!(t&&t.render&&t.render())&&(d.data.replace(new Uint8Array(t.data.buffer)),!0)}class ft extends c.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:l,callback:p}of this.requestors)this._notify(l,p);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,l){this._validate(t,l)&&(this.images[t]=l)}_validate(t,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new c.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new c.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new c.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),p=!1),p}_validateStretch(t,l){if(!t)return!0;let p=0;for(const _ of t){if(_[0]<p||_[1]<_[0]||l<_[1])return!1;p=_[1]}return!0}_validateContent(t,l){return!(t&&(4!==t.length||t[0]<0||l.data.width<t[0]||t[1]<0||l.data.height<t[1]||t[2]<0||l.data.width<t[2]||t[3]<0||l.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,l){l.version=this.images[t].version+1,this.images[t]=l,this.updatedImages[t]=!0}removeImage(t){const l=this.images[t];delete this.images[t],delete this.patterns[t],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,l){let p=!0;if(!this.isLoaded())for(const _ of t)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(t,l):this.requestors.push({ids:t,callback:l})}_notify(t,l){const p={};for(const _ of t){this.images[_]||this.fire(new c.Event("styleimagemissing",{id:_}));const v=this.images[_];v?p[_]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:c.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,p)}getPixelSize(){const{width:t,height:l}=this.atlasImage;return{width:t,height:l}}getPattern(t){const l=this.patterns[t],p=this.getImage(t);if(!p)return null;if(l&&l.position.version===p.version)return l.position;if(l)l.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new c.ImagePosition(_,p);this.patterns[t]={bin:_,position:v}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const l=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.Texture(t,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const v in this.patterns)t.push(this.patterns[v].bin);const{w:l,h:p}=c.potpack(t),_=this.atlasImage;_.resize({width:l||1,height:p||1});for(const v in this.patterns){const{bin:E}=this.patterns[v],S=E.x+1,R=E.y+1,z=this.images[v].data,N=z.width,j=z.height;c.RGBAImage.copy(z,_,{x:0,y:0},{x:S,y:R},{width:N,height:j}),c.RGBAImage.copy(z,_,{x:0,y:j-1},{x:S,y:R-1},{width:N,height:1}),c.RGBAImage.copy(z,_,{x:0,y:0},{x:S,y:R+j},{width:N,height:1}),c.RGBAImage.copy(z,_,{x:N-1,y:0},{x:S-1,y:R},{width:1,height:j}),c.RGBAImage.copy(z,_,{x:0,y:0},{x:S+N,y:R},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const l of t){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const p=this.images[l];At(p)&&this.updateImage(l,p)}}}const cn=new c.Properties({anchor:new c.DataConstantProperty(c.spec.light.anchor),position:new class{constructor(){this.specification=c.spec.light.position}possiblyEvaluate(d,t){return function([l,p,_]){const v=c.degToRad(p+90),E=c.degToRad(_);return{x:l*Math.cos(v)*Math.sin(E),y:l*Math.sin(v)*Math.sin(E),z:l*Math.cos(E),azimuthal:p,polar:_}}(d.expression.evaluate(t))}interpolate(d,t,l){return{x:c.number(d.x,t.x,l),y:c.number(d.y,t.y,l),z:c.number(d.z,t.z,l),azimuthal:c.number(d.azimuthal,t.azimuthal,l),polar:c.number(d.polar,t.polar,l)}}},color:new c.DataConstantProperty(c.spec.light.color),intensity:new c.DataConstantProperty(c.spec.light.intensity)}),Pn="-transition";class Gt extends c.Evented{constructor(t){super(),this._transitionable=new c.Transitionable(cn),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,l={}){if(!this._validate(c.validateLight,t,l))for(const p in t){const _=t[p];c.endsWith(p,Pn)?this._transitionable.setTransition(p.slice(0,-Pn.length),_):this._transitionable.setValue(p,_)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,l,p){return(!p||!1!==p.validate)&&c.emitValidationErrors(this,t.call(c.validateStyle,c.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}const an=new c.Properties({source:new c.DataConstantProperty(c.spec.terrain.source),exaggeration:new c.DataConstantProperty(c.spec.terrain.exaggeration)}),gt="-transition";class Be extends c.Evented{constructor(t){super(),this._transitionable=new c.Transitionable(an),this.set(t),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(t){for(const l in t){const p=t[l];c.endsWith(l,gt)?this._transitionable.setTransition(l.slice(0,-gt.length),p):this._transitionable.setValue(l,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function He(d,t,l,p){const _=c.smoothstep(45,65,l),[v,E]=Je(d,p),S=c.length(t);let R=1-Math.min(1,Math.exp((S-v)/(E-v)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*_*d.alpha}function Je(d,t){const l=.5/Math.tan(.5*t);return[d.range[0]+l,d.range[1]+l]}const Ke=new c.Properties({range:new c.DataConstantProperty(c.spec.fog.range),color:new c.DataConstantProperty(c.spec.fog.color),"horizon-blend":new c.DataConstantProperty(c.spec.fog["horizon-blend"])}),_t="-transition";class $e extends c.Evented{constructor(t,l){super(),this._transitionable=new c.Transitionable(Ke),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=l}isSoftDisabled(){return"mercator"!==this._transform.projection.name}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,l={}){if(!this._validate(c.validateFog,t,l))for(const p in t){const _=t[p];c.endsWith(p,_t)?this._transitionable.setTransition(p.slice(0,-_t.length),_):this._transitionable.setValue(p,_)}}getOpacity(t){if(this.isSoftDisabled())return 0;const l=this.properties&&this.properties.get("color")||1;return c.smoothstep(45,65,t)*l.a}getOpacityAtLatLng(t,l){return this.isSoftDisabled()?0:function(p,_,v){const E=c.MercatorCoordinate.fromLngLat(_),S=v.elevation?v.elevation.getAtPointOrZero(E):0,R=[E.x,E.y,S];return c.transformMat4$1(R,R,v.mercatorFogMatrix),He(p,R,v.pitch,v._fov)}(this.state,t,l)}getFovAdjustedRange(t){return this.isSoftDisabled()?[0,1]:Je(this.state,t)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,l,p){return(!p||!1!==p.validate)&&c.emitValidationErrors(this,t.call(c.validateStyle,c.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}class tn{constructor(t,l){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=c.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const v=new tn.Actor(p[_],l,this.id);v.name=`Worker ${_}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,l,p){c.asyncAll(this.actors,(_,v)=>{_.send(t,l,v)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function wn(d,t,l){return t*(c.EXTENT/(d.tileSize*Math.pow(2,l-d.tileID.overscaledZ)))}tn.Actor=c.Actor;class ri{constructor(t,l,p,_){this.screenBounds=t,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(v=>_.pointCoordinate3D(v)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(t,l){let p,_;if(t instanceof c.pointGeometry||"number"==typeof t[0]){const v=c.pointGeometry.convert(t);p=[c.pointGeometry.convert(t)],_=l.isPointAboveHorizon(v)}else{const v=c.pointGeometry.convert(t[0]),E=c.pointGeometry.convert(t[1]);p=[v,E],_=c.polygonizeBounds(v,E).every(S=>l.isPointAboveHorizon(S))}return new ri(p,l.getCameraPoint(),_,l)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return c.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const l=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new c.pointGeometry(1,1)):this.screenBounds[1],_=c.polygonizeBounds(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(_[3]=this.cameraPoint)),c.bufferConvexPolygon(_,t)}containsTile(t,l,p){const _=t.queryPadding+1,v=t.tileID.wrap,E=p?this._bufferedCameraMercator(_,l).map(ie=>c.getTilePoint(t.tileTransform,ie,v)):this._bufferedScreenMercator(_,l).map(ie=>c.getTilePoint(t.tileTransform,ie,v)),S=this.screenGeometryMercator.map(ie=>c.getTileVec3(t.tileTransform,ie,v)),R=S.map(ie=>new c.pointGeometry(ie[0],ie[1])),z=l.getFreeCameraOptions().position||new c.MercatorCoordinate(0,0,0),N=c.getTileVec3(t.tileTransform,z,v),j=S.map(ie=>{const re=c.sub(ie,ie,N);return c.normalize(re,re),new Ot(N,re)}),Q=wn(t,1,l.zoom);if(c.polygonIntersectsBox(E,0,0,c.EXTENT,c.EXTENT))return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:j,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(oe=c.getBounds(E),oe.min.x=c.clamp(oe.min.x,0,c.EXTENT),oe.min.y=c.clamp(oe.min.y,0,c.EXTENT),oe.max.x=c.clamp(oe.max.x,0,c.EXTENT),oe.max.y=c.clamp(oe.max.y,0,c.EXTENT),oe),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:Q};var oe}_bufferedScreenMercator(t,l){const p=zt(t);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{const _=this.bufferedScreenGeometry(t).map(v=>l.pointCoordinate3D(v));return this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(t,l){const p=zt(t);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{const _=this.bufferedCameraGeometry(t).map(v=>l.pointCoordinate3D(v));return this._cameraRaycastCache[p]=_,_}}}function zt(d){return 100*d|0}function Zn(d,t,l){const p=function(_,v){if(_)return l(_);if(v){const E=c.pick(c.extend(v,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(E.vectorLayers=v.vector_layers,E.vectorLayerIds=E.vectorLayers.map(S=>S.id)),E.tiles=t.canonicalizeTileset(E,d.url),l(null,E)}};return d.url?c.getJSON(t.transformRequest(t.normalizeSourceURL(d.url),c.ResourceType.Source),p):c.exported.frame(()=>p(null,d))}class Ui{constructor(t,l,p){this.bounds=c.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const l=Math.pow(2,t.z),p=Math.floor(c.mercatorXfromLng(this.bounds.getWest())*l),_=Math.floor(c.mercatorYfromLat(this.bounds.getNorth())*l),v=Math.ceil(c.mercatorXfromLng(this.bounds.getEast())*l),E=Math.ceil(c.mercatorYfromLat(this.bounds.getSouth())*l);return t.x>=p&&t.x<v&&t.y>=_&&t.y<E}}class sr{constructor(t,l,p){this.context=t;const _=t.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const vi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Fr{constructor(t,l,p,_){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.context=t;const v=t.gl;this.buffer=v.createBuffer(),t.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,l){for(let p=0;p<this.attributes.length;p++){const _=l.attributes[this.attributes[p].name];void 0!==_&&t.enableVertexAttribArray(_)}}setVertexAttribPointers(t,l,p){for(let _=0;_<this.attributes.length;_++){const v=this.attributes[_],E=l.attributes[v.name];void 0!==E&&t.vertexAttribPointer(E,v.components,t[vi[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class pn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class mr extends pn{getDefault(){return c.Color.transparent}set(t){const l=this.current;(t.r!==l.r||t.g!==l.g||t.b!==l.b||t.a!==l.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ur extends pn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class xr extends pn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class $n extends pn{getDefault(){return[!0,!0,!0,!0]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||t[3]!==l[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Mi extends pn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class xs extends pn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Fn extends pn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const l=this.current;(t.func!==l.func||t.ref!==l.ref||t.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ir extends pn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Wi extends pn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=t,this.dirty=!1}}class Vr extends pn{getDefault(){return[0,1]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Or extends pn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=t,this.dirty=!1}}class ko extends pn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class lr extends pn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.BLEND):l.disable(l.BLEND),this.current=t,this.dirty=!1}}class Kr extends pn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class co extends pn{getDefault(){return c.Color.transparent}set(t){const l=this.current;(t.r!==l.r||t.g!==l.g||t.b!==l.b||t.a!==l.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class zr extends pn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Xi extends pn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=t,this.dirty=!1}}class bs extends pn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class jr extends pn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class qt extends pn{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class gr extends pn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class rn extends pn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||t[3]!==l[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class on extends pn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class wo extends pn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Eo extends pn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class $r extends pn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Qr extends pn{getDefault(){return null}set(t){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class xi extends pn{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class jo extends pn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Un extends pn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class dn extends pn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class qn extends pn{constructor(t,l){super(t),this.context=t,this.parent=l}getDefault(){return null}}class Do extends qn{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Yi extends qn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Wn extends Yi{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ro{constructor(t,l,p,_){this.context=t,this.width=l,this.height=p;const v=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new Do(t,v),_&&(this.depthAttachment=new Yi(t,v))}destroy(){const t=this.context.gl,l=this.colorAttachment.get();if(l&&t.deleteTexture(l),this.depthAttachment){const p=this.depthAttachment.get();p&&t.deleteRenderbuffer(p)}t.deleteFramebuffer(this.framebuffer)}}class Vs{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new mr(this),this.clearDepth=new Ur(this),this.clearStencil=new xr(this),this.colorMask=new $n(this),this.depthMask=new Mi(this),this.stencilMask=new xs(this),this.stencilFunc=new Fn(this),this.stencilOp=new Ir(this),this.stencilTest=new Wi(this),this.depthRange=new Vr(this),this.depthTest=new Or(this),this.depthFunc=new ko(this),this.blend=new lr(this),this.blendFunc=new Kr(this),this.blendColor=new co(this),this.blendEquation=new zr(this),this.cullFace=new Xi(this),this.cullFaceSide=new bs(this),this.frontFace=new jr(this),this.program=new qt(this),this.activeTexture=new gr(this),this.viewport=new rn(this),this.bindFramebuffer=new on(this),this.bindRenderbuffer=new wo(this),this.bindTexture=new Eo(this),this.bindVertexBuffer=new $r(this),this.bindElementBuffer=new Qr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new xi(this),this.pixelStoreUnpack=new jo(this),this.pixelStoreUnpackPremultiplyAlpha=new Un(this),this.pixelStoreUnpackFlipY=new dn(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,l){return new sr(this,t,l)}createVertexBuffer(t,l,p){return new Fr(this,t,l,p)}createRenderbuffer(t,l,p){const _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,t,l,p),this.bindRenderbuffer.set(null),v}createFramebuffer(t,l,p){return new Ro(this,t,l,p)}clear({color:t,depth:l,stencil:p}){const _=this.gl;let v=0;t&&(v|=_.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==l&&(v|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),void 0!==p&&(v|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),_.clear(v)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){Ve(t.blendFunction,c.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ai extends c.Evented{constructor(t,l,p,_){super(),this.id=t,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.extend({type:"raster"},l),c.extend(this,c.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Zn(this._options,this.map._requestManager,(t,l)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new c.ErrorEvent(t)):l&&(c.extend(this,l),l.bounds&&(this.tileBounds=new Ui(l.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(l.tiles),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return c.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,l){const p=c.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);t.request=c.getImage(this.map._requestManager.transformRequest(_,c.ResourceType.Tile),(v,E,S,R)=>{if(delete t.request,t.aborted)t.state="unloaded",l(null);else if(v)t.state="errored",l(v);else if(E){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:S,expires:R});const z=this.map.painter.context,N=z.gl;t.texture=this.map.painter.getTileTexture(E.width),t.texture?t.texture.update(E,{useMipmap:!0}):(t.texture=new c.Texture(z,E,N.RGBA,{useMipmap:!0}),t.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE),z.extTextureFilterAnisotropic&&N.texParameterf(N.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax)),t.state="loaded",c.cacheEntryPossiblyAdded(this.dispatcher),l(null)}})}abortTile(t,l){t.request&&(t.request.cancel(),delete t.request),l()}unloadTile(t,l){t.texture&&this.map.painter.saveTileTexture(t.texture),l()}hasTransition(){return!1}}let En;class ae extends c.Evented{constructor(t,l,p,_){super(),this.id=t,this.dispatcher=p,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=l}load(t,l){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this.url=this.options.url,c.getImage(this.map._requestManager.transformRequest(this.url,c.ResourceType.Image),(p,_)=>{this._loaded=!0,p?this.fire(new c.ErrorEvent(p)):_&&(this.image=c.exported.getImageData(_),t&&(this.coordinates=t),l&&l(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t,delete this._boundsArray;const l=t.map(c.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let _=1/0,v=1/0,E=-1/0,S=-1/0;for(const j of p)_=Math.min(_,j.x),v=Math.min(v,j.y),E=Math.max(E,j.x),S=Math.max(S,j.y);const R=Math.max(E-_,S-v),z=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),N=Math.pow(2,z);return new c.CanonicalTileID(z,Math.floor((_+E)/2*N),Math.floor((v+S)/2*N))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const t=c.tileTransform(this.tileID,this.map.transform.projection),l=this.coordinates.map(p=>{const _=t.projection.project(p[0],p[1]);return c.getTilePoint(t,_)._round()});return this._boundsArray=new c.StructArrayLayout4i8,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,c.EXTENT,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,c.EXTENT),this._boundsArray.emplaceBack(l[2].x,l[2].y,c.EXTENT,c.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,l=t.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,c.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new c.Texture(t,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];"loaded"!==_.state&&(_.state="loaded",_.texture=this.texture)}}loadTile(t,l){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},l(null)):(t.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const V={vector:class extends c.Evented{constructor(d,t,l,p){if(super(),this.id=d,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.extend(this,c.pick(t,["url","scheme","tileSize","promoteId"])),this._options=c.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new c.DedupedRequest}load(){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Zn(this._options,this.map._requestManager,(d,t)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new c.ErrorEvent(d)):t&&(c.extend(this,t),t.bounds&&(this.tileBounds=new Ui(t.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(t.tiles,this.map._requestManager._customAccessToken),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}onAdd(d){this.map=d,this.load()}setSourceProperty(d){this._tileJSONRequest&&this._tileJSONRequest.cancel(),d();const t=this.map.style._getSourceCaches(this.id);for(const l of t)l.clearTiles();this.load()}setTiles(d){return this.setSourceProperty(()=>{this._options.tiles=d}),this}setUrl(d){return this.setSourceProperty(()=>{this.url=d,this._options.url=d}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return c.extend({},this._options)}loadTile(d,t){const l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,c.ResourceType.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:d.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,d.actor&&"expired"!==d.state)"loading"===d.state?d.reloadCallback=t:d.request=d.actor.send("reloadTile",p,_.bind(this));else if(d.actor=this._tileWorkers[l]=this._tileWorkers[l]||this.dispatcher.getActor(),this.dispatcher.ready)d.request=d.actor.send("loadTile",p,_.bind(this),void 0,!0);else{const v=c.loadVectorTile.call({deduped:this._deduped},p,(E,S)=>{E||!S?_.call(this,E):(p.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},d.actor&&d.actor.send("loadTile",p,_.bind(this),void 0,!0))},!0);d.request={cancel:v}}function _(v,E){return delete d.request,d.aborted?t(null):v&&404!==v.status?t(v):(E&&E.resourceTiming&&(d.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&d.setExpiryData(E),d.loadVectorData(E,this.map.painter),c.cacheEntryPossiblyAdded(this.dispatcher),t(null),void(d.reloadCallback&&(this.loadTile(d,d.reloadCallback),d.reloadCallback=null)))}}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id})}unloadTile(d){d.unloadVectorData(),d.actor&&d.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Ai,"raster-dem":class extends Ai{constructor(d,t,l,p){super(d,t,l,p),this.type="raster-dem",this.maxzoom=22,this._options=c.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(d,t){const l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,v){_&&(d.state="errored",t(_)),v&&(d.dem=v,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",t(null))}d.request=c.getImage(this.map._requestManager.transformRequest(l,c.ResourceType.Tile),function(_,v,E,S){if(delete d.request,d.aborted)d.state="unloaded",t(null);else if(_)d.state="errored",t(_);else if(v){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:E,expires:S});const R=c.window.ImageBitmap&&v instanceof c.window.ImageBitmap&&(null==En&&(En=c.window.OffscreenCanvas&&new c.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof c.window.createImageBitmap),En),z=1-(v.width-c.prevPowerOfTwo(v.width))/2;z<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const N=R?v:c.exported.getImageData(v,z),j={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:N,encoding:this.encoding,padding:z};d.actor&&"expired"!==d.state||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",j,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(d){const t=d.canonical,l=Math.pow(2,t.z),p=(t.x-1+l)%l,_=0===t.x?d.wrap-1:d.wrap,v=(t.x+1+l)%l,E=t.x+1===l?d.wrap+1:d.wrap,S={};return S[new c.OverscaledTileID(d.overscaledZ,_,t.z,p,t.y).key]={backfilled:!1},S[new c.OverscaledTileID(d.overscaledZ,E,t.z,v,t.y).key]={backfilled:!1},t.y>0&&(S[new c.OverscaledTileID(d.overscaledZ,_,t.z,p,t.y-1).key]={backfilled:!1},S[new c.OverscaledTileID(d.overscaledZ,d.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},S[new c.OverscaledTileID(d.overscaledZ,E,t.z,v,t.y-1).key]={backfilled:!1}),t.y+1<l&&(S[new c.OverscaledTileID(d.overscaledZ,_,t.z,p,t.y+1).key]={backfilled:!1},S[new c.OverscaledTileID(d.overscaledZ,d.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},S[new c.OverscaledTileID(d.overscaledZ,E,t.z,v,t.y+1).key]={backfilled:!1}),S}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends c.Evented{constructor(d,t,l,p){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=t.data,this._options=c.extend({},t),this._collectResourceTiming=t.collectResourceTiming,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const _=c.EXTENT/this.tileSize;this.workerOptions=c.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(void 0!==t.buffer?t.buffer:128)*_,tolerance:(void 0!==t.tolerance?t.tolerance:.375)*_,extent:c.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:void 0!==t.clusterMaxZoom?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:c.EXTENT,radius:(void 0!==t.clusterRadius?t.clusterRadius:50)*_,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},t),this}getClusterChildren(d,t){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},t),this}getClusterLeaves(d,t,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:t,offset:l},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new c.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=c.extend({},this.workerOptions),t=this._data;"string"==typeof t?(d.request=this.map._requestManager.transformRequest(c.exported.resolveURL(t),c.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(l,p)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new c.ErrorEvent(l));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),this.fire(new c.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,t){const l=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(l,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,_)=>(delete d.request,d.unloadVectorData(),d.aborted?t(null):p?t(p):(d.loadVectorData(_,this.map.painter,"reloadTile"===l),t(null))),void 0,"loadTile"===l)}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return c.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ae{constructor(d,t,l,p){super(d,t,l,p),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const t of d.urls)this.urls.push(this.map._requestManager.transformRequest(t,c.ResourceType.Source).url);c.getVideo(this.urls,(t,l)=>{this._loaded=!0,t?this.fire(new c.ErrorEvent(t)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const t=this.video.seekable;d<t.start(0)||d>t.end(0)?this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const d=this.map.painter.context,t=d.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,c.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new c.Texture(d,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE));for(const l in this.tiles){const p=this.tiles[l];"loaded"!==p.state&&(p.state="loaded",p.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ae,canvas:class extends ae{constructor(d,t,l,p){super(d,t,l,p),t.coordinates?Array.isArray(t.coordinates)&&4===t.coordinates.length&&!t.coordinates.some(_=>!Array.isArray(_)||2!==_.length||_.some(v=>"number"!=typeof v))||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),t.animate&&"boolean"!=typeof t.animate&&this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),t.canvas?"string"==typeof t.canvas||t.canvas instanceof c.window.HTMLCanvasElement||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=t,this.animate=void 0===t.animate||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof c.window.HTMLCanvasElement?this.options.canvas:c.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const t=this.map.painter.context,l=t.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,c.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.Texture(t,this.canvas,l.RGBA,{premultiply:!0});for(const p in this.tiles){const _=this.tiles[p];"loaded"!==_.state&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}}},Z=function(d,t,l,p){const _=new V[t.type](d,t,l,p);if(_.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${_.id}`);return c.bindAll(["load","abort","unload","serialize","prepare"],_),_};function ce(d,t){const l=c.identity([]);return c.scale$1(l,l,[.5*d.width,.5*-d.height,1]),c.translate(l,l,[1,-1,0]),c.multiply(l,l,d.calculateProjMatrix(t.toUnwrapped()))}function he(d,t,l,p,_,v,E,S=!1){const R=d.tilesIn(p,E,S);R.sort(ke);const z=[];for(const j of R)z.push({wrappedTileID:j.tile.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(t,l,d._state,j,_,v,ce(d.transform,j.tile.tileID),S)});const N=function(j){const Q={},oe={};for(const ie of j){const re=ie.queryResults,pe=ie.wrappedTileID,se=oe[pe]=oe[pe]||{};for(const me in re){const _e=re[me],le=se[me]=se[me]||{},ye=Q[me]=Q[me]||[];for(const Ee of _e)le[Ee.featureIndex]||(le[Ee.featureIndex]=!0,ye.push(Ee))}}return Q}(z);for(const j in N)N[j].forEach(Q=>{const oe=Q.feature,ie=d.getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=ie});return N}function xe(d,t){const l=d.getRenderableIds().map(v=>d.getTileByID(v)),p=[],_={};for(let v=0;v<l.length;v++){const E=l[v],S=E.tileID.canonical.key;_[S]||(_[S]=!0,E.querySourceFeatures(p,t))}return p}function ke(d,t){const l=d.tileID,p=t.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function Me(){return null!=wa.workerClass?new wa.workerClass:new c.window.Worker(wa.workerUrl)}const we="mapboxgl_preloaded_worker_pool";class Le{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Le.workerCount;)this.workers.push(new Me);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[we]}numActive(){return Object.keys(this.active).length}}let rt;function wt(){return rt||(rt=new Le),rt}function it(d,t){const l={};for(const p in d)"ref"!==p&&(l[p]=d[p]);return c.refProperties.forEach(p=>{p in t&&(l[p]=t[p])}),l}function Ht(d){d=d.slice();const t=Object.create(null);for(let l=0;l<d.length;l++)t[d[l].id]=d[l];for(let l=0;l<d.length;l++)"ref"in d[l]&&(d[l]=it(d[l],t[d[l].ref]));return d}Le.workerCount=2;const vt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function W(d,t,l){l.push({command:vt.addSource,args:[d,t[d]]})}function J(d,t,l){t.push({command:vt.removeSource,args:[d]}),l[d]=!0}function ne(d,t,l,p){J(d,l,p),W(d,t,l)}function Ae(d,t,l){let p;for(p in d[l])if(d[l].hasOwnProperty(p)&&"data"!==p&&!Ve(d[l][p],t[l][p]))return!1;for(p in t[l])if(t[l].hasOwnProperty(p)&&"data"!==p&&!Ve(d[l][p],t[l][p]))return!1;return!0}function je(d,t,l,p,_,v){let E;for(E in t=t||{},d=d||{})d.hasOwnProperty(E)&&(Ve(d[E],t[E])||l.push({command:v,args:[p,E,t[E],_]}));for(E in t)t.hasOwnProperty(E)&&!d.hasOwnProperty(E)&&(Ve(d[E],t[E])||l.push({command:v,args:[p,E,t[E],_]}))}function yt(d){return d.id}function $t(d,t){return d[t.id]=t,d}class _r{constructor(t,l){this.reset(t,l)}reset(t,l){this.points=t||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=c.clamp(t,0,1);let l=1,p=this._distances[l];const _=t*this.paddedLength+this.padding;for(;p<_&&l<this._distances.length;)p=this._distances[++l];const v=l-1,E=this._distances[v],S=p-E,R=S>0?(_-E)/S:0;return this.points[v].mult(1-R).add(this.points[l].mult(R))}}class cr{constructor(t,l,p){const _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(t/p),this.yCellCount=Math.ceil(l/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=l,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,l,p,_,v){this._forEachCell(l,p,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(t,l,p,_){this._forEachCell(l-_,p-_,l+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(l),this.circles.push(p),this.circles.push(_)}_insertBoxCell(t,l,p,_,v,E){this.boxCells[v].push(E)}_insertCircleCell(t,l,p,_,v,E){this.circleCells[v].push(E)}_query(t,l,p,_,v,E){if(p<0||t>this.width||_<0||l>this.height)return!v&&[];const S=[];if(t<=0&&l<=0&&this.width<=p&&this.height<=_){if(v)return!0;for(let R=0;R<this.boxKeys.length;R++)S.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const z=this.circles[3*R],N=this.circles[3*R+1],j=this.circles[3*R+2];S.push({key:this.circleKeys[R],x1:z-j,y1:N-j,x2:z+j,y2:N+j})}return E?S.filter(E):S}return this._forEachCell(t,l,p,_,this._queryCell,S,{hitTest:v,seenUids:{box:{},circle:{}}},E),v?S.length>0:S}_queryCircle(t,l,p,_,v){const E=t-p,S=t+p,R=l-p,z=l+p;if(S<0||E>this.width||z<0||R>this.height)return!_&&[];const N=[];return this._forEachCell(E,R,S,z,this._queryCellCircle,N,{hitTest:_,circle:{x:t,y:l,radius:p},seenUids:{box:{},circle:{}}},v),_?N.length>0:N}query(t,l,p,_,v){return this._query(t,l,p,_,!1,v)}hitTest(t,l,p,_,v){return this._query(t,l,p,_,!0,v)}hitTestCircle(t,l,p,_){return this._queryCircle(t,l,p,!0,_)}_queryCell(t,l,p,_,v,E,S,R){const z=S.seenUids,N=this.boxCells[v];if(null!==N){const Q=this.bboxes;for(const oe of N)if(!z.box[oe]){z.box[oe]=!0;const ie=4*oe;if(t<=Q[ie+2]&&l<=Q[ie+3]&&p>=Q[ie+0]&&_>=Q[ie+1]&&(!R||R(this.boxKeys[oe]))){if(S.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[oe],x1:Q[ie],y1:Q[ie+1],x2:Q[ie+2],y2:Q[ie+3]})}}}const j=this.circleCells[v];if(null!==j){const Q=this.circles;for(const oe of j)if(!z.circle[oe]){z.circle[oe]=!0;const ie=3*oe;if(this._circleAndRectCollide(Q[ie],Q[ie+1],Q[ie+2],t,l,p,_)&&(!R||R(this.circleKeys[oe]))){if(S.hitTest)return E.push(!0),!0;{const re=Q[ie],pe=Q[ie+1],se=Q[ie+2];E.push({key:this.circleKeys[oe],x1:re-se,y1:pe-se,x2:re+se,y2:pe+se})}}}}}_queryCellCircle(t,l,p,_,v,E,S,R){const z=S.circle,N=S.seenUids,j=this.boxCells[v];if(null!==j){const oe=this.bboxes;for(const ie of j)if(!N.box[ie]){N.box[ie]=!0;const re=4*ie;if(this._circleAndRectCollide(z.x,z.y,z.radius,oe[re+0],oe[re+1],oe[re+2],oe[re+3])&&(!R||R(this.boxKeys[ie])))return E.push(!0),!0}}const Q=this.circleCells[v];if(null!==Q){const oe=this.circles;for(const ie of Q)if(!N.circle[ie]){N.circle[ie]=!0;const re=3*ie;if(this._circlesCollide(oe[re],oe[re+1],oe[re+2],z.x,z.y,z.radius)&&(!R||R(this.circleKeys[ie])))return E.push(!0),!0}}}_forEachCell(t,l,p,_,v,E,S,R){const z=this._convertToXCellCoord(t),N=this._convertToYCellCoord(l),j=this._convertToXCellCoord(p),Q=this._convertToYCellCoord(_);for(let oe=z;oe<=j;oe++)for(let ie=N;ie<=Q;ie++)if(v.call(this,t,l,p,_,this.xCellCount*ie+oe,E,S,R))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,l,p,_,v,E){const S=_-t,R=v-l,z=p+E;return z*z>S*S+R*R}_circleAndRectCollide(t,l,p,_,v,E,S){const R=(E-_)/2,z=Math.abs(t-(_+R));if(z>R+p)return!1;const N=(S-v)/2,j=Math.abs(l-(v+N));if(j>N+p)return!1;if(z<=R||j<=N)return!0;const Q=z-R,oe=j-N;return Q*Q+oe*oe<=p*p}}const Dt=Math.tan(85*Math.PI/180);function fn(d,t,l,p,_){const v=c.create$1();if(t){const E=sn([],_);v[0]=E[0],v[1]=E[1],v[4]=E[2],v[5]=E[3],l||c.rotateZ(v,v,p.angle)}else c.multiply(v,p.labelPlaneMatrix,d);return v}function Wt(d,t,l,p,_){if(t){const v=c.clone$1(d),E=c.identity([]);return E[0]=_[0],E[1]=_[1],E[4]=_[2],E[5]=_[3],c.multiply(v,v,E),l||c.rotateZ(v,v,-p.angle),v}return p.glCoordMatrix}function br(d,t,l=0){const p=[d.x,d.y,l,1];l?c.transformMat4(p,p,t):Cn(p,p,t);const _=p[3];return{point:new c.pointGeometry(p[0]/_,p[1]/_),signedDistanceFromCamera:_}}function Pr(d,t){return Math.min(.5+d/t*.5,1.5)}function at(d,t){const l=d[0]/d[3],p=d[1]/d[3];return l>=-t[0]&&l<=t[0]&&p>=-t[1]&&p<=t[1]}function kn(d,t,l,p,_,v,E,S,R){const z=p?d.textSizeData:d.iconSizeData,N=c.evaluateSizeForZoom(z,l.transform.zoom),j=[256/l.width*2+1,256/l.height*2+1],Q=p?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;Q.clear();const oe=d.lineVertexArray,ie=p?d.text.placedSymbolArray:d.icon.placedSymbolArray,re=l.transform.width/l.transform.height;let pe=!1;for(let se=0;se<ie.length;se++){const me=ie.get(se);if(me.writingMode!==c.WritingMode.vertical||pe||0!==se&&ie.get(se-1).writingMode===c.WritingMode.horizontal||(pe=!0),me.hidden||me.writingMode===c.WritingMode.vertical&&!pe){ui(me.numGlyphs,Q);continue}pe=!1;const _e=new c.pointGeometry(me.tileAnchorX,me.tileAnchorY),le=R?R(_e):0,ye=[_e.x,_e.y,le],Ee=[...ye,1];if(c.transformMat4(Ee,Ee,t),!at(Ee,j)){ui(me.numGlyphs,Q);continue}const Ze=Pr(l.transform.cameraToCenterDistance,Ee[3]),Ge=c.evaluateSizeForFeature(z,N,me),tt=E?Ge/Ze:Ge*Ze,nt=br(new c.pointGeometry(ye[0],ye[1]),_,ye[2]);if(nt.signedDistanceFromCamera<=0){ui(me.numGlyphs,Q);continue}let xt={};const Xe=E?null:R,Et=Nr(me,tt,!1,S,t,_,v,d.glyphOffsetArray,oe,Q,nt.point,_e,xt,re,Xe);pe=Et.useVertical,Xe&&Et.needsFlipping&&(xt={}),(Et.notEnoughRoom||pe||Et.needsFlipping&&Nr(me,tt,!0,S,t,_,v,d.glyphOffsetArray,oe,Q,nt.point,_e,xt,re,Xe).notEnoughRoom)&&ui(me.numGlyphs,Q)}p?d.text.dynamicLayoutVertexBuffer.updateData(Q):d.icon.dynamicLayoutVertexBuffer.updateData(Q)}function Kn(d,t,l,p,_,v,E,S,R,z,N,j,Q){const oe=S.glyphStartIndex+S.numGlyphs,ie=S.lineStartIndex,re=S.lineStartIndex+S.lineLength,pe=t.getoffsetX(S.glyphStartIndex),se=t.getoffsetX(oe-1),me=rr(d*pe,l,p,_,v,E,S.segment,ie,re,R,z,N,j,Q,!0);if(!me)return null;const _e=rr(d*se,l,p,_,v,E,S.segment,ie,re,R,z,N,j,Q,!0);return _e?{first:me,last:_e}:null}function Gr(d,t,l,p){return d.writingMode===c.WritingMode.horizontal&&Math.abs(l.y-t.y)>Math.abs(l.x-t.x)*p?{useVertical:!0}:d.writingMode===c.WritingMode.vertical?t.y<l.y?{needsFlipping:!0}:null:0!==d.flipState&&function(_,v,E){const S=(v.x-_.x)*E;return 0===S||Math.abs((v.y-_.y)/S)>Dt}(t,l,p)?1===d.flipState?{needsFlipping:!0}:null:t.x>l.x?{needsFlipping:!0}:null}function Nr(d,t,l,p,_,v,E,S,R,z,N,j,Q,oe,ie){const re=t/24,pe=d.lineOffsetX*re,se=d.lineOffsetY*re;let me;if(d.numGlyphs>1){const _e=d.glyphStartIndex+d.numGlyphs,le=d.lineStartIndex,ye=d.lineStartIndex+d.lineLength,Ee=Kn(re,S,pe,se,l,N,j,d,R,v,Q,ie,!1);if(!Ee)return{notEnoughRoom:!0};const Ze=br(Ee.first.point,E).point,Ge=br(Ee.last.point,E).point;if(p&&!l){const tt=Gr(d,Ze,Ge,oe);if(d.flipState=tt&&tt.needsFlipping?1:2,tt)return tt}me=[Ee.first];for(let tt=d.glyphStartIndex+1;tt<_e-1;tt++)me.push(rr(re*S.getoffsetX(tt),pe,se,l,N,j,d.segment,le,ye,R,v,Q,ie,!1,!1));me.push(Ee.last)}else{if(p&&!l){const le=br(j,_).point,ye=d.lineStartIndex+d.segment+1,Ee=new c.pointGeometry(R.getx(ye),R.gety(ye)),Ze=br(Ee,_),Ge=Gr(d,le,Ze.signedDistanceFromCamera>0?Ze.point:Lo(j,Ee,le,1,_,void 0),oe);if(d.flipState=Ge&&Ge.needsFlipping?1:2,Ge)return Ge}const _e=rr(re*S.getoffsetX(d.glyphStartIndex),pe,se,l,N,j,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,R,v,Q,ie,!1,!1);if(!_e)return{notEnoughRoom:!0};me=[_e]}for(const _e of me)c.addDynamicAttributes(z,_e.point,_e.angle);return{}}function Rn(d,t,l){const p={x:d.x,y:d.y,z:0};if(!l)return br(p,t,p.z);const _=l(d);return br(new c.pointGeometry(p.x,p.y),t,p.z+_)}function Lo(d,t,l,p,_,v){const E=Rn(d.add(d.sub(t)._unit()),_,v).point,S=l.sub(E);return l.add(S._mult(p/S.mag()))}function rr(d,t,l,p,_,v,E,S,R,z,N,j,Q,oe,ie){const re=p?d-t:d+t;let pe=re>0?1:-1,se=0;p&&(pe*=-1,se=Math.PI),pe<0&&(se+=Math.PI);let me=pe>0?S+E:S+E+1,_e=_,le=_,ye=0,Ee=0;const Ze=Math.abs(re),Ge=[],tt=[];let nt=v;const xt=()=>{const un=me-pe;return 0===ye?v:new c.pointGeometry(z.getx(un),z.gety(un))},Xe=()=>Lo(xt(),nt,le,Ze-ye+1,N,Q);for(;ye+Ee<=Ze;){if(me+=pe,me<S||me>=R)return null;if(le=_e,Ge.push(_e),oe&&tt.push(nt||xt()),_e=j[me],void 0===_e){nt=new c.pointGeometry(z.getx(me),z.gety(me));const un=Rn(nt,N,Q);_e=un.signedDistanceFromCamera>0?j[me]=un.point:Xe()}else nt=null;ye+=Ee,Ee=le.dist(_e)}ie&&Q&&(nt=nt||new c.pointGeometry(z.getx(me),z.gety(me)),j[me]=_e=void 0===j[me]?_e:Xe(),Ee=le.dist(_e));const Et=(Ze-ye)/Ee,Ne=_e.sub(le),St=Ne.mult(Et)._add(le);l&&St._add(Ne._unit()._perp()._mult(l*pe));const jt=se+Math.atan2(_e.y-le.y,_e.x-le.x);return Ge.push(St),oe&&(nt=nt||new c.pointGeometry(z.getx(me),z.gety(me)),tt.push(function(un,mn,yn){const hn=1-yn;return new c.pointGeometry(un.x*hn+mn.x*yn,un.y*hn+mn.y*yn)}(tt.length>0?tt[tt.length-1]:nt,nt,Et))),{point:St,angle:jt,path:Ge,tilePath:tt}}const Fo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ui(d,t){for(let l=0;l<d;l++){const p=t.length;t.resize(p+4),t.float32.set(Fo,3*p)}}function Cn(d,t,l){const p=t[0],_=t[1];return d[0]=l[0]*p+l[4]*_+l[12],d[1]=l[1]*p+l[5]*_+l[13],d[3]=l[3]*p+l[7]*_+l[15],d}const bi=100;class Ln{constructor(t,l,p=new cr(t.width+200,t.height+200,25),_=new cr(t.width+200,t.height+200,25)){this.transform=t,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+bi,this.screenBottomBoundary=t.height+bi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=l}placeCollisionBox(t,l,p,_,v,E,S){let R=l.projectedAnchorZ;l.elevation&&(R+=l.elevation);const z=this.projectAndGetPerspectiveRatio(E,l.projectedAnchorX,l.projectedAnchorY,R,l.tileID),N=v*z.perspectiveRatio,j=(l.x1*t+p.x-l.padding)*N+z.point.x,Q=(l.y1*t+p.y-l.padding)*N+z.point.y,oe=(l.x2*t+p.x+l.padding)*N+z.point.x,ie=(l.y2*t+p.y+l.padding)*N+z.point.y,re=z.perspectiveRatio<=.55||z.aboveHorizon;return!this.isInsideGrid(j,Q,oe,ie)||!_&&this.grid.hitTest(j,Q,oe,ie,S)||re?{box:[],offscreen:!1}:{box:[j,Q,oe,ie],offscreen:this.isOffscreen(j,Q,oe,ie)}}placeCollisionCircles(t,l,p,_,v,E,S,R,z,N,j,Q,oe,ie){const re=[],pe=this.transform.elevation,se=pe?Xe=>pe.getAtTileOffset(ie,Xe.x,Xe.y):Xe=>0,me=new c.pointGeometry(l.tileAnchorX,l.tileAnchorY),_e=se(me),le=this.projectAndGetPerspectiveRatio(E,me.x,me.y,_e,ie),{perspectiveRatio:ye}=le,Ee=(N?v/ye:v*ye)/c.ONE_EM,Ze=br(me,S,_e).point,Ge=le.signedDistanceFromCamera>0?Kn(Ee,_,l.lineOffsetX*Ee,l.lineOffsetY*Ee,!1,Ze,me,l,p,S,{},pe&&!N?se:null,N&&!!pe):null;let tt=!1,nt=!1,xt=!0;if(Ge&&!le.aboveHorizon){const Xe=.5*Q*ye+oe,Et=new c.pointGeometry(-100,-100),Ne=new c.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),St=new _r,jt=Ge.first,un=Ge.last;let mn=[];for(let nn=jt.path.length-1;nn>=1;nn--)mn.push(jt.path[nn]);for(let nn=1;nn<un.path.length;nn++)mn.push(un.path[nn]);const yn=2.5*Xe;if(R){const nn=mn.map(pe?(An,Dn)=>{const si=se(Dn<jt.path.length-1?jt.tilePath[jt.path.length-1-Dn]:un.tilePath[Dn-jt.path.length+2]);return br(An,R,si)}:An=>br(An,R));mn=nn.some(An=>An.signedDistanceFromCamera<=0)?[]:nn.map(An=>An.point)}let hn=[];if(mn.length>0){const nn=mn[0].clone(),An=mn[0].clone();for(let Dn=1;Dn<mn.length;Dn++)nn.x=Math.min(nn.x,mn[Dn].x),nn.y=Math.min(nn.y,mn[Dn].y),An.x=Math.max(An.x,mn[Dn].x),An.y=Math.max(An.y,mn[Dn].y);hn=nn.x>=Et.x&&An.x<=Ne.x&&nn.y>=Et.y&&An.y<=Ne.y?[mn]:An.x<Et.x||nn.x>Ne.x||An.y<Et.y||nn.y>Ne.y?[]:c.clipLine([mn],Et.x,Et.y,Ne.x,Ne.y)}for(const nn of hn){St.reset(nn,.25*Xe);let An=0;An=St.length<=.5*Xe?1:Math.ceil(St.paddedLength/yn)+1;for(let Dn=0;Dn<An;Dn++){const si=Dn/Math.max(An-1,1),so=St.lerp(si),Fi=so.x+bi,Ci=so.y+bi;re.push(Fi,Ci,Xe,0);const mi=Fi-Xe,ea=Ci-Xe,As=Fi+Xe,ur=Ci+Xe;if(xt=xt&&this.isOffscreen(mi,ea,As,ur),nt=nt||this.isInsideGrid(mi,ea,As,ur),!t&&this.grid.hitTestCircle(Fi,Ci,Xe,j)&&(tt=!0,!z))return{circles:[],offscreen:!1,collisionDetected:tt}}}}return{circles:!z&&tt||!nt?[]:re,offscreen:xt,collisionDetected:tt}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const l=[];let p=1/0,_=1/0,v=-1/0,E=-1/0;for(const N of t){const j=new c.pointGeometry(N.x+bi,N.y+bi);p=Math.min(p,j.x),_=Math.min(_,j.y),v=Math.max(v,j.x),E=Math.max(E,j.y),l.push(j)}const S=this.grid.query(p,_,v,E).concat(this.ignoredGrid.query(p,_,v,E)),R={},z={};for(const N of S){const j=N.key;if(void 0===R[j.bucketInstanceId]&&(R[j.bucketInstanceId]={}),R[j.bucketInstanceId][j.featureIndex])continue;const Q=[new c.pointGeometry(N.x1,N.y1),new c.pointGeometry(N.x2,N.y1),new c.pointGeometry(N.x2,N.y2),new c.pointGeometry(N.x1,N.y2)];c.polygonIntersectsPolygon(l,Q)&&(R[j.bucketInstanceId][j.featureIndex]=!0,void 0===z[j.bucketInstanceId]&&(z[j.bucketInstanceId]=[]),z[j.bucketInstanceId].push(j.featureIndex))}return z}insertCollisionBox(t,l,p,_,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:v},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,l,p,_,v){const E=l?this.ignoredGrid:this.grid,S={bucketInstanceId:p,featureIndex:_,collisionGroupID:v};for(let R=0;R<t.length;R+=4)E.insertCircle(S,t[R],t[R+1],t[R+2])}projectAndGetPerspectiveRatio(t,l,p,_,v){const E=[l,p,_||0,1];let S=!1;if(_||this.transform.pitch>0){c.transformMat4(E,E,t);let R=!1;this.fogState&&v&&(R=function(z,N,j,Q,oe,ie){const re=ie.calculateFogTileMatrix(oe),pe=[N,j,Q];return c.transformMat4$1(pe,pe,re),He(z,pe,ie.pitch,ie._fov)}(this.fogState,l,p,_||0,v.toUnwrapped(),this.transform)>.9),S=E[2]>E[3]||R}else Cn(E,E,t);return{point:new c.pointGeometry((E[0]/E[3]+1)/2*this.transform.width+bi,(-E[1]/E[3]+1)/2*this.transform.height+bi),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/E[3]*.5,1.5),signedDistanceFromCamera:E[3],aboveHorizon:S}}isOffscreen(t,l,p,_){return p<bi||t>=this.screenRightBoundary||_<bi||l>this.screenBottomBoundary}isInsideGrid(t,l,p,_){return p>=0&&t<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const t=c.identity([]);return c.translate(t,t,[-100,-100,0]),t}}class $o{constructor(t,l,p,_){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?l:-l))):_&&p?1:0,this.placed=p}isHidden(){return 0===this.opacity&&!this.placed}}class Vi{constructor(t,l,p,_,v,E=!1){this.text=new $o(t?t.text:null,l,p,v),this.icon=new $o(t?t.icon:null,l,_,v),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Jn{constructor(t,l,p,_=!1){this.text=t,this.icon=l,this.skipFade=p,this.clipped=_}}class ii{constructor(){this.invProjMatrix=c.create$1(),this.viewportMatrix=c.create$1(),this.circles=[]}}class hi{constructor(t,l,p,_,v){this.bucketInstanceId=t,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=v}}class Hr{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const l=++this.maxGroupID;this.collisionGroups[t]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[t]}}function _n(d,t,l,p,_){const{horizontalAlign:v,verticalAlign:E}=c.getAnchorAlignment(d),S=-(v-.5)*t,R=-(E-.5)*l,z=c.evaluateVariableOffset(d,p);return new c.pointGeometry(S+z[0]*_,R+z[1]*_)}function Go(d,t,l,p,_){const v=new c.pointGeometry(d,t);return l&&v._rotate(p?_:-_),v}class ws{constructor(t,l,p,_,v){this.transform=t.clone(),this.collisionIndex=new Ln(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Hr(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,l,p,_){const v=p.getBucket(l),E=p.latestFeatureIndex;if(!v||!E||l.id!==v.layerIds[0])return;const S=v.layers[0].layout,R=p.collisionBoxArray,z=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),N=p.tileSize/c.EXTENT,j=p.tileID.toUnwrapped(),Q=this.transform.calculateProjMatrix(j),oe="map"===S.get("text-pitch-alignment"),ie="map"===S.get("text-rotation-alignment");l.compileFilter();const re=l.dynamicFilter(),pe=l.dynamicFilterNeedsFeature(),se=this.transform.calculatePixelsToTileUnitsMatrix(p),me=fn(Q,oe,ie,this.transform,se);let _e=null;if(oe){const Ee=Wt(Q,oe,ie,this.transform,se);_e=c.multiply([],this.transform.labelPlaneMatrix,Ee)}let le=null;re&&p.latestFeatureIndex&&(le={unwrappedTileID:j,dynamicFilter:re,dynamicFilterNeedsFeature:pe,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new hi(v.bucketInstanceId,E,v.sourceLayerIndex,v.index,p.tileID);const ye={bucket:v,layout:S,posMatrix:Q,textLabelPlaneMatrix:me,labelToScreenMatrix:_e,clippingData:le,scale:z,textPixelRatio:N,holdingForFade:p.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:c.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:c.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(_)for(const Ee of v.sortKeyRanges){const{sortKey:Ze,symbolInstanceStart:Ge,symbolInstanceEnd:tt}=Ee;t.push({sortKey:Ze,symbolInstanceStart:Ge,symbolInstanceEnd:tt,parameters:ye})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ye})}attemptAnchorPlacement(t,l,p,_,v,E,S,R,z,N,j,Q,oe,ie,re,pe,se,me){const _e=[Q.textOffset0,Q.textOffset1],le=_n(t,p,_,_e,v),ye=this.collisionIndex.placeCollisionBox(v,l,Go(le.x,le.y,E,S,this.transform.angle),j,R,z,N.predicate);if((!pe||0!==this.collisionIndex.placeCollisionBox(ie.getSymbolInstanceIconSize(me,this.transform.zoom,oe),pe,Go(le.x,le.y,E,S,this.transform.angle),j,R,z,N.predicate).box.length)&&ye.box.length>0){let Ee;return this.prevPlacement&&this.prevPlacement.variableOffsets[Q.crossTileID]&&this.prevPlacement.placements[Q.crossTileID]&&this.prevPlacement.placements[Q.crossTileID].text&&(Ee=this.prevPlacement.variableOffsets[Q.crossTileID].anchor),this.variableOffsets[Q.crossTileID]={textOffset:_e,width:p,height:_,anchor:t,textScale:v,prevAnchor:Ee},this.markUsedJustification(ie,t,Q,re),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,re,Q),this.placedOrientations[Q.crossTileID]=re),{shift:le,placedGlyphBoxes:ye}}}placeLayerBucketPart(t,l,p,_){const{bucket:v,layout:E,posMatrix:S,textLabelPlaneMatrix:R,labelToScreenMatrix:z,clippingData:N,textPixelRatio:j,holdingForFade:Q,collisionBoxArray:oe,partiallyEvaluatedTextSize:ie,partiallyEvaluatedIconSize:re,collisionGroup:pe}=t.parameters,se=E.get("text-optional"),me=E.get("icon-optional"),_e=E.get("text-allow-overlap"),le=E.get("icon-allow-overlap"),ye="map"===E.get("text-rotation-alignment"),Ee="map"===E.get("text-pitch-alignment"),Ze="none"!==E.get("icon-text-fit"),Ge="viewport-y"===E.get("symbol-z-order"),tt=_e&&(le||!v.hasIconData()||me),nt=le&&(_e||!v.hasTextData()||se);!v.collisionArrays&&oe&&v.deserializeCollisionBoxes(oe),p&&_&&v.updateCollisionDebugBuffers(this.transform.zoom,oe);const xt=(Xe,Et,Ne)=>{if(N){const ur={zoom:this.transform.zoom,pitch:this.transform.pitch};let Cr=null;if(N.dynamicFilterNeedsFeature){const Xn=this.retainedQueryData[v.bucketInstanceId];Cr=N.featureIndex.loadFeature({featureIndex:Xe.featureIndex,bucketIndex:Xn.bucketIndex,sourceLayerIndex:Xn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,N.dynamicFilter)(ur,Cr,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new c.pointGeometry(Xe.tileAnchorX,Xe.tileAnchorY),this.transform.calculateDistanceTileData(N.unwrappedTileID)))return this.placements[Xe.crossTileID]=new Jn(!1,!1,!1,!0),void(l[Xe.crossTileID]=!0)}if(l[Xe.crossTileID])return;if(Q)return void(this.placements[Xe.crossTileID]=new Jn(!1,!1,!1));let St=!1,jt=!1,un=!0,mn=null,yn={box:null,offscreen:null},hn={box:null,offscreen:null},nn=null,An=null,Dn=null,si=0,so=0,Fi=0;Ne.textFeatureIndex?si=Ne.textFeatureIndex:Xe.useRuntimeCollisionCircles&&(si=Xe.featureIndex),Ne.verticalTextFeatureIndex&&(so=Ne.verticalTextFeatureIndex);const Ci=ur=>{ur.tileID=this.retainedQueryData[v.bucketInstanceId].tileID,(this.transform.elevation||ur.elevation)&&(ur.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[v.bucketInstanceId].tileID,ur.tileAnchorX,ur.tileAnchorY):0)},mi=Ne.textBox;if(mi){Ci(mi);const ur=Xn=>{let hr=c.WritingMode.horizontal;if(v.allowVerticalPlacement&&!Xn&&this.prevPlacement){const Zi=this.prevPlacement.placedOrientations[Xe.crossTileID];Zi&&(this.placedOrientations[Xe.crossTileID]=Zi,hr=Zi,this.markUsedOrientation(v,hr,Xe))}return hr},Cr=(Xn,hr)=>{if(v.allowVerticalPlacement&&Xe.numVerticalGlyphVertices>0&&Ne.verticalTextBox){for(const Zi of v.writingModes)if(Zi===c.WritingMode.vertical?(yn=hr(),hn=yn):yn=Xn(),yn&&yn.box&&yn.box.length)break}else yn=Xn()};if(E.get("text-variable-anchor")){let Xn=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Xe.crossTileID]){const Tr=this.prevPlacement.variableOffsets[Xe.crossTileID];Xn.indexOf(Tr.anchor)>0&&(Xn=Xn.filter(go=>go!==Tr.anchor),Xn.unshift(Tr.anchor))}const hr=(Tr,go,Ea)=>{const _o=v.getSymbolInstanceTextSize(ie,Xe,this.transform.zoom,Et),Da=(Tr.x2-Tr.x1)*_o+2*Tr.padding,Bu=(Tr.y2-Tr.y1)*_o+2*Tr.padding,ta=Ze&&!le?go:null;ta&&Ci(ta);let Ps={box:[],offscreen:!1};const Nu=_e?2*Xn.length:Xn.length;for(let yc=0;yc<Nu;++yc){const Kl=this.attemptAnchorPlacement(Xn[yc%Xn.length],Tr,Da,Bu,_o,ye,Ee,j,S,pe,yc>=Xn.length,Xe,Et,v,Ea,ta,ie,re);if(Kl&&(Ps=Kl.placedGlyphBoxes,Ps&&Ps.box&&Ps.box.length)){St=!0,mn=Kl.shift;break}}return Ps};Cr(()=>hr(mi,Ne.iconBox,c.WritingMode.horizontal),()=>{const Tr=Ne.verticalTextBox;return Tr&&Ci(Tr),v.allowVerticalPlacement&&!(yn&&yn.box&&yn.box.length)&&Xe.numVerticalGlyphVertices>0&&Tr?hr(Tr,Ne.verticalIconBox,c.WritingMode.vertical):{box:null,offscreen:null}}),yn&&(St=yn.box,un=yn.offscreen);const Zi=ur(yn&&yn.box);if(!St&&this.prevPlacement){const Tr=this.prevPlacement.variableOffsets[Xe.crossTileID];Tr&&(this.variableOffsets[Xe.crossTileID]=Tr,this.markUsedJustification(v,Tr.anchor,Xe,Zi))}}else{const Xn=(hr,Zi)=>{const Tr=v.getSymbolInstanceTextSize(ie,Xe,this.transform.zoom,Et),go=this.collisionIndex.placeCollisionBox(Tr,hr,new c.pointGeometry(0,0),_e,j,S,pe.predicate);return go&&go.box&&go.box.length&&(this.markUsedOrientation(v,Zi,Xe),this.placedOrientations[Xe.crossTileID]=Zi),go};Cr(()=>Xn(mi,c.WritingMode.horizontal),()=>{const hr=Ne.verticalTextBox;return v.allowVerticalPlacement&&Xe.numVerticalGlyphVertices>0&&hr?(Ci(hr),Xn(hr,c.WritingMode.vertical)):{box:null,offscreen:null}}),ur(yn&&yn.box&&yn.box.length)}}if(nn=yn,St=nn&&nn.box&&nn.box.length>0,un=nn&&nn.offscreen,Xe.useRuntimeCollisionCircles){const ur=v.text.placedSymbolArray.get(Xe.centerJustifiedTextSymbolIndex>=0?Xe.centerJustifiedTextSymbolIndex:Xe.verticalPlacedTextSymbolIndex),Cr=c.evaluateSizeForFeature(v.textSizeData,ie,ur),Xn=E.get("text-padding");An=this.collisionIndex.placeCollisionCircles(_e,ur,v.lineVertexArray,v.glyphOffsetArray,Cr,S,R,z,p,Ee,pe.predicate,Xe.collisionCircleDiameter*Cr/c.ONE_EM,Xn,this.retainedQueryData[v.bucketInstanceId].tileID),St=_e||An.circles.length>0&&!An.collisionDetected,un=un&&An.offscreen}if(Ne.iconFeatureIndex&&(Fi=Ne.iconFeatureIndex),Ne.iconBox){const ur=Cr=>{Ci(Cr);const Xn=Ze&&mn?Go(mn.x,mn.y,ye,Ee,this.transform.angle):new c.pointGeometry(0,0),hr=v.getSymbolInstanceIconSize(re,this.transform.zoom,Et);return this.collisionIndex.placeCollisionBox(hr,Cr,Xn,le,j,S,pe.predicate)};hn&&hn.box&&hn.box.length&&Ne.verticalIconBox?(Dn=ur(Ne.verticalIconBox),jt=Dn.box.length>0):(Dn=ur(Ne.iconBox),jt=Dn.box.length>0),un=un&&Dn.offscreen}const ea=se||0===Xe.numHorizontalGlyphVertices&&0===Xe.numVerticalGlyphVertices,As=me||0===Xe.numIconVertices;if(ea||As?As?ea||(jt=jt&&St):St=jt&&St:jt=St=jt&&St,St&&nn&&nn.box&&this.collisionIndex.insertCollisionBox(nn.box,E.get("text-ignore-placement"),v.bucketInstanceId,hn&&hn.box&&so?so:si,pe.ID),jt&&Dn&&this.collisionIndex.insertCollisionBox(Dn.box,E.get("icon-ignore-placement"),v.bucketInstanceId,Fi,pe.ID),An&&(St&&this.collisionIndex.insertCollisionCircles(An.circles,E.get("text-ignore-placement"),v.bucketInstanceId,si,pe.ID),p)){const ur=v.bucketInstanceId;let Cr=this.collisionCircleArrays[ur];void 0===Cr&&(Cr=this.collisionCircleArrays[ur]=new ii);for(let Xn=0;Xn<An.circles.length;Xn+=4)Cr.circles.push(An.circles[Xn+0]),Cr.circles.push(An.circles[Xn+1]),Cr.circles.push(An.circles[Xn+2]),Cr.circles.push(An.collisionDetected?1:0)}this.placements[Xe.crossTileID]=new Jn(St||tt,jt||nt,un||v.justReloaded),l[Xe.crossTileID]=!0};if(Ge){const Xe=v.getSortedSymbolIndexes(this.transform.angle);for(let Et=Xe.length-1;Et>=0;--Et){const Ne=Xe[Et];xt(v.symbolInstances.get(Ne),Ne,v.collisionArrays[Ne])}}else for(let Xe=t.symbolInstanceStart;Xe<t.symbolInstanceEnd;Xe++)xt(v.symbolInstances.get(Xe),Xe,v.collisionArrays[Xe]);if(p&&v.bucketInstanceId in this.collisionCircleArrays){const Xe=this.collisionCircleArrays[v.bucketInstanceId];c.invert(Xe.invProjMatrix,S),Xe.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(t,l,p,_){let v;v=_===c.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[c.getAnchorJustification(l)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const S of E)S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=v>=0&&S!==v?0:p.crossTileID)}markUsedOrientation(t,l,p){const _=l===c.WritingMode.horizontal||l===c.WritingMode.horizontalOnly?l:0,v=l===c.WritingMode.vertical?l:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const S of E)t.text.placedSymbolArray.get(S).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const _=l?l.symbolFadeChange(t):1,v=l?l.opacities:{},E=l?l.variableOffsets:{},S=l?l.placedOrientations:{};for(const R in this.placements){const z=this.placements[R],N=v[R];N?(this.opacities[R]=new Vi(N,_,z.text,z.icon,null,z.clipped),p=p||z.text!==N.text.placed||z.icon!==N.icon.placed):(this.opacities[R]=new Vi(null,_,z.text,z.icon,z.skipFade,z.clipped),p=p||z.text||z.icon)}for(const R in v){const z=v[R];if(!this.opacities[R]){const N=new Vi(z,_,!1,!1);N.isHidden()||(this.opacities[R]=N,p=p||z.text.placed||z.icon.placed)}}for(const R in E)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=E[R]);for(const R in S)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=S[R]);p?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:t)}updateLayerOpacities(t,l){const p={};for(const _ of l){const v=_.getBucket(t);v&&_.latestFeatureIndex&&t.id===v.layerIds[0]&&this.updateBucketOpacities(v,p,_.collisionBoxArray)}}updateBucketOpacities(t,l,p){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const _=t.layers[0].layout,v=!!t.layers[0].dynamicFilter(),E=new Vi(null,0,!1,!1,!0),S=_.get("text-allow-overlap"),R=_.get("icon-allow-overlap"),z=_.get("text-variable-anchor"),N="map"===_.get("text-rotation-alignment"),j="map"===_.get("text-pitch-alignment"),Q="none"!==_.get("icon-text-fit"),oe=new Vi(null,0,S&&(R||!t.hasIconData()||_.get("icon-optional")),R&&(S||!t.hasTextData()||_.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const ie=(re,pe,se)=>{for(let me=0;me<pe/4;me++)re.opacityVertexArray.emplaceBack(se)};for(let re=0;re<t.symbolInstances.length;re++){const pe=t.symbolInstances.get(re),{numHorizontalGlyphVertices:se,numVerticalGlyphVertices:me,crossTileID:_e}=pe;let le=this.opacities[_e];l[_e]?le=E:le||(le=oe,this.opacities[_e]=le),l[_e]=!0;const ye=pe.numIconVertices>0,Ee=this.placedOrientations[pe.crossTileID],Ze=Ee===c.WritingMode.vertical,Ge=Ee===c.WritingMode.horizontal||Ee===c.WritingMode.horizontalOnly;if(se>0||me>0){const tt=js(le.text);ie(t.text,se,Ze?di:tt),ie(t.text,me,Ge?di:tt);const nt=le.text.isHidden();[pe.rightJustifiedTextSymbolIndex,pe.centerJustifiedTextSymbolIndex,pe.leftJustifiedTextSymbolIndex].forEach(Et=>{Et>=0&&(t.text.placedSymbolArray.get(Et).hidden=nt||Ze?1:0)}),pe.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(pe.verticalPlacedTextSymbolIndex).hidden=nt||Ge?1:0);const xt=this.variableOffsets[pe.crossTileID];xt&&this.markUsedJustification(t,xt.anchor,pe,Ee);const Xe=this.placedOrientations[pe.crossTileID];Xe&&(this.markUsedJustification(t,"left",pe,Xe),this.markUsedOrientation(t,Xe,pe))}if(ye){const tt=js(le.icon);pe.placedIconSymbolIndex>=0&&(ie(t.icon,pe.numIconVertices,Ze?di:tt),t.icon.placedSymbolArray.get(pe.placedIconSymbolIndex).hidden=le.icon.isHidden()),pe.verticalPlacedIconSymbolIndex>=0&&(ie(t.icon,pe.numVerticalIconVertices,Ge?di:tt),t.icon.placedSymbolArray.get(pe.verticalPlacedIconSymbolIndex).hidden=le.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const tt=t.collisionArrays[re];if(tt){let nt=new c.pointGeometry(0,0),xt=!0;if(tt.textBox||tt.verticalTextBox){if(z){const Et=this.variableOffsets[_e];Et?(nt=_n(Et.anchor,Et.width,Et.height,Et.textOffset,Et.textScale),N&&nt._rotate(j?this.transform.angle:-this.transform.angle)):xt=!1}v&&(xt=!le.clipped),tt.textBox&&Tn(t.textCollisionBox.collisionVertexArray,le.text.placed,!xt||Ze,nt.x,nt.y),tt.verticalTextBox&&Tn(t.textCollisionBox.collisionVertexArray,le.text.placed,!xt||Ge,nt.x,nt.y)}const Xe=xt&&Boolean(!Ge&&tt.verticalIconBox);tt.iconBox&&Tn(t.iconCollisionBox.collisionVertexArray,le.icon.placed,Xe,Q?nt.x:0,Q?nt.y:0),tt.verticalIconBox&&Tn(t.iconCollisionBox.collisionVertexArray,le.icon.placed,!Xe,Q?nt.x:0,Q?nt.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const re=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=re.invProjMatrix,t.placementViewportMatrix=re.viewportMatrix,t.collisionCircleArray=re.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>t}setStale(){this.stale=!0}}function Tn(d,t,l,p,_){d.emplaceBack(t?1:0,l?1:0,p||0,_||0),d.emplaceBack(t?1:0,l?1:0,p||0,_||0),d.emplaceBack(t?1:0,l?1:0,p||0,_||0),d.emplaceBack(t?1:0,l?1:0,p||0,_||0)}const Pi=Math.pow(2,25),ji=Math.pow(2,24),uo=Math.pow(2,17),Ho=Math.pow(2,16),$i=Math.pow(2,9),Oo=Math.pow(2,8),hl=Math.pow(2,1);function js(d){if(0===d.opacity&&!d.placed)return 0;if(1===d.opacity&&d.placed)return 4294967295;const t=d.placed?1:0,l=Math.floor(127*d.opacity);return l*Pi+t*ji+l*uo+t*Ho+l*$i+t*Oo+l*hl+t}const di=0;class ns{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,l,p,_,v){const E=this._bucketParts;for(;this._currentTileIndex<t.length;)if(l.getBucketParts(E,_,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((S,R)=>S.sortKey-R.sortKey));this._currentPartIndex<E.length;){const S=E[this._currentPartIndex];if(l.placeLayerBucketPart(S,this._seenCrossTileIDs,p,0===S.symbolInstanceStart),this._currentPartIndex++,v())return!0}return!1}}class rs{constructor(t,l,p,_,v,E,S,R){this.placement=new ws(t,v,E,S,R),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,l,p){const _=c.exported.now(),v=()=>{const E=c.exported.now()-_;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=l[t[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if("symbol"===E.type&&(!E.minzoom||E.minzoom<=S)&&(!E.maxzoom||E.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new ns(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const dl=512/c.EXTENT/2;class Oa{constructor(t,l,p){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<l.length;_++){const v=l.get(_),E=v.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,t)})}}getScaledCoordinates(t,l){const p=dl/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*c.EXTENT+t.tileAnchorX)*p),y:Math.floor((l.canonical.y*c.EXTENT+t.tileAnchorY)*p)}}findMatches(t,l,p){const _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let v=0;v<t.length;v++){const E=t.get(v);if(E.crossTileID)continue;const S=this.indexedSymbolInstances[E.key];if(!S)continue;const R=this.getScaledCoordinates(E,l);for(const z of S)if(Math.abs(z.coord.x-R.x)<=_&&Math.abs(z.coord.y-R.y)<=_&&!p[z.crossTileID]){p[z.crossTileID]=!0,E.crossTileID=z.crossTileID;break}}}}class za{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ua{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const l=Math.round((t-this.lng)/360);if(0!==l)for(const p in this.indexes){const _=this.indexes[p],v={};for(const E in _){const S=_[E];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+l),v[S.tileID.key]=S}this.indexes[p]=v}this.lng=t}addBucket(t,l,p){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const _=this.usedCrossTileIDs[t.overscaledZ];for(const v in this.indexes){const E=this.indexes[v];if(Number(v)>t.overscaledZ)for(const S in E){const R=E[S];R.tileID.isChildOf(t)&&R.findMatches(l.symbolInstances,t,_)}else{const S=E[t.scaledTo(Number(v)).key];S&&S.findMatches(l.symbolInstances,t,_)}}for(let v=0;v<l.symbolInstances.length;v++){const E=l.symbolInstances.get(v);E.crossTileID||(E.crossTileID=p.generate(),_[E.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Oa(t,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(t,l){for(const p in l.indexedSymbolInstances)for(const _ of l.indexedSymbolInstances[p])delete this.usedCrossTileIDs[t][_.crossTileID]}removeStaleBuckets(t){let l=!1;for(const p in this.indexes){const _=this.indexes[p];for(const v in _)t[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[v]),delete _[v],l=!0)}return l}}class $s{constructor(){this.layerIndexes={},this.crossTileIDs=new za,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,l,p){let _=this.layerIndexes[t.id];void 0===_&&(_=this.layerIndexes[t.id]=new ua);let v=!1;const E={};_.handleWrapJump(p);for(const S of l){const R=S.getBucket(t);R&&t.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(S.tileID,R,this.crossTileIDs)&&(v=!0),E[R.bucketInstanceId]=!0)}return _.removeStaleBuckets(E)&&(v=!0),v}pruneUnusedLayers(t){const l={};t.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const ha=(d,t)=>c.emitValidationErrors(d,t&&t.filter(l=>"source.canvas"!==l.identifier)),Ba=c.pick(vt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Vl=c.pick(vt,["setCenter","setZoom","setBearing","setPitch"]),Na=function(){const d={},t=c.spec.$version;for(const l in c.spec.$root){const p=c.spec.$root[l];if(p.required){let _=null;_="version"===l?t:"array"===p.type?[]:{},null!=_&&(d[l]=_)}}return d}(),dc={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Gi extends c.Evented{constructor(t,l={}){super(),this.map=t,this.dispatcher=new tn(wt(),this),this.imageManager=new ft,this.imageManager.setEventedParent(this),this.glyphManager=new c.GlyphManager(t._requestManager,l.localFontFamily?c.LocalGlyphMode.all:l.localIdeographFontFamily?c.LocalGlyphMode.ideographs:c.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.lineAtlas=new c.LineAtlas(256,512),this.crossTileSymbolIndex=new $s,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new c.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",c.getReferrer());const p=this;this._rtlTextPluginCallback=Gi.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(v,E)=>{if(c.triggerPluginCompletionEvent(v),E&&E.every(S=>S))for(const S in p._sourceCaches){const R=p._sourceCaches[S],z=R.getSource().type;"vector"!==z&&"geojson"!==z||R.reload()}})}),this.on("data",_=>{if("source"!==_.dataType||"metadata"!==_.sourceDataType)return;const v=this.getSource(_.sourceId);if(v&&v.vectorLayerIds)for(const E in this._layers){const S=this._layers[E];S.source===v.id&&this._validateLayer(S)}})}loadURL(t,l={}){this.fire(new c.Event("dataloading",{dataType:"style"}));const p="boolean"==typeof l.validate?l.validate:!c.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,l.accessToken);const _=this.map._requestManager.transformRequest(t,c.ResourceType.Style);this._request=c.getJSON(_,(v,E)=>{this._request=null,v?this.fire(new c.ErrorEvent(v)):E&&this._load(E,p)})}loadJSON(t,l={}){this.fire(new c.Event("dataloading",{dataType:"style"})),this._request=c.exported.frame(()=>{this._request=null,this._load(t,!1!==l.validate)})}loadEmpty(){this.fire(new c.Event("dataloading",{dataType:"style"})),this._load(Na,!1)}_updateLayerCount(t,l){const p=l?1:-1;t.is3D()&&(this._num3DLayers+=p),"circle"===t.type&&(this._numCircleLayers+=p),"symbol"===t.type&&(this._numSymbolLayers+=p)}_load(t,l){if(l&&ha(this,c.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t,this.updateProjection();for(const _ in t.sources)this.addSource(_,t.sources[_],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const p=Ht(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=c.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Gt(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new c.Event("data",{dataType:"style"})),this.fire(new c.Event("style.load"))}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const t=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0));if(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),t){this.map.painter.clearBackgroundTiles();for(const l in this._sourceCaches)this._sourceCaches[l].clearTiles();this.map._update(!0)}}_loadSprite(t){this._spriteRequest=function(l,p,_){let v,E,S;const R=c.exported.devicePixelRatio>1?"@2x":"";let z=c.getJSON(p.transformRequest(p.normalizeSpriteURL(l,R,".json"),c.ResourceType.SpriteJSON),(Q,oe)=>{z=null,S||(S=Q,v=oe,j())}),N=c.getImage(p.transformRequest(p.normalizeSpriteURL(l,R,".png"),c.ResourceType.SpriteImage),(Q,oe)=>{N=null,S||(S=Q,E=oe,j())});function j(){if(S)_(S);else if(v&&E){const Q=c.exported.getImageData(E),oe={};for(const ie in v){const{width:re,height:pe,x:se,y:me,sdf:_e,pixelRatio:le,stretchX:ye,stretchY:Ee,content:Ze}=v[ie],Ge=new c.RGBAImage({width:re,height:pe});c.RGBAImage.copy(Q,Ge,{x:se,y:me},{x:0,y:0},{width:re,height:pe}),oe[ie]={data:Ge,pixelRatio:le,sdf:_e,stretchX:ye,stretchY:Ee,content:Ze}}_(null,oe)}}return{cancel(){z&&(z.cancel(),z=null),N&&(N.cancel(),N=null)}}}(t,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new c.ErrorEvent(l));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new c.Event("data",{dataType:"style"}))})}_validateLayer(t){const l=this.getSource(t.source);if(!l)return;const p=t.sourceLayer;p&&("geojson"===l.type||l.vectorLayerIds&&-1===l.vectorLayerIds.indexOf(p))&&this.fire(new c.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const l=[];for(const p of t){const _=this._layers[p];"custom"!==_.type&&l.push(_.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&dc[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const l=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(_.length||v.length)&&this._updateWorkerLayers(_,v);for(const E in this._updatedSources){const S=this._updatedSources[E];"reload"===S?this._reloadSource(E):"clear"===S&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const p={};for(const _ in this._sourceCaches){const v=this._sourceCaches[_];p[_]=v.used,v.used=!1}for(const _ of this._order){const v=this._layers[_];if(v.recalculate(t,this._availableImages),!v.isHidden(t.zoom)){const S=this._getLayerSourceCache(v);S&&(S.used=!0)}const E=this.map.painter;if(E){const S=v.getProgramIds();if(!S)continue;const R=v.getProgramConfiguration(t.zoom);for(const z of S)E.useProgram(z,R)}}for(const _ in p){const v=this._sourceCaches[_];p[_]!==v.used&&v.getSource().fire(new c.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new c.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),ha(this,c.validateStyle(t)))return!1;(t=c.clone$2(t)).layers=Ht(t.layers);const l=function(_,v){if(!_)return[{command:vt.setStyle,args:[v]}];let E=[];try{if(!Ve(_.version,v.version))return[{command:vt.setStyle,args:[v]}];Ve(_.center,v.center)||E.push({command:vt.setCenter,args:[v.center]}),Ve(_.zoom,v.zoom)||E.push({command:vt.setZoom,args:[v.zoom]}),Ve(_.bearing,v.bearing)||E.push({command:vt.setBearing,args:[v.bearing]}),Ve(_.pitch,v.pitch)||E.push({command:vt.setPitch,args:[v.pitch]}),Ve(_.sprite,v.sprite)||E.push({command:vt.setSprite,args:[v.sprite]}),Ve(_.glyphs,v.glyphs)||E.push({command:vt.setGlyphs,args:[v.glyphs]}),Ve(_.transition,v.transition)||E.push({command:vt.setTransition,args:[v.transition]}),Ve(_.light,v.light)||E.push({command:vt.setLight,args:[v.light]}),Ve(_.fog,v.fog)||E.push({command:vt.setFog,args:[v.fog]}),Ve(_.projection,v.projection)||E.push({command:vt.setProjection,args:[v.projection]});const S={},R=[];!function(j,Q,oe,ie){let re;for(re in Q=Q||{},j=j||{})j.hasOwnProperty(re)&&(Q.hasOwnProperty(re)||J(re,oe,ie));for(re in Q)Q.hasOwnProperty(re)&&(j.hasOwnProperty(re)?Ve(j[re],Q[re])||("geojson"===j[re].type&&"geojson"===Q[re].type&&Ae(j,Q,re)?oe.push({command:vt.setGeoJSONSourceData,args:[re,Q[re].data]}):ne(re,Q,oe,ie)):W(re,Q,oe))}(_.sources,v.sources,R,S);const z=[];_.layers&&_.layers.forEach(j=>{S[j.source]?E.push({command:vt.removeLayer,args:[j.id]}):z.push(j)});let N=_.terrain;N&&S[N.source]&&(E.push({command:vt.setTerrain,args:[void 0]}),N=void 0),E=E.concat(R),Ve(N,v.terrain)||E.push({command:vt.setTerrain,args:[v.terrain]}),function(j,Q,oe){Q=Q||[];const ie=(j=j||[]).map(yt),re=Q.map(yt),pe=j.reduce($t,{}),se=Q.reduce($t,{}),me=ie.slice(),_e=Object.create(null);let le,ye,Ee,Ze,Ge,tt,nt;for(le=0,ye=0;le<ie.length;le++)Ee=ie[le],se.hasOwnProperty(Ee)?ye++:(oe.push({command:vt.removeLayer,args:[Ee]}),me.splice(me.indexOf(Ee,ye),1));for(le=0,ye=0;le<re.length;le++)Ee=re[re.length-1-le],me[me.length-1-le]!==Ee&&(pe.hasOwnProperty(Ee)?(oe.push({command:vt.removeLayer,args:[Ee]}),me.splice(me.lastIndexOf(Ee,me.length-ye),1)):ye++,tt=me[me.length-le],oe.push({command:vt.addLayer,args:[se[Ee],tt]}),me.splice(me.length-le,0,Ee),_e[Ee]=!0);for(le=0;le<re.length;le++)if(Ee=re[le],Ze=pe[Ee],Ge=se[Ee],!_e[Ee]&&!Ve(Ze,Ge))if(Ve(Ze.source,Ge.source)&&Ve(Ze["source-layer"],Ge["source-layer"])&&Ve(Ze.type,Ge.type)){for(nt in je(Ze.layout,Ge.layout,oe,Ee,null,vt.setLayoutProperty),je(Ze.paint,Ge.paint,oe,Ee,null,vt.setPaintProperty),Ve(Ze.filter,Ge.filter)||oe.push({command:vt.setFilter,args:[Ee,Ge.filter]}),Ve(Ze.minzoom,Ge.minzoom)&&Ve(Ze.maxzoom,Ge.maxzoom)||oe.push({command:vt.setLayerZoomRange,args:[Ee,Ge.minzoom,Ge.maxzoom]}),Ze)Ze.hasOwnProperty(nt)&&"layout"!==nt&&"paint"!==nt&&"filter"!==nt&&"metadata"!==nt&&"minzoom"!==nt&&"maxzoom"!==nt&&(0===nt.indexOf("paint.")?je(Ze[nt],Ge[nt],oe,Ee,nt.slice(6),vt.setPaintProperty):Ve(Ze[nt],Ge[nt])||oe.push({command:vt.setLayerProperty,args:[Ee,nt,Ge[nt]]}));for(nt in Ge)Ge.hasOwnProperty(nt)&&!Ze.hasOwnProperty(nt)&&"layout"!==nt&&"paint"!==nt&&"filter"!==nt&&"metadata"!==nt&&"minzoom"!==nt&&"maxzoom"!==nt&&(0===nt.indexOf("paint.")?je(Ze[nt],Ge[nt],oe,Ee,nt.slice(6),vt.setPaintProperty):Ve(Ze[nt],Ge[nt])||oe.push({command:vt.setLayerProperty,args:[Ee,nt,Ge[nt]]}))}else oe.push({command:vt.removeLayer,args:[Ee]}),tt=me[me.lastIndexOf(Ee)+1],oe.push({command:vt.addLayer,args:[Ge,tt]})}(z,v.layers,E)}catch(S){console.warn("Unable to compute style diff:",S),E=[{command:vt.setStyle,args:[v]}]}return E}(this.serialize(),t).filter(_=>!(_.command in Vl));if(0===l.length)return!1;const p=l.filter(_=>!(_.command in Ba));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return l.forEach(_=>{"setTransition"!==_.command&&this[_.command].apply(this,_.args)}),this.stylesheet=t,!0}addImage(t,l){if(this.getImage(t))return this.fire(new c.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,l),this._afterImageUpdated(t)}updateImage(t,l){this.imageManager.updateImage(t,l)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new c.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,l,p={}){if(this._checkLoaded(),void 0!==this.getSource(t))throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(c.validateStyle.source,`sources.${t}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const _=Z(t,l,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:t}));const v=E=>{const S=(E?"symbol:":"other:")+t,R=this._sourceCaches[S]=new c.SourceCache(S,_,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[t]=R,R.style=this,R.onAdd(this.map)};v(!1),"vector"!==l.type&&"geojson"!==l.type||v(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const l=this.getSource(t);if(void 0===l)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===t)return this.fire(new c.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new c.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(t);for(const _ of p)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new c.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,l){this._checkLoaded(),this.getSource(t).setData(l),this._changed=!0}getSource(t){const l=this._getSourceCache(t);return l&&l.getSource()}addLayer(t,l,p={}){this._checkLoaded();const _=t.id;if(this.getLayer(_))return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let v;if("custom"===t.type){if(ha(this,c.validateCustomStyleLayer(t)))return;v=c.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(_,t.source),t=c.clone$2(t),t=c.extend(t,{source:_})),this._validate(c.validateStyle.layer,`layers.${_}`,t,{arrayIndex:-1},p))return;v=c.createStyleLayer(t),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const E=l?this._order.indexOf(l):this._order.length;if(l&&-1===E)return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(E,0,_),this._layerOrderChanged=!0,this._layers[_]=v;const S=this._getLayerSourceCache(v);if(this._removedLayers[_]&&v.source&&S&&"custom"!==v.type){const R=this._removedLayers[_];delete this._removedLayers[_],R.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",S.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,l){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new c.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===l)return;const p=this._order.indexOf(t);this._order.splice(p,1);const _=l?this._order.indexOf(l):this._order.length;l&&-1===_?this.fire(new c.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(_,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const l=this._layers[t];if(!l)return void this.fire(new c.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const p=this._order.indexOf(t);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=l,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const l in this._layers)if(this._layers[l].type===t)return!0;return!1}setLayerZoomRange(t,l,p){this._checkLoaded();const _=this.getLayer(t);_?_.minzoom===l&&_.maxzoom===p||(null!=l&&(_.minzoom=l),null!=p&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new c.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,l,p={}){this._checkLoaded();const _=this.getLayer(t);if(_){if(!Ve(_.filter,l))return null==l?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(c.validateStyle.filter,`layers.${_.id}.filter`,l,{layerType:_.type},p)||(_.filter=c.clone$2(l),this._updateLayer(_)))}else this.fire(new c.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){return c.clone$2(this.getLayer(t).filter)}setLayoutProperty(t,l,p,_={}){this._checkLoaded();const v=this.getLayer(t);v?Ve(v.getLayoutProperty(l),p)||(v.setLayoutProperty(l,p,_),this._updateLayer(v)):this.fire(new c.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,l){const p=this.getLayer(t);if(p)return p.getLayoutProperty(l);this.fire(new c.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,l,p,_={}){this._checkLoaded();const v=this.getLayer(t);v?Ve(v.getPaintProperty(l),p)||(v.setPaintProperty(l,p,_)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new c.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,l){return this.getLayer(t).getPaintProperty(l)}setFeatureState(t,l){this._checkLoaded();const p=t.source,_=t.sourceLayer,v=this.getSource(p);if(void 0===v)return void this.fire(new c.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const E=v.type;if("geojson"===E&&_)return void this.fire(new c.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===E&&!_)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(p);for(const R of S)R.setFeatureState(_,t.id,l)}removeFeatureState(t,l){this._checkLoaded();const p=t.source,_=this.getSource(p);if(void 0===_)return void this.fire(new c.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const v=_.type,E="vector"===v?t.sourceLayer:void 0;if("vector"===v&&!E)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new c.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(p);for(const R of S)R.removeFeatureState(E,t.id,l)}getFeatureState(t){this._checkLoaded();const l=t.source,p=t.sourceLayer,_=this.getSource(l);if(void 0!==_){if("vector"!==_.type||p)return void 0===t.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(p,t.id);this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new c.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return c.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();t[p.id]||(t[p.id]=p.serialize())}return c.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},l=>void 0!==l)}_updateLayer(t){this._updatedLayers[t.id]=!0;const l=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&l&&"raster"!==l.getSource().type&&(this._updatedSources[t.source]="reload",l.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const l=E=>"fill-extrusion"===this._layers[E].type,p={},_=[];for(let E=this._order.length-1;E>=0;E--){const S=this._order[E];if(l(S)){p[S]=E;for(const R of t){const z=R[S];if(z)for(const N of z)_.push(N)}}}_.sort((E,S)=>S.intersectionZ-E.intersectionZ);const v=[];for(let E=this._order.length-1;E>=0;E--){const S=this._order[E];if(l(S))for(let R=_.length-1;R>=0;R--){const z=_[R].feature;if(p[z.layer.id]<E)break;v.push(z),_.pop()}else for(const R of t){const z=R[S];if(z)for(const N of z)v.push(N.feature)}}return v}queryRenderedFeatures(t,l,p){l&&l.filter&&this._validate(c.validateStyle.filter,"queryRenderedFeatures.filter",l.filter,null,l);const _={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new c.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const R of l.layers){const z=this._layers[R];if(!z)return this.fire(new c.ErrorEvent(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];_[z.source]=!0}}const v=[];l.availableImages=this._availableImages;const E=l&&l.layers?l.layers.some(R=>{const z=this.getLayer(R);return z&&z.is3D()}):this.has3DLayers(),S=ri.createFromScreenPoints(t,p);for(const R in this._sourceCaches){const z=this._sourceCaches[R].getSource().id;l.layers&&!_[z]||v.push(he(this._sourceCaches[R],this._layers,this._serializedLayers,S,l,p,E,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(R,z,N,j,Q,oe,ie){const re={},pe=oe.queryRenderedSymbols(j),se=[];for(const me of Object.keys(pe).map(Number))se.push(ie[me]);se.sort(ke);for(const me of se){const _e=me.featureIndex.lookupSymbolFeatures(pe[me.bucketInstanceId],z,me.bucketIndex,me.sourceLayerIndex,Q.filter,Q.layers,Q.availableImages,R);for(const le in _e){const ye=re[le]=re[le]||[],Ee=_e[le];Ee.sort((Ze,Ge)=>{const tt=me.featureSortOrder;if(tt){const nt=tt.indexOf(Ze.featureIndex);return tt.indexOf(Ge.featureIndex)-nt}return Ge.featureIndex-Ze.featureIndex});for(const Ze of Ee)ye.push(Ze)}}for(const me in re)re[me].forEach(_e=>{const le=_e.feature,ye=N(R[me]).getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=ye});return re}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(t,l){l&&l.filter&&this._validate(c.validateStyle.filter,"querySourceFeatures.filter",l.filter,null,l);const p=this._getSourceCaches(t);let _=[];for(const v of p)_=_.concat(xe(v,l));return _}addSourceType(t,l,p){return Gi.getSourceType(t)?p(new Error(`A source type called "${t}" already exists.`)):(Gi.setSourceType(t,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:l.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(t,l={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const E in t)if(!Ve(t[E],p[E])){_=!0;break}if(!_)return;const v={now:c.exported.now(),transition:c.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,l),this.light.updateTransitions(v)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(t){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof t.source){const l="terrain-dem-src";this.addSource(l,t.source),t=c.clone$2(t),t=c.extend(t,{source:l})}if(!this._validate(c.validateStyle.terrain,"terrain",t)){if(this.terrain){const l=this.terrain,p=l.get();for(const _ in t)if(!Ve(t[_],p[_])){l.set(t),this.stylesheet.terrain=t;const v={now:c.exported.now(),transition:c.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(v);break}}else this._createTerrain(t);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(t){const l=this.fog=new $e(t,this.map.transform);this.stylesheet.fog=t;const p={now:c.exported.now(),transition:c.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(p)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,p=l.get();for(const _ in t)if(!Ve(t[_],p[_])){l.set(t),this.stylesheet.fog=t;const v={now:c.exported.now(),transition:c.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(v);break}}else this._createFog(t);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(p=>this.isLayerDraped(this._layers[p])),l=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...l)}_createTerrain(t){const l=this.terrain=new Be(t);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const p={now:c.exported.now(),transition:c.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(p)}_force3DLayerUpdate(){for(const t in this._layers){const l=this._layers[t];"fill-extrusion"===l.type&&this._updateLayer(l)}}_validate(t,l,p,_,v={}){return(!v||!1!==v.validate)&&ha(this,t.call(c.validateStyle,c.extend({key:l,style:this.serialize(),value:p,styleSpec:c.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const l=this._getSourceCaches(t);for(const p of l)p.clearTiles()}_reloadSource(t){const l=this._getSourceCaches(t);for(const p of l)p.resume(),p.reload()}_updateSources(t){for(const l in this._sourceCaches)this._sourceCaches[l].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const l=this._sourceCaches[t];l.resume(),l.reload()}}_updatePlacement(t,l,p,_,v=!1){let E=!1,S=!1;const R={};for(const z of this._order){const N=this._layers[z];if("symbol"!==N.type)continue;if(!R[N.source]){const Q=this._getLayerSourceCache(N);if(!Q)continue;R[N.source]=Q.getRenderableIds(!0).map(oe=>Q.getTileByID(oe)).sort((oe,ie)=>ie.tileID.overscaledZ-oe.tileID.overscaledZ||(oe.tileID.isLessThan(ie.tileID)?-1:1))}const j=this.crossTileSymbolIndex.addLayer(N,R[N.source],t.center.lng);E=E||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||0===p,this._layerOrderChanged&&this.fire(new c.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.exported.now(),t.zoom))&&(this.pauseablePlacement=new rs(t,this._order,v,l,p,_,this.placement,this.fog&&!this.fog.isSoftDisabled()?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.exported.now()),S=!0),E&&this.pauseablePlacement.placement.setStale()),S||E)for(const z of this._order){const N=this._layers[z];"symbol"===N.type&&this.placement.updateLayerOpacities(N,R[N.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,l,p){this.imageManager.getImages(l.icons,p),this._updateTilesForChangedImages();const _=v=>{v&&v.setDependencies(l.tileID.key,l.type,l.icons)};_(this._otherSourceCaches[l.source]),_(this._symbolSourceCaches[l.source])}getGlyphs(t,l,p){this.glyphManager.getGlyphs(l.stacks,p)}getResource(t,l,p){return c.makeRequest(l,p)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const l=[];return this._otherSourceCaches[t]&&l.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&l.push(this._symbolSourceCaches[t]),l}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}}Gi.getSourceType=function(d){return V[d]},Gi.setSourceType=function(d,t){V[d]=t},Gi.registerForPluginStateChange=c.registerForPluginStateChange;var da="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Gs="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let zo={},Hs={};zo=zn("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else \nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Hs=zn("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Co=zn("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Zs=da;var ho={background:zn("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:zn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:zn("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:zn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:zn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));vec3 globePos=a_pos_3+xAxis*extrude.x+yAxis*extrude.y+elevationVector(tilePos)*elevation(tilePos);vec3 mercPos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+xAxis*extrude.x+yAxis*extrude.y;vec3 pos=mix_globe_mercator(globePos,mercPos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:zn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:zn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:zn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:zn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:zn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:zn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:zn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:zn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:zn("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:zn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:zn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:zn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:zn("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:zn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:zn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:zn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:zn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:zn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:zn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:zn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:zn("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Gs),skyboxGradient:zn("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Gs),skyboxCapture:zn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:zn("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:zn("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:zn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying float v_depth;void main() {vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);v_depth=gl_Position.z/gl_Position.w;}")};function zn(d,t,l){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,v=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),E=d.match(_),S=t.match(_),R=da.match(_);let z=S?S.concat(E):E;l||(zo.staticUniforms&&(z=zo.staticUniforms.concat(z)),Hs.staticUniforms&&(z=Hs.staticUniforms.concat(z))),z&&(z=z.concat(R));const N={};return{fragmentSource:d=d.replace(p,(j,Q,oe,ie,re)=>(N[re]=!0,"define"===Q?`\n#ifndef HAS_UNIFORM_u_${re}\nvarying ${oe} ${ie} ${re};\n#else\nuniform ${oe} ${ie} u_${re};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${re}\n    ${oe} ${ie} ${re} = u_${re};\n#endif\n`)),vertexSource:t=t.replace(p,(j,Q,oe,ie,re)=>{const pe="float"===ie?"vec2":"vec4",se=re.match(/color/)?"color":pe;return N[re]?"define"===Q?`\n#ifndef HAS_UNIFORM_u_${re}\nuniform lowp float u_${re}_t;\nattribute ${oe} ${pe} a_${re};\nvarying ${oe} ${ie} ${re};\n#else\nuniform ${oe} ${ie} u_${re};\n#endif\n`:"vec4"===se?`\n#ifndef HAS_UNIFORM_u_${re}\n    ${re} = a_${re};\n#else\n    ${oe} ${ie} ${re} = u_${re};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${re}\n    ${re} = unpack_mix_${se}(a_${re}, u_${re}_t);\n#else\n    ${oe} ${ie} ${re} = u_${re};\n#endif\n`:"define"===Q?`\n#ifndef HAS_UNIFORM_u_${re}\nuniform lowp float u_${re}_t;\nattribute ${oe} ${pe} a_${re};\n#else\nuniform ${oe} ${ie} u_${re};\n#endif\n`:"vec4"===se?`\n#ifndef HAS_UNIFORM_u_${re}\n    ${oe} ${ie} ${re} = a_${re};\n#else\n    ${oe} ${ie} ${re} = u_${re};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${re}\n    ${oe} ${ie} ${re} = unpack_mix_${se}(a_${re}, u_${re}_t);\n#else\n    ${oe} ${ie} ${re} = u_${re};\n#endif\n`}),staticAttributes:v,staticUniforms:z}}class qs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,l,p,_,v,E,S,R){this.context=t;let z=this.boundPaintVertexBuffers.length!==_.length;for(let N=0;!z&&N<_.length;N++)this.boundPaintVertexBuffers[N]!==_[N]&&(z=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===l&&this.boundLayoutVertexBuffer===p&&!z&&this.boundIndexBuffer===v&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===R?(t.bindVertexArrayOES.set(this.vao),S&&S.bind(),v&&v.dynamicDraw&&v.bind(),R&&R.bind()):this.freshBind(l,p,_,v,E,S,R)}freshBind(t,l,p,_,v,E,S){let R;const z=t.numAttributes,N=this.context,j=N.gl;if(N.extVertexArrayObject)this.vao&&this.destroy(),this.vao=N.extVertexArrayObject.createVertexArrayOES(),N.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=t,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=S;else{R=N.currentNumAttributes||0;for(let Q=z;Q<R;Q++)j.disableVertexAttribArray(Q)}l.enableAttributes(j,t);for(const Q of p)Q.enableAttributes(j,t);E&&E.enableAttributes(j,t),S&&S.enableAttributes(j,t),l.bind(),l.setVertexAttribPointers(j,t,v);for(const Q of p)Q.bind(),Q.setVertexAttribPointers(j,t,v);E&&(E.bind(),E.setVertexAttribPointers(j,t,v)),_&&_.bind(),S&&(S.bind(),S.setVertexAttribPointers(j,t,v)),N.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function fa(d,t){const l=Math.pow(2,t.canonical.z),p=t.canonical.y;return[new c.MercatorCoordinate(0,p/l).toLngLat().lat,new c.MercatorCoordinate(0,(p+1)/l).toLngLat().lat]}function fl(d,t,l,p,_,v,E){const S=d.context,R=S.gl,z=l.fbo;if(!z)return;d.prepareDrawTile(t);const N=d.useProgram("hillshade");S.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,z.colorAttachment.get());const j=((re,pe,se,me)=>{const _e=se.paint.get("hillshade-shadow-color"),le=se.paint.get("hillshade-highlight-color"),ye=se.paint.get("hillshade-accent-color");let Ee=se.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===se.paint.get("hillshade-illumination-anchor")&&(Ee-=re.transform.angle);const Ze=!re.options.moving;return{u_matrix:me||re.transform.calculateProjMatrix(pe.tileID.toUnwrapped(),Ze),u_image:0,u_latrange:fa(0,pe.tileID),u_light:[se.paint.get("hillshade-exaggeration"),Ee],u_shadow:_e,u_highlight:le,u_accent:ye}})(d,l,p,d.terrain?t.projMatrix:null);d.prepareDrawProgram(S,N,t.toUnwrapped());const{tileBoundsBuffer:Q,tileBoundsIndexBuffer:oe,tileBoundsSegments:ie}=d.getTileBoundsBuffers(l);N.draw(S,R.TRIANGLES,_,v,E,c.CullFaceMode.disabled,j,p.id,Q,oe,ie)}function Es(d,t,l){if(!t.needsDEMTextureUpload)return;const p=d.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||d.getTileTexture(l.stride);const v=l.getPixels();t.demTexture?t.demTexture.update(v,{premultiply:!1}):t.demTexture=new c.Texture(p,v,_.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Ki(d,t,l,p,_,v){const E=d.context,S=E.gl;if(!t.dem)return;const R=t.dem;if(E.activeTexture.set(S.TEXTURE1),Es(d,t,R),!t.demTexture)return;t.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const z=R.dim;E.activeTexture.set(S.TEXTURE0);let N=t.fbo;if(!N){const ie=new c.Texture(E,{width:z,height:z,data:null},S.RGBA);ie.bind(S.LINEAR,S.CLAMP_TO_EDGE),N=t.fbo=E.createFramebuffer(z,z,!0),N.colorAttachment.set(ie.texture)}E.bindFramebuffer.set(N.framebuffer),E.viewport.set([0,0,z,z]);const{tileBoundsBuffer:j,tileBoundsIndexBuffer:Q,tileBoundsSegments:oe}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(E,S.TRIANGLES,p,_,v,c.CullFaceMode.disabled,((ie,re)=>{const pe=re.stride,se=c.create$1();return c.ortho(se,0,c.EXTENT,-c.EXTENT,0,0,1),c.translate(se,se,[0,-c.EXTENT,0]),{u_matrix:se,u_image:1,u_dimension:[pe,pe],u_zoom:ie.overscaledZ,u_unpack:re.unpackVector}})(t.tileID,R),l.id,j,Q,oe),t.needsHillshadePrepare=!1}const Vn=(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_image0:new c.Uniform1i(d,t.u_image0),u_skirt_height:new c.Uniform1f(d,t.u_skirt_height)}),fo=(d,t)=>({u_matrix:d,u_image0:0,u_skirt_height:t}),is=new class{constructor(){this.operations={}}newMorphing(d,t,l,p,_){if(d in this.operations){const v=this.operations[d];v.to.tileID.key!==l.tileID.key&&(v.queued=l)}else this.operations[d]={startTime:p,phase:0,duration:_,from:t,to:l,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const t=this.operations[d];return{from:t.from,to:t.to,phase:t.phase}}update(d){for(const t in this.operations){const l=this.operations[t];for(l.phase=(d-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,d)){delete this.operations[t];break}}}_nextOp(d,t){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=t,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Ua={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Qi(d,t){const l=1<<d.z;return!t&&(0===d.x||d.x===l-1)||0===d.y||d.y===l-1}const os=d=>({u_matrix:d});function O(d,t,l,p,_){if(_>0){const v=c.exported.now(),E=(v-d.timeAdded)/_,S=t?(v-t.timeAdded)/_:-1,R=l.getSource(),z=p.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),N=!t||Math.abs(t.tileID.overscaledZ-z)>Math.abs(d.tileID.overscaledZ-z),j=N&&d.refreshedUponExpiration?1:c.clamp(N?E:1-S,0,1);return d.refreshedUponExpiration&&E>=1&&(d.refreshedUponExpiration=!1),t?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}class K extends c.SourceCache{constructor(t){const l=Z("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new tn(wt(),null),t.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,l,p){if(t.freezeTileCoverage)return;this.transform=t;const _=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,E)=>{if(v[E.key]="",!this._tiles[E.key]){const S=new c.Tile(E,this._source.tileSize*E.overscaleFactor(),t.tileZoom);S.state="loaded",this._tiles[E.key]=S}return v},{});for(const v in this._tiles)v in _||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(t){const l=this.proxyCachedFBO[t];if(void 0!==l){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class B extends c.OverscaledTileID{constructor(t,l,p){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class te extends c.Elevation{constructor(t,l){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,_,v]=function(R){const z=new c.StructArrayLayout4i8,N=new c.StructArrayLayout3ui6,j=131;z.reserve(17161),N.reserve(33800);const Q=c.EXTENT/128,oe=c.EXTENT+Q/2,ie=oe+Q;for(let pe=-Q;pe<ie;pe+=Q)for(let se=-Q;se<ie;se+=Q){const me=se<0||se>oe||pe<0||pe>oe?24575:0,_e=c.clamp(Math.round(se),0,c.EXTENT),le=c.clamp(Math.round(pe),0,c.EXTENT);z.emplaceBack(_e+me,le,_e,le)}const re=(pe,se)=>{const me=se*j+pe;N.emplaceBack(me+1,me,me+j),N.emplaceBack(me+j,me+j+1,me+1)};for(let pe=1;pe<129;pe++)for(let se=1;se<129;se++)re(se,pe);return[0,129].forEach(pe=>{for(let se=0;se<130;se++)re(se,pe),re(pe,se)}),[z,N,32768]}(),E=t.context;this.gridBuffer=E.createVertexBuffer(p,c.boundsAttributes.members),this.gridIndexBuffer=E.createIndexBuffer(_),this.gridSegments=c.SegmentVector.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=c.SegmentVector.simpleSegment(0,0,p.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new K(l.map),this.orthoMatrix=c.create$1(),c.ortho(this.orthoMatrix,0,c.EXTENT,0,c.EXTENT,0,1);const S=E.gl;this._overlapStencilMode=new c.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(t,l,p){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const _=t.terrain.properties;this.sourceCache=t._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const v=()=>{this.sourceCache.used&&c.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.sourceCache.getSource().tileSize/128,S=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(l,E*S,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),l.updateElevation(!p),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==t.efficiency&&c.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=0===p._centerAltitude&&-1===this.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(p.center),-1),this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=l.getIds().map(R=>{const z=l.getTileByID(R).tileID;return z.projMatrix=p.calculateProjMatrix(z.toUnwrapped()),z});(function(R,z){const N=z.transform.pointCoordinate(z.transform.getCameraPoint()),j=new c.pointGeometry(N.x,N.y);R.sort((Q,oe)=>{if(oe.overscaledZ-Q.overscaledZ)return oe.overscaledZ-Q.overscaledZ;const ie=new c.pointGeometry(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),re=new c.pointGeometry(oe.canonical.x+(1<<oe.canonical.z)*oe.wrap,oe.canonical.y),pe=j.mult(1<<Q.canonical.z);return pe.x-=.5,pe.y-=.5,pe.distSqr(ie)-pe.distSqr(re)})})(_,this.painter),this._previousZoom=p.zoom;const v=this.proxyToSource||{};this.proxyToSource={},_.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const E=this._style._sourceCaches;for(const R in E){const z=E[R];if(!z.used||(z!==this.sourceCache&&(this._findCoveringTileCache[z.id]={}),this._setupProxiedCoordsForOrtho(z,t[R],v),z.usedForTerrain))continue;const N=t[R];z.getSource().reparseOverscaled&&this._assignTerrainTiles(N)}this.proxiedCoords[l.id]=_.map(R=>new B(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=c.exported.now();const S={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const z=this.terrainTileForTile[R.key];if(!z)continue;const N=z.tileID.key;N in S||(this._visibleDemTiles.push(z),S[N]=N)}}_assignTerrainTiles(t){this._initializing||t.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const t=this.painter.context,l=t.gl;for(const p in this.terrainTileForTile){const _=this.terrainTileForTile[p],v=_.dem;!v||_.demTexture&&!_.needsDEMTextureUpload||(t.activeTexture.set(l.TEXTURE1),Es(this.painter,_,v))}}_prepareDemTileUniforms(t,l,p,_){if(!l||null==l.demTexture)return!1;const v=t.tileID.canonical,E=Math.pow(2,l.tileID.canonical.z-v.z),S=_||"";return p[`u_dem_tl${S}`]=[v.x*E%1,v.y*E%1],p[`u_dem_scale${S}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let t=0;const l=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;const v=_.dem.tree.minimums[0];return v>0&&t++,p+v},0);return t?l/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,l=t.gl;t.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),_={width:1,height:1,data:new Uint8Array(c.DEMData.pack(p,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(_,{premultiply:!1}):v=this._emptyDEMTexture=new c.Texture(t,_,l.RGBA,{premultiply:!1}),v}setupElevationDraw(t,l,p){const _=this.painter.context,v=_.gl,E=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:c.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var S;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();let R=null,z=null,N=1;if(p&&p.morphing&&this._useVertexMorphing){const j=p.morphing.srcDemTile,Q=p.morphing.dstDemTile;N=p.morphing.phase,j&&Q&&(this._prepareDemTileUniforms(t,j,E,"_prev")&&(z=j),this._prepareDemTileUniforms(t,Q,E)&&(R=Q))}if(z&&R?(_.activeTexture.set(v.TEXTURE2),R.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),_.activeTexture.set(v.TEXTURE4),z.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),E.u_dem_lerp=N):(R=this.terrainTileForTile[t.tileID.key],_.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(t,R,E)?R.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),p&&p.useDepthForOcclusion&&(_.activeTexture.set(v.TEXTURE3),this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),p&&p.useMeterToDem&&R){const j=(1<<R.tileID.canonical.z)*c.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=j}p&&p.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(_,E)}renderToBackBuffer(t){const l=this.painter,p=this.painter.context;0!==t.length&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),this.renderingToTexture=!1,function(_,v,E,S,R){const z=_.context,N=z.gl;let j,Q;const oe=_.options.showTerrainWireframe?2:0,ie=(_e,le)=>{if(Q===_e)return;const ye=[Ua[_e]];le&&ye.push(Ua[oe]),j=_.useProgram("terrainRaster",null,ye),Q=_e},re=_.colorModeForRenderPass(),pe=new c.DepthMode(N.LEQUAL,c.DepthMode.ReadWrite,_.depthRangeFor3D);is.update(R);const se=_.transform,me=6*Math.pow(1.5,22-se.zoom)*v.exaggeration();(oe?[!1,!0]:[!1]).forEach(_e=>{Q=-1;const le=_e?N.LINES:N.TRIANGLES,[ye,Ee]=_e?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const tt of S){const nt=E.getTile(tt),xt=c.StencilMode.disabled,Xe=v.prevTerrainTileForTile[tt.key],Et=v.terrainTileForTile[tt.key];Ge=Et,null!=(Ze=Xe)&&null!=Ge&&Ze.hasData()&&Ge.hasData()&&null!=Ze.demTexture&&null!=Ge.demTexture&&Ze.tileID.key!==Ge.tileID.key&&is.newMorphing(tt.key,Xe,Et,R,250),z.activeTexture.set(N.TEXTURE0),nt.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const Ne=is.getMorphValuesForProxy(tt.key),St=Ne?1:0;let jt;Ne&&(jt={morphing:{srcDemTile:Ne.from,dstDemTile:Ne.to,phase:c.easeCubicInOut(Ne.phase)}});const un=fo(tt.projMatrix,Qi(tt.canonical,se.renderWorldCopies)?me/10:me);ie(St,_e),v.setupElevationDraw(nt,j,jt),_.prepareDrawProgram(z,j,tt.toUnwrapped()),j.draw(z,le,pe,xt,re,c.CullFaceMode.backCCW,un,"terrain_raster",v.gridBuffer,ye,Ee)}var Ze,Ge})}(l,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,_=this.proxySourceCache,v=this.proxiedCoords[_.id],E=this._drapedRenderBatches.shift(),S=[],R=l.style.order;let z=0;for(const N of v){const j=_.getTileByID(N.proxyTileKey),Q=_.proxyCachedFBO[N.key]?_.proxyCachedFBO[N.key][t]:void 0,oe=void 0!==Q?_.renderCache[Q]:this.pool[z++],ie=void 0!==Q;if(j.texture=oe.tex,ie&&!oe.dirty){S.push(j.tileID);continue}let re;p.bindFramebuffer.set(oe.fb.framebuffer),this.renderedToTile=!1,oe.dirty&&(p.clear({color:c.Color.transparent}),oe.dirty=!1);for(let pe=E.start;pe<=E.end;++pe){const se=l.style._layers[R[pe]];if(se.isHidden(l.transform.zoom))continue;const me=l.style._getLayerSourceCache(se),_e=me?this.proxyToSource[N.key][me.id]:[N];if(!_e)continue;const le=_e;p.viewport.set([0,0,oe.fb.width,oe.fb.height]),re!==(me?me.id:null)&&(this._setupStencil(oe,_e,se,me),re=me?me.id:null),l.renderLayer(l,me,se,le)}this.renderedToTile?(oe.dirty=!0,S.push(j.tileID)):ie||--z,5===z&&(z=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),E.end+1}postRender(){}renderCacheEfficiency(t){const l=t.order.length;if(0===l)return{efficiency:100};let p,_=0,v=0,E=!1;for(let S=0;S<l;++S){const R=t._layers[t.order[S]];this._style.isLayerDraped(R)?(E&&++_,++v):E||(E=!0,p=R.id)}return 0===v?{efficiency:100}:{efficiency:100*(1-_/v),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{t=Math.min(t,l.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(t,l,p){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const E=v.tileID,S=Math.pow(2,E.overscaledZ),{x:R,y:z}=E.canonical,N=R/S,j=(R+1)/S,Q=z/S,oe=(z+1)/S;return{minx:N,miny:Q,maxx:j,maxy:oe,t:v.dem.tree.raycastRoot(N,Q,j,oe,t,l,p),tile:v}});_.sort((v,E)=>(null!==v.t?v.t:Number.MAX_VALUE)-(null!==E.t?E.t:Number.MAX_VALUE));for(const v of _){if(null==v.t)return null;const E=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,t,l,p);if(null!=E)return E}return null}_createFBO(){const t=this.painter.context,l=t.gl,p=this.drapeBufferSize;t.activeTexture.set(l.TEXTURE0);const _=new c.Texture(t,{width:p[0],height:p[1],data:null},l.RGBA);_.bind(l.LINEAR,l.CLAMP_TO_EDGE);const v=t.createFramebuffer(p[0],p[1],!1);return v.colorAttachment.set(_.texture),v.depthAttachment=new Wn(t,v.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:v,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const l=this._style._layers[t],p=l.isHidden(this.painter.transform.zoom),_=l.getCrossfadeParameters(),v=!!_&&1!==_.t,E=l.hasTransition();return"custom"!==l.type&&!p&&(v||E)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l]._source instanceof Ai){t=!0;break}if(t)for(let l=0;l<this._style.order.length;++l){const p=this._style._layers[this._style.order[l]],_=p.isHidden(this.painter.transform.zoom),v=this._style._getLayerSourceCache(p);if("raster"!==p.type||_||!v)continue;const E=p.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const R=this.proxyToSource[S.key][v.id];if(R)for(const z of R){const N=O(v.getTile(z),v.findLoadedParent(z,0),v,this.painter.transform,E);(1!==N.opacity||0!==N.mix)&&this._clearRenderCacheForTile(v.id,z)}}}}_setupDrapedRenderBatches(){const t=this._style.order,l=t.length;if(0===l)return;const p=[];let _,v=0,E=this._style._layers[t[v]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++v<l;)E=this._style._layers[t[v]];for(;v<l;++v){const S=this._style._layers[t[v]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?void 0===_&&(_=v):void 0!==_&&(p.push({start:_,end:v-1}),_=void 0))}void 0!==_&&p.push({start:_,end:v-1}),this._drapedRenderBatches=p}_setupRenderCache(t){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const E=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let S=0;S<E.length;++S){const R=Object.values(E[S]);l.renderCachePool.push(...R)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,_=this._tilesDirty;for(let E=p.length-1;E>=0;E--){const S=p[E];if(l.getTileByID(S.key),void 0!==l.proxyCachedFBO[S.key]){const R=t[S.key],z=this.proxyToSource[S.key];let N=0;for(const j in z){const Q=z[j],oe=R[j];if(!oe||oe.length!==Q.length||Q.some((ie,re)=>ie!==oe[re]||_[j]&&_[j].hasOwnProperty(ie.key))){N=-1;break}++N}for(const j in l.proxyCachedFBO[S.key])l.renderCache[l.proxyCachedFBO[S.key][j]].dirty=N<0||N!==Object.values(R).length}}const v=[...this._drapedRenderBatches];v.sort((E,S)=>S.end-S.start-(E.end-E.start));for(const E of v)for(const S of p){if(l.proxyCachedFBO[S.key])continue;let R=l.renderCachePool.pop();void 0===R&&l.renderCache.length<50&&(R=l.renderCache.length,l.renderCache.push(this._createFBO())),void 0!==R&&(l.proxyCachedFBO[S.key]={},l.proxyCachedFBO[S.key][E.start]=R,l.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(t,l,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,E=v.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let S;if(p.isTileClipped())S=l.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):c.StencilMode.disabled}_renderTileClippingMasks(t,l){const p=this.painter,_=this.painter.context,v=_.gl;p._tileClippingMaskIDs={},_.setColorMode(c.ColorMode.disabled),_.setDepthMode(c.DepthMode.disabled);const E=p.useProgram("clippingMask");for(const S of t){const R=p._tileClippingMaskIDs[S.key]=--l;E.draw(_,v.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:v.ALWAYS,mask:0},R,255,v.KEEP,v.KEEP,v.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,os(S.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(t){const l=this.painter.transform;if(t.x<0||t.x>l.width||t.y<0||t.y>l.height)return null;const p=[t.x,t.y,1,1];c.transformMat4(p,p,l.pixelMatrixInverse),c.scale$2(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const _=l._camera.position,v=c.mercatorZfromAltitude(1,l.center.lat),E=[_[0],_[1],_[2]/v,0],S=c.subtract([],p.slice(0,3),E);c.normalize(S,S);const R=this.raycast(E,S,this._exaggeration);return null!==R&&R?(c.scaleAndAdd(E,E,S,R),E[3]=E[2],E[2]*=v,E):null}drawDepth(){const t=this.painter,l=t.context,p=this.proxySourceCache,_=Math.ceil(t.width),v=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===v||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const E=l.gl,S=l.createFramebuffer(_,v,!0);l.activeTexture.set(E.TEXTURE0);const R=new c.Texture(l,{width:_,height:v,data:null},E.RGBA);R.bind(E.NEAREST,E.CLAMP_TO_EDGE),S.colorAttachment.set(R.texture);const z=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,_,v);S.depthAttachment.set(z),this._depthFBO=S,this._depthTexture=R}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,_,v]),function(E,S,R,z){const N=E.context,j=N.gl;N.clear({depth:1});const Q=E.useProgram("terrainDepth"),oe=new c.DepthMode(j.LESS,c.DepthMode.ReadWrite,E.depthRangeFor3D);for(const ie of z){const re=R.getTile(ie),pe=fo(ie.projMatrix,0);S.setupElevationDraw(re,Q),Q.draw(N,j.TRIANGLES,oe,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.backCCW,pe,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(t,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,l,p){if(t.getSource()instanceof ae)return this._setupProxiedCoordsForImageSource(t,l,p);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const _=this.proxiedCoords[t.id]=[],v=this.proxyCoords;for(let S=0;S<v.length;S++){const R=v[S],z=this._findTileCoveringTileID(R,t);if(z){const N=this._createProxiedId(R,z,p[R.key]&&p[R.key][t.id]);_.push(N),this.proxyToSource[R.key][t.id]=[N]}}let E=!1;for(let S=0;S<l.length;S++){const R=t.getTile(l[S]);if(!R||!R.hasData())continue;const z=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==R.tileID.canonical.z){const N=this.proxyToSource[z.tileID.key][t.id],j=this._createProxiedId(z.tileID,R,p[z.tileID.key]&&p[z.tileID.key][t.id]);N?N.splice(N.length-1,0,j):this.proxyToSource[z.tileID.key][t.id]=[j],_.push(j),E=!0}}this._sourceTilesOverlap[t.id]=E}_setupProxiedCoordsForImageSource(t,l,p){if(!t.getSource().loaded())return;const _=this.proxiedCoords[t.id]=[],v=this.proxyCoords,E=t.getSource(),S=new c.pointGeometry(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),R=E.coordinates.map(c.MercatorCoordinate.fromLngLat).reduce((N,j)=>(N.min.x=Math.min(N.min.x,j.x-S.x),N.min.y=Math.min(N.min.y,j.y-S.y),N.max.x=Math.max(N.max.x,j.x-S.x),N.max.y=Math.max(N.max.y,j.y-S.y),N),{min:new c.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new c.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(N,j)=>{const Q=N.wrap+N.canonical.x/(1<<N.canonical.z),oe=N.canonical.y/(1<<N.canonical.z),ie=c.EXTENT/(1<<N.canonical.z),re=j.wrap+j.canonical.x/(1<<j.canonical.z),pe=j.canonical.y/(1<<j.canonical.z);return Q+ie<re+R.min.x||Q>re+R.max.x||oe+ie<pe+R.min.y||oe>pe+R.max.y};for(let N=0;N<v.length;N++){const j=v[N];for(let Q=0;Q<l.length;Q++){const oe=t.getTile(l[Q]);if(!oe||!oe.hasData()||z(j,oe.tileID))continue;const ie=this._createProxiedId(j,oe,p[j.key]&&p[j.key][t.id]),re=this.proxyToSource[j.key][t.id];re?re.push(ie):this.proxyToSource[j.key][t.id]=[ie],_.push(ie)}}}_createProxiedId(t,l,p){let _=this.orthoMatrix;if(p){const v=p.find(E=>E.key===l.tileID.key);if(v)return v}if(l.tileID.key!==t.key){const v=t.canonical.z-l.tileID.canonical.z;let E,S,R;_=c.create$1();const z=l.tileID.wrap-t.wrap<<t.overscaledZ;v>0?(E=c.EXTENT>>v,S=E*((l.tileID.canonical.x<<v)-t.canonical.x+z),R=E*((l.tileID.canonical.y<<v)-t.canonical.y)):(E=c.EXTENT<<-v,S=c.EXTENT*(l.tileID.canonical.x-(t.canonical.x+z<<-v)),R=c.EXTENT*(l.tileID.canonical.y-(t.canonical.y<<-v))),c.ortho(_,0,E,0,E,0,1),c.translate(_,_,[S,R,0])}return new B(l.tileID,t.key,_)}_findTileCoveringTileID(t,l){let p=l.getTile(t);if(p&&p.hasData())return p;const _=this._findCoveringTileCache[l.id],v=_[t.key];if(p=v?l.getTileByID(v):null,p&&p.hasData()||null===v)return p;let E=p?p.tileID:t,S=E.overscaledZ;const R=l.getSource().minzoom,z=[];if(!v){const j=l.getSource().maxzoom;if(t.canonical.z>=j){const Q=t.canonical.z-j;l.getSource().reparseOverscaled?(S=Math.max(t.canonical.z+2,l.transform.tileZoom),E=new c.OverscaledTileID(S,t.wrap,j,t.canonical.x>>Q,t.canonical.y>>Q)):0!==Q&&(S=j,E=new c.OverscaledTileID(S,t.wrap,j,t.canonical.x>>Q,t.canonical.y>>Q))}E.key!==t.key&&(z.push(E.key),p=l.getTile(E))}const N=j=>{z.forEach(Q=>{_[Q]=j}),z.length=0};for(S-=1;S>=R&&(!p||!p.hasData());S--){p&&N(p.tileID.key);const j=E.calculateScaledKey(S);if(p=l.getTileByID(j),p&&p.hasData())break;const Q=_[j];if(null===Q)break;void 0===Q?z.push(j):p=l.getTileByID(Q)}return N(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(t){this.renderedToTile=!0}_clearRenderCacheForTile(t,l){let p=this._tilesDirty[t];p||(p=this._tilesDirty[t]={}),p[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(l){let p,_,v;const E=new c.StructArrayLayout2ui4,S=131;for(_=1;_<129;_++){for(p=1;p<129;p++)v=_*S+p,E.emplaceBack(v,v+1),E.emplaceBack(v,v+S),E.emplaceBack(v+1,v+S),128===_&&E.emplaceBack(v+S,v+S+1);E.emplaceBack(v+1,v+1+S)}return E}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=c.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function De(d){const t=[];for(let l=0;l<d.length;l++){if(null===d[l])continue;const p=d[l].split(" ");t.push(p.pop())}return t}class et{static cacheKey(t,l,p){let _=`${t}${p?p.cacheKey:""}`;for(const v of l)_+=`/${v}`;return _}constructor(t,l,p,_,v,E){const S=t.gl;this.program=S.createProgram();const R=De(p.staticAttributes),z=_?_.getBinderAttributes():[],N=R.concat(z),j=p.staticUniforms?De(p.staticUniforms):[],Q=_?_.getBinderUniforms():[],oe=j.concat(Q),ie=[];for(const ye of oe)ie.indexOf(ye)<0&&ie.push(ye);let re=_?_.defines():[];re=re.concat(E.map(ye=>`#define ${ye}`));const pe=re.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Zs,Co.fragmentSource,Hs.fragmentSource,p.fragmentSource).join("\n"),se=re.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Zs,Co.vertexSource,Hs.vertexSource,zo.vertexSource,p.vertexSource).join("\n"),me=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(me,pe),S.compileShader(me),S.attachShader(this.program,me);const _e=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(_e,se),S.compileShader(_e),S.attachShader(this.program,_e),this.attributes={};const le={};this.numAttributes=N.length;for(let ye=0;ye<this.numAttributes;ye++)N[ye]&&(S.bindAttribLocation(this.program,ye,N[ye]),this.attributes[N[ye]]=ye);S.linkProgram(this.program),S.deleteShader(_e),S.deleteShader(me);for(let ye=0;ye<ie.length;ye++){const Ee=ie[ye];if(Ee&&!le[Ee]){const Ze=S.getUniformLocation(this.program,Ee);Ze&&(le[Ee]=Ze)}}var ye,Ee;this.fixedUniforms=v(t,le),this.binderUniforms=_?_.getUniforms(t,le):[],-1!==E.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new c.Uniform1i(ye=t,(Ee=le).u_dem),u_dem_prev:new c.Uniform1i(ye,Ee.u_dem_prev),u_dem_unpack:new c.Uniform4f(ye,Ee.u_dem_unpack),u_dem_tl:new c.Uniform2f(ye,Ee.u_dem_tl),u_dem_scale:new c.Uniform1f(ye,Ee.u_dem_scale),u_dem_tl_prev:new c.Uniform2f(ye,Ee.u_dem_tl_prev),u_dem_scale_prev:new c.Uniform1f(ye,Ee.u_dem_scale_prev),u_dem_size:new c.Uniform1f(ye,Ee.u_dem_size),u_dem_lerp:new c.Uniform1f(ye,Ee.u_dem_lerp),u_exaggeration:new c.Uniform1f(ye,Ee.u_exaggeration),u_depth:new c.Uniform1i(ye,Ee.u_depth),u_depth_size_inv:new c.Uniform2f(ye,Ee.u_depth_size_inv),u_meter_to_dem:new c.Uniform1f(ye,Ee.u_meter_to_dem),u_label_plane_matrix_inv:new c.UniformMatrix4f(ye,Ee.u_label_plane_matrix_inv),u_tile_tl_up:new c.Uniform3f(ye,Ee.u_tile_tl_up),u_tile_tr_up:new c.Uniform3f(ye,Ee.u_tile_tr_up),u_tile_br_up:new c.Uniform3f(ye,Ee.u_tile_br_up),u_tile_bl_up:new c.Uniform3f(ye,Ee.u_tile_bl_up),u_tile_up_scale:new c.Uniform1f(ye,Ee.u_tile_up_scale)}),-1!==E.indexOf("FOG")&&(this.fogUniforms=((ye,Ee)=>({u_fog_matrix:new c.UniformMatrix4f(ye,Ee.u_fog_matrix),u_fog_range:new c.Uniform2f(ye,Ee.u_fog_range),u_fog_color:new c.Uniform4f(ye,Ee.u_fog_color),u_fog_horizon_blend:new c.Uniform1f(ye,Ee.u_fog_horizon_blend),u_fog_temporal_offset:new c.Uniform1f(ye,Ee.u_fog_temporal_offset)}))(t,le))}setTerrainUniformValues(t,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in l)p[_].set(l[_])}}setFogUniformValues(t,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in l)p[_].location&&p[_].set(l[_])}}draw(t,l,p,_,v,E,S,R,z,N,j,Q,oe,ie,re,pe){const se=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(p),t.setStencilMode(_),t.setColorMode(v),t.setCullFace(E);for(const _e in this.fixedUniforms)this.fixedUniforms[_e].set(S[_e]);ie&&ie.setUniforms(t,this.binderUniforms,Q,{zoom:oe});const me={[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[l];for(const _e of j.get()){const le=_e.vaos||(_e.vaos={});(le[R]||(le[R]=new qs)).bind(t,this,z,ie?ie.getPaintVertexBuffers():[],N,_e.vertexOffset,re,pe),se.drawElements(l,_e.primitiveLength*me,se.UNSIGNED_SHORT,_e.primitiveOffset*me*2)}}}function mt(d,t,l){const p=1/wn(l,1,t.transform.tileZoom),_=Math.pow(2,l.tileID.overscaledZ),v=l.tileSize*Math.pow(2,t.transform.tileZoom)/_,E=v*(l.tileID.canonical.x+l.tileID.wrap*_),S=v*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[p,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[E>>16,S>>16],u_pixel_coord_lower:[65535&E,65535&S]}}const Kt=(d,t,l,p)=>{const _=t.style.light,v=_.properties.get("position"),E=[v.x,v.y,v.z],S=c.create$2();"viewport"===_.properties.get("anchor")&&(c.fromRotation(S,-t.transform.angle),c.transformMat3(E,E,S));const R=_.properties.get("color");return{u_matrix:d,u_lightpos:E,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+l,u_opacity:p}},xn=(d,t,l,p,_,v,E)=>c.extend(Kt(d,t,l,p),mt(v,t,E),{u_height_factor:-Math.pow(2,_.overscaledZ)/E.tileSize/8}),yr=d=>({u_matrix:d}),er=(d,t,l,p)=>c.extend(yr(d),mt(l,t,p)),Zt=(d,t)=>({u_matrix:d,u_world:t}),Jr=(d,t,l,p,_)=>c.extend(er(d,t,l,p),{u_world:_}),jn=(d,t,l,p)=>{const _=d.transform;let v;return v="map"===p.paint.get("circle-pitch-alignment")?_.calculatePixelsToTileUnitsMatrix(l):new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]),{u_camera_to_center_distance:_.cameraToCenterDistance,u_matrix:d.translatePosMatrix(t.projMatrix,l,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:c.exported.devicePixelRatio,u_extrude_scale:v}},Mr=d=>{const t=[];return"map"===d.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===d.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t},kr=(d,t,l)=>{const p=c.EXTENT/l.tileSize;return{u_matrix:d,u_camera_to_center_distance:t.cameraToCenterDistance,u_extrude_scale:[t.pixelsToGLUnits[0]/p,t.pixelsToGLUnits[1]/p]}},po=(d,t,l=1)=>({u_matrix:d,u_color:t,u_overlay:0,u_overlay_scale:l}),Zo=(d,t,l,p)=>({u_matrix:d,u_extrude_scale:wn(t,1,l),u_intensity:p}),Hi=(d,t,l,p,_,v)=>{const E=d.transform,S=E.calculatePixelsToTileUnitsMatrix(t),R={u_matrix:qo(d,t,l,_),u_pixels_to_tile_units:S,u_device_pixel_ratio:c.exported.devicePixelRatio,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(Ji(l)){const z=To(t,d.transform);R.u_texsize=t.lineAtlasTexture.size,R.u_scale=[z,p.fromScale,p.toScale],R.u_mix=p.t}return R},oi=(d,t,l,p,_)=>{const v=d.transform,E=To(t,v);return{u_matrix:qo(d,t,l,_),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:v.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:c.exported.devicePixelRatio,u_image:0,u_scale:[E,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}};function To(d,t){return 1/wn(d,1,t.tileZoom)}function qo(d,t,l,p){return d.translatePosMatrix(p||t.tileID.projMatrix,t,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const Va=d=>{const t=[];return Ji(d)&&t.push("RENDER_LINE_DASH"),d.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT"),t};function Ji(d){const t=d.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const pl=(d,t,l,p,_)=>{return{u_matrix:d,u_tl_parent:t,u_scale_parent:l,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(E=_.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(v=_.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Bo(_.paint.get("raster-hue-rotate"))};var v,E};function Bo(d){d*=Math.PI/180;const t=Math.sin(d),l=Math.cos(d);return[(2*l+1)/3,(-Math.sqrt(3)*t-l+1)/3,(Math.sqrt(3)*t-l+1)/3]}const bn=(d,t,l,p,_,v,E,S,R,z,N,j,Q,oe)=>{const ie=_.transform;return{u_is_size_zoom_constant:+("constant"===d||"source"===d),u_is_size_feature_constant:+("constant"===d||"camera"===d),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ie.cameraToCenterDistance,u_pitch:ie.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:ie.width/ie.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:E,u_coord_matrix:S,u_is_text:+R,u_pitch_with_map:+p,u_texsize:z,u_tile_id:N,u_zoom_transition:j,u_inv_rot_matrix:Q,u_merc_center:oe,u_texture:0}},Hc=(d,t,l,p,_,v,E,S,R,z,N,j,Q,oe,ie)=>{const{cameraToCenterDistance:re,_pitch:pe}=_.transform;return c.extend(bn(d,t,l,p,_,v,E,S,R,z,j,Q,oe,ie),{u_gamma_scale:p?re*Math.cos(_.terrain?0:pe):1,u_device_pixel_ratio:c.exported.devicePixelRatio,u_is_halo:+N})},Zc=(d,t,l,p,_,v,E,S,R,z,N,j,Q,oe)=>c.extend(Hc(d,t,l,p,_,v,E,S,!0,R,!0,N,j,Q,oe),{u_texsize_icon:z,u_texture_icon:1}),qc=(d,t,l)=>({u_matrix:d,u_opacity:t,u_color:l}),Wc=(d,t,l,p,_,v)=>c.extend(function(E,S,R,z){const N=R.imageManager.getPattern(E.from.toString()),j=R.imageManager.getPattern(E.to.toString()),{width:Q,height:oe}=R.imageManager.getPixelSize(),ie=Math.pow(2,z.tileID.overscaledZ),re=z.tileSize*Math.pow(2,R.transform.tileZoom)/ie,pe=re*(z.tileID.canonical.x+z.tileID.wrap*ie),se=re*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:N.tl,u_pattern_br_a:N.br,u_pattern_tl_b:j.tl,u_pattern_br_b:j.br,u_texsize:[Q,oe],u_mix:S.t,u_pattern_size_a:N.displaySize,u_pattern_size_b:j.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/wn(z,1,R.transform.tileZoom),u_pixel_coord_upper:[pe>>16,se>>16],u_pixel_coord_lower:[65535&pe,65535&se]}}(p,v,l,_),{u_matrix:d,u_opacity:t}),fc={fillExtrusion:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_lightpos:new c.Uniform3f(d,t.u_lightpos),u_lightintensity:new c.Uniform1f(d,t.u_lightintensity),u_lightcolor:new c.Uniform3f(d,t.u_lightcolor),u_vertical_gradient:new c.Uniform1f(d,t.u_vertical_gradient),u_opacity:new c.Uniform1f(d,t.u_opacity)}),fillExtrusionPattern:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_lightpos:new c.Uniform3f(d,t.u_lightpos),u_lightintensity:new c.Uniform1f(d,t.u_lightintensity),u_lightcolor:new c.Uniform3f(d,t.u_lightcolor),u_vertical_gradient:new c.Uniform1f(d,t.u_vertical_gradient),u_height_factor:new c.Uniform1f(d,t.u_height_factor),u_image:new c.Uniform1i(d,t.u_image),u_texsize:new c.Uniform2f(d,t.u_texsize),u_pixel_coord_upper:new c.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.Uniform2f(d,t.u_pixel_coord_lower),u_scale:new c.Uniform3f(d,t.u_scale),u_fade:new c.Uniform1f(d,t.u_fade),u_opacity:new c.Uniform1f(d,t.u_opacity)}),fill:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix)}),fillPattern:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_image:new c.Uniform1i(d,t.u_image),u_texsize:new c.Uniform2f(d,t.u_texsize),u_pixel_coord_upper:new c.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.Uniform2f(d,t.u_pixel_coord_lower),u_scale:new c.Uniform3f(d,t.u_scale),u_fade:new c.Uniform1f(d,t.u_fade)}),fillOutline:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_world:new c.Uniform2f(d,t.u_world)}),fillOutlinePattern:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_world:new c.Uniform2f(d,t.u_world),u_image:new c.Uniform1i(d,t.u_image),u_texsize:new c.Uniform2f(d,t.u_texsize),u_pixel_coord_upper:new c.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.Uniform2f(d,t.u_pixel_coord_lower),u_scale:new c.Uniform3f(d,t.u_scale),u_fade:new c.Uniform1f(d,t.u_fade)}),circle:(d,t)=>({u_camera_to_center_distance:new c.Uniform1f(d,t.u_camera_to_center_distance),u_extrude_scale:new c.UniformMatrix2f(d,t.u_extrude_scale),u_device_pixel_ratio:new c.Uniform1f(d,t.u_device_pixel_ratio),u_matrix:new c.UniformMatrix4f(d,t.u_matrix)}),collisionBox:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_camera_to_center_distance:new c.Uniform1f(d,t.u_camera_to_center_distance),u_extrude_scale:new c.Uniform2f(d,t.u_extrude_scale)}),collisionCircle:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_inv_matrix:new c.UniformMatrix4f(d,t.u_inv_matrix),u_camera_to_center_distance:new c.Uniform1f(d,t.u_camera_to_center_distance),u_viewport_size:new c.Uniform2f(d,t.u_viewport_size)}),debug:(d,t)=>({u_color:new c.UniformColor(d,t.u_color),u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_overlay:new c.Uniform1i(d,t.u_overlay),u_overlay_scale:new c.Uniform1f(d,t.u_overlay_scale)}),clippingMask:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix)}),heatmap:(d,t)=>({u_extrude_scale:new c.Uniform1f(d,t.u_extrude_scale),u_intensity:new c.Uniform1f(d,t.u_intensity),u_matrix:new c.UniformMatrix4f(d,t.u_matrix)}),heatmapTexture:(d,t)=>({u_image:new c.Uniform1i(d,t.u_image),u_color_ramp:new c.Uniform1i(d,t.u_color_ramp),u_opacity:new c.Uniform1f(d,t.u_opacity)}),hillshade:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_image:new c.Uniform1i(d,t.u_image),u_latrange:new c.Uniform2f(d,t.u_latrange),u_light:new c.Uniform2f(d,t.u_light),u_shadow:new c.UniformColor(d,t.u_shadow),u_highlight:new c.UniformColor(d,t.u_highlight),u_accent:new c.UniformColor(d,t.u_accent)}),hillshadePrepare:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_image:new c.Uniform1i(d,t.u_image),u_dimension:new c.Uniform2f(d,t.u_dimension),u_zoom:new c.Uniform1f(d,t.u_zoom),u_unpack:new c.Uniform4f(d,t.u_unpack)}),line:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_pixels_to_tile_units:new c.UniformMatrix2f(d,t.u_pixels_to_tile_units),u_device_pixel_ratio:new c.Uniform1f(d,t.u_device_pixel_ratio),u_units_to_pixels:new c.Uniform2f(d,t.u_units_to_pixels),u_dash_image:new c.Uniform1i(d,t.u_dash_image),u_gradient_image:new c.Uniform1i(d,t.u_gradient_image),u_image_height:new c.Uniform1f(d,t.u_image_height),u_texsize:new c.Uniform2f(d,t.u_texsize),u_scale:new c.Uniform3f(d,t.u_scale),u_mix:new c.Uniform1f(d,t.u_mix)}),linePattern:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_texsize:new c.Uniform2f(d,t.u_texsize),u_pixels_to_tile_units:new c.UniformMatrix2f(d,t.u_pixels_to_tile_units),u_device_pixel_ratio:new c.Uniform1f(d,t.u_device_pixel_ratio),u_image:new c.Uniform1i(d,t.u_image),u_units_to_pixels:new c.Uniform2f(d,t.u_units_to_pixels),u_scale:new c.Uniform3f(d,t.u_scale),u_fade:new c.Uniform1f(d,t.u_fade)}),raster:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_tl_parent:new c.Uniform2f(d,t.u_tl_parent),u_scale_parent:new c.Uniform1f(d,t.u_scale_parent),u_buffer_scale:new c.Uniform1f(d,t.u_buffer_scale),u_fade_t:new c.Uniform1f(d,t.u_fade_t),u_opacity:new c.Uniform1f(d,t.u_opacity),u_image0:new c.Uniform1i(d,t.u_image0),u_image1:new c.Uniform1i(d,t.u_image1),u_brightness_low:new c.Uniform1f(d,t.u_brightness_low),u_brightness_high:new c.Uniform1f(d,t.u_brightness_high),u_saturation_factor:new c.Uniform1f(d,t.u_saturation_factor),u_contrast_factor:new c.Uniform1f(d,t.u_contrast_factor),u_spin_weights:new c.Uniform3f(d,t.u_spin_weights)}),symbolIcon:(d,t)=>({u_is_size_zoom_constant:new c.Uniform1i(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.Uniform1i(d,t.u_is_size_feature_constant),u_size_t:new c.Uniform1f(d,t.u_size_t),u_size:new c.Uniform1f(d,t.u_size),u_camera_to_center_distance:new c.Uniform1f(d,t.u_camera_to_center_distance),u_pitch:new c.Uniform1f(d,t.u_pitch),u_rotate_symbol:new c.Uniform1i(d,t.u_rotate_symbol),u_aspect_ratio:new c.Uniform1f(d,t.u_aspect_ratio),u_fade_change:new c.Uniform1f(d,t.u_fade_change),u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_label_plane_matrix:new c.UniformMatrix4f(d,t.u_label_plane_matrix),u_coord_matrix:new c.UniformMatrix4f(d,t.u_coord_matrix),u_is_text:new c.Uniform1i(d,t.u_is_text),u_pitch_with_map:new c.Uniform1i(d,t.u_pitch_with_map),u_texsize:new c.Uniform2f(d,t.u_texsize),u_tile_id:new c.Uniform3f(d,t.u_tile_id),u_zoom_transition:new c.Uniform1f(d,t.u_zoom_transition),u_inv_rot_matrix:new c.UniformMatrix4f(d,t.u_inv_rot_matrix),u_merc_center:new c.Uniform2f(d,t.u_merc_center),u_texture:new c.Uniform1i(d,t.u_texture)}),symbolSDF:(d,t)=>({u_is_size_zoom_constant:new c.Uniform1i(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.Uniform1i(d,t.u_is_size_feature_constant),u_size_t:new c.Uniform1f(d,t.u_size_t),u_size:new c.Uniform1f(d,t.u_size),u_camera_to_center_distance:new c.Uniform1f(d,t.u_camera_to_center_distance),u_pitch:new c.Uniform1f(d,t.u_pitch),u_rotate_symbol:new c.Uniform1i(d,t.u_rotate_symbol),u_aspect_ratio:new c.Uniform1f(d,t.u_aspect_ratio),u_fade_change:new c.Uniform1f(d,t.u_fade_change),u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_label_plane_matrix:new c.UniformMatrix4f(d,t.u_label_plane_matrix),u_coord_matrix:new c.UniformMatrix4f(d,t.u_coord_matrix),u_is_text:new c.Uniform1i(d,t.u_is_text),u_pitch_with_map:new c.Uniform1i(d,t.u_pitch_with_map),u_texsize:new c.Uniform2f(d,t.u_texsize),u_texture:new c.Uniform1i(d,t.u_texture),u_gamma_scale:new c.Uniform1f(d,t.u_gamma_scale),u_device_pixel_ratio:new c.Uniform1f(d,t.u_device_pixel_ratio),u_tile_id:new c.Uniform3f(d,t.u_tile_id),u_zoom_transition:new c.Uniform1f(d,t.u_zoom_transition),u_inv_rot_matrix:new c.UniformMatrix4f(d,t.u_inv_rot_matrix),u_merc_center:new c.Uniform2f(d,t.u_merc_center),u_is_halo:new c.Uniform1i(d,t.u_is_halo)}),symbolTextAndIcon:(d,t)=>({u_is_size_zoom_constant:new c.Uniform1i(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.Uniform1i(d,t.u_is_size_feature_constant),u_size_t:new c.Uniform1f(d,t.u_size_t),u_size:new c.Uniform1f(d,t.u_size),u_camera_to_center_distance:new c.Uniform1f(d,t.u_camera_to_center_distance),u_pitch:new c.Uniform1f(d,t.u_pitch),u_rotate_symbol:new c.Uniform1i(d,t.u_rotate_symbol),u_aspect_ratio:new c.Uniform1f(d,t.u_aspect_ratio),u_fade_change:new c.Uniform1f(d,t.u_fade_change),u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_label_plane_matrix:new c.UniformMatrix4f(d,t.u_label_plane_matrix),u_coord_matrix:new c.UniformMatrix4f(d,t.u_coord_matrix),u_is_text:new c.Uniform1i(d,t.u_is_text),u_pitch_with_map:new c.Uniform1i(d,t.u_pitch_with_map),u_texsize:new c.Uniform2f(d,t.u_texsize),u_texsize_icon:new c.Uniform2f(d,t.u_texsize_icon),u_texture:new c.Uniform1i(d,t.u_texture),u_texture_icon:new c.Uniform1i(d,t.u_texture_icon),u_gamma_scale:new c.Uniform1f(d,t.u_gamma_scale),u_device_pixel_ratio:new c.Uniform1f(d,t.u_device_pixel_ratio),u_is_halo:new c.Uniform1i(d,t.u_is_halo)}),background:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_opacity:new c.Uniform1f(d,t.u_opacity),u_color:new c.UniformColor(d,t.u_color)}),backgroundPattern:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_opacity:new c.Uniform1f(d,t.u_opacity),u_image:new c.Uniform1i(d,t.u_image),u_pattern_tl_a:new c.Uniform2f(d,t.u_pattern_tl_a),u_pattern_br_a:new c.Uniform2f(d,t.u_pattern_br_a),u_pattern_tl_b:new c.Uniform2f(d,t.u_pattern_tl_b),u_pattern_br_b:new c.Uniform2f(d,t.u_pattern_br_b),u_texsize:new c.Uniform2f(d,t.u_texsize),u_mix:new c.Uniform1f(d,t.u_mix),u_pattern_size_a:new c.Uniform2f(d,t.u_pattern_size_a),u_pattern_size_b:new c.Uniform2f(d,t.u_pattern_size_b),u_scale_a:new c.Uniform1f(d,t.u_scale_a),u_scale_b:new c.Uniform1f(d,t.u_scale_b),u_pixel_coord_upper:new c.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.Uniform2f(d,t.u_pixel_coord_lower),u_tile_units_to_pixels:new c.Uniform1f(d,t.u_tile_units_to_pixels)}),terrainRaster:Vn,terrainDepth:Vn,skybox:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_sun_direction:new c.Uniform3f(d,t.u_sun_direction),u_cubemap:new c.Uniform1i(d,t.u_cubemap),u_opacity:new c.Uniform1f(d,t.u_opacity),u_temporal_offset:new c.Uniform1f(d,t.u_temporal_offset)}),skyboxGradient:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_color_ramp:new c.Uniform1i(d,t.u_color_ramp),u_center_direction:new c.Uniform3f(d,t.u_center_direction),u_radius:new c.Uniform1f(d,t.u_radius),u_opacity:new c.Uniform1f(d,t.u_opacity),u_temporal_offset:new c.Uniform1f(d,t.u_temporal_offset)}),skyboxCapture:(d,t)=>({u_matrix_3f:new c.UniformMatrix3f(d,t.u_matrix_3f),u_sun_direction:new c.Uniform3f(d,t.u_sun_direction),u_sun_intensity:new c.Uniform1f(d,t.u_sun_intensity),u_color_tint_r:new c.Uniform4f(d,t.u_color_tint_r),u_color_tint_m:new c.Uniform4f(d,t.u_color_tint_m),u_luminance:new c.Uniform1f(d,t.u_luminance)})};let Ds;function ml(d,t,l,p,_,v,E){const S=d.context,R=S.gl,z=d.useProgram("collisionBox"),N=[];let j=0,Q=0;for(let _e=0;_e<p.length;_e++){const le=p[_e],ye=t.getTile(le),Ee=ye.getBucket(l);if(!Ee)continue;let Ze=le.projMatrix;0===_[0]&&0===_[1]||(Ze=d.translatePosMatrix(le.projMatrix,ye,_,v));const Ge=E?Ee.textCollisionBox:Ee.iconCollisionBox,tt=Ee.collisionCircleArray;if(tt.length>0){const nt=c.create$1(),xt=Ze;c.mul$1(nt,Ee.placementInvProjMatrix,d.transform.glCoordMatrix),c.mul$1(nt,nt,Ee.placementViewportMatrix),N.push({circleArray:tt,circleOffset:Q,transform:xt,invTransform:nt}),j+=tt.length/4,Q=j}Ge&&(d.terrain&&d.terrain.setupElevationDraw(ye,z),z.draw(S,R.LINES,c.DepthMode.disabled,c.StencilMode.disabled,d.colorModeForRenderPass(),c.CullFaceMode.disabled,kr(Ze,d.transform,ye),l.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,null,d.transform.zoom,null,Ge.collisionVertexBuffer,Ge.collisionVertexBufferExt))}if(!E||!N.length)return;const oe=d.useProgram("collisionCircle"),ie=new c.StructArrayLayout2f1f2i16;ie.resize(4*j),ie._trim();let re=0;for(const _e of N)for(let le=0;le<_e.circleArray.length/4;le++){const ye=4*le,Ee=_e.circleArray[ye+0],Ze=_e.circleArray[ye+1],Ge=_e.circleArray[ye+2],tt=_e.circleArray[ye+3];ie.emplace(re++,Ee,Ze,Ge,tt,0),ie.emplace(re++,Ee,Ze,Ge,tt,1),ie.emplace(re++,Ee,Ze,Ge,tt,2),ie.emplace(re++,Ee,Ze,Ge,tt,3)}(!Ds||Ds.length<2*j)&&(Ds=function(_e){const le=2*_e,ye=new c.StructArrayLayout3ui6;ye.resize(le),ye._trim();for(let Ee=0;Ee<le;Ee++){const Ze=6*Ee;ye.uint16[Ze+0]=4*Ee+0,ye.uint16[Ze+1]=4*Ee+1,ye.uint16[Ze+2]=4*Ee+2,ye.uint16[Ze+3]=4*Ee+2,ye.uint16[Ze+4]=4*Ee+3,ye.uint16[Ze+5]=4*Ee+0}return ye}(j));const pe=S.createIndexBuffer(Ds,!0),se=S.createVertexBuffer(ie,c.collisionCircleLayout.members,!0);for(const _e of N){const le={u_matrix:_e.transform,u_inv_matrix:_e.invTransform,u_camera_to_center_distance:(me=d.transform).cameraToCenterDistance,u_viewport_size:[me.width,me.height]};oe.draw(S,R.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,d.colorModeForRenderPass(),c.CullFaceMode.disabled,le,l.id,se,pe,c.SegmentVector.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,d.transform.zoom,null,null,null)}var me;se.destroy(),pe.destroy()}const ut=c.identity(new Float32Array(16));function Nn(d,t,l,p,_,v){const{horizontalAlign:E,verticalAlign:S}=c.getAnchorAlignment(d),R=-(E-.5)*t,z=-(S-.5)*l,N=c.evaluateVariableOffset(d,p);return new c.pointGeometry((R/_+N[0])*v,(z/_+N[1])*v)}function jl(d,t,l,p,_,v,E,S,R,z,N,j){const Q=d.text.placedSymbolArray,oe=d.text.dynamicLayoutVertexArray,ie=d.icon.dynamicLayoutVertexArray,re={};oe.clear();for(let pe=0;pe<Q.length;pe++){const se=Q.get(pe),me=d.allowVerticalPlacement&&!se.placedOrientation,_e=se.hidden||!se.crossTileID||me?null:p[se.crossTileID];if(_e){const le=new c.pointGeometry(se.tileAnchorX,se.tileAnchorY),ye=j(le),Ee=br(le,l?S:E,ye),Ze=Pr(v.cameraToCenterDistance,Ee.signedDistanceFromCamera);let Ge=_.evaluateSizeForFeature(d.textSizeData,z,se)*Ze/c.ONE_EM;l&&(Ge*=d.tilePixelRatio/R);const{width:tt,height:nt,anchor:xt,textOffset:Xe,textScale:Et}=_e,Ne=Nn(xt,tt,nt,Xe,Et,Ge),St=l?br(le.add(Ne),E,ye).point:Ee.point.add(t?Ne.rotate(-v.angle):Ne),jt=d.allowVerticalPlacement&&se.placedOrientation===c.WritingMode.vertical?Math.PI/2:0;for(let un=0;un<se.numGlyphs;un++)c.addDynamicAttributes(oe,St,jt);N&&se.associatedIconIndex>=0&&(re[se.associatedIconIndex]={shiftedAnchor:St,angle:jt})}else ui(se.numGlyphs,oe)}if(N){ie.clear();const pe=d.icon.placedSymbolArray;for(let se=0;se<pe.length;se++){const me=pe.get(se);if(me.hidden)ui(me.numGlyphs,ie);else{const _e=re[se];if(_e)for(let le=0;le<me.numGlyphs;le++)c.addDynamicAttributes(ie,_e.shiftedAnchor,_e.angle);else ui(me.numGlyphs,ie)}}d.icon.dynamicLayoutVertexBuffer.updateData(ie)}d.text.dynamicLayoutVertexBuffer.updateData(oe)}function Zr(d,t,l){return l.iconsInText&&t?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function So(d,t,l,p,_,v,E,S,R,z,N,j){const Q=d.context,oe=Q.gl,ie=d.transform,re="map"===S,pe="map"===R,se=re&&"point"!==l.layout.get("symbol-placement"),me=re&&!pe&&!se,_e=void 0!==l.layout.get("symbol-sort-key").constantOr(1);let le=!1;const ye=d.depthModeForSublayer(0,c.DepthMode.ReadOnly),Ee=[0,0],Ze=l.layout.get("text-variable-anchor"),Ge=[],tt=[];d.terrain&&pe&&tt.push("PITCH_WITH_MAP_TERRAIN"),se&&tt.push("PROJECTED_POS_ON_VIEWPORT");for(const nt of p){const xt=t.getTile(nt),Xe=xt.getBucket(l);if(!Xe)continue;const Et=_?Xe.text:Xe.icon;if(!Et||!Et.segments.get().length)continue;const Ne=Et.programConfigurations.get(l.id),St=_||Xe.sdfIcons,jt=_?Xe.textSizeData:Xe.iconSizeData,un=pe||0!==ie.pitch,mn=d.useProgram(Zr(St,_,Xe),Ne,tt),yn=c.evaluateSizeForZoom(jt,ie.zoom),hn=[nt.canonical.x,nt.canonical.y,1<<nt.canonical.z];let nn,An,Dn,si,so=[0,0],Fi=null;if(_){if(An=xt.glyphAtlasTexture,Dn=oe.LINEAR,nn=xt.glyphAtlasTexture.size,Xe.iconsInText){so=xt.imageAtlasTexture.size,Fi=xt.imageAtlasTexture;const _o="composite"===jt.kind||"camera"===jt.kind;si=un||d.options.rotating||d.options.zooming||_o?oe.LINEAR:oe.NEAREST}}else{const _o=1!==l.layout.get("icon-size").constantOr(0)||Xe.iconsNeedLinear;An=xt.imageAtlasTexture,Dn=St||d.options.rotating||d.options.zooming||_o||un?oe.LINEAR:oe.NEAREST,nn=xt.imageAtlasTexture.size}const Ci=d.transform.calculatePixelsToTileUnitsMatrix(xt),mi=fn(nt.projMatrix,pe,re,d.transform,Ci),ea=d.terrain&&pe&&se?c.invert(new Float32Array(16),mi):ut,As=Wt(nt.projMatrix,pe,re,d.transform,Ci),ur=Ze&&Xe.hasTextData(),Cr="none"!==l.layout.get("icon-text-fit")&&ur&&Xe.hasIconData();if(se){const _o=ie.elevation;kn(Xe,nt.projMatrix,d,_,mi,As,pe,z,_o?Da=>_o.getAtTileOffset(nt,Da.x,Da.y):null)}const Xn=d.translatePosMatrix(nt.projMatrix,xt,v,E),hr=se||_&&Ze||Cr?ut:mi,Zi=d.translatePosMatrix(As,xt,v,E,!0),Tr=St&&0!==l.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1);let go;go=St?Xe.iconsInText?Zc(jt.kind,yn,me,pe,d,Xn,hr,Zi,nn,so,hn,0,d.identityMat,Ee):Hc(jt.kind,yn,me,pe,d,Xn,hr,Zi,_,nn,!0,hn,0,d.identityMat,Ee):bn(jt.kind,yn,me,pe,d,Xn,hr,Zi,_,nn,hn,0,d.identityMat,Ee);const Ea={program:mn,buffers:Et,uniformValues:go,atlasTexture:An,atlasTextureIcon:Fi,atlasInterpolation:Dn,atlasInterpolationIcon:si,isSDF:St,hasHalo:Tr,tile:xt,labelPlaneMatrixInv:ea};if(_e&&Xe.canOverlap){le=!0;const _o=Et.segments.get();for(const Da of _o)Ge.push({segments:new c.SegmentVector([Da]),sortKey:Da.sortKey,state:Ea})}else Ge.push({segments:Et.segments,sortKey:0,state:Ea})}le&&Ge.sort((nt,xt)=>nt.sortKey-xt.sortKey);for(const nt of Ge){const xt=nt.state;if(d.terrain&&d.terrain.setupElevationDraw(xt.tile,xt.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:xt.labelPlaneMatrixInv}),Q.activeTexture.set(oe.TEXTURE0),xt.atlasTexture.bind(xt.atlasInterpolation,oe.CLAMP_TO_EDGE),xt.atlasTextureIcon&&(Q.activeTexture.set(oe.TEXTURE1),xt.atlasTextureIcon&&xt.atlasTextureIcon.bind(xt.atlasInterpolationIcon,oe.CLAMP_TO_EDGE)),xt.isSDF){const Xe=xt.uniformValues;xt.hasHalo&&(Xe.u_is_halo=1,Ws(xt.buffers,nt.segments,l,d,xt.program,ye,N,j,Xe)),Xe.u_is_halo=0}Ws(xt.buffers,nt.segments,l,d,xt.program,ye,N,j,xt.uniformValues)}}function Ws(d,t,l,p,_,v,E,S,R){const z=p.context;_.draw(z,z.gl.TRIANGLES,v,E,S,c.CullFaceMode.disabled,R,l.id,d.layoutVertexBuffer,d.indexBuffer,t,l.paint,p.transform.zoom,d.programConfigurations.get(l.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function ei(d,t,l,p,_,v,E){const S=d.context.gl,R=l.paint.get("fill-pattern"),z=R&&R.constantOr(1),N=l.getCrossfadeParameters();let j,Q,oe,ie,re;E?(Q=z&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=S.LINES):(Q=z?"fillPattern":"fill",j=S.TRIANGLES);for(const pe of p){const se=t.getTile(pe);if(z&&!se.patternsLoaded())continue;const me=se.getBucket(l);if(!me)continue;d.prepareDrawTile(pe);const _e=me.programConfigurations.get(l.id),le=d.useProgram(Q,_e);z&&(d.context.activeTexture.set(S.TEXTURE0),se.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),_e.updatePaintBuffers(N));const ye=R.constantOr(null);if(ye&&se.imageAtlas){const Ze=se.imageAtlas,Ge=Ze.patternPositions[ye.to.toString()],tt=Ze.patternPositions[ye.from.toString()];Ge&&tt&&_e.setConstantPatternPositions(Ge,tt)}const Ee=d.translatePosMatrix(pe.projMatrix,se,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(E){ie=me.indexBuffer2,re=me.segments2;const Ze=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];oe="fillOutlinePattern"===Q&&z?Jr(Ee,d,N,se,Ze):Zt(Ee,Ze)}else ie=me.indexBuffer,re=me.segments,oe=z?er(Ee,d,N,se):yr(Ee);d.prepareDrawProgram(d.context,le,pe.toUnwrapped()),le.draw(d.context,j,_,d.stencilModeForClipping(pe),v,c.CullFaceMode.disabled,oe,l.id,me.layoutVertexBuffer,ie,re,l.paint,d.transform.zoom,_e)}}function Wo(d,t,l,p,_,v,E){const S=d.context,R=S.gl,z=l.paint.get("fill-extrusion-pattern"),N=z.constantOr(1),j=l.getCrossfadeParameters(),Q=l.paint.get("fill-extrusion-opacity");for(const oe of p){const ie=t.getTile(oe),re=ie.getBucket(l);if(!re)continue;const pe=re.programConfigurations.get(l.id),se=d.useProgram(N?"fillExtrusionPattern":"fillExtrusion",pe);if(d.terrain){const Ee=d.terrain;if(!re.enableTerrain)continue;if(Ee.setupElevationDraw(ie,se,{useMeterToDem:!0}),gl(S,t,oe,re,l,Ee),!re.centroidVertexBuffer){const Ze=se.attributes.a_centroid_pos;void 0!==Ze&&R.vertexAttrib2f(Ze,0,0)}}N&&(d.context.activeTexture.set(R.TEXTURE0),ie.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),pe.updatePaintBuffers(j));const me=z.constantOr(null);if(me&&ie.imageAtlas){const Ee=ie.imageAtlas,Ze=Ee.patternPositions[me.to.toString()],Ge=Ee.patternPositions[me.from.toString()];Ze&&Ge&&pe.setConstantPatternPositions(Ze,Ge)}const _e=d.translatePosMatrix(oe.projMatrix,ie,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),le=l.paint.get("fill-extrusion-vertical-gradient"),ye=N?xn(_e,d,le,Q,oe,j,ie):Kt(_e,d,le,Q);d.prepareDrawProgram(S,se,oe.toUnwrapped()),se.draw(S,S.gl.TRIANGLES,_,v,E,c.CullFaceMode.backCCW,ye,l.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,l.paint,d.transform.zoom,pe,d.terrain?re.centroidVertexBuffer:null)}}function gl(d,t,l,p,_,v){const E=[se=>{let me=se.canonical.x-1,_e=se.wrap;return me<0&&(me=(1<<se.canonical.z)-1,_e--),new c.OverscaledTileID(se.overscaledZ,_e,se.canonical.z,me,se.canonical.y)},se=>{let me=se.canonical.x+1,_e=se.wrap;return me===1<<se.canonical.z&&(me=0,_e++),new c.OverscaledTileID(se.overscaledZ,_e,se.canonical.z,me,se.canonical.y)},se=>new c.OverscaledTileID(se.overscaledZ,se.wrap,se.canonical.z,se.canonical.x,(0===se.canonical.y?1<<se.canonical.z:se.canonical.y)-1),se=>new c.OverscaledTileID(se.overscaledZ,se.wrap,se.canonical.z,se.canonical.x,se.canonical.y===(1<<se.canonical.z)-1?0:se.canonical.y+1)],S=se=>{const me=t.getSource().maxzoom,_e=Ze=>{const Ge=t.getTileByID(Ze);if(Ge&&Ge.hasData())return Ge.getBucket(_)};let le,ye,Ee;return(se.overscaledZ===se.canonical.z||se.overscaledZ>=me)&&(le=_e(se.key)),se.overscaledZ>=me&&(ye=_e(se.calculateScaledKey(se.overscaledZ+1))),se.overscaledZ>me&&(Ee=_e(se.calculateScaledKey(se.overscaledZ-1))),le||ye||Ee},R=[0,0,0],z=(se,me)=>(R[0]=Math.min(se.min.y,me.min.y),R[1]=Math.max(se.max.y,me.max.y),R[2]=c.EXTENT-me.min.x>se.max.x?me.min.x-c.EXTENT:se.max.x,R),N=(se,me)=>(R[0]=Math.min(se.min.x,me.min.x),R[1]=Math.max(se.max.x,me.max.x),R[2]=c.EXTENT-me.min.y>se.max.y?me.min.y-c.EXTENT:se.max.y,R),j=[(se,me)=>z(se,me),(se,me)=>z(me,se),(se,me)=>N(se,me),(se,me)=>N(me,se)],Q=new c.pointGeometry(0,0);let oe,ie,re;const pe=(se,me,_e,le,ye)=>{const Ee=[[le?_e:se,le?se:_e,0],[le?_e:me,le?me:_e,0]],Ze=ye<0?c.EXTENT+ye:ye,Ge=[le?Ze:(se+me)/2,le?(se+me)/2:Ze,0];return 0===_e&&ye<0||0!==_e&&ye>0?v.getForTilePoints(re,[Ge],!0,ie):Ee.push(Ge),v.getForTilePoints(l,Ee,!0,oe),Math.max(Ee[0][2],Ee[1][2],Ge[2])/v.exaggeration()};for(let se=0;se<4;se++){const me=p.borders[se];if(0===me.length&&(p.borderDone[se]=!0),p.borderDone[se])continue;const _e=re=E[se](l),le=S(_e);if(!(le&&le.enableTerrain&&(ie=v.findDEMTileFor(_e),ie&&ie.dem)))continue;if(!oe){const Ge=v.findDEMTileFor(l);if(!Ge||!Ge.dem)return;oe=Ge}const ye=(se<2?1:5)-se,Ee=le.borders[ye];let Ze=0;for(let Ge=0;Ge<me.length;Ge++){const tt=p.featuresOnBorder[me[Ge]],nt=tt.borders[se];let xt;for(;Ze<Ee.length&&(xt=le.featuresOnBorder[Ee[Ze]],!(xt.borders[ye][1]>nt[0]+3));)le.borderDone[ye]||le.encodeCentroid(void 0,xt,!1),Ze++;if(xt&&Ze<Ee.length){const Xe=Ze;let Et=0;for(;!(xt.borders[ye][0]>nt[1]-3)&&(Et++,++Ze!==Ee.length);)xt=le.featuresOnBorder[Ee[Ze]];if(xt=le.featuresOnBorder[Ee[Xe]],tt.intersectsCount()>1||xt.intersectsCount()>1||1!==Et){1!==Et&&(Ze=Xe),p.encodeCentroid(void 0,tt,!1),le.borderDone[ye]||le.encodeCentroid(void 0,xt,!1);continue}const Ne=j[se](tt,xt),St=se%2?c.EXTENT-1:0;Q.x=pe(Ne[0],Math.min(c.EXTENT-1,Ne[1]),St,se<2,Ne[2]),Q.y=0,p.encodeCentroid(Q,tt,!1),le.borderDone[ye]||le.encodeCentroid(Q,xt,!1)}else p.encodeCentroid(void 0,tt,!1)}p.borderDone[se]=p.needsCentroidUpdate=!0,le.borderDone[ye]||(le.borderDone[ye]=le.needsCentroidUpdate=!0)}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&0!==p.centroidVertexArray.length)&&p.uploadCentroid(d)}const pa=new c.Color(1,0,0,1),Qn=new c.Color(0,1,0,1),Xs=new c.Color(0,0,1,1),_l=new c.Color(1,0,1,1),ki=new c.Color(0,1,1,1);function eo(d,t,l,p){ss(d,0,t+l/2,d.transform.width,l,p)}function $l(d,t,l,p){ss(d,t-l/2,0,l,d.transform.height,p)}function ss(d,t,l,p,_,v){const E=d.context,S=E.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*c.exported.devicePixelRatio,l*c.exported.devicePixelRatio,p*c.exported.devicePixelRatio,_*c.exported.devicePixelRatio),E.clear({color:v}),S.disable(S.SCISSOR_TEST)}function Xo(d,t,l){const p=d.context,_=p.gl,v=l.projMatrix,E=d.useProgram("debug"),S=t.getTileByID(l.key);d.terrain&&d.terrain.setupElevationDraw(S,E);const R=c.DepthMode.disabled,z=c.StencilMode.disabled,N=d.colorModeForRenderPass(),j="$debug";p.activeTexture.set(_.TEXTURE0),d.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),S._makeDebugTileBoundsBuffers(d.context,d.transform.projection);const Q=S._tileDebugBuffer||d.debugBuffer,oe=S._tileDebugIndexBuffer||d.debugIndexBuffer,ie=S._tileDebugSegments||d.debugSegments;E.draw(p,_.LINE_STRIP,R,z,N,c.CullFaceMode.disabled,po(v,c.Color.red),j,Q,oe,ie);const re=S.latestRawTileData,pe=Math.floor((re&&re.byteLength||0)/1024),se=t.getTile(l).tileSize,me=512/Math.min(se,512)*(l.overscaledZ/d.transform.zoom)*.5;let _e=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(_e+=` => ${l.overscaledZ}`),function(le,ye){le.initDebugOverlayCanvas();const Ee=le.debugOverlayCanvas,Ze=le.context.gl,Ge=le.debugOverlayCanvas.getContext("2d");Ge.clearRect(0,0,Ee.width,Ee.height),Ge.shadowColor="white",Ge.shadowBlur=2,Ge.lineWidth=1.5,Ge.strokeStyle="white",Ge.textBaseline="top",Ge.font="bold 36px Open Sans, sans-serif",Ge.fillText(ye,5,5),Ge.strokeText(ye,5,5),le.debugOverlayTexture.update(Ee),le.debugOverlayTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE)}(d,`${_e} ${pe}kb`),E.draw(p,_.TRIANGLES,R,z,c.ColorMode.alphaBlended,c.CullFaceMode.disabled,po(v,c.Color.transparent,me),j,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments)}const Xc=c.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ja}=Xc;function No(d,t,l,p){d.emplaceBack(t,l,p)}class ma{constructor(t){this.vertexArray=new c.StructArrayLayout3f12,this.indices=new c.StructArrayLayout3ui6,No(this.vertexArray,-1,-1,1),No(this.vertexArray,1,-1,1),No(this.vertexArray,-1,1,1),No(this.vertexArray,1,1,1),No(this.vertexArray,-1,-1,-1),No(this.vertexArray,1,-1,-1),No(this.vertexArray,-1,1,-1),No(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,ja),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=c.SegmentVector.simpleSegment(0,0,36,12)}}function Yo(d,t,l,p,_,v){const E=d.gl,S=t.paint.get("sky-atmosphere-color"),R=t.paint.get("sky-atmosphere-halo-color"),z=t.paint.get("sky-atmosphere-sun-intensity"),N={u_matrix_3f:c.fromMat4([],p),u_sun_direction:_,u_sun_intensity:z,u_color_tint_r:[(ie=S).r,ie.g,ie.b,ie.a],u_color_tint_m:[(re=R).r,re.g,re.b,re.a],u_luminance:5e-5};var ie,re;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+v,t.skyboxTexture,0),l.draw(d,E.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.frontCW,N,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const ga={symbol:function(d,t,l,p,_){if("translucent"!==d.renderPass)return;const v=c.StencilMode.disabled,E=d.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(S,R,z,N,j,Q,oe){const ie=R.transform,re="map"===j,pe="map"===Q;for(const se of S){const me=N.getTile(se),_e=me.getBucket(z);if(!_e||!_e.text||!_e.text.segments.get().length)continue;const le=c.evaluateSizeForZoom(_e.textSizeData,ie.zoom),ye=R.transform.calculatePixelsToTileUnitsMatrix(me),Ee=fn(se.projMatrix,pe,re,R.transform,ye),Ze="none"!==z.layout.get("icon-text-fit")&&_e.hasIconData();if(le){const Ge=Math.pow(2,ie.zoom-me.tileID.overscaledZ),tt=ie.elevation;jl(_e,re,pe,oe,c.symbolSize,ie,Ee,se.projMatrix,Ge,le,Ze,tt?nt=>tt.getAtTileOffset(se,nt.x,nt.y):nt=>0)}}}(p,d,l,t,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_),0!==l.paint.get("icon-opacity").constantOr(1)&&So(d,t,l,p,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),v,E),0!==l.paint.get("text-opacity").constantOr(1)&&So(d,t,l,p,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),v,E),t.map.showCollisionBoxes&&(ml(d,t,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),ml(d,t,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(d,t,l,p){if("translucent"!==d.renderPass)return;const _=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),E=l.paint.get("circle-stroke-opacity"),S=void 0!==l.layout.get("circle-sort-key").constantOr(1);if(0===_.constantOr(1)&&(0===v.constantOr(1)||0===E.constantOr(1)))return;const R=d.context,z=R.gl,N=d.depthModeForSublayer(0,c.DepthMode.ReadOnly),j=c.StencilMode.disabled,Q=d.colorModeForRenderPass(),oe=[];for(let ie=0;ie<p.length;ie++){const re=p[ie],pe=t.getTile(re),se=pe.getBucket(l);if(!se)continue;const me=se.programConfigurations.get(l.id),_e=Mr(l),le={programConfiguration:me,program:d.useProgram("circle",me,_e),layoutVertexBuffer:se.layoutVertexBuffer,indexBuffer:se.indexBuffer,uniformValues:jn(d,re,pe,l),tile:pe};if(S){const ye=se.segments.get();for(const Ee of ye)oe.push({segments:new c.SegmentVector([Ee]),sortKey:Ee.sortKey,state:le})}else oe.push({segments:se.segments,sortKey:0,state:le})}S&&oe.sort((ie,re)=>ie.sortKey-re.sortKey);for(const ie of oe){const{programConfiguration:re,program:pe,layoutVertexBuffer:se,indexBuffer:me,uniformValues:_e,tile:le}=ie.state,ye=ie.segments;d.terrain&&d.terrain.setupElevationDraw(le,pe,{useDepthForOcclusion:!0}),d.prepareDrawProgram(R,pe,le.tileID.toUnwrapped()),pe.draw(R,z.TRIANGLES,N,j,Q,c.CullFaceMode.disabled,_e,l.id,se,me,ye,l.paint,d.transform.zoom,re)}},heatmap:function(d,t,l,p){if(0!==l.paint.get("heatmap-opacity"))if("offscreen"===d.renderPass){const _=d.context,v=_.gl,E=c.StencilMode.disabled,S=new c.ColorMode([v.ONE,v.ONE],c.Color.transparent,[!0,!0,!0,!0]);(function(R,z,N){const j=R.gl;R.activeTexture.set(j.TEXTURE1),R.viewport.set([0,0,z.width/4,z.height/4]);let Q=N.heatmapFbo;if(Q)j.bindTexture(j.TEXTURE_2D,Q.colorAttachment.get()),R.bindFramebuffer.set(Q.framebuffer);else{const oe=j.createTexture();j.bindTexture(j.TEXTURE_2D,oe),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),Q=N.heatmapFbo=R.createFramebuffer(z.width/4,z.height/4,!1),function(ie,re,pe,se){const me=ie.gl;me.texImage2D(me.TEXTURE_2D,0,me.RGBA,re.width/4,re.height/4,0,me.RGBA,ie.extRenderToTextureHalfFloat?ie.extTextureHalfFloat.HALF_FLOAT_OES:me.UNSIGNED_BYTE,null),se.colorAttachment.set(pe)}(R,z,oe,Q)}})(_,d,l),_.clear({color:c.Color.transparent});for(let R=0;R<p.length;R++){const z=p[R];if(t.hasRenderableParent(z))continue;const N=t.getTile(z),j=N.getBucket(l);if(!j)continue;const Q=j.programConfigurations.get(l.id),oe=d.useProgram("heatmap",Q),{zoom:ie}=d.transform;d.terrain&&d.terrain.setupElevationDraw(N,oe),d.prepareDrawProgram(_,oe,z.toUnwrapped()),oe.draw(_,v.TRIANGLES,c.DepthMode.disabled,E,S,c.CullFaceMode.disabled,Zo(z.projMatrix,N,ie,l.paint.get("heatmap-intensity")),l.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,l.paint,d.transform.zoom,Q)}_.viewport.set([0,0,d.width,d.height])}else"translucent"===d.renderPass&&(d.context.setColorMode(d.colorModeForRenderPass()),function(_,v){const E=_.context,S=E.gl,R=v.heatmapFbo;if(!R)return;E.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,R.colorAttachment.get()),E.activeTexture.set(S.TEXTURE1);let z=v.colorRampTexture;z||(z=v.colorRampTexture=new c.Texture(E,v.colorRamp,S.RGBA)),z.bind(S.LINEAR,S.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(E,S.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,_.colorModeForRenderPass(),c.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:v.paint.get("heatmap-opacity")},v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)}(d,l))},line:function(d,t,l,p){if("translucent"!==d.renderPass)return;const _=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(0===_.constantOr(1)||0===v.constantOr(1))return;const E=d.depthModeForSublayer(0,c.DepthMode.ReadOnly),S=d.colorModeForRenderPass(),R=l.paint.get("line-dasharray"),z=R.constantOr(1),N=l.layout.get("line-cap"),j=l.paint.get("line-pattern"),Q=j.constantOr(1),oe=l.paint.get("line-gradient"),ie=l.getCrossfadeParameters(),re=Q?"linePattern":"line",pe=d.context,se=pe.gl;for(const me of p){const _e=t.getTile(me);if(Q&&!_e.patternsLoaded())continue;const le=_e.getBucket(l);if(!le)continue;d.prepareDrawTile(me);const ye=le.programConfigurations.get(l.id),Ee=Va(l),Ze=d.useProgram(re,ye,Ee),Ge=j.constantOr(null);if(Ge&&_e.imageAtlas){const Et=_e.imageAtlas,Ne=Et.patternPositions[Ge.to.toString()],St=Et.patternPositions[Ge.from.toString()];Ne&&St&&ye.setConstantPatternPositions(Ne,St)}const tt=R.constantOr(null),nt=N.constantOr(null);if(!Q&&tt&&nt&&_e.lineAtlas){const Et=_e.lineAtlas,Ne=Et.getDash(tt.to,nt),St=Et.getDash(tt.from,nt);Ne&&St&&ye.setConstantPatternPositions(Ne,St)}const xt=d.terrain?me.projMatrix:null,Xe=Q?oi(d,_e,l,ie,xt):Hi(d,_e,l,ie,xt,le.lineClipsArray.length);if(oe){const Et=le.gradients[l.id];let Ne=Et.texture;if(l.gradientVersion!==Et.version){let St=256;if(l.stepInterpolant){const jt=t.getSource().maxzoom,un=me.canonical.z===jt?Math.ceil(1<<d.transform.maxZoom-me.canonical.z):1;St=c.clamp(c.nextPowerOfTwo(le.maxLineLength/c.EXTENT*1024*un),256,pe.maxTextureSize)}Et.gradient=c.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:St,image:Et.gradient||void 0,clips:le.lineClipsArray}),Et.texture?Et.texture.update(Et.gradient):Et.texture=new c.Texture(pe,Et.gradient,se.RGBA),Et.version=l.gradientVersion,Ne=Et.texture}pe.activeTexture.set(se.TEXTURE1),Ne.bind(l.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}z&&(pe.activeTexture.set(se.TEXTURE0),_e.lineAtlasTexture.bind(se.LINEAR,se.REPEAT),ye.updatePaintBuffers(ie)),Q&&(pe.activeTexture.set(se.TEXTURE0),_e.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),ye.updatePaintBuffers(ie)),d.prepareDrawProgram(pe,Ze,me.toUnwrapped()),Ze.draw(pe,se.TRIANGLES,E,d.stencilModeForClipping(me),S,c.CullFaceMode.disabled,Xe,l.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,l.paint,d.transform.zoom,ye,le.layoutVertexBuffer2)}},fill:function(d,t,l,p){const _=l.paint.get("fill-color"),v=l.paint.get("fill-opacity");if(0===v.constantOr(1))return;const E=d.colorModeForRenderPass(),S=l.paint.get("fill-pattern"),R=d.opaquePassEnabledForLayer()&&!S.constantOr(1)&&1===_.constantOr(c.Color.transparent).a&&1===v.constantOr(0)?"opaque":"translucent";if(d.renderPass===R){const z=d.depthModeForSublayer(1,"opaque"===d.renderPass?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly);ei(d,t,l,p,z,E,!1)}if("translucent"===d.renderPass&&l.paint.get("fill-antialias")){const z=d.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,c.DepthMode.ReadOnly);ei(d,t,l,p,z,E,!0)}},"fill-extrusion":function(d,t,l,p){const _=l.paint.get("fill-extrusion-opacity");if(0!==_&&"translucent"===d.renderPass){const v=new c.DepthMode(d.context.gl.LEQUAL,c.DepthMode.ReadWrite,d.depthRangeFor3D);if(1!==_||l.paint.get("fill-extrusion-pattern").constantOr(1))Wo(d,t,l,p,v,c.StencilMode.disabled,c.ColorMode.disabled),Wo(d,t,l,p,v,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const E=d.colorModeForRenderPass();Wo(d,t,l,p,v,c.StencilMode.disabled,E)}}},hillshade:function(d,t,l,p){if("offscreen"!==d.renderPass&&"translucent"!==d.renderPass)return;const _=d.context,v=d.depthModeForSublayer(0,c.DepthMode.ReadOnly),E=d.colorModeForRenderPass(),S=d.terrain&&d.terrain.renderingToTexture,[R,z]="translucent"!==d.renderPass||S?[{},p]:d.stencilConfigForOverlap(p);for(const N of z){const j=t.getTile(N);if(j.needsHillshadePrepare&&"offscreen"===d.renderPass)Ki(d,j,l,v,c.StencilMode.disabled,E);else if("translucent"===d.renderPass){const Q=S&&d.terrain?d.terrain.stencilModeForRTTOverlap(N):R[N.overscaledZ];fl(d,N,j,l,v,Q,E)}}_.viewport.set([0,0,d.width,d.height])},raster:function(d,t,l,p,_,v){if("translucent"!==d.renderPass||0===l.paint.get("raster-opacity")||!p.length)return;const E=d.context,S=E.gl,R=t.getSource(),z=d.useProgram("raster"),N=d.colorModeForRenderPass(),j=d.terrain&&d.terrain.renderingToTexture,[Q,oe]=R instanceof ae||j?[{},p]:d.stencilConfigForOverlap(p),ie=oe[oe.length-1].overscaledZ,re=!d.options.moving;for(const pe of oe){const se=j?c.DepthMode.disabled:d.depthModeForSublayer(pe.overscaledZ-ie,1===l.paint.get("raster-opacity")?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly,S.LESS),me=pe.toUnwrapped(),_e=t.getTile(pe);if(j&&(!_e||!_e.hasData()))continue;const le=j?pe.projMatrix:d.transform.calculateProjMatrix(me,re),ye=d.terrain&&j?d.terrain.stencilModeForRTTOverlap(pe):Q[pe.overscaledZ],Ee=v?0:l.paint.get("raster-fade-duration");_e.registerFadeDuration(Ee);const Ze=t.findLoadedParent(pe,0),Ge=O(_e,Ze,t,d.transform,Ee);let tt,nt;d.terrain&&d.terrain.prepareDrawTile(pe);const xt="nearest"===l.paint.get("raster-resampling")?S.NEAREST:S.LINEAR;E.activeTexture.set(S.TEXTURE0),_e.texture.bind(xt,S.CLAMP_TO_EDGE),E.activeTexture.set(S.TEXTURE1),Ze?(Ze.texture.bind(xt,S.CLAMP_TO_EDGE),tt=Math.pow(2,Ze.tileID.overscaledZ-_e.tileID.overscaledZ),nt=[_e.tileID.canonical.x*tt%1,_e.tileID.canonical.y*tt%1]):_e.texture.bind(xt,S.CLAMP_TO_EDGE);const Xe=pl(le,nt||[0,0],tt||1,Ge,l);if(d.prepareDrawProgram(E,z,me),R instanceof ae)z.draw(E,S.TRIANGLES,se,c.StencilMode.disabled,N,c.CullFaceMode.disabled,Xe,l.id,R.boundsBuffer,d.quadTriangleIndexBuffer,R.boundsSegments);else{const{tileBoundsBuffer:Et,tileBoundsIndexBuffer:Ne,tileBoundsSegments:St}=d.getTileBoundsBuffers(_e);z.draw(E,S.TRIANGLES,se,ye,N,c.CullFaceMode.disabled,Xe,l.id,Et,Ne,St)}}},background:function(d,t,l,p){const _=l.paint.get("background-color"),v=l.paint.get("background-opacity");if(0===v)return;const E=d.context,S=E.gl,R=d.transform,z=R.tileSize,N=l.paint.get("background-pattern");if(d.isPatternMissing(N))return;const j=!N&&1===_.a&&1===v&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==j)return;const Q=c.StencilMode.disabled,oe=d.depthModeForSublayer(0,"opaque"===j?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly),ie=d.colorModeForRenderPass(),re=d.useProgram(N?"backgroundPattern":"background");let pe,se=p;se||(pe=d.getBackgroundTiles(),se=Object.values(pe).map(_e=>_e.tileID)),N&&(E.activeTexture.set(S.TEXTURE0),d.imageManager.bind(d.context));const me=l.getCrossfadeParameters();for(const _e of se){const le=_e.toUnwrapped(),ye=p?_e.projMatrix:d.transform.calculateProjMatrix(le);d.prepareDrawTile(_e);const Ee=t?t.getTile(_e):pe?pe[_e.key]:new c.Tile(_e,z,R.zoom,d),Ze=N?Wc(ye,v,d,N,{tileID:_e,tileSize:z},me):qc(ye,v,_);d.prepareDrawProgram(E,re,le);const{tileBoundsBuffer:Ge,tileBoundsIndexBuffer:tt,tileBoundsSegments:nt}=d.getTileBoundsBuffers(Ee);re.draw(E,S.TRIANGLES,oe,Q,ie,c.CullFaceMode.disabled,Ze,l.id,Ge,tt,nt)}},sky:function(d,t,l){const p=d.transform,_="mercator"===p.projection.name?1:c.smoothstep(7,8,p.zoom),v=l.paint.get("sky-opacity")*_;if(0===v)return;const E=d.context,S=l.paint.get("sky-type"),R=new c.DepthMode(E.gl.LEQUAL,c.DepthMode.ReadOnly,[0,1]),z=d.frameCounter/1e3%1;"atmosphere"===S?"offscreen"===d.renderPass?l.needsSkyboxCapture(d)&&(function(N,j,Q,oe){const ie=N.context,re=ie.gl;let pe=j.skyboxFbo;if(!pe){pe=j.skyboxFbo=ie.createFramebuffer(32,32,!1),j.skyboxGeometry=new ma(ie),j.skyboxTexture=ie.gl.createTexture(),re.bindTexture(re.TEXTURE_CUBE_MAP,j.skyboxTexture),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MAG_FILTER,re.LINEAR);for(let le=0;le<6;++le)re.texImage2D(re.TEXTURE_CUBE_MAP_POSITIVE_X+le,0,re.RGBA,32,32,0,re.RGBA,re.UNSIGNED_BYTE,null)}ie.bindFramebuffer.set(pe.framebuffer),ie.viewport.set([0,0,32,32]);const se=j.getCenter(N,!0),me=N.useProgram("skyboxCapture"),_e=new Float64Array(16);c.identity(_e),c.rotateY(_e,_e,.5*-Math.PI),Yo(ie,j,me,_e,se,0),c.identity(_e),c.rotateY(_e,_e,.5*Math.PI),Yo(ie,j,me,_e,se,1),c.identity(_e),c.rotateX(_e,_e,.5*-Math.PI),Yo(ie,j,me,_e,se,2),c.identity(_e),c.rotateX(_e,_e,.5*Math.PI),Yo(ie,j,me,_e,se,3),c.identity(_e),Yo(ie,j,me,_e,se,4),c.identity(_e),c.rotateY(_e,_e,Math.PI),Yo(ie,j,me,_e,se,5),ie.viewport.set([0,0,N.width,N.height])}(d,l),l.markSkyboxValid(d)):"sky"===d.renderPass&&function(N,j,Q,oe,ie){const re=N.context,pe=re.gl,se=N.transform,me=N.useProgram("skybox");re.activeTexture.set(pe.TEXTURE0),pe.bindTexture(pe.TEXTURE_CUBE_MAP,j.skyboxTexture);const _e={u_matrix:se.skyboxMatrix,u_sun_direction:j.getCenter(N,!1),u_cubemap:0,u_opacity:oe,u_temporal_offset:ie};N.prepareDrawProgram(re,me),me.draw(re,pe.TRIANGLES,Q,c.StencilMode.disabled,N.colorModeForRenderPass(),c.CullFaceMode.backCW,_e,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(d,l,R,v,z):"gradient"===S&&"sky"===d.renderPass&&function(N,j,Q,oe,ie){const re=N.context,pe=re.gl,se=N.transform,me=N.useProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new ma(re)),re.activeTexture.set(pe.TEXTURE0);let _e=j.colorRampTexture;_e||(_e=j.colorRampTexture=new c.Texture(re,j.colorRamp,pe.RGBA)),_e.bind(pe.LINEAR,pe.CLAMP_TO_EDGE);const le=(ye=se.skyboxMatrix,Ee=j.getCenter(N,!1),Ze=j.paint.get("sky-gradient-radius"),Ge=oe,tt=ie,{u_matrix:ye,u_color_ramp:0,u_center_direction:Ee,u_radius:c.degToRad(Ze),u_opacity:Ge,u_temporal_offset:tt});var ye,Ee,Ze,Ge,tt;N.prepareDrawProgram(re,me),me.draw(re,pe.TRIANGLES,Q,c.StencilMode.disabled,N.colorModeForRenderPass(),c.CullFaceMode.backCW,le,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(d,l,R,v,z)},debug:function(d,t,l){for(let p=0;p<l.length;p++)Xo(d,t,l[p])},custom:function(d,t,l){const p=d.context,_=l.implementation;if("mercator"===d.transform.projection.name){if("offscreen"===d.renderPass){const v=_.prerender;v&&(d.setCustomLayerDefaults(),p.setColorMode(d.colorModeForRenderPass()),v.call(_,p.gl,d.transform.customLayerMatrix()),p.setDirty(),d.setBaseState())}else if("translucent"===d.renderPass){d.setCustomLayerDefaults(),p.setColorMode(d.colorModeForRenderPass()),p.setStencilMode(c.StencilMode.disabled);const v="3d"===_.renderingMode?new c.DepthMode(d.context.gl.LEQUAL,c.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,c.DepthMode.ReadOnly);p.setDepthMode(v),_.render(p.gl,d.transform.customLayerMatrix()),p.setDirty(),d.setBaseState(),p.bindFramebuffer.set(null)}}else c.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.")}};class Gl{constructor(t,l){this.context=new Vs(t),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=c.SourceCache.maxUnderzooming+c.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new $s,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(t,l){const p=!!t&&!!t.terrain&&"mercator"===this.transform.projection.name;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new te(this,t));const _=this._terrain;this.transform.elevation=p?_:null,_.update(t,this.transform,l)}_updateFog(t){const l=t.fog;if(!l||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,_]=l.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);const v=p+.78*(_-p);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,l){if(this.width=t*c.exported.devicePixelRatio,this.height=l*c.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const t=this.context,l=new c.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(c.EXTENT,0),l.emplaceBack(0,c.EXTENT),l.emplaceBack(c.EXTENT,c.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(l,c.posAttributes.members),this.tileExtentSegments=c.SegmentVector.simpleSegment(0,0,4,2);const p=new c.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(c.EXTENT,0),p.emplaceBack(0,c.EXTENT),p.emplaceBack(c.EXTENT,c.EXTENT),this.debugBuffer=t.createVertexBuffer(p,c.posAttributes.members),this.debugSegments=c.SegmentVector.simpleSegment(0,0,4,5);const _=new c.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(_,c.posAttributes.members),this.viewportSegments=c.SegmentVector.simpleSegment(0,0,4,2);const v=new c.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(c.EXTENT,0,c.EXTENT,0),v.emplaceBack(0,c.EXTENT,0,c.EXTENT),v.emplaceBack(c.EXTENT,c.EXTENT,c.EXTENT,c.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(v,c.boundsAttributes.members),this.mercatorBoundsSegments=c.SegmentVector.simpleSegment(0,0,4,2);const E=new c.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(E);const S=new c.StructArrayLayout1ui2;for(const z of[0,1,3,2,0])S.emplaceBack(z);this.debugIndexBuffer=t.createIndexBuffer(S),this.emptyTexture=new c.Texture(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA),this.identityMat=c.create$1();const R=this.context.gl;this.stencilClearMode=new c.StencilMode({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(c.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,l=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(t,l.TRIANGLES,c.DepthMode.disabled,this.stencilClearMode,c.ColorMode.disabled,c.CullFaceMode.disabled,os(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,l,p){if(!(l&&this.currentStencilSource!==l.id&&t.isTileClipped()&&p&&p.length))return;this.currentStencilSource=l.id;const _=this.context,v=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(c.ColorMode.disabled),_.setDepthMode(c.DepthMode.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of p){const R=l.getTile(S),z=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:N,tileBoundsIndexBuffer:j,tileBoundsSegments:Q}=this.getTileBoundsBuffers(R);E.draw(_,v.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:v.ALWAYS,mask:0},z,255,v.KEEP,v.KEEP,v.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,os(S.projMatrix),"$clipping",N,j,Q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,l=this.context.gl;return new c.StencilMode({func:l.NOTEQUAL,mask:255},t,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const l=this.context.gl;return new c.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(t){const l=this.context.gl,p=t.sort((E,S)=>S.overscaledZ-E.overscaledZ),_=p[p.length-1].overscaledZ,v=p[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const E={};for(let S=0;S<v;S++)E[S+_]=new c.StencilMode({func:l.GEQUAL,mask:255},S+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[E,p]}return[{[_]:c.StencilMode.disabled},p]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const l=1/8;return new c.ColorMode([t.CONSTANT_COLOR,t.ONE],new c.Color(l,l,l,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?c.ColorMode.unblended:c.ColorMode.alphaBlended}depthModeForSublayer(t,l,p){if(!this.opaquePassEnabledForLayer())return c.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new c.DepthMode(p||this.context.gl.LEQUAL,l,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,l){this.style=t,this.options=l,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(c.exported.now()),this.imageManager.beginFrame();const p=this.style.order,_=this.style._sourceCaches;for(const z in _){const N=_[z];N.used&&N.prepare(this.context)}const v={},E={},S={};for(const z in _){const N=_[z];v[z]=N.getVisibleCoordinates(),E[z]=v[z].slice().reverse(),S[z]=N.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<p.length;z++)if(this.style._layers[p[z]].is3D()){this.opaquePassCutoff=z;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),!c.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const z of p){const N=this.style._layers[z],j=t._getLayerSourceCache(N);if(!N.hasOffscreenPass()||N.isHidden(this.transform.zoom))continue;const Q=j?E[j.id]:void 0;("custom"===N.type||N.isSky()||Q&&Q.length)&&this.renderLayer(this,j,N,Q)}this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let R=c.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(R=this.style.fog.properties.get("color")),this.context.clear({color:l.showOverdrawInspector?c.Color.black:R,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[p[this.currentLayer]],N=t._getLayerSourceCache(z);if(z.isSky())continue;const j=N?E[N.id]:void 0;this._renderTileClippingMasks(z,N,j),this.renderLayer(this,N,z,j)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const z=this.style._layers[p[this.currentLayer]],N=t._getLayerSourceCache(z);z.isSky()&&this.renderLayer(this,N,z,N?E[N.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const z=this.style._layers[p[this.currentLayer]],N=t._getLayerSourceCache(z);if(z.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(z)){if(z.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const j=N?("symbol"===z.type?S:E)[N.id]:void 0;this._renderTileClippingMasks(z,N,N?v[N.id]:void 0),this.renderLayer(this,N,z,j),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let z=null;c.values(this.style._layers).forEach(N=>{const j=t._getLayerSourceCache(N);j&&!N.isHidden(this.transform.zoom)&&(!z||z.getSource().maxzoom<j.getSource().maxzoom)&&(z=j)}),z&&this.options.showTileBoundaries&&ga.debug(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const N=z.transform.padding;eo(z,z.transform.height-(N.top||0),3,pa),eo(z,N.bottom||0,3,Qn),$l(z,N.left||0,3,Xs),$l(z,z.transform.width-(N.right||0),3,_l);const j=z.transform.centerPoint;var Q,oe,ie,re;ss(Q=z,(oe=j.x)-1,(ie=z.transform.height-j.y)-10,2,20,re=ki),ss(Q,oe-10,ie-1,20,2,re)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%c.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(c.window.performance.now()),this.saveCanvasCopy())}renderLayer(t,l,p,_){p.isHidden(this.transform.zoom)||("background"===p.type||"sky"===p.type||"custom"===p.type||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),ga[p.type](t,l,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),p.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const l={};for(const p in t){const _=t[p],v=this.context.extTimerQuery,E=v.getQueryObjectEXT(_.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(_.query),l[p]=E}return l}translatePosMatrix(t,l,p,_,v){if(!p[0]&&!p[1])return t;const E=v?"map"===_?this.transform.angle:0:"viewport"===_?-this.transform.angle:0;if(E){const z=Math.sin(E),N=Math.cos(E);p=[p[0]*N-p[1]*z,p[0]*z+p[1]*N]}const S=[v?p[0]:wn(l,p[0],this.transform.zoom),v?p[1]:wn(l,p[1],this.transform.zoom),0],R=new Float32Array(16);return c.translate(R,t,S),R}saveTileTexture(t){const l=this._tileTextures[t.size[0]];l?l.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const l=this._tileTextures[t];return l&&l.length>0?l.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const l=this.imageManager.getPattern(t.from.toString()),p=this.imageManager.getPattern(t.to.toString());return!l||!p}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,l=this.style&&this.style.fog,p=[];return this.terrain&&!this.terrain.renderingToTexture&&p.push("TERRAIN"),l&&!t&&0!==l.getOpacity(this.transform.pitch)&&p.push("FOG"),t&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(t,l,p){this.cache=this.cache||{};const _=p||[],v=this.currentGlobalDefines().concat(_),E=et.cacheKey(t,v,l);return this.cache[E]||(this.cache[E]=new et(this.context,t,ho[t],l,fc[t],v)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=c.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(t){this.terrain&&this.terrain.prepareDrawTile(t)}prepareDrawProgram(t,l,p){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const v=_.getOpacity(this.transform.pitch);0!==v&&l.setFogUniformValues(t,((E,S,R,z)=>{const N=S.properties.get("color"),j=E.frameCounter/1e3%1,Q=[N.r/N.a,N.g/N.a,N.b/N.a,z];return{u_fog_matrix:R?E.transform.calculateFogTileMatrix(R):E.identityMat,u_fog_range:S.getFovAdjustedRange(E.transform._fov),u_fog_color:Q,u_fog_horizon_blend:S.properties.get("horizon-blend"),u_fog_temporal_offset:j}})(this,_,p,v))}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,l=t.createTexture();return t.bindTexture(t.TEXTURE_2D,l),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const _ of p)l[_.key]=t[_.key]||new c.Tile(_,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class as{constructor(t=0,l=0,p=0,_=0){if(isNaN(t)||t<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=l,this.left=p,this.right=_}interpolate(t,l,p){return null!=l.top&&null!=t.top&&(this.top=c.number(t.top,l.top,p)),null!=l.bottom&&null!=t.bottom&&(this.bottom=c.number(t.bottom,l.bottom,p)),null!=l.left&&null!=t.left&&(this.left=c.number(t.left,l.left,p)),null!=l.right&&null!=t.right&&(this.right=c.number(t.right,l.right,p)),this}getCenter(t,l){const p=c.clamp((this.left+t-this.right)/2,0,t),_=c.clamp((this.top+l-this.bottom)/2,0,l);return new c.pointGeometry(p,_)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new as(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ys(d,t){return[d[4*t],d[4*t+1],d[4*t+2],d[4*t+3]]}function to(d,t,l){d[4*t+0]=l[0],d[4*t+1]=l[1],d[4*t+2]=l[2],d[4*t+3]=l[3]}function Cs(d,t){const l=Ys(d,3);c.fromQuat(d,t),to(d,3,l)}function $a(d,t){to(d,3,[t[0],t[1],t[2],1])}function _a(d,t){const l=c.identity$1([]);return c.rotateZ$1(l,l,-t),c.rotateX$1(l,l,-d),l}function ls(d,t){const l=[d[0],d[1],0],p=[t[0],t[1],0];if(c.length(l)>=1e-15){const E=c.normalize([],l);c.scale(p,E,c.dot(p,E)),t[0]=p[0],t[1]=p[1]}const _=c.cross([],t,d);if(c.len(_)<1e-15)return null;const v=Math.atan2(-_[1],_[0]);return _a(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),v)}class yl{constructor(t,l){this.position=t,this.orientation=l}get position(){return this._position}set position(t){this._position=this._renderWorldCopies?function(l){if(!l)return;const p=Array.isArray(l)?new c.MercatorCoordinate(l[0],l[1],l[2]):l;return p.x=c.wrap(p.x,0,1),p}(t):t}lookAtPoint(t,l){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(t)):0,_=this.position,v=c.MercatorCoordinate.fromLngLat(t,p),E=[v.x-_.x,v.y-_.y,v.z-_.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=ls(E,l)}setPitchBearing(t,l){this.orientation=_a(c.degToRad(t),c.degToRad(-l))}}class cs{constructor(t,l){this._transform=c.identity([]),this._orientation=c.identity$1([]),l&&(this._orientation=l,Cs(this._transform,this._orientation)),t&&$a(this._transform,t)}get mercatorPosition(){const t=this.position;return new c.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=Ys(this._transform,3);return[t[0],t[1],t[2]]}set position(t){$a(this._transform,t)}get orientation(){return this._orientation}set orientation(t){this._orientation=t,Cs(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,l){this._orientation=_a(t,l),Cs(this._transform,this._orientation)}forward(){const t=Ys(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=Ys(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=Ys(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,l){const p=new Float64Array(16);return c.invert(p,this.getWorldToCamera(t,l)),p}getWorldToCameraPosition(t,l,p){const _=this.position;c.scale(_,_,-t);const v=new Float64Array(16);return c.fromScaling(v,[p,p,p]),c.translate(v,v,_),v[10]*=l,v}getWorldToCamera(t,l){const p=new Float64Array(16),_=new Float64Array(4),v=this.position;return c.conjugate(_,this._orientation),c.scale(v,v,-t),c.fromQuat(p,_),c.translate(p,p,v),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(t,l,p,_){const v=new Float64Array(16);return c.perspective(v,t,l,p,_),v}getDistanceToElevation(t){const l=0===t?0:c.mercatorZfromAltitude(t,this.position[1]),p=this.forward();return(l-this.position[2])/p[2]}clone(){return new cs([...this.position],[...this.orientation])}}function vl(d,t){const l=wi(d),p=function(v,E,S,R,z){const N=new c.LngLat(S.lng-180*Ri,S.lat),j=new c.LngLat(S.lng+180*Ri,S.lat),Q=v.project(N.lng,N.lat),oe=v.project(j.lng,j.lat),ie=-Math.atan2(oe.y-Q.y,oe.x-Q.x),re=c.MercatorCoordinate.fromLngLat(S);re.y=c.clamp(re.y,-.999975,.999975);const pe=re.toLngLat(),se=v.project(pe.lng,pe.lat),me=c.MercatorCoordinate.fromLngLat(pe);me.x+=Ri;const _e=me.toLngLat(),le=v.project(_e.lng,_e.lat),ye=pc(le.x-se.x,le.y-se.y,ie),Ee=c.MercatorCoordinate.fromLngLat(pe);Ee.y+=Ri;const Ze=Ee.toLngLat(),Ge=v.project(Ze.lng,Ze.lat),tt=pc(Ge.x-se.x,Ge.y-se.y,ie),nt=Math.abs(ye.x)/Math.abs(tt.y),xt=c.identity([]);c.rotateZ(xt,xt,-ie*(1-(z?0:R)));const Xe=c.identity([]);return c.scale$1(Xe,Xe,[1,1-(1-nt)*R,1]),Xe[4]=-tt.x/tt.y*R,c.rotateZ(Xe,Xe,ie),c.multiply(Xe,xt,Xe),Xe}(d.projection,0,d.center,l,t),_=ya(d);return c.scale$1(p,p,[_,_,1]),p}function ya(d){const t=d.projection,l=wi(d),p=vr(t,d.center),_=vr(t,c.LngLat.convert(t.center));return Math.pow(2,p*l+(1-l)*_)}function wi(d){const t=d.projection.range;if(!t)return 0;const l=Math.max(d.width,d.height),p=Math.log(l/1024)/Math.LN2;return c.smoothstep(t[0]+p,t[1]+p,d.zoom)}const Ri=1/4e4;function vr(d,t){const l=c.clamp(t.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),p=new c.LngLat(t.lng-180*Ri,l),_=new c.LngLat(t.lng+180*Ri,l),v=d.project(p.lng,l),E=d.project(_.lng,l),S=c.MercatorCoordinate.fromLngLat(p),R=c.MercatorCoordinate.fromLngLat(_),z=E.x-v.x,N=E.y-v.y,j=R.x-S.x,Q=R.y-S.y,oe=Math.sqrt((j*j+Q*Q)/(z*z+N*N));return Math.log(oe)/Math.LN2}function pc(d,t,l){const p=Math.cos(l),_=Math.sin(l);return{x:d*p-t*_,y:d*_+t*p}}class Hl{constructor(t,l,p,_,v){this.tileSize=512,this._renderWorldCopies=void 0===v||v,this._minZoom=t||0,this._maxZoom=l||22,this._minPitch=null==p?0:p,this._maxPitch=null==_?60:_,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new as,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new cs,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const t=new Hl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t.tileSize=this.tileSize,t.setMaxBounds(this.getMaxBounds()),t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._cameraZoom=this._cameraZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.setProjection(this.getProjection()),t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,t?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(t){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),t&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return c.pick(this.projection,["name","center","parallels"])}setProjection(t){null==t&&(t={name:"mercator"}),this.projectionOptions=t;const l=this.projection?this.getProjection():void 0;return this.projection=c.getProjection(t),!Ve(l,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.wrap}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return c.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return c.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.pointGeometry(this.width,this.height)}get bearing(){return c.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const l=-t*Math.PI/180;var p,_,v,E,S,R,z,N,j,Q;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(p=new c.ARRAY_TYPE(4),c.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),_=this.rotationMatrix,E=this.angle,S=(v=this.rotationMatrix)[0],R=v[1],z=v[2],N=v[3],j=Math.sin(E),Q=Math.cos(E),_[0]=S*Q+z*j,_[1]=R*Q+N*j,_[2]=S*-j+z*Q,_[3]=R*-j+N*Q)}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const l=c.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(t){const l=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===t?(this._cameraZoom=null,!1):(this._centerAltitude=t,!0)}_updateCameraOnTerrain(){const t=this.cameraToCenterDistance/this.worldSize,l=c.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(l+t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let _=0,v=0;for(let E=0;E<l.length;E++){const S=new c.pointGeometry(l[E][0]*this.width,p+l[E][1]*(this.height-p)),R=t.pointCoordinate(S);if(!R)continue;const z=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);_+=R[3]*z,v+=z}return 0===v?NaN:_/v}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const t=this._cameraZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=c.mercatorZfromAltitude(l,this.center.lat),_=this._mercatorZfromZoom(t),v=this._mercatorZfromZoom(this._maxZoom),E=Math.max(_-p,v);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let p;p=t.z<this._camera.position[2]?[l.x,l.y,l.z]:[t.x,t.y,t.z];const _=c.length(c.sub([],this._camera.position,p));return c.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let l=!1;if(t.orientation&&!c.exactEquals(t.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(t.orientation)),t.position){const p=[t.position.x,t.position.y,t.position.z];c.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,l=new yl;return l.position=new c.MercatorCoordinate(t[0],t[1],t[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(t){if(!c.length$1(t))return!1;c.normalize$1(t,t);const l=c.transformQuat([],[0,0,-1],t),p=c.transformQuat([],[0,-1,0],t);if(p[2]<0)return!1;const _=ls(l,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(t){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;t[2]=c.clamp(t[2],_/p,_/l),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,l,p){this._unmodified=!1,this._edgeInsets.interpolate(t,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const l=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(t){const l=[new c.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const p=this.pointCoordinate(new c.pointGeometry(0,0)),_=this.pointCoordinate(new c.pointGeometry(this.width,0)),v=this.pointCoordinate(new c.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new c.pointGeometry(0,this.height)),S=Math.floor(Math.min(p.x,_.x,v.x,E.x)),R=Math.floor(Math.max(p.x,_.x,v.x,E.x)),z=1;for(let N=S-z;N<=R+z;N++)0!==N&&l.push(new c.UnwrappedTileID(N,t))}return l}coveringTiles(t){let l=this.coveringZoomLevel(t);const p=l,_=this.elevation&&!t.isTerrainDEM,v="mercator"===this.projection.name;if(void 0!==t.minzoom&&l<t.minzoom)return[];void 0!==t.maxzoom&&l>t.maxzoom&&(l=t.maxzoom);const E=this.locationCoordinate(this.center),S=1<<l,R=[S*E.x,S*E.y,0],z=ln.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l),N=this.pointCoordinate(this.getCameraPoint()),j=S*c.mercatorZfromAltitude(1,this.center.lat),Q=this._camera.position[2]/c.mercatorZfromAltitude(1,this.center.lat),oe=[S*N.x,S*N.y,Q],ie=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),re=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&v?l:0,pe=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,se=t.isTerrainDEM?-pe:this._elevation?this._elevation.getMinElevationBelowMSL():0,me=ya(this),_e=Ne=>{const St=1/4e4,jt=new c.MercatorCoordinate(Ne.x+St,Ne.y,Ne.z),un=new c.MercatorCoordinate(Ne.x,Ne.y+St,Ne.z),mn=Ne.toLngLat(),yn=jt.toLngLat(),hn=un.toLngLat(),nn=this.locationCoordinate(mn),An=this.locationCoordinate(yn),Dn=this.locationCoordinate(hn),si=Math.hypot(An.x-nn.x,An.y-nn.y),so=Math.hypot(Dn.x-nn.x,Dn.y-nn.y);return Math.sqrt(si*so)*me/St},le=(Ne,St,jt,un,mn,yn)=>{const hn=c.tileTransform({z:Ne,x:St,y:jt},this.projection);return new Yt([(un+hn.x/hn.scale)*S,S*(hn.y/hn.scale),mn],[(un+hn.x2/hn.scale)*S,S*(hn.y2/hn.scale),yn])},ye=Ne=>({aabb:le(0,0,0,Ne,se,pe),zoom:0,x:0,y:0,wrap:Ne,fullyVisible:!1}),Ee=[];let Ze=[];const Ge=l,tt=t.reparseOverscaled?p:l,nt=Ne=>{if(!this._elevation||!Ne.tileID)return;const St=this._elevation.getMinMaxForTile(Ne.tileID),jt=Ne.aabb;St?(jt.min[2]=St.min,jt.max[2]=St.max,jt.center[2]=(jt.min[2]+jt.max[2])/2):(Ne.shouldSplit=Et(Ne),Ne.shouldSplit||(jt.min[2]=jt.max[2]=jt.center[2]=this._centerAltitude))},xt=Ne=>Ne*Ne,Xe=xt((Q-this._centerAltitude)*j),Et=Ne=>{if(Ne.zoom<re)return!0;if(Ne.zoom===Ge)return!1;if(null!=Ne.shouldSplit)return Ne.shouldSplit;const St=Ne.aabb.distanceX(oe),jt=Ne.aabb.distanceY(oe);let un=Xe;_&&(un=xt(Ne.aabb.distanceZ(oe)*j));let mn=1;if(!v&&p<=5){const hn=Math.pow(2,Ne.zoom),nn=_e(new c.MercatorCoordinate((Ne.x+.5)/hn,(Ne.y+.5)/hn));mn=nn>.85?1:nn}const yn=St*St+jt*jt+un;return yn<xt((1<<Ge-Ne.zoom)*ie*mn*((hn,nn)=>{if(nn*xt(.707)<hn)return 1;const An=Math.sqrt(nn/hn);return An/(1.4144271570014144+(Math.pow(1.1,An-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(un,Xe),yn))};if(this.renderWorldCopies)for(let Ne=1;Ne<=3;Ne++)Ee.push(ye(-Ne)),Ee.push(ye(Ne));for(Ee.push(ye(0));Ee.length>0;){const Ne=Ee.pop(),St=Ne.x,jt=Ne.y;let un=Ne.fullyVisible;if(!un){const mn=Ne.aabb.intersects(z);if(0===mn)continue;un=2===mn}if(Ne.zoom!==Ge&&Et(Ne))for(let mn=0;mn<4;mn++){const yn=(St<<1)+mn%2,hn=(jt<<1)+(mn>>1),nn={aabb:"mercator"===this.projection.name?Ne.aabb.quadrant(mn):le(Ne.zoom+1,yn,hn,Ne.wrap,0,0),zoom:Ne.zoom+1,x:yn,y:hn,wrap:Ne.wrap,fullyVisible:un,tileID:void 0,shouldSplit:void 0};_&&(nn.tileID=new c.OverscaledTileID(Ne.zoom+1===Ge?tt:Ne.zoom+1,Ne.wrap,Ne.zoom+1,yn,hn),nt(nn)),Ee.push(nn)}else{const mn=Ne.zoom===Ge?tt:Ne.zoom;if(t.minzoom&&t.minzoom>mn)continue;const yn=R[0]-(.5+St+(Ne.wrap<<Ne.zoom))*(1<<l-Ne.zoom),hn=R[1]-.5-jt,nn=Ne.tileID?Ne.tileID:new c.OverscaledTileID(mn,Ne.wrap,Ne.zoom,St,jt);Ze.push({tileID:nn,distanceSq:yn*yn+hn*hn})}}if(this.fogCullDistSq){const Ne=this.fogCullDistSq,St=this.horizonLineFromTop();Ze=Ze.filter(jt=>{const un=[0,0,0,1],mn=[c.EXTENT,c.EXTENT,0,1],yn=this.calculateFogTileMatrix(jt.tileID.toUnwrapped());c.transformMat4(un,un,yn),c.transformMat4(mn,mn,yn);const hn=c.getAABBPointSquareDist(un,mn);if(0===hn)return!0;let nn=!1;const An=this._elevation;if(An&&hn>Ne&&0!==St){const Dn=this.calculateProjMatrix(jt.tileID.toUnwrapped());let si;t.isTerrainDEM||(si=An.getMinMaxForTile(jt.tileID)),si||(si={min:se,max:pe});const so=c.furthestTileCorner(this.rotation),Fi=[so[0]*c.EXTENT,so[1]*c.EXTENT,si.max];c.transformMat4$1(Fi,Fi,Dn),nn=(1-Fi[1])*this.height*.5<St}return hn<Ne||nn})}return Ze.sort((Ne,St)=>Ne.distanceSq-St.distanceSq).map(Ne=>Ne.tileID)}resize(t,l){this.width=t,this.height=l,this.pixelsToGLUnits=[2/t,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const l=c.clamp(t.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),p=this.projection.project(t.lng,l);return new c.pointGeometry(p.x*this.worldSize,p.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(t,l){const p=this.pointCoordinate(l),_=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(t);this.setLocation(new c.MercatorCoordinate(v.x-(p.x-_.x),v.y-(p.y-_.y)))}setLocation(t){this.center=this.coordinateLocation(t),this.renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t){return this._coordinatePoint(this.locationCoordinate(t),!1)}locationPoint3D(t){return this._coordinatePoint(this.locationCoordinate(t),!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,l){const p=l?c.mercatorZfromAltitude(l,t.lat):void 0,_=this.projection.project(t.lng,t.lat);return new c.MercatorCoordinate(_.x,_.y,p)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,l){const p=null!=l?l:this._centerAltitude,_=[t.x,t.y,0,1],v=[t.x,t.y,1,1];c.transformMat4(_,_,this.pixelMatrixInverse),c.transformMat4(v,v,this.pixelMatrixInverse);const E=v[3];c.scale$2(_,_,1/_[3]),c.scale$2(v,v,1/E);const S=_[2],R=v[2];return{p0:_,p1:v,t:S===R?0:(p-S)/(R-S)}}screenPointToMercatorRay(t){const l=[t.x,t.y,0,1],p=[t.x,t.y,1,1];return c.transformMat4(l,l,this.pixelMatrixInverse),c.transformMat4(p,p,this.pixelMatrixInverse),c.scale$2(l,l,1/l[3]),c.scale$2(p,p,1/p[3]),l[2]=c.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,p[2]=c.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,c.scale$2(l,l,1/this.worldSize),c.scale$2(p,p,1/this.worldSize),new Ot([l[0],l[1],l[2]],c.normalize([],c.sub([],p,l)))}rayIntersectionCoordinate(t){const{p0:l,p1:p,t:_}=t,v=c.mercatorZfromAltitude(l[2],this._center.lat),E=c.mercatorZfromAltitude(p[2],this._center.lat);return new c.MercatorCoordinate(c.number(l[0],p[0],_)/this.worldSize,c.number(l[1],p[1],_)/this.worldSize,c.number(v,E,_))}pointCoordinate(t,l=this._centerAltitude){const p=this.horizonLineFromTop(!1),_=new c.pointGeometry(t.x,Math.max(p,t.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(_,l))}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);const l=this.elevation;let p=this.elevation.pointCoordinate(t);if(p)return new c.MercatorCoordinate(p[0],p[1],p[2]);let _=0,v=this.horizonLineFromTop();if(t.y>v)return this.pointCoordinate(t);const E=.02*v,S=t.clone();for(let R=0;R<10&&v-_>E;R++){S.y=c.number(_,v,.66);const z=l.pointCoordinate(S);z?(v=S.y,p=z):_=S.y}return p?new c.MercatorCoordinate(p[0],p[1],p[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){if(this.elevation)return!this.elevation.pointCoordinate(t);{const l=this.horizonLineFromTop();return t.y<l}}_coordinatePoint(t,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,_=[t.x*this.worldSize,t.y*this.worldSize,p+t.toAltitude(),1];return c.transformMat4(_,_,this.pixelMatrix),_[3]>0?new c.pointGeometry(_[0]/_[3],_[1]/_[3]):new c.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(t,l){const p=new c.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),_=new c.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),v=new c.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),E=new c.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let S=this.pointCoordinate(p,t),R=this.pointCoordinate(_,t);const z=this.pointCoordinate(v,l),N=this.pointCoordinate(E,l),j=(Q,oe)=>(oe.y-Q.y)/(oe.x-Q.x);return S.y>1&&R.y>=0?S=new c.MercatorCoordinate((1-N.y)/j(N,S)+N.x,1):S.y<0&&R.y<=1&&(S=new c.MercatorCoordinate(-N.y/j(N,S)+N.x,0)),R.y>1&&S.y>=0?R=new c.MercatorCoordinate((1-z.y)/j(z,R)+z.x,1):R.y<0&&S.y<=1&&(R=new c.MercatorCoordinate(-z.y/j(z,R)+z.x,0)),(new c.LngLatBounds).extend(this.coordinateLocation(S)).extend(this.coordinateLocation(R)).extend(this.coordinateLocation(N)).extend(this.coordinateLocation(z))}_getBounds3D(){const t=this.elevation,l=t.visibleDemTiles.reduce((p,_)=>{if(_.dem){const v=_.dem.tree;p.min=Math.min(p.min,v.minimums[0]),p.max=Math.max(p.max,v.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(l.min*t.exaggeration(),l.max*t.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(t=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return t?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-c.MAX_MERCATOR_LATITUDE,this.maxLat=c.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=c.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=c.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=c.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=c.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,l){let p,_,v;const E=t.canonical,S=c.identity(new Float64Array(16));if("mercator"===this.projection.name)p=l/this.zoomScale(E.z),_=(E.x+Math.pow(2,E.z)*t.wrap)*p,v=E.y*p;else{const R=c.tileTransform(E,this.projection);p=1,_=R.x+t.wrap*R.scale,v=R.y,c.scale$1(S,S,[p/R.scale,p/R.scale,this.pixelsPerMeter/this.worldSize])}return c.translate(S,S,[_,v,0]),c.scale$1(S,S,[p/c.EXTENT,p/c.EXTENT,1]),S}calculateDistanceTileData(t){const l=t.key,p=this._distanceTileDataCache;if(p[l])return p[l];const _=t.canonical,v=1/this.height,E=this.cameraWorldSize/this.zoomScale(_.z),S=(_.x+Math.pow(2,_.z)*t.wrap)*E,R=_.y*E,z=this.point,N=this.angle,j=Math.sin(-N),Q=-Math.cos(-N);return p[l]={bearing:[j,Q],center:[(z.x-S)*v,(z.y-R)*v],scale:E/c.EXTENT*v},p[l]}calculateFogTileMatrix(t){const l=t.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const _=this.calculatePosMatrix(t,this.cameraWorldSize);return c.multiply(_,this.worldToFogMatrix,_),p[l]=new Float32Array(_),p[l]}calculateProjMatrix(t,l=!1){const p=t.key,_=l?this._alignedProjMatrixCache:this._projMatrixCache;if(_[p])return _[p];const v=this.calculatePosMatrix(t,this.worldSize);return c.multiply(v,"mercator"===this.projection.name?l?this.alignedProjMatrix:this.projMatrix:this.mercatorMatrix,v),_[p]=new Float32Array(v),_[p]}calculatePixelsToTileUnitsMatrix(t){const l=t.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const _=function(v,E){const{scale:S}=v.tileTransform,R=S*c.EXTENT/(v.tileSize*Math.pow(2,E.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return z=new Float32Array(4),Q=(N=E.inverseAdjustmentMatrix)[1],oe=N[2],ie=N[3],pe=(j=[R,R])[1],z[0]=N[0]*(re=j[0]),z[1]=Q*re,z[2]=oe*pe,z[3]=ie*pe,z;var z,N,j,Q,oe,ie,re,pe}(t,this);return p[l]=_,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const l=this._camera.position,p=this._camera.forward();if(l[2]<=0||p[2]>=0)return;const _=c.mercatorZfromAltitude(1,this._center.lat);l[2]/=_,p[2]/=_,c.normalize(p,p);const v=t.raycast(l,p,t.exaggeration());if(v){const E=c.scaleAndAdd([],l,p,v),S=new c.MercatorCoordinate(E[0],E[1],c.mercatorZfromAltitude(E[2],c.latFromMercatorY(E[1]))),R=this._camera.position,z=S.z+c.length([S.x-R[0],S.y-R[1],S.z-R[2]]);this._cameraZoom=this._zoomFromMercatorZ(z),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const l=t.getAtPointOrZero(this._camera.mercatorPosition),p=this._minimumHeightOverTerrain()*Math.cos(c.degToRad(this._maxPitch)),_=c.mercatorZfromAltitude(l,this._center.lat),v=this._camera.position[2]-_;if(v<p){const E=this.locationCoordinate(this._center,this._centerAltitude),S=this._camera.mercatorPosition,R=[E.x-S.x,E.y-S.y,E.z-S.z],z=c.length(R);R[2]-=p-v;const N=c.length(R);if(0===N)return;c.scale(R,R,z/N),this._camera.position=[E.x-R[0],E.y-R[1],E.z-R[2]],this._camera.orientation=ls(R,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,"mercator"!==this.projection.name){const j=this.center;return j.lat=c.clamp(j.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(j.lng=c.clamp(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}const t=this._unmodified,{x:l,y:p}=this.point;let _=0,v=l,E=p;const S=this.width/2,R=this.height/2,z=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(p-R<z&&(E=z+R),p+R>N&&(E=N-R),N-z<this.height&&(_=Math.max(_,this.height/(N-z)),E=(N+z)/2),this.maxBounds||!this.renderWorldCopies){const j=this.worldMinX*this.scale,Q=this.worldMaxX*this.scale,oe=this.worldSize/2-(j+Q)/2;v=(l+oe+this.worldSize)%this.worldSize-oe,v-S<j&&(v=j+S),v+S>Q&&(v=Q-S),Q-j<this.width&&(_=Math.max(_,this.width/(Q-j)),v=(Q+j)/2)}v===l&&E===p||(this.center=this.unproject(new c.pointGeometry(v,E))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCameraAltitude(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const l=this.pixelsPerMeter;this._updateCameraState();const p=Math.PI/2+this._pitch,_=this.fovAboveCenter,v=this.elevation?this.elevation.getMinElevationBelowMSL()*l:0,E=(this._camera.position[2]*this.worldSize-v)/Math.cos(this._pitch),S=Math.sin(_)*E/Math.sin(c.clamp(Math.PI-p-_,.01,Math.PI-.01)),R=this.point,z=R.x,N=R.y,j=Math.cos(Math.PI/2-this._pitch)*S+E,Q=Math.min(1.01*j,E*(1/this._horizonShift)),oe=this.height/50,ie=this._camera.getWorldToCamera(this.worldSize,l),re=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,oe,Q);re[8]=2*-t.x/this.width,re[9]=2*t.y/this.height;let pe=c.mul$1([],re,ie);if("mercator"!==this.projection.name){const xt=this.locationCoordinate(this.center),Xe=c.identity([]);c.translate(Xe,Xe,[xt.x*this.worldSize,xt.y*this.worldSize,0]),c.multiply(Xe,Xe,vl(this)),c.translate(Xe,Xe,[-xt.x*this.worldSize,-xt.y*this.worldSize,0]),c.multiply(pe,pe,Xe),this.inverseAdjustmentMatrix=function(Et){const Ne=vl(Et,!0);return sn([],[Ne[0],Ne[1],Ne[4],Ne[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=c.scale$1([],pe,[this.worldSize,this.worldSize,this.worldSize/l]),this.projMatrix=pe,this.invProjMatrix=c.invert(new Float64Array(16),this.projMatrix);const se=new Float32Array(16);c.identity(se),c.scale$1(se,se,[1,-1,1]),c.rotateX(se,se,this._pitch),c.rotateZ(se,se,this.angle);const me=c.perspective(new Float32Array(16),this._fov,this.width/this.height,oe,Q),_e=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;me[8]=2*-t.x/this.width,me[9]=2*(t.y+_e)/this.height,this.skyboxMatrix=c.multiply(se,me,se);const le=this.width%2/2,ye=this.height%2/2,Ee=Math.cos(this.angle),Ze=Math.sin(this.angle),Ge=z-Math.round(z)+Ee*le+Ze*ye,tt=N-Math.round(N)+Ee*ye+Ze*le,nt=new Float64Array(pe);if(c.translate(nt,nt,[Ge>.5?Ge-1:Ge,tt>.5?tt-1:tt,0]),this.alignedProjMatrix=nt,pe=c.create$1(),c.scale$1(pe,pe,[this.width/2,-this.height/2,1]),c.translate(pe,pe,[1,-1,0]),this.labelPlaneMatrix=pe,pe=c.create$1(),c.scale$1(pe,pe,[1,-1,1]),c.translate(pe,pe,[-1,-1,0]),c.scale$1(pe,pe,[2/this.width,2/this.height,1]),this.glCoordMatrix=pe,this.pixelMatrix=c.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},pe=c.invert(new Float64Array(16),this.pixelMatrix),!pe)throw new Error("failed to invert matrix");this.pixelMatrixInverse=pe,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,l=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height,v=[t,t,l];c.scale(v,v,_),c.scale(p,p,-1),c.multiply$1(p,p,v);const E=c.create$1();c.translate(E,E,p),c.scale$1(E,E,v),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,l,_)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const t=this._camera.forward(),l=this.cameraToCenterDistance,p=this.point,_=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-c.mercatorZfromAltitude(this._centerAltitude,this.center.lat),v=this.cameraToCenterDistance/_;this._camera.position=[p.x/this.worldSize-t[0]*l/v,p.y/this.worldSize-t[1]*l/v,c.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-t[2]*l/v]}_translateCameraConstrained(t){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=t[2];let _=1;p>0&&(_=Math.min((l-this._camera.position[2])/p,1)),this._camera.position=c.scaleAndAdd([],this._camera.position,t,_),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),v=c.mercatorZfromAltitude(this._centerAltitude,this.center.lat),E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(c.degToRad(this._maxPitch)),S=Math.max((t[2]-v)/Math.cos(p),E),R=this._zoomFromMercatorZ(S);c.scaleAndAdd(t,t,l,S),this._pitch=c.clamp(p,c.degToRad(this.minPitch),c.degToRad(this.maxPitch)),this.angle=c.wrap(_,-Math.PI,Math.PI),this._setZoom(c.clamp(R,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new c.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!(!this._elevation||"mercator"!==this.projection.name&&(c.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(t,l){const p=Math.min(t.x,l.x),_=Math.max(t.x,l.x),v=Math.min(t.y,l.y),E=Math.max(t.y,l.y);if(v<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const S=[new c.pointGeometry(p,v),new c.pointGeometry(_,E),new c.pointGeometry(p,E),new c.pointGeometry(_,v)],R=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const N of S){const j=this.pointRayIntersection(N);if(j.t<0)return!0;const Q=this.rayIntersectionCoordinate(j);if(Q.x<R||Q.y<0||Q.x>z||Q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+c.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new c.pointGeometry(0,0),new c.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,l){const p=c.length(c.sub([],this._camera.position,t)),_=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(_)}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.pointGeometry(0,t))}}function Ga(d,t){let l=!1,p=null;const _=()=>{p=null,l&&(d(),p=setTimeout(_,t),l=!1)};return()=>(l=!0,p||_(),p)}class Ha{constructor(t){this._hashName=t&&encodeURIComponent(t),c.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ga(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,c.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return c.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const l=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,_),E=Math.round(l.lng*v)/v,S=Math.round(l.lat*v)/v,R=this._map.getBearing(),z=this._map.getPitch();let N="";if(N+=t?`/${E}/${S}/${p}`:`${p}/${S}/${E}`,(R||z)&&(N+="/"+Math.round(10*R)/10),z&&(N+=`/${Math.round(z)}`),this._hashName){const j=this._hashName;let Q=!1;const oe=c.window.location.hash.slice(1).split("&").map(ie=>{const re=ie.split("=")[0];return re===j?(Q=!0,`${re}=${N}`):ie}).filter(ie=>ie);return Q||oe.push(`${j}=${N}`),`#${oe.join("&")}`}return`#${N}`}_getCurrentHash(){const t=c.window.location.hash.replace("#","");if(this._hashName){let l;return t.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:l,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=c.window.location.href.replace(/(#.+)?$/,this.getHashString());c.window.history.replaceState(c.window.history.state,null,t)}}const va={linearity:.3,easing:c.bezier(0,0,.3,1)},mc=c.extend({deceleration:2500,maxSpeed:1400},va),Za=c.extend({deceleration:20,maxSpeed:1400},va),Ks=c.extend({deceleration:1e3,maxSpeed:360},va),Qs=c.extend({deceleration:1e3,maxSpeed:90},va);class xl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,l=c.exported.now();for(;t.length>0&&l-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new c.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){const v=Ei(l.pan.mag(),p,c.extend({},mc,t||{}));_.offset=l.pan.mult(v.amount/l.pan.mag()),_.center=this._map.transform.center,xa(_,v)}if(l.zoom){const v=Ei(l.zoom,p,Za);_.zoom=this._map.transform.zoom+v.amount,xa(_,v)}if(l.bearing){const v=Ei(l.bearing,p,Ks);_.bearing=this._map.transform.bearing+c.clamp(v.amount,-179,179),xa(_,v)}if(l.pitch){const v=Ei(l.pitch,p,Qs);_.pitch=this._map.transform.pitch+v.amount,xa(_,v)}if(_.zoom||_.bearing){const v=void 0===l.pinchAround?l.around:l.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),c.extend(_,{noMoveStart:!0})}}function xa(d,t){(!d.duration||d.duration<t.duration)&&(d.duration=t.duration,d.easing=t.easing)}function Ei(d,t,l){const{maxSpeed:p,linearity:_,deceleration:v}=l,E=c.clamp(d*_/(t/1e3),-p,p),S=Math.abs(E)/(v*_);return{easing:l.easing,duration:1e3*S,amount:E*(S/2)}}class qr extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,l,p,_={}){const v=ze.mousePos(l.getCanvasContainer(),p),E=l.unproject(v);super(t,c.extend({point:v,lngLat:E,originalEvent:p},_)),this._defaultPrevented=!1,this.target=l}}class Io extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,l,p){const _="touchend"===t?p.changedTouches:p.touches,v=ze.touchPos(l.getCanvasContainer(),_),E=v.map(R=>l.unproject(R)),S=v.reduce((R,z,N,j)=>R.add(z.div(j.length)),new c.pointGeometry(0,0));super(t,{points:v,point:S,lngLats:E,lngLat:l.unproject(S),originalEvent:p}),this._defaultPrevented=!1}}class us extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,l,p){super(t,{originalEvent:p}),this._defaultPrevented=!1}}class bl{constructor(t,l){this._map=t,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new us(t.type,this._map,t))}mousedown(t,l){return this._mousedownPos=l,this._firePreventable(new qr(t.type,this._map,t))}mouseup(t){this._map.fire(new qr(t.type,this._map,t))}preclick(t){const l=c.extend({},t);l.type="preclick",this._map.fire(new qr(l.type,this._map,l))}click(t,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(t),this._map.fire(new qr(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new qr(t.type,this._map,t))}mouseover(t){this._map.fire(new qr(t.type,this._map,t))}mouseout(t){this._map.fire(new qr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Io(t.type,this._map,t))}touchmove(t){this._map.fire(new Io(t.type,this._map,t))}touchend(t){this._map.fire(new Io(t.type,this._map,t))}touchcancel(t){this._map.fire(new Io(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Uo{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(t){this._map.fire(new qr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new qr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new qr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qa{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,l){this.isEnabled()&&t.shiftKey&&0===t.button&&(ze.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(t,l){if(!this._active)return;const p=l;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=ze.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const v=Math.min(_.x,p.x),E=Math.max(_.x,p.x),S=Math.min(_.y,p.y),R=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(ze.setTransform(this._box,`translate(${v}px,${S}px)`),this._box.style.width=E-v+"px",this._box.style.height=R-S+"px")})}mouseupWindow(t,l){if(!this._active||0!==t.button)return;const p=this._startPos,_=l;if(this.reset(),ze.suppressClick(),p.x!==_.x||p.y!==_.y)return this._map.fire(new c.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:v=>v.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(ze.remove(this._box),this._box=null),ze.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,l){return this._map.fire(new c.Event(t,{originalEvent:l}))}}function wl(d,t){const l={};for(let p=0;p<d.length;p++)l[d[p].identifier]=t[p];return l}class Zl{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const v=new c.pointGeometry(0,0);for(const E of _)v._add(E);return v.div(_.length)}(l),this.touches=wl(p,l)))}touchmove(t,l,p){if(this.aborted||!this.centroid)return;const _=wl(p,l);for(const v in this.touches){const E=this.touches[v],S=_[v];(!S||S.dist(E)>30)&&(this.aborted=!0)}}touchend(t,l,p){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===p.length){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class ql{constructor(t){this.singleTap=new Zl(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,l,p){this.singleTap.touchstart(t,l,p)}touchmove(t,l,p){this.singleTap.touchmove(t,l,p)}touchend(t,l,p){const _=this.singleTap.touchend(t,l,p);if(_){const v=t.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(_)<30;if(v&&E||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Li{constructor(){this._zoomIn=new ql({numTouches:1,numTaps:2}),this._zoomOut=new ql({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,l,p){this._zoomIn.touchstart(t,l,p),this._zoomOut.touchstart(t,l,p)}touchmove(t,l,p){this._zoomIn.touchmove(t,l,p),this._zoomOut.touchmove(t,l,p)}touchend(t,l,p){const _=this._zoomIn.touchend(t,l,p),v=this._zoomOut.touchend(t,l,p);return _?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(_)},{originalEvent:t})}):v?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(v)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Wa={0:1,2:2};class no{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,l){return!1}_move(t,l){return{}}mousedown(t,l){if(this._lastPoint)return;const p=ze.mouseButton(t);this._correctButton(t,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(t,l){const p=this._lastPoint;if(p)if(t.preventDefault(),function(_,v){const E=Wa[v];return void 0===_.buttons||(_.buttons&E)!==E}(t,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}mouseupWindow(t){this._lastPoint&&ze.mouseButton(t)===this._eventButton&&(this._moved&&ze.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wl extends no{mousedown(t,l){super.mousedown(t,l),this._lastPoint&&(this._active=!0)}_correctButton(t,l){return 0===l&&!t.ctrlKey}_move(t,l){return{around:l,panDelta:l.sub(t)}}}class fi extends no{_correctButton(t,l){return 0===l&&t.ctrlKey||2===l}_move(t,l){const p=.8*(l.x-t.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(t){t.preventDefault()}}class hs extends no{_correctButton(t,l){return 0===l&&t.ctrlKey||2===l}_move(t,l){const p=-.5*(l.y-t.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(t){t.preventDefault()}}class gc{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),c.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new c.pointGeometry(0,0)}touchstart(t,l,p){return this._calculateTransform(t,l,p)}touchmove(t,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===p.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.preventDefault(),this._calculateTransform(t,l,p)}}touchend(t,l,p){this._calculateTransform(t,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,l,p){p.length>0&&(this._active=!0);const _=wl(p,l),v=new c.pointGeometry(0,0),E=new c.pointGeometry(0,0);let S=0;for(const z in _){const N=_[z],j=this._touches[z];j&&(v._add(N),E._add(N.sub(j)),S++,_[z]=N)}if(this._touches=_,S<this._minTouches||!E.mag())return;const R=E.div(S);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(S),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ze.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Ts{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,l,p){return{}}touchstart(t,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(t,l,p){if(!this._firstTwoTouches)return;t.preventDefault();const[_,v]=this._firstTwoTouches,E=El(p,l,_),S=El(p,l,v);if(!E||!S)return;const R=this._aroundCenter?null:E.add(S).div(2);return this._move([E,S],R,t)}touchend(t,l,p){if(!this._firstTwoTouches)return;const[_,v]=this._firstTwoTouches,E=El(p,l,_),S=El(p,l,v);E&&S||(this._active&&ze.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function El(d,t,l){for(let p=0;p<d.length;p++)if(d[p].identifier===l)return t[p]}function Js(d,t){return Math.log(d/t)/Math.LN2}class Dl extends Ts{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,l){const p=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Js(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Js(this._distance,p),pinchAround:l}}}function ds(d,t){return 180*d.angleWith(t)/Math.PI}class Ko extends Ts{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,l){const p=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ds(this._vector,p),pinchAround:l}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const l=25/(Math.PI*this._minDiameter)*360,p=ds(t,this._startVector);return Math.abs(p)<l}}function Xa(d){return Math.abs(d.y)>Math.abs(d.x)}class Xl extends Ts{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(t){this._lastPoints=t,Xa(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,l,p){const _=t[0].sub(this._lastPoints[0]),v=t[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&p.touches.length<3)&&(this._valid=this.gestureBeginsVertically(_,v,p.timeStamp),this._valid))return this._lastPoints=t,this._active=!0,{pitchDelta:(_.y+v.y)/2*-.5}}gestureBeginsVertically(t,l,p){if(void 0!==this._valid)return this._valid;const _=t.mag()>=2,v=l.mag()>=2;if(!_&&!v)return;if(!_||!v)return void 0===this._firstMove&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=t.y>0==l.y>0;return Xa(t)&&Xa(l)&&E}}const Ya={panStep:100,bearingStep:15,pitchStep:10};class Bt{constructor(){const t=Ya;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let l=0,p=0,_=0,v=0,E=0;switch(t.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:t.shiftKey?p=-1:(t.preventDefault(),v=-1);break;case 39:t.shiftKey?p=1:(t.preventDefault(),v=1);break;case 38:t.shiftKey?_=1:(t.preventDefault(),E=-1);break;case 40:t.shiftKey?_=-1:(t.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:S=>{const R=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:ba,zoom:l?Math.round(R)+l*(t.shiftKey?2:1):R,bearing:S.getBearing()+p*this._bearingStep,pitch:S.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-E*this._panStep],center:S.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ba(d){return d*(2-d)}const Ka=4.000244140625;class Ss{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,c.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=t.deltaMode===c.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const p=c.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,0!==l&&l%Ka==0?this._type="wheel":0!==l&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),t.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=t,this._delta-=l,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=ze.mousePos(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform,l=()=>t._terrainEnabled()?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const R="wheel"===this._type&&Math.abs(this._delta)>Ka?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&0!==z&&(z=1/z);const N=l(),j=Math.pow(2,N),Q="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(Q*z))),"wheel"===this._type&&(this._startZoom=l(),this._easing=this._smoothOutEasing(200)),this._delta=0}const p="number"==typeof this._targetZoom?this._targetZoom:l(),_=this._startZoom,v=this._easing;let E,S=!1;if("wheel"===this._type&&_&&v){const R=Math.min((c.exported.now()-this._lastWheelEventTime)/200,1),z=v(R);E=c.number(_,p,z),R<1?this._frameId||(this._frameId=!0):S=!0}else E=p,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:E-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let l=c.ease;if(this._prevEase){const p=this._prevEase,_=(c.exported.now()-p.start)/p.duration,v=p.easing(_+.01)-p.easing(_),E=.27/Math.sqrt(v*v+1e-4)*.01,S=Math.sqrt(.0729-E*E);l=c.bezier(E,S,.25,1)}return this._prevEase={start:c.exported.now(),duration:t,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ze.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(c.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!c.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Is{constructor(t,l){this._clickZoom=t,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Cl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,l){return t.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(t.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class M{constructor(){this._tap=new ql({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,l,p){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(t,l,p))}touchmove(t,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=l[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,t.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(t,l,p)}touchend(t,l,p){this._tapTime?this._swipePoint&&0===p.length&&this.reset():this._tap.touchend(t,l,p)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class T{constructor(t,l,p){this._el=t,this._mousePan=l,this._touchPan=p}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class C{constructor(t,l,p){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class L{constructor(t,l,p,_){this._el=t,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const U=d=>d.zoom||d.drag||d.pitch||d.rotate;class X extends c.Event{}class ge{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,l){const p=c.sub([],l,t);this.radius=c.length(p[2]<0?c.div([],p,this.constants):[p[0],p[1],0])}projectRay(t){c.div(t,t,this.constants),c.normalize(t,t),c.mul$2(t,t,this.constants);const l=c.scale([],t,this.radius);if(l[2]>0){const p=c.scale([],[0,0,1],c.dot(l,[0,0,1])),_=c.scale([],c.normalize([],[l[0],l[1],0]),this.radius),v=c.add([],l,c.scale([],c.sub([],c.add([],_,p),l),2));l[0]=v[0],l[1]=v[1]}return l}}function be(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Ue{constructor(t,l){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new xl(t),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ge,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),c.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[c.window.document,"mousemove",{capture:!0}],[c.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[c.window,"blur",void 0]];for(const[_,v,E]of this._listeners)ze.addEventListener(_,v,_===c.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[t,l,p]of this._listeners)ze.removeEventListener(t,l,t===c.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(t){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new bl(l,t));const _=l.boxZoom=new qa(l,t);this._add("boxZoom",_);const v=new Li,E=new Cl;l.doubleClickZoom=new Is(E,v),this._add("tapZoom",v),this._add("clickZoom",E);const S=new M;this._add("tapDragZoom",S);const R=l.touchPitch=new Xl(l);this._add("touchPitch",R);const z=new fi(t),N=new hs(t);l.dragRotate=new C(t,z,N),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]);const j=new Wl(t),Q=new gc(l,t);l.dragPan=new T(p,j,Q),this._add("mousePan",j),this._add("touchPan",Q,["touchZoom","touchRotate"]);const oe=new Ko,ie=new Dl;l.touchZoomRotate=new L(p,ie,oe,S),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",ie,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Uo(l));const re=l.scrollZoom=new Ss(l,this);this._add("scrollZoom",re,["mousePan"]);const pe=l.keyboard=new Bt;this._add("keyboard",pe);for(const se of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[se]&&l[se].enable(t[se])}_add(t,l,p){this._handlers.push({handlerName:t,handler:l,allowed:p}),this._handlersById[t]=l}stop(t){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(U(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,l,p){for(const _ in t)if(_!==p&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const l=[];for(const p of t)this._el.contains(p.target)&&l.push(p);return l}handleEvent(t,l){this._updatingCamera=!0;const p="renderFrame"===t.type,_=p?void 0:t,v={needsRenderFrame:!1},E={},S={},R=t.touches?this._getMapTouches(t.touches):void 0,z=R?ze.touchPos(this._el,R):p?void 0:ze.mousePos(this._el,t);for(const{handlerName:Q,handler:oe,allowed:ie}of this._handlers){if(!oe.isEnabled())continue;let re;this._blockedByActive(S,ie,Q)?oe.reset():oe[l||t.type]&&(re=oe[l||t.type](t,z,R),this.mergeHandlerResult(v,E,re,Q,_),re&&re.needsRenderFrame&&this._triggerRenderFrame()),(re||oe.isActive())&&(S[Q]=oe)}const N={};for(const Q in this._previousActiveHandlers)S[Q]||(N[Q]=_);this._previousActiveHandlers=S,(Object.keys(N).length||be(v))&&(this._changes.push([v,E,N]),this._triggerRenderFrame()),(Object.keys(S).length||be(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=v;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(t,l,p,_,v){if(!p)return;c.extend(t,p);const E={handlerName:_,originalEvent:p.originalEvent||v};void 0!==p.zoomDelta&&(l.zoom=E),void 0!==p.panDelta&&(l.drag=E),void 0!==p.pitchDelta&&(l.pitch=E),void 0!==p.bearingDelta&&(l.rotate=E)}_applyChanges(){const t={},l={},p={};for(const[_,v,E]of this._changes)_.panDelta&&(t.panDelta=(t.panDelta||new c.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+_.pitchDelta),void 0!==_.around&&(t.around=_.around),void 0!==_.aroundCoord&&(t.aroundCoord=_.aroundCoord),void 0!==_.pinchAround&&(t.pinchAround=_.pinchAround),_.noInertia&&(t.noInertia=_.noInertia),c.extend(l,v),c.extend(p,E);this._updateMapTransform(t,l,p),this._changes=[]}_updateMapTransform(t,l,p){const _=this._map,v=_.transform,E=me=>[me.x,me.y,me.z];if((me=>{const _e=this._eventsInProgress.drag;return _e&&!this._handlersById[_e.handlerName].isActive()})()&&!be(t)){const me=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",me!==v.zoom&&this._map._update(!0)}if(!be(t))return this._fireEvents(l,p,!0);let{panDelta:S,zoomDelta:R,bearingDelta:z,pitchDelta:N,around:j,aroundCoord:Q,pinchAround:oe}=t;void 0!==oe&&(j=oe),(me=>l.drag&&!this._eventsInProgress.drag)()&&j&&(this._dragOrigin=E(v.pointCoordinate3D(j)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",_._stop(!0),j=j||_.transform.centerPoint,z&&(v.bearing+=z),N&&(v.pitch+=N),v._updateCameraState();const ie=[0,0,0];if(S){const me=v.screenPointToMercatorRay(j),_e=v.screenPointToMercatorRay(j.sub(S)),le=this._trackingEllipsoid.projectRay(me.dir),ye=this._trackingEllipsoid.projectRay(_e.dir);ie[0]=ye[0]-le[0],ie[1]=ye[1]-le[1]}const re=v.zoom,pe=[0,0,0];if(R){const me=E(Q||v.pointCoordinate3D(j)),_e={dir:c.normalize([],c.sub([],me,v._camera.position))},le=v.screenPointToMercatorRay(v.centerPoint);if(_e.dir[2]<0){const ye=c.altitudeFromMercatorZ(me[2],me[1]),Ee=v.rayIntersectionCoordinate(v.pointRayIntersection(v.centerPoint,ye)),Ze=v.zoomDeltaToMovement(E(Ee),R)*(le.dir[2]/_e.dir[2]);c.scale(pe,_e.dir,Ze)}else if(v._terrainEnabled()){const ye=v.zoomDeltaToMovement(me,R);c.scale(pe,_e.dir,ye)}}const se=c.add(ie,ie,pe);v._translateCameraConstrained(se),R&&Math.abs(v.zoom-re)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(l,p,!0)}_fireEvents(t,l,p){const _=U(this._eventsInProgress),v=U(t),E={};for(const N in t){const{originalEvent:j}=t[N];this._eventsInProgress[N]||(E[`${N}start`]=j),this._eventsInProgress[N]=t[N]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(const N in E)this._fireEvent(N,E[N]);v&&this._fireEvent("move",v.originalEvent);for(const N in t){const{originalEvent:j}=t[N];this._fireEvent(N,j)}const S={};let R;for(const N in this._eventsInProgress){const{handlerName:j,originalEvent:Q}=this._eventsInProgress[N];this._handlersById[j].isActive()||(delete this._eventsInProgress[N],R=l[j]||Q,S[`${N}end`]=R)}for(const N in S)this._fireEvent(N,S[N]);const z=U(this._eventsInProgress);if(p&&(_||v)&&!z){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=Q=>0!==Q&&-this._bearingSnap<Q&&Q<this._bearingSnap;N?(j(N.bearing||this._map.getBearing())&&(N.bearing=0),this._map.easeTo(N,{originalEvent:R})):(this._map.fire(new c.Event("moveend",{originalEvent:R})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,l){this._map.fire(new c.Event(t,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new X("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Lt="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Mn extends c.Evented{constructor(t,l){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=l.bearingSnap,c.bindAll(["_renderFrameCallback"],this)}getCenter(){return new c.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,l){return this.jumpTo({center:t},l)}panBy(t,l,p){return t=c.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,c.extend({offset:t},l),p)}panTo(t,l,p){return this.easeTo(c.extend({center:t},l),p)}getZoom(){return this.transform.zoom}setZoom(t,l){return this.jumpTo({zoom:t},l),this}zoomTo(t,l,p){return this.easeTo(c.extend({zoom:t},l),p)}zoomIn(t,l){return this.zoomTo(this.getZoom()+1,t,l),this}zoomOut(t,l){return this.zoomTo(this.getZoom()-1,t,l),this}getBearing(){return this.transform.bearing}setBearing(t,l){return this.jumpTo({bearing:t},l),this}getPadding(){return this.transform.padding}setPadding(t,l){return this.jumpTo({padding:t},l),this}rotateTo(t,l,p){return this.easeTo(c.extend({bearing:t},l),p)}resetNorth(t,l){return this.rotateTo(0,c.extend({duration:1e3},t),l),this}resetNorthPitch(t,l){return this.easeTo(c.extend({bearing:0,pitch:0,duration:1e3},t),l),this}snapToNorth(t,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,l):this}getPitch(){return this.transform.pitch}setPitch(t,l){return this.jumpTo({pitch:t},l),this}cameraForBounds(t,l){t=c.LngLatBounds.convert(t);const p=l&&l.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),p,l)}_extendCameraOptions(t){const l={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=c.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const p=t.padding;t.padding={top:p,bottom:p,right:p,left:p}}return t.padding=c.extend(l,t.padding),t}_cameraForBoxAndBearing(t,l,p,_){const v=this._extendCameraOptions(_),E=this.transform,S=E.padding,R=E.project(c.LngLat.convert(t)),z=E.project(c.LngLat.convert(l)),N=R.rotate(-c.degToRad(p)),j=z.rotate(-c.degToRad(p)),Q=new c.pointGeometry(Math.max(N.x,j.x),Math.max(N.y,j.y)),oe=new c.pointGeometry(Math.min(N.x,j.x),Math.min(N.y,j.y)),ie=Q.sub(oe),re=(E.width-(S.left+S.right+v.padding.left+v.padding.right))/ie.x,pe=(E.height-(S.top+S.bottom+v.padding.top+v.padding.bottom))/ie.y;if(pe<0||re<0)return void c.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const se=Math.min(E.scaleZoom(E.scale*Math.min(re,pe)),v.maxZoom),me="number"==typeof v.offset.x?new c.pointGeometry(v.offset.x,v.offset.y):c.pointGeometry.convert(v.offset),_e=new c.pointGeometry((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(p*Math.PI/180),le=me.add(_e).mult(E.scale/E.zoomScale(se));return{center:E.unproject(R.add(z).div(2).sub(le)),zoom:se,bearing:p}}_cameraForBox(t,l,p,_,v){const E=this._extendCameraOptions(v);p=p||0,_=_||0,t=c.LngLat.convert(t),l=c.LngLat.convert(l);const S=this.transform.clone();S.padding=E.padding;const R=this.getFreeCameraOptions(),z=new c.LngLat(.5*(t.lng+l.lng),.5*(t.lat+l.lat)),N=.5*(p+_);if(S._camera.position[2]<c.mercatorZfromAltitude(N,z.lat))return void c.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");R.lookAtPoint(z),S.setFreeCameraOptions(R);const j=c.MercatorCoordinate.fromLngLat(t),Q=c.MercatorCoordinate.fromLngLat(l),oe=S.pointRayIntersection(S.centerPoint,N),ie=[(re=S.rayIntersectionCoordinate(oe)).x,re.y,re.z];var re;const pe=S.screenPointToMercatorRay(S.centerPoint);let se,me=0;do{const _e=Math.floor(S.zoom),le=1<<_e,ye=Math.min(le*j.x,le*Q.x),Ee=Math.min(le*j.y,le*Q.y),Ze=Math.max(le*j.x,le*Q.x),Ge=Math.max(le*j.y,le*Q.y),tt=new Yt([ye,Ee,p],[Ze,Ge,_]),nt=ln.fromInvProjectionMatrix(S.invProjMatrix,S.worldSize,_e);if(2!==tt.intersects(nt)){se&&(S._camera.position=c.scaleAndAdd([],S._camera.position,pe.dir,-se),S._updateStateFromCamera());break}const xt=c.sub([],S._camera.position,ie);se=.5*c.length(xt),S._camera.position=c.scaleAndAdd([],S._camera.position,pe.dir,se);try{S._updateStateFromCamera()}catch(Xe){return void c.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++me<10);return{center:S.center,zoom:S.zoom,bearing:S.bearing,pitch:S.pitch}}fitBounds(t,l,p){return this._fitInternal(this.cameraForBounds(t,l),l,p)}_raycastElevationBox(t,l){const p=this.transform.elevation;if(!p)return;const _=new c.pointGeometry(t.x,l.y),v=new c.pointGeometry(l.x,t.y),E=p.pointCoordinate(t);if(!E)return;const S=p.pointCoordinate(l);if(!S)return;const R=p.pointCoordinate(_);if(!R)return;const z=p.pointCoordinate(v);if(!z)return;const N=new c.MercatorCoordinate(E[0],E[1]).toLngLat(),j=new c.MercatorCoordinate(S[0],S[1]).toLngLat(),Q=new c.MercatorCoordinate(R[0],R[1]).toLngLat(),oe=new c.MercatorCoordinate(z[0],z[1]).toLngLat(),ie=Math.min(N.lng,Math.min(j.lng,Math.min(Q.lng,oe.lng))),re=Math.min(N.lat,Math.min(j.lat,Math.min(Q.lat,oe.lat))),pe=Math.max(N.lng,Math.max(j.lng,Math.max(Q.lng,oe.lng))),se=Math.max(N.lat,Math.max(j.lat,Math.max(Q.lat,oe.lat))),me=Math.min(E[3],Math.min(S[3],Math.min(R[3],z[3]))),_e=Math.max(E[3],Math.max(S[3],Math.max(R[3],z[3])));return{minLngLat:new c.LngLat(ie,re),maxLngLat:new c.LngLat(pe,se),minAltitude:me,maxAltitude:_e}}fitScreenCoordinates(t,l,p,_,v){let E,S,R,z;const N=c.pointGeometry.convert(t),j=c.pointGeometry.convert(l),Q=this._raycastElevationBox(N,j);if(Q)E=Q.minLngLat,S=Q.maxLngLat,R=Q.minAltitude,z=Q.maxAltitude;else{if(this.transform.anyCornerOffEdge(N,j))return this;E=this.transform.pointLocation(N),S=this.transform.pointLocation(j)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(c.pointGeometry.convert(t)),this.transform.pointLocation(c.pointGeometry.convert(l)),p,_):this._cameraForBox(E,S,R,z,_),_,v)}_fitInternal(t,l,p){return t?(delete(l=c.extend(t,l)).padding,l.linear?this.easeTo(l,p):this.flyTo(l,p)):this}jumpTo(t,l){this.stop();const p=this.transform;let _=!1,v=!1,E=!1;return"zoom"in t&&p.zoom!==+t.zoom&&(_=!0,p.zoom=+t.zoom),void 0!==t.center&&(p.center=c.LngLat.convert(t.center)),"bearing"in t&&p.bearing!==+t.bearing&&(v=!0,p.bearing=+t.bearing),"pitch"in t&&p.pitch!==+t.pitch&&(E=!0,p.pitch=+t.pitch),null==t.padding||p.isPaddingEqual(t.padding)||(p.padding=t.padding),this.fire(new c.Event("movestart",l)).fire(new c.Event("move",l)),_&&this.fire(new c.Event("zoomstart",l)).fire(new c.Event("zoom",l)).fire(new c.Event("zoomend",l)),v&&this.fire(new c.Event("rotatestart",l)).fire(new c.Event("rotate",l)).fire(new c.Event("rotateend",l)),E&&this.fire(new c.Event("pitchstart",l)).fire(new c.Event("pitch",l)).fire(new c.Event("pitchend",l)),this.fire(new c.Event("moveend",l))}getFreeCameraOptions(){return"mercator"!==this.transform.projection.name&&c.warnOnce(Lt),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,l){const p=this.transform;if("mercator"!==p.projection.name)return void c.warnOnce(Lt);this.stop();const _=p.zoom,v=p.pitch,E=p.bearing;p.setFreeCameraOptions(t);const S=_!==p.zoom,R=v!==p.pitch,z=E!==p.bearing;return this.fire(new c.Event("movestart",l)).fire(new c.Event("move",l)),S&&this.fire(new c.Event("zoomstart",l)).fire(new c.Event("zoom",l)).fire(new c.Event("zoomend",l)),z&&this.fire(new c.Event("rotatestart",l)).fire(new c.Event("rotate",l)).fire(new c.Event("rotateend",l)),R&&this.fire(new c.Event("pitchstart",l)).fire(new c.Event("pitch",l)).fire(new c.Event("pitchend",l)),this.fire(new c.Event("moveend",l)),this}easeTo(t,l){this._stop(!1,t.easeId),(!1===(t=c.extend({offset:[0,0],duration:500,easing:c.ease},t)).animate||!t.essential&&c.exported.prefersReducedMotion)&&(t.duration=0);const p=this.transform,_=this.getZoom(),v=this.getBearing(),E=this.getPitch(),S=this.getPadding(),R="zoom"in t?+t.zoom:_,z="bearing"in t?this._normalizeBearing(t.bearing,v):v,N="pitch"in t?+t.pitch:E,j="padding"in t?t.padding:p.padding,Q=c.pointGeometry.convert(t.offset);let oe=p.centerPoint.add(Q);const ie=p.pointLocation(oe),re=c.LngLat.convert(t.center||ie);this._normalizeCenter(re);const pe=p.project(ie),se=p.project(re).sub(pe),me=p.zoomScale(R-_);let _e,le;t.around&&(_e=c.LngLat.convert(t.around),le=p.locationPoint(_e));const ye={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||R!==_,this._rotating=this._rotating||v!==z,this._pitching=this._pitching||N!==E,this._padding=!p.isPaddingEqual(j),this._easeId=t.easeId,this._prepareEase(l,t.noMoveStart,ye),this._ease(Ee=>{if(this._zooming&&(p.zoom=c.number(_,R,Ee)),this._rotating&&(p.bearing=c.number(v,z,Ee)),this._pitching&&(p.pitch=c.number(E,N,Ee)),this._padding&&(p.interpolatePadding(S,j,Ee),oe=p.centerPoint.add(Q)),_e)p.setLocationAtPoint(_e,le);else{const Ze=p.zoomScale(p.zoom-_),Ge=R>_?Math.min(2,me):Math.max(.5,me),tt=Math.pow(Ge,1-Ee),nt=p.unproject(pe.add(se.mult(Ee*tt)).mult(Ze));p.setLocationAtPoint(p.renderWorldCopies?nt.wrap():nt,oe)}this._fireMoveEvents(l)},Ee=>{p.recenterOnTerrain(),this._afterEase(l,Ee)},t),this}_prepareEase(t,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||p.moving||this.fire(new c.Event("movestart",t)),this._zooming&&!p.zooming&&this.fire(new c.Event("zoomstart",t)),this._rotating&&!p.rotating&&this.fire(new c.Event("rotatestart",t)),this._pitching&&!p.pitching&&this.fire(new c.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new c.Event("move",t)),this._zooming&&this.fire(new c.Event("zoom",t)),this._rotating&&this.fire(new c.Event("rotate",t)),this._pitching&&this.fire(new c.Event("pitch",t))}_afterEase(t,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId,this.transform.cameraElevationReference="ground";const p=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new c.Event("zoomend",t)),_&&this.fire(new c.Event("rotateend",t)),v&&this.fire(new c.Event("pitchend",t)),this.fire(new c.Event("moveend",t))}flyTo(t,l){if(!t.essential&&c.exported.prefersReducedMotion){const St=c.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(St,l)}this.stop(),t=c.extend({offset:[0,0],speed:1.2,curve:1.42,easing:c.ease},t);const p=this.transform,_=this.getZoom(),v=this.getBearing(),E=this.getPitch(),S=this.getPadding(),R="zoom"in t?c.clamp(+t.zoom,p.minZoom,p.maxZoom):_,z="bearing"in t?this._normalizeBearing(t.bearing,v):v,N="pitch"in t?+t.pitch:E,j="padding"in t?t.padding:p.padding,Q=p.zoomScale(R-_),oe=c.pointGeometry.convert(t.offset);let ie=p.centerPoint.add(oe);const re=p.pointLocation(ie),pe=c.LngLat.convert(t.center||re);this._normalizeCenter(pe);const se=p.project(re),me=p.project(pe).sub(se);let _e=t.curve;const le=Math.max(p.width,p.height),ye=le/Q,Ee=me.mag();if("minZoom"in t){const St=c.clamp(Math.min(t.minZoom,_,R),p.minZoom,p.maxZoom),jt=le/p.zoomScale(St-_);_e=Math.sqrt(jt/Ee*2)}const Ze=_e*_e;function Ge(St){const jt=(ye*ye-le*le+(St?-1:1)*Ze*Ze*Ee*Ee)/(2*(St?ye:le)*Ze*Ee);return Math.log(Math.sqrt(jt*jt+1)-jt)}function tt(St){return(Math.exp(St)-Math.exp(-St))/2}function nt(St){return(Math.exp(St)+Math.exp(-St))/2}const xt=Ge(0);let Xe=function(St){return nt(xt)/nt(xt+_e*St)},Et=function(St){return le*((nt(xt)*(tt(jt=xt+_e*St)/nt(jt))-tt(xt))/Ze)/Ee;var jt},Ne=(Ge(1)-xt)/_e;if(Math.abs(Ee)<1e-6||!isFinite(Ne)){if(Math.abs(le-ye)<1e-6)return this.easeTo(t,l);const St=ye<le?-1:1;Ne=Math.abs(Math.log(ye/le))/_e,Et=function(){return 0},Xe=function(jt){return Math.exp(St*_e*jt)}}return t.duration="duration"in t?+t.duration:1e3*Ne/("screenSpeed"in t?+t.screenSpeed/_e:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=v!==z,this._pitching=N!==E,this._padding=!p.isPaddingEqual(j),this._prepareEase(l,!1),this._ease(St=>{const jt=St*Ne,un=1/Xe(jt);p.zoom=1===St?R:_+p.scaleZoom(un),this._rotating&&(p.bearing=c.number(v,z,St)),this._pitching&&(p.pitch=c.number(E,N,St)),this._padding&&(p.interpolatePadding(S,j,St),ie=p.centerPoint.add(oe));const mn=1===St?pe:p.unproject(se.add(me.mult(Et(jt))).mult(un));p.setLocationAtPoint(p.renderWorldCopies?mn.wrap():mn,ie),p._updateCenterElevation(),this._fireMoveEvents(l)},()=>this._afterEase(l),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,l)}if(!t){const p=this.handlers;p&&p.stop(!1)}return this}_ease(t,l,p){!1===p.animate||0===p.duration?(t(1),l()):(this._easeStart=c.exported.now(),this._easeOptions=p,this._onEaseFrame=t,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((c.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,l){t=c.wrap(t,-180,180);const p=Math.abs(t-l);return Math.abs(t-360-l)<p&&(t-=360),Math.abs(t+360-l)<p&&(t+=360),t}_normalizeCenter(t){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const p=t.lng-l.center.lng;t.lng+=p>180?-360:p<-180?360:0}}class Qt{constructor(t={}){this.options=t,c.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const l=this.options&&this.options.compact;return this._map=t,this._container=ze.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ze.create("button","mapboxgl-ctrl-attrib-button",this._container),ze.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ze.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===l&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){ze.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,l){const p=this._map._getUIString(`AttributionControl.${l}`);t.setAttribute("aria-label",p),t.firstElementChild&&t.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||c.config.ACCESS_TOKEN}];if(t){const p=l.reduce((_,v,E)=>(v.value&&(_+=`${v.key}=${v.value}${E<l.length-1?"&":""}`),_),"?");t.href=`${c.config.FEEDBACK_URL}/${p}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(_=>"string"!=typeof _?"":_)):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const l=this._map.style._sourceCaches;for(const _ in l){const v=l[_];if(v.used){const E=v.getSource();E.attribution&&t.indexOf(E.attribution)<0&&t.push(E.attribution)}}t.sort((_,v)=>_.length-v.length),t=t.filter((_,v)=>{for(let E=v+1;E<t.length;E++)if(t[E].indexOf(_)>=0)return!1;return!0});const p=t.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,t.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Gn{constructor(){c.bindAll(["_updateLogo"],this),c.bindAll(["_updateCompact"],this)}onAdd(t){this._map=t,this._container=ze.create("div","mapboxgl-ctrl");const l=ze.create("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ze.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const l in t){const p=t[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const l=t[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class ar{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const l=++this._id;return this._queue.push({callback:t,id:l,cancelled:!1}),l}remove(t){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const _ of p)if(_.id===t)return void(_.cancelled=!0)}run(t=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function fs(d,t,l){if(d=new c.LngLat(d.lng,d.lat),t){const p=new c.LngLat(d.lng-360,d.lat),_=new c.LngLat(d.lng+360,d.lat),v=360*Math.ceil(Math.abs(d.lng-l.center.lng)/360),E=l.locationPoint(d).distSqr(t),S=t.x<0||t.y<0||t.x>l.width||t.y>l.height;l.locationPoint(p).distSqr(t)<E&&(S||Math.abs(p.lng-l.center.lng)<v)?d=p:l.locationPoint(_).distSqr(t)<E&&(S||Math.abs(_.lng-l.center.lng)<v)&&(d=_)}for(;Math.abs(d.lng-l.center.lng)>180;){const p=l.locationPoint(d);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;d.lng>l.center.lng?d.lng-=360:d.lng+=360}return d}const ro={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class pi extends c.Evented{constructor(t,l){if(super(),(t instanceof c.window.HTMLElement||l)&&(t=c.extend({element:t},l)),c.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&"auto"!==t.pitchAlignment?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=c.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=ze.create("div"),this._element.setAttribute("aria-label","Map marker");const _=ze.createNS("http://www.w3.org/2000/svg","svg"),v=41,E=27;_.setAttributeNS(null,"display","block"),_.setAttributeNS(null,"height",`${v}px`),_.setAttributeNS(null,"width",`${E}px`),_.setAttributeNS(null,"viewBox",`0 0 ${E} ${v}`);const S=ze.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const R=ze.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");const z=ze.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(3.0, 29.0)"),z.setAttributeNS(null,"fill","#000000");const N=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const _e of N){const le=ze.createNS("http://www.w3.org/2000/svg","ellipse");le.setAttributeNS(null,"opacity","0.04"),le.setAttributeNS(null,"cx","10.5"),le.setAttributeNS(null,"cy","5.80029008"),le.setAttributeNS(null,"rx",_e.rx),le.setAttributeNS(null,"ry",_e.ry),z.appendChild(le)}const j=ze.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"fill",this._color);const Q=ze.createNS("http://www.w3.org/2000/svg","path");Q.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),j.appendChild(Q);const oe=ze.createNS("http://www.w3.org/2000/svg","g");oe.setAttributeNS(null,"opacity","0.25"),oe.setAttributeNS(null,"fill","#000000");const ie=ze.createNS("http://www.w3.org/2000/svg","path");ie.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),oe.appendChild(ie);const re=ze.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"transform","translate(6.0, 7.0)"),re.setAttributeNS(null,"fill","#FFFFFF");const pe=ze.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const se=ze.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#000000"),se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962");const me=ze.createNS("http://www.w3.org/2000/svg","circle");me.setAttributeNS(null,"fill","#FFFFFF"),me.setAttributeNS(null,"cx","5.5"),me.setAttributeNS(null,"cy","5.5"),me.setAttributeNS(null,"r","5.4999962"),pe.appendChild(se),pe.appendChild(me),R.appendChild(z),R.appendChild(j),R.appendChild(oe),R.appendChild(re),R.appendChild(pe),_.appendChild(R),_.setAttributeNS(null,"height",v*this._scale+"px"),_.setAttributeNS(null,"width",E*this._scale+"px"),this._element.appendChild(_),this._offset=c.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const p=this._element.classList;for(const _ in ro)p.remove(`mapboxgl-marker-anchor-${_}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),ze.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=c.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const l=38.1,p=13.5,_=Math.sqrt(Math.pow(p,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-l],"bottom-left":[_,-1*(l-p+_)],"bottom-right":[-_,-1*(l-p+_)],left:[p,-1*(l-p)],right:[-p,-1*(l-p)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const l=t.code,p=t.charCode||t.keyCode;"Space"!==l&&"Enter"!==l&&32!==p&&13!==p||this.togglePopup()}_onMapClick(t){const l=t.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const t=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(t))return void this._clearFadeTimer();const l=this._map.unproject(t);let p=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const v=this._map.getFreeCameraOptions();if(v.position){const E=v.position.toLngLat();p=E.distanceTo(l)<.9*E.distanceTo(this._lngLat)}}const _=(1-this._map._queryFogOpacity(l))*(p?.2:1);this._element.style.opacity=`${_}`,this._popup&&this._popup._setOpacity(`${_}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(t){const l=this._map.transform;return!!t&&t.x>=0&&t.x<l.width&&t.y>=0&&t.y<l.height}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=fs(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let l="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?l=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(l=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?p="rotateX(0deg)":"map"===this._pitchAlignment&&(p=`rotateX(${this._map.getPitch()}deg)`),t&&"moveend"!==t.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&ze.setTransform(this._element,`${ro[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${l}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const t=this._map.transform,l=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&l._rotate(t.angle),"map"===this._pitchAlignment&&(l.y*=Math.cos(t._pitch)),l}getOffset(){return this._offset}setOffset(t){return this._offset=c.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new c.Event("dragstart"))),this.fire(new c.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new c.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class io{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const l=c.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,l,p){this._start=this.getValue(l),this._end=t,this._startTime=l,this._endTime=l+p}}const Qo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:oo,HTMLElement:ps,ImageBitmap:mo}=c.window,Mh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Yl(d){d.parentNode&&d.parentNode.removeChild(d)}const Wr={showCompass:!0,showZoom:!0,visualizePitch:!1};class Yc{constructor(t,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new fi({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,p&&(this.mousePitch=new hs({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),c.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ze.addEventListener(l,"mousedown",this.mousedown),ze.addEventListener(l,"touchstart",this.touchstart,{passive:!1}),ze.addEventListener(l,"touchmove",this.touchmove),ze.addEventListener(l,"touchend",this.touchend),ze.addEventListener(l,"touchcancel",this.reset)}down(t,l){this.mouseRotate.mousedown(t,l),this.mousePitch&&this.mousePitch.mousedown(t,l),ze.disableDrag()}move(t,l){const p=this.map,_=this.mouseRotate.mousemoveWindow(t,l);if(_&&_.bearingDelta&&p.setBearing(p.getBearing()+_.bearingDelta),this.mousePitch){const v=this.mousePitch.mousemoveWindow(t,l);v&&v.pitchDelta&&p.setPitch(p.getPitch()+v.pitchDelta)}}off(){const t=this.element;ze.removeEventListener(t,"mousedown",this.mousedown),ze.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),ze.removeEventListener(t,"touchmove",this.touchmove),ze.removeEventListener(t,"touchend",this.touchend),ze.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){ze.enableDrag(),ze.removeEventListener(c.window,"mousemove",this.mousemove),ze.removeEventListener(c.window,"mouseup",this.mouseup)}mousedown(t){this.down(c.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),ze.mousePos(this.element,t)),ze.addEventListener(c.window,"mousemove",this.mousemove),ze.addEventListener(c.window,"mouseup",this.mouseup)}mousemove(t){this.move(t,ze.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=ze.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=ze.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Fu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Qa,Kc=0,_c=!1;const Ou={maxWidth:100,unit:"metric"};function zu(d,t,l){const p=l&&l.maxWidth||100,_=d._container.getBoundingClientRect().height/2,v=d.unproject([0,_]),E=d.unproject([p,_]),S=v.distanceTo(E);if(l&&"imperial"===l.unit){const R=3.2808*S;R>5280?Ms(t,p,R/5280,d._getUIString("ScaleControl.Miles"),d):Ms(t,p,R,d._getUIString("ScaleControl.Feet"),d)}else l&&"nautical"===l.unit?Ms(t,p,S/1852,d._getUIString("ScaleControl.NauticalMiles"),d):S>=1e3?Ms(t,p,S/1e3,d._getUIString("ScaleControl.Kilometers"),d):Ms(t,p,S,d._getUIString("ScaleControl.Meters"),d)}function Ms(d,t,l,p,_){const v=function(S){const R=Math.pow(10,`${Math.floor(S)}`.length-1);let z=S/R;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:function(N){const j=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*j)/j}(z),R*z}(l),E=v/l;_._requestDomTask(()=>{d.style.width=t*E+"px",d.innerHTML=`${v}&nbsp;${p}`})}const ef={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Di=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),wa={version:c.version,supported:Tt,setRTLTextPlugin:c.setRTLTextPlugin,getRTLTextPluginStatus:c.getRTLTextPluginStatus,Map:class extends Mn{constructor(d){if(null!=(d=c.extend({},Mh,d)).minZoom&&null!=d.maxZoom&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=d.minPitch&&null!=d.maxPitch&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=d.minPitch&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=d.maxPitch&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Hl(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._renderTaskQueue=new ar,this._domRenderTaskQueue=new ar,this._controls=[],this._markers=[],this._mapId=c.uniqueId(),this._locale=c.extend({},Qo,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new io(0),this._requestManager=new c.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,"string"==typeof d.container){if(this._container=c.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof ps))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),c.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==c.window&&(c.window.addEventListener("online",this._onWindowOnline,!1),c.window.addEventListener("resize",this._onWindowResize,!1),c.window.addEventListener("orientationchange",this._onWindowResize,!1),c.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Ue(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new Ha("string"==typeof d.hash&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,c.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new Qt({customAttribution:d.customAttribution})),this._logoControl=new Gn,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new c.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new c.Event(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(d,t){if(void 0===t&&(t=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=d.onAdd(this);this._controls.push(d);const p=this._controlPositions[t];return-1!==t.indexOf("bottom")?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(d);return t>-1&&this._controls.splice(t,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){const[t,l]=this._containerDimensions();if(t===this.transform.width&&l===this.transform.height)return this;this._resizeCanvas(t,l),this.transform.resize(t,l),this.painter.resize(Math.ceil(t),Math.ceil(l));const p=!this._moving;return p&&this.fire(new c.Event("movestart",d)).fire(new c.Event("move",d)),this.fire(new c.Event("resize",d)),p&&this.fire(new c.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(c.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=null==d?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=null==d?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=null==d?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=null==d?85:d)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}getProjection(){return this.transform.getProjection()}setProjection(d){this._lazyInitEmptyStyle(),"string"==typeof d&&(d={name:d}),this._runtimeProjection=d,this.style.updateProjection()}project(d){return this.transform.locationPoint3D(c.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(c.pointGeometry.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(d,t,l){if("mouseenter"===d||"mouseover"===d){let p=!1;const _=E=>{const S=t.filter(z=>this.getLayer(z)),R=S.length?this.queryRenderedFeatures(E.point,{layers:S}):[];R.length?p||(p=!0,l.call(this,new qr(d,this,E.originalEvent,{features:R}))):p=!1},v=()=>{p=!1};return{layers:new Set(t),listener:l,delegates:{mousemove:_,mouseout:v}}}if("mouseleave"===d||"mouseout"===d){let p=!1;const _=E=>{const S=t.filter(R=>this.getLayer(R));(S.length?this.queryRenderedFeatures(E.point,{layers:S}):[]).length?p=!0:p&&(p=!1,l.call(this,new qr(d,this,E.originalEvent)))},v=E=>{p&&(p=!1,l.call(this,new qr(d,this,E.originalEvent)))};return{layers:new Set(t),listener:l,delegates:{mousemove:_,mouseout:v}}}{const p=_=>{const v=t.filter(S=>this.getLayer(S)),E=v.length?this.queryRenderedFeatures(_.point,{layers:v}):[];E.length&&(_.features=E,l.call(this,_),delete _.features)};return{layers:new Set(t),listener:l,delegates:{[d]:p}}}}on(d,t,l){if(void 0===l)return super.on(d,t);Array.isArray(t)||(t=[t]);const p=this._createDelegatedListener(d,t,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(d,t,l){if(void 0===l)return super.once(d,t);Array.isArray(t)||(t=[t]);const p=this._createDelegatedListener(d,t,l);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(d,t,l){if(void 0===l)return super.off(d,t);t=new Set(Array.isArray(t)?t:[t]);const p=(v,E)=>{if(v.size!==E.size)return!1;for(const S of v)if(!E.has(S))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[d]:void 0;return _&&(v=>{for(let E=0;E<v.length;E++){const S=v[E];if(S.listener===l&&p(S.layers,t)){for(const R in S.delegates)this.off(R,S.delegates[R]);return v.splice(E,1),this}}})(_),this}queryRenderedFeatures(d,t){return this.style?(void 0!==t||void 0===d||d instanceof c.pointGeometry||Array.isArray(d)||(t=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(d,t){return this.style.querySourceFeatures(d,t)}queryTerrainElevation(d,t){const l=this.transform.elevation;return l?(t=c.extend({},{exaggerated:!0},t),l.getAtPoint(c.MercatorCoordinate.fromLngLat(d),null,t.exaggerated)):null}setStyle(d,t){return!1!==(t=c.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(d,t))}_getUIString(d){const t=this._locale[d];if(null==t)throw new Error(`Missing UI string '${d}'`);return t}_updateStyle(d,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),d&&(this.style=new Gi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof d?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Gi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,t){if("string"==typeof d){const l=this._requestManager.normalizeStyleURL(d),p=this._requestManager.transformRequest(l,c.ResourceType.Style);c.getJSON(p,(_,v)=>{_?this.fire(new c.ErrorEvent(_)):v&&this._updateDiff(v,t)})}else"object"==typeof d&&this._updateDiff(d,t)}_updateDiff(d,t){try{this.style.setState(d)&&this._update(!0)}catch(l){c.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(d,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.warnOnce("There is no style added to the map.")}addSource(d,t){return this._lazyInitEmptyStyle(),this.style.addSource(d,t),this._update(!0)}isSourceLoaded(d){const t=this.style&&this.style._getSourceCaches(d);if(0!==t.length)return t.every(l=>l.loaded());this.fire(new c.ErrorEvent(new Error(`There is no source with ID '${d}'`)))}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const t in d){const l=d[t]._tiles;for(const p in l){const _=l[p];if("loaded"!==_.state&&"errored"!==_.state)return!1}}return!0}addSourceType(d,t,l){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,t,l)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,t,{pixelRatio:l=1,sdf:p=!1,stretchX:_,stretchY:v,content:E}={}){if(this._lazyInitEmptyStyle(),t instanceof oo||mo&&t instanceof mo){const{width:S,height:R,data:z}=c.exported.getImageData(t);this.style.addImage(d,{data:new c.RGBAImage({width:S,height:R},z),pixelRatio:l,stretchX:_,stretchY:v,content:E,sdf:p,version:0})}else{if(void 0===t.width||void 0===t.height)return this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:R,data:z}=t,N=t;this.style.addImage(d,{data:new c.RGBAImage({width:S,height:R},new Uint8Array(z)),pixelRatio:l,stretchX:_,stretchY:v,content:E,sdf:p,version:0,userImage:N}),N.onAdd&&N.onAdd(this,d)}}}updateImage(d,t){const l=this.style.getImage(d);if(!l)return this.fire(new c.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof oo||mo&&t instanceof mo?c.exported.getImageData(t):t,{width:_,height:v,data:E}=p;return void 0===_||void 0===v?this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):_!==l.data.width||v!==l.data.height?this.fire(new c.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(l.data.replace(E,!(t instanceof oo||mo&&t instanceof mo)),void this.style.updateImage(d,l))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new c.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,t){c.getImage(this._requestManager.transformRequest(d,c.ResourceType.Image),(l,p)=>{t(l,p instanceof oo?c.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(d,t){return this._lazyInitEmptyStyle(),this.style.addLayer(d,t),this._update(!0)}moveLayer(d,t){return this.style.moveLayer(d,t),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,t,l){return this.style.setLayerZoomRange(d,t,l),this._update(!0)}setFilter(d,t,l={}){return this.style.setFilter(d,t,l),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,t,l,p={}){return this.style.setPaintProperty(d,t,l,p),this._update(!0)}getPaintProperty(d,t){return this.style.getPaintProperty(d,t)}setLayoutProperty(d,t,l,p={}){return this.style.setLayoutProperty(d,t,l,p),this._update(!0)}getLayoutProperty(d,t){return this.style.getLayoutProperty(d,t)}setLight(d,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(c.LngLat.convert(d),this.transform):0}setFeatureState(d,t){return this.style.setFeatureState(d,t),this._update()}removeFeatureState(d,t){return this.style.removeFeatureState(d,t),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_containerDimensions(){let d=0,t=0;return this._container&&(d=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300),[d,t]}_detectMissingCSS(){"rgb(250, 128, 114)"!==c.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&c.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=ze.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=ze.create("div","mapboxgl-canvas-container",d);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=ze.create("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const l=this._containerDimensions();this._resizeCanvas(l[0],l[1]);const p=this._controlContainer=ze.create("div","mapboxgl-control-container",d),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{_[v]=ze.create("div",`mapboxgl-ctrl-${v}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,t){const l=c.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(d),this._canvas.height=l*Math.ceil(t),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${t}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const t=this._markers.indexOf(d);-1!==t&&this._markers.splice(t,1)}_setupPainter(){const d=c.extend({},Tt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);t?(c.storeAuthState(t,!0),this.painter=new Gl(t,this.transform),this.on("data",l=>{"source"===l.dataType&&this.painter.setTileLoadedFlag(!0)}),c.exported$1.testSupport(t)):this.fire(new c.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new c.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let t;const l=this.painter.context.extTimerQuery,p=c.exported.now();this.listens("gpu-timing-frame")&&(t=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,t));let _=this._updateAverageElevation(p);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;let v=!1;const E=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,z=this.transform.pitch,N=c.exported.now();this.style.zoomHistory.update(R,N);const j=new c.EvaluationParameters(R,{now:N,fadeDuration:E,pitch:z,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Q=j.crossFadingFactor();1===Q&&Q===this._crossFadingFactor||(v=!0,this._crossFadingFactor=Q),this.style.update(j)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,E,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new c.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new c.Event("load"))),this.style&&(this.style.hasTransitions()||v)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const R=c.exported.now()-p;l.endQueryEXT(l.TIME_ELAPSED_EXT,t),setTimeout(()=>{const z=l.getQueryObjectEXT(t,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(t),this.fire(new c.Event("gpu-timing-frame",{cpuTime:R,gpuTime:z}))},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(R);this.fire(new c.Event("gpu-timing-layer",{layerTimes:z}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(S||this._repaint)this.triggerRepaint();else{const R=!this.isMoving()&&this.loaded();if(R&&(_=this._updateAverageElevation(p,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new c.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new c.Event("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const d of this._markers)d._update()}_updateAverageElevation(d,t=!1){const l=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&l(0);if((t||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation();isNaN(_)?_=0:this._averageElevationLastSampledAt=d;const v=Math.abs(p-_);if(v>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(_),l(_);this._averageElevation.easeTo(_,d,300)}else if(v>1e-4)return this._averageElevation.jumpTo(_),l(_)}return!!this._averageElevation.isEasing(d)&&l(this._averageElevation.getValue(d))}_authenticate(){c.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===c.AUTH_ERR_MSG||401===d.status)){const t=this.painter.context.gl;c.storeAuthState(t,!1),this._logoControl instanceof Gn&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new c.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),c.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function _(v){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,v,0);const E=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,E),E}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(_(d),t.canvasCopies.map(_),t.timeStamps)}_canvasPixelComparison(d,t,l){let p=l[1]-l[0];const _=d.length/4;for(let v=0;v<t.length;v++){const E=t[v];let S=0;for(let R=0;R<E.length;R+=4)E[R]===d[R]&&E[R+1]===d[R+1]&&E[R+2]===d[R+2]&&E[R+3]===d[R+3]&&(S+=1);p+=(l[v+2]-l[v+1])*(1-S/_)}return p}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.clearWorkerCaches(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==c.window&&(c.window.removeEventListener("resize",this._onWindowResize,!1),c.window.removeEventListener("orientationchange",this._onWindowResize,!1),c.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),c.window.removeEventListener("online",this._onWindowOnline,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),Yl(this._canvasContainer),Yl(this._controlContainer),Yl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),c.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new c.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=c.exported.frame(t=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(t)}))}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}_setCacheLimits(d,t){c.setCacheLimits(d,t)}get version(){return c.version}},NavigationControl:class{constructor(d){this.options=c.extend({},Wr,d),this._container=ze.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(c.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),ze.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),ze.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(c.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=ze.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const d=this._map.getZoom(),t=d===this._map.getMaxZoom(),l=d===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())}_rotateCompassArrow(){const d=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=d)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ze.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,t){const l=ze.create("button",d,this._container);return l.type="button",l.addEventListener("click",t),l}_setButtonTitle(d,t){const l=this._map._getUIString(`NavigationControl.${t}`);d.setAttribute("aria-label",l),d.firstElementChild&&d.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends c.Evented{constructor(d){super(),this.options=c.extend({},Fu,d),c.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Ga(this._updateMarkerRotation,20)}onAdd(d){var t;return this._map=d,this._container=ze.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,void 0!==Qa?t(Qa):void 0!==c.window.navigator.permissions?c.window.navigator.permissions.query({name:"geolocation"}).then(l=>{Qa="denied"!==l.state,t(Qa)}):(Qa=!!c.window.navigator.geolocation,t(Qa)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(c.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ze.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Kc=0,_c=!1}_isOutOfMapMaxBounds(d){const t=this._map.getMaxBounds(),l=d.coords;return t&&(l.longitude<t.getWest()||l.longitude>t.getEast()||l.latitude<t.getSouth()||l.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new c.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(d),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("geolocate",d)),this._finish()}}_updateCamera(d){const t=new c.LngLat(d.coords.longitude,d.coords.latitude),l=d.coords.accuracy,p=this._map.getBearing(),_=c.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(l),_,{geolocateSource:!0})}_updateMarker(d){if(d){const t=new c.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map._container.getBoundingClientRect().height/2,t=this._map.unproject([0,d]),l=this._map.unproject([100,d]),p=t.distanceTo(l)/100,_=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(1===d.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===d.code&&_c)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=ze.create("button","mapboxgl-ctrl-geolocate",this._container),ze.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===d){c.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ze.create("div","mapboxgl-user-location"),this._dotElement.appendChild(ze.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ze.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new pi({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ze.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new pi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new c.Event("trackuserlocationend")))})}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:!0===d.absolute&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return c.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Kc--,_c=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new c.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Kc++,Kc>1?(d={maximumAge:6e5,timeout:0},_c=!0):(d=this.options.positionOptions,_c=!1),this._geolocationWatchID=c.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else c.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{c.window.addEventListener("ondeviceorientationabsolute"in c.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==c.window.DeviceMotionEvent&&"function"==typeof c.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&d()}).catch(console.error):d()}_clearWatch(){c.window.navigator.geolocation.clearWatch(this._geolocationWatchID),c.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),c.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Qt,ScaleControl:class{constructor(d){this.options=c.extend({},Ou,d),c.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){zu(this._map,this._container,this.options)}onAdd(d){return this._map=d,this._container=ze.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ze.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(d){this.options.unit=d,zu(this._map,this._container,this.options)}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof c.window.HTMLElement?this._container=d.container:c.warnOnce("Full screen control 'container' must be a DOM element.")),c.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in c.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in c.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=ze.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",c.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){ze.remove(this._controlContainer),this._map=null,c.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!c.window.document.fullscreenEnabled&&!c.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=ze.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ze.create("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden",!0),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),c.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(c.window.document.fullscreenElement||c.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?c.window.document.exitFullscreen?c.window.document.exitFullscreen():c.window.document.webkitCancelFullScreen&&c.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends c.Evented{constructor(d){super(),this.options=c.extend(Object.create(ef),d),c.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new c.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&ze.remove(this._content),this._container&&(ze.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new c.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=c.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(c.window.document.createTextNode(d))}setHTML(d){const t=c.window.document.createDocumentFragment(),l=c.window.document.createElement("body");let p;for(l.innerHTML=d;p=l.firstChild,p;)t.appendChild(p);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ze.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._container&&this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._container&&this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let t;return this._classList.delete(d)?t=!1:(this._classList.add(d),t=!0),this._container&&this._updateClassList(),t}_createCloseButton(){this.options.closeButton&&(this._closeButton=ze.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(d){this._update(d.point)}_onMouseMove(d){this._update(d.point)}_onDrag(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const t=this._pos,l=this._container.offsetWidth,p=this._container.offsetHeight;let _;return _=t.y+d.bottom.y<p?["top"]:t.y>this._map.transform.height-p?["bottom"]:[],t.x<l/2?_.push("left"):t.x>this._map.transform.width-l/2&&_.push("right"),0===_.length?"bottom":_.join("-")}_updateClassList(){const d=[...this._classList];d.push("mapboxgl-popup"),this._anchor&&d.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&d.push("mapboxgl-popup-track-pointer"),this._container.className=d.join(" ")}_update(d){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=ze.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=ze.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=fs(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||d){const t=this._pos=this._trackPointer&&d?d:this._map.project(this._lngLat),l=function(v){if(v||(v=new c.pointGeometry(0,0)),"number"==typeof v){const E=Math.round(Math.sqrt(.5*Math.pow(v,2)));return{center:new c.pointGeometry(0,0),top:new c.pointGeometry(0,v),"top-left":new c.pointGeometry(E,E),"top-right":new c.pointGeometry(-E,E),bottom:new c.pointGeometry(0,-v),"bottom-left":new c.pointGeometry(E,-E),"bottom-right":new c.pointGeometry(-E,-E),left:new c.pointGeometry(v,0),right:new c.pointGeometry(-v,0)}}if(v instanceof c.pointGeometry||Array.isArray(v)){const E=c.pointGeometry.convert(v);return{center:E,top:E,"top-left":E,"top-right":E,bottom:E,"bottom-left":E,"bottom-right":E,left:E,right:E}}return{center:c.pointGeometry.convert(v.center||[0,0]),top:c.pointGeometry.convert(v.top||[0,0]),"top-left":c.pointGeometry.convert(v["top-left"]||[0,0]),"top-right":c.pointGeometry.convert(v["top-right"]||[0,0]),bottom:c.pointGeometry.convert(v.bottom||[0,0]),"bottom-left":c.pointGeometry.convert(v["bottom-left"]||[0,0]),"bottom-right":c.pointGeometry.convert(v["bottom-right"]||[0,0]),left:c.pointGeometry.convert(v.left||[0,0]),right:c.pointGeometry.convert(v.right||[0,0])}}(this.options.offset),p=this._anchor=this._getAnchor(l),_=t.add(l[p]).round();this._map._requestDomTask(()=>{this._container&&p&&ze.setTransform(this._container,`${ro[p]} translate(${_.x}px,${_.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Di);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._content&&(this._content.style.opacity=d),this._tip&&(this._tip.style.opacity=d)}},Marker:pi,Style:Gi,LngLat:c.LngLat,LngLatBounds:c.LngLatBounds,Point:c.pointGeometry,MercatorCoordinate:c.MercatorCoordinate,FreeCameraOptions:yl,Evented:c.Evented,config:c.config,prewarm:function(){wt().acquire(we)},clearPrewarmedResources:function(){const d=rt;d&&(d.isPreloaded()&&1===d.numActive()?(d.release(we),rt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return c.config.ACCESS_TOKEN},set accessToken(d){c.config.ACCESS_TOKEN=d},get baseApiUrl(){return c.config.API_URL},set baseApiUrl(d){c.config.API_URL=d},get workerCount(){return Le.workerCount},set workerCount(d){Le.workerCount=d},get maxParallelImageRequests(){return c.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){c.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){c.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:c.exported.setNow,restoreNow:c.exported.restoreNow};return wa}),Y}()},306:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{y:()=>qe});var Y=Re(961),Fe=Re(727),Pt=Re(822),c=Re(671);var Ft=Re(416),Ve=Re(576),ze=Re(806);let qe=(()=>{class bt{constructor(sn){sn&&(this._subscribe=sn)}lift(sn){const Ot=new bt;return Ot.source=this,Ot.operator=sn,Ot}subscribe(sn,Ot,ln){const Yt=function On(bt){return bt&&bt instanceof Y.Lv||function en(bt){return bt&&(0,Ve.m)(bt.next)&&(0,Ve.m)(bt.error)&&(0,Ve.m)(bt.complete)}(bt)&&(0,Fe.Nn)(bt)}(sn)?sn:new Y.Hp(sn,Ot,ln);return(0,ze.x)(()=>{const{operator:At,source:ft}=this;Yt.add(At?At.call(Yt,ft):ft?this._subscribe(Yt):this._trySubscribe(Yt))}),Yt}_trySubscribe(sn){try{return this._subscribe(sn)}catch(Ot){sn.error(Ot)}}forEach(sn,Ot){return new(Ot=lt(Ot))((ln,Yt)=>{const At=new Y.Hp({next:ft=>{try{sn(ft)}catch(cn){Yt(cn),At.unsubscribe()}},error:Yt,complete:ln});this.subscribe(At)})}_subscribe(sn){var Ot;return null===(Ot=this.source)||void 0===Ot?void 0:Ot.subscribe(sn)}[Pt.L](){return this}pipe(...sn){return function Jt(bt){return 0===bt.length?c.y:1===bt.length?bt[0]:function(sn){return bt.reduce((Ot,ln)=>ln(Ot),sn)}}(sn)(this)}toPromise(sn){return new(sn=lt(sn))((Ot,ln)=>{let Yt;this.subscribe(At=>Yt=At,At=>ln(At),()=>Ot(Yt))})}}return bt.create=Ct=>new bt(Ct),bt})();function lt(bt){var Ct;return null!==(Ct=null!=bt?bt:Ft.v.Promise)&&void 0!==Ct?Ct:Promise}},579:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{x:()=>Ft});var Y=Re(306),Fe=Re(727);const c=(0,Re(888).d)(ze=>function(){ze(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Tt=Re(737),Jt=Re(806);let Ft=(()=>{class ze extends Y.y{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(lt){const en=new Ve(this,this);return en.operator=lt,en}_throwIfClosed(){if(this.closed)throw new c}next(lt){(0,Jt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){const en=this.observers.slice();for(const On of en)On.next(lt)}})}error(lt){(0,Jt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=lt;const{observers:en}=this;for(;en.length;)en.shift().error(lt)}})}complete(){(0,Jt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:lt}=this;for(;lt.length;)lt.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var lt;return(null===(lt=this.observers)||void 0===lt?void 0:lt.length)>0}_trySubscribe(lt){return this._throwIfClosed(),super._trySubscribe(lt)}_subscribe(lt){return this._throwIfClosed(),this._checkFinalizedStatuses(lt),this._innerSubscribe(lt)}_innerSubscribe(lt){const{hasError:en,isStopped:On,observers:bt}=this;return en||On?Fe.Lc:(bt.push(lt),new Fe.w0(()=>(0,Tt.P)(bt,lt)))}_checkFinalizedStatuses(lt){const{hasError:en,thrownError:On,isStopped:bt}=this;en?lt.error(On):bt&&lt.complete()}asObservable(){const lt=new Y.y;return lt.source=this,lt}}return ze.create=(qe,lt)=>new Ve(qe,lt),ze})();class Ve extends Ft{constructor(qe,lt){super(),this.destination=qe,this.source=lt}next(qe){var lt,en;null===(en=null===(lt=this.destination)||void 0===lt?void 0:lt.next)||void 0===en||en.call(lt,qe)}error(qe){var lt,en;null===(en=null===(lt=this.destination)||void 0===lt?void 0:lt.error)||void 0===en||en.call(lt,qe)}complete(){var qe,lt;null===(lt=null===(qe=this.destination)||void 0===qe?void 0:qe.complete)||void 0===lt||lt.call(qe)}_subscribe(qe){var lt,en;return null!==(en=null===(lt=this.source)||void 0===lt?void 0:lt.subscribe(qe))&&void 0!==en?en:Fe.Lc}}},961:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{Hp:()=>On,Lv:()=>en});var Y=Re(576),Fe=Re(727),Pt=Re(416),c=Re(849);function Tt(){}const Jt=ze("C",void 0,void 0);function ze(ln,Yt,At){return{kind:ln,value:Yt,error:At}}var qe=Re(410),lt=Re(806);class en extends Fe.w0{constructor(Yt){super(),this.isStopped=!1,Yt?(this.destination=Yt,(0,Fe.Nn)(Yt)&&Yt.add(this)):this.destination=Ot}static create(Yt,At,ft){return new On(Yt,At,ft)}next(Yt){this.isStopped?sn(function Ve(ln){return ze("N",ln,void 0)}(Yt),this):this._next(Yt)}error(Yt){this.isStopped?sn(function Ft(ln){return ze("E",void 0,ln)}(Yt),this):(this.isStopped=!0,this._error(Yt))}complete(){this.isStopped?sn(Jt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(Yt){this.destination.next(Yt)}_error(Yt){try{this.destination.error(Yt)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class On extends en{constructor(Yt,At,ft){let cn;if(super(),(0,Y.m)(Yt))cn=Yt;else if(Yt){let Pn;({next:cn,error:At,complete:ft}=Yt),this&&Pt.v.useDeprecatedNextContext?(Pn=Object.create(Yt),Pn.unsubscribe=()=>this.unsubscribe()):Pn=Yt,cn=null==cn?void 0:cn.bind(Pn),At=null==At?void 0:At.bind(Pn),ft=null==ft?void 0:ft.bind(Pn)}this.destination={next:cn?bt(cn):Tt,error:bt(null!=At?At:Ct),complete:ft?bt(ft):Tt}}}function bt(ln,Yt){return(...At)=>{try{ln(...At)}catch(ft){Pt.v.useDeprecatedSynchronousErrorHandling?(0,lt.O)(ft):(0,c.h)(ft)}}}function Ct(ln){throw ln}function sn(ln,Yt){const{onStoppedNotification:At}=Pt.v;At&&qe.z.setTimeout(()=>At(ln,Yt))}const Ot={closed:!0,next:Tt,error:Ct,complete:Tt}},727:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{Lc:()=>Jt,w0:()=>Tt,Nn:()=>Ft});var Y=Re(576);const Pt=(0,Re(888).d)(ze=>function(lt){ze(this),this.message=lt?`${lt.length} errors occurred during unsubscription:\n${lt.map((en,On)=>`${On+1}) ${en.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=lt});var c=Re(737);class Tt{constructor(qe){this.initialTeardown=qe,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let qe;if(!this.closed){this.closed=!0;const{_parentage:lt}=this;if(lt)if(this._parentage=null,Array.isArray(lt))for(const bt of lt)bt.remove(this);else lt.remove(this);const{initialTeardown:en}=this;if((0,Y.m)(en))try{en()}catch(bt){qe=bt instanceof Pt?bt.errors:[bt]}const{_teardowns:On}=this;if(On){this._teardowns=null;for(const bt of On)try{Ve(bt)}catch(Ct){qe=null!=qe?qe:[],Ct instanceof Pt?qe=[...qe,...Ct.errors]:qe.push(Ct)}}if(qe)throw new Pt(qe)}}add(qe){var lt;if(qe&&qe!==this)if(this.closed)Ve(qe);else{if(qe instanceof Tt){if(qe.closed||qe._hasParent(this))return;qe._addParent(this)}(this._teardowns=null!==(lt=this._teardowns)&&void 0!==lt?lt:[]).push(qe)}}_hasParent(qe){const{_parentage:lt}=this;return lt===qe||Array.isArray(lt)&&lt.includes(qe)}_addParent(qe){const{_parentage:lt}=this;this._parentage=Array.isArray(lt)?(lt.push(qe),lt):lt?[lt,qe]:qe}_removeParent(qe){const{_parentage:lt}=this;lt===qe?this._parentage=null:Array.isArray(lt)&&(0,c.P)(lt,qe)}remove(qe){const{_teardowns:lt}=this;lt&&(0,c.P)(lt,qe),qe instanceof Tt&&qe._removeParent(this)}}Tt.EMPTY=(()=>{const ze=new Tt;return ze.closed=!0,ze})();const Jt=Tt.EMPTY;function Ft(ze){return ze instanceof Tt||ze&&"closed"in ze&&(0,Y.m)(ze.remove)&&(0,Y.m)(ze.add)&&(0,Y.m)(ze.unsubscribe)}function Ve(ze){(0,Y.m)(ze)?ze():ze.unsubscribe()}},416:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{v:()=>Y});const Y={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},515:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{E:()=>Fe});const Fe=new(Re(306).y)(Tt=>Tt.complete())},76:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{D:()=>Gt});var Y=Re(421),Fe=Re(672),Pt=Re(482),c=Re(403);function Tt(an,gt=0){return(0,Pt.e)((Be,He)=>{Be.subscribe(new c.Q(He,Je=>(0,Fe.f)(He,an,()=>He.next(Je),gt),()=>(0,Fe.f)(He,an,()=>He.complete(),gt),Je=>(0,Fe.f)(He,an,()=>He.error(Je),gt)))})}function Jt(an,gt=0){return(0,Pt.e)((Be,He)=>{He.add(an.schedule(()=>Be.subscribe(He),gt))})}var ze=Re(306),lt=Re(202),en=Re(576);function bt(an,gt){if(!an)throw new Error("Iterable cannot be null");return new ze.y(Be=>{(0,Fe.f)(Be,gt,()=>{const He=an[Symbol.asyncIterator]();(0,Fe.f)(Be,gt,()=>{He.next().then(Je=>{Je.done?Be.complete():Be.next(Je.value)})},0,!0)})})}var Ct=Re(670),sn=Re(239),Ot=Re(144),ln=Re(495),Yt=Re(206),At=Re(532),ft=Re(260);function Gt(an,gt){return gt?function Pn(an,gt){if(null!=an){if((0,Ct.c)(an))return function Ft(an,gt){return(0,Y.Xf)(an).pipe(Jt(gt),Tt(gt))}(an,gt);if((0,Ot.z)(an))return function qe(an,gt){return new ze.y(Be=>{let He=0;return gt.schedule(function(){He===an.length?Be.complete():(Be.next(an[He++]),Be.closed||this.schedule())})})}(an,gt);if((0,sn.t)(an))return function Ve(an,gt){return(0,Y.Xf)(an).pipe(Jt(gt),Tt(gt))}(an,gt);if((0,Yt.D)(an))return bt(an,gt);if((0,ln.T)(an))return function On(an,gt){return new ze.y(Be=>{let He;return(0,Fe.f)(Be,gt,()=>{He=an[lt.h](),(0,Fe.f)(Be,gt,()=>{let Je,Ke;try{({value:Je,done:Ke}=He.next())}catch(_t){return void Be.error(_t)}Ke?Be.complete():Be.next(Je)},0,!0)}),()=>(0,en.m)(null==He?void 0:He.return)&&He.return()})}(an,gt);if((0,ft.L)(an))return function cn(an,gt){return bt((0,ft.Q)(an),gt)}(an,gt)}throw(0,At.z)(an)}(an,gt):(0,Y.Xf)(an)}},421:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{Xf:()=>On});var Y=Re(655),Fe=Re(144),Pt=Re(239),c=Re(306),Tt=Re(670),Jt=Re(206),Ft=Re(532),Ve=Re(495),ze=Re(260),qe=Re(576),lt=Re(849),en=Re(822);function On(ft){if(ft instanceof c.y)return ft;if(null!=ft){if((0,Tt.c)(ft))return function bt(ft){return new c.y(cn=>{const Pn=ft[en.L]();if((0,qe.m)(Pn.subscribe))return Pn.subscribe(cn);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(ft);if((0,Fe.z)(ft))return function Ct(ft){return new c.y(cn=>{for(let Pn=0;Pn<ft.length&&!cn.closed;Pn++)cn.next(ft[Pn]);cn.complete()})}(ft);if((0,Pt.t)(ft))return function sn(ft){return new c.y(cn=>{ft.then(Pn=>{cn.closed||(cn.next(Pn),cn.complete())},Pn=>cn.error(Pn)).then(null,lt.h)})}(ft);if((0,Jt.D)(ft))return ln(ft);if((0,Ve.T)(ft))return function Ot(ft){return new c.y(cn=>{for(const Pn of ft)if(cn.next(Pn),cn.closed)return;cn.complete()})}(ft);if((0,ze.L)(ft))return function Yt(ft){return ln((0,ze.Q)(ft))}(ft)}throw(0,Ft.z)(ft)}function ln(ft){return new c.y(cn=>{(function At(ft,cn){var Pn,Gt,an,gt;return(0,Y.mG)(this,void 0,void 0,function*(){try{for(Pn=(0,Y.KL)(ft);!(Gt=yield Pn.next()).done;)if(cn.next(Gt.value),cn.closed)return}catch(Be){an={error:Be}}finally{try{Gt&&!Gt.done&&(gt=Pn.return)&&(yield gt.call(Pn))}finally{if(an)throw an.error}}cn.complete()})})(ft,cn).catch(Pn=>cn.error(Pn))})}},403:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{Q:()=>Fe});var Y=Re(961);class Fe extends Y.Lv{constructor(c,Tt,Jt,Ft,Ve){super(c),this.onFinalize=Ve,this._next=Tt?function(ze){try{Tt(ze)}catch(qe){c.error(qe)}}:super._next,this._error=Ft?function(ze){try{Ft(ze)}catch(qe){c.error(qe)}finally{this.unsubscribe()}}:super._error,this._complete=Jt?function(){try{Jt()}catch(ze){c.error(ze)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var c;const{closed:Tt}=this;super.unsubscribe(),!Tt&&(null===(c=this.onFinalize)||void 0===c||c.call(this))}}},4:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{U:()=>Pt});var Y=Re(482),Fe=Re(403);function Pt(c,Tt){return(0,Y.e)((Jt,Ft)=>{let Ve=0;Jt.subscribe(new Fe.Q(Ft,ze=>{Ft.next(c.call(Tt,ze,Ve++))}))})}},189:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{J:()=>Pt});var Y=Re(577),Fe=Re(671);function Pt(c=1/0){return(0,Y.z)(Fe.y,c)}},577:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{z:()=>Ve});var Y=Re(4),Fe=Re(421),Pt=Re(482),c=Re(672),Tt=Re(403),Ft=Re(576);function Ve(ze,qe,lt=1/0){return(0,Ft.m)(qe)?Ve((en,On)=>(0,Y.U)((bt,Ct)=>qe(en,bt,On,Ct))((0,Fe.Xf)(ze(en,On))),lt):("number"==typeof qe&&(lt=qe),(0,Pt.e)((en,On)=>function Jt(ze,qe,lt,en,On,bt,Ct,sn){const Ot=[];let ln=0,Yt=0,At=!1;const ft=()=>{At&&!Ot.length&&!ln&&qe.complete()},cn=Gt=>ln<en?Pn(Gt):Ot.push(Gt),Pn=Gt=>{bt&&qe.next(Gt),ln++;let an=!1;(0,Fe.Xf)(lt(Gt,Yt++)).subscribe(new Tt.Q(qe,gt=>{null==On||On(gt),bt?cn(gt):qe.next(gt)},()=>{an=!0},void 0,()=>{if(an)try{for(ln--;Ot.length&&ln<en;){const gt=Ot.shift();Ct?(0,c.f)(qe,Ct,()=>Pn(gt)):Pn(gt)}ft()}catch(gt){qe.error(gt)}}))};return ze.subscribe(new Tt.Q(qe,cn,()=>{At=!0,ft()})),()=>{null==sn||sn()}}(en,On,ze,lt)))}},698:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{q:()=>c});var Y=Re(515),Fe=Re(482),Pt=Re(403);function c(Tt){return Tt<=0?()=>Y.E:(0,Fe.e)((Jt,Ft)=>{let Ve=0;Jt.subscribe(new Pt.Q(Ft,ze=>{++Ve<=Tt&&(Ft.next(ze),Tt<=Ve&&Ft.complete())}))})}},410:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{z:()=>Y});const Y={setTimeout(...Fe){const{delegate:Pt}=Y;return((null==Pt?void 0:Pt.setTimeout)||setTimeout)(...Fe)},clearTimeout(Fe){const{delegate:Pt}=Y;return((null==Pt?void 0:Pt.clearTimeout)||clearTimeout)(Fe)},delegate:void 0}},202:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{h:()=>Fe});const Fe=function Y(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},822:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{L:()=>Y});const Y="function"==typeof Symbol&&Symbol.observable||"@@observable"},669:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{_6:()=>Jt,jO:()=>c,yG:()=>Tt});var Y=Re(576);function Pt(Ft){return Ft[Ft.length-1]}function c(Ft){return(0,Y.m)(Pt(Ft))?Ft.pop():void 0}function Tt(Ft){return function Fe(Ft){return Ft&&(0,Y.m)(Ft.schedule)}(Pt(Ft))?Ft.pop():void 0}function Jt(Ft,Ve){return"number"==typeof Pt(Ft)?Ft.pop():Ve}},737:(Hn,Vt,Re)=>{"use strict";function Y(Fe,Pt){if(Fe){const c=Fe.indexOf(Pt);0<=c&&Fe.splice(c,1)}}Re.d(Vt,{P:()=>Y})},888:(Hn,Vt,Re)=>{"use strict";function Y(Fe){const c=Fe(Tt=>{Error.call(Tt),Tt.stack=(new Error).stack});return c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,c}Re.d(Vt,{d:()=>Y})},806:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{x:()=>Pt,O:()=>c});var Y=Re(416);let Fe=null;function Pt(Tt){if(Y.v.useDeprecatedSynchronousErrorHandling){const Jt=!Fe;if(Jt&&(Fe={errorThrown:!1,error:null}),Tt(),Jt){const{errorThrown:Ft,error:Ve}=Fe;if(Fe=null,Ft)throw Ve}}else Tt()}function c(Tt){Y.v.useDeprecatedSynchronousErrorHandling&&Fe&&(Fe.errorThrown=!0,Fe.error=Tt)}},672:(Hn,Vt,Re)=>{"use strict";function Y(Fe,Pt,c,Tt=0,Jt=!1){const Ft=Pt.schedule(function(){c(),Jt?Fe.add(this.schedule(null,Tt)):this.unsubscribe()},Tt);if(Fe.add(Ft),!Jt)return Ft}Re.d(Vt,{f:()=>Y})},671:(Hn,Vt,Re)=>{"use strict";function Y(Fe){return Fe}Re.d(Vt,{y:()=>Y})},144:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{z:()=>Y});const Y=Fe=>Fe&&"number"==typeof Fe.length&&"function"!=typeof Fe},206:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{D:()=>Fe});var Y=Re(576);function Fe(Pt){return Symbol.asyncIterator&&(0,Y.m)(null==Pt?void 0:Pt[Symbol.asyncIterator])}},576:(Hn,Vt,Re)=>{"use strict";function Y(Fe){return"function"==typeof Fe}Re.d(Vt,{m:()=>Y})},670:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{c:()=>Pt});var Y=Re(822),Fe=Re(576);function Pt(c){return(0,Fe.m)(c[Y.L])}},495:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{T:()=>Pt});var Y=Re(202),Fe=Re(576);function Pt(c){return(0,Fe.m)(null==c?void 0:c[Y.h])}},239:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{t:()=>Fe});var Y=Re(576);function Fe(Pt){return(0,Y.m)(null==Pt?void 0:Pt.then)}},260:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{Q:()=>Pt,L:()=>c});var Y=Re(655),Fe=Re(576);function Pt(Tt){return(0,Y.FC)(this,arguments,function*(){const Ft=Tt.getReader();try{for(;;){const{value:Ve,done:ze}=yield(0,Y.qq)(Ft.read());if(ze)return yield(0,Y.qq)(void 0);yield yield(0,Y.qq)(Ve)}}finally{Ft.releaseLock()}})}function c(Tt){return(0,Fe.m)(null==Tt?void 0:Tt.getReader)}},482:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{A:()=>Fe,e:()=>Pt});var Y=Re(576);function Fe(c){return(0,Y.m)(null==c?void 0:c.lift)}function Pt(c){return Tt=>{if(Fe(Tt))return Tt.lift(function(Jt){try{return c(Jt,this)}catch(Ft){this.error(Ft)}});throw new TypeError("Unable to lift unknown Observable type")}}},849:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{h:()=>Pt});var Y=Re(416),Fe=Re(410);function Pt(c){Fe.z.setTimeout(()=>{const{onUnhandledError:Tt}=Y.v;if(!Tt)throw c;Tt(c)})}},532:(Hn,Vt,Re)=>{"use strict";function Y(Fe){return new TypeError(`You provided ${null!==Fe&&"object"==typeof Fe?"an invalid object":`'${Fe}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}Re.d(Vt,{z:()=>Y})},655:(Hn,Vt,Re)=>{"use strict";function Ve(Be,He,Je,Ke){return new(Je||(Je=Promise))(function($e,tn){function wn(Zn){try{zt(Ke.next(Zn))}catch(Ui){tn(Ui)}}function ri(Zn){try{zt(Ke.throw(Zn))}catch(Ui){tn(Ui)}}function zt(Zn){Zn.done?$e(Zn.value):function _t($e){return $e instanceof Je?$e:new Je(function(tn){tn($e)})}(Zn.value).then(wn,ri)}zt((Ke=Ke.apply(Be,He||[])).next())})}function Ot(Be){return this instanceof Ot?(this.v=Be,this):new Ot(Be)}function ln(Be,He,Je){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var _t,Ke=Je.apply(Be,He||[]),$e=[];return _t={},tn("next"),tn("throw"),tn("return"),_t[Symbol.asyncIterator]=function(){return this},_t;function tn(sr){Ke[sr]&&(_t[sr]=function(vi){return new Promise(function(Fr,pn){$e.push([sr,vi,Fr,pn])>1||wn(sr,vi)})})}function wn(sr,vi){try{!function ri(sr){sr.value instanceof Ot?Promise.resolve(sr.value.v).then(zt,Zn):Ui($e[0][2],sr)}(Ke[sr](vi))}catch(Fr){Ui($e[0][3],Fr)}}function zt(sr){wn("next",sr)}function Zn(sr){wn("throw",sr)}function Ui(sr,vi){sr(vi),$e.shift(),$e.length&&wn($e[0][0],$e[0][1])}}function At(Be){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Je,He=Be[Symbol.asyncIterator];return He?He.call(Be):(Be=function en(Be){var He="function"==typeof Symbol&&Symbol.iterator,Je=He&&Be[He],Ke=0;if(Je)return Je.call(Be);if(Be&&"number"==typeof Be.length)return{next:function(){return Be&&Ke>=Be.length&&(Be=void 0),{value:Be&&Be[Ke++],done:!Be}}};throw new TypeError(He?"Object is not iterable.":"Symbol.iterator is not defined.")}(Be),Je={},Ke("next"),Ke("throw"),Ke("return"),Je[Symbol.asyncIterator]=function(){return this},Je);function Ke($e){Je[$e]=Be[$e]&&function(tn){return new Promise(function(wn,ri){!function _t($e,tn,wn,ri){Promise.resolve(ri).then(function(zt){$e({value:zt,done:wn})},tn)}(wn,ri,(tn=Be[$e](tn)).done,tn.value)})}}}Re.d(Vt,{mG:()=>Ve,qq:()=>Ot,FC:()=>ln,KL:()=>At})},808:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{mr:()=>Yt,ez:()=>Hs,K0:()=>Ft,JJ:()=>Vl,Do:()=>ft,V_:()=>qe,Ye:()=>cn,S$:()=>Ot,sg:()=>Lo,PC:()=>_n,b0:()=>At,lw:()=>Ve,EM:()=>Vn,JF:()=>os,w_:()=>Jt,bD:()=>Co,q:()=>Pt,Mx:()=>Kn,HT:()=>Tt});var Y=Re(223);let Fe=null;function Pt(){return Fe}function Tt(O){Fe||(Fe=O)}class Jt{}const Ft=new Y.OlP("DocumentToken");let Ve=(()=>{class O{historyGo(B){throw new Error("Not implemented")}}return O.\u0275fac=function(B){return new(B||O)},O.\u0275prov=Y.Yz7({token:O,factory:function(){return function ze(){return(0,Y.LFG)(lt)}()},providedIn:"platform"}),O})();const qe=new Y.OlP("Location Initialized");let lt=(()=>{class O extends Ve{constructor(B){super(),this._doc=B,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Pt().getBaseHref(this._doc)}onPopState(B){const te=Pt().getGlobalEventTarget(this._doc,"window");return te.addEventListener("popstate",B,!1),()=>te.removeEventListener("popstate",B)}onHashChange(B){const te=Pt().getGlobalEventTarget(this._doc,"window");return te.addEventListener("hashchange",B,!1),()=>te.removeEventListener("hashchange",B)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(B){this.location.pathname=B}pushState(B,te,De){en()?this._history.pushState(B,te,De):this.location.hash=De}replaceState(B,te,De){en()?this._history.replaceState(B,te,De):this.location.hash=De}forward(){this._history.forward()}back(){this._history.back()}historyGo(B=0){this._history.go(B)}getState(){return this._history.state}}return O.\u0275fac=function(B){return new(B||O)(Y.LFG(Ft))},O.\u0275prov=Y.Yz7({token:O,factory:function(){return function On(){return new lt((0,Y.LFG)(Ft))}()},providedIn:"platform"}),O})();function en(){return!!window.history.pushState}function bt(O,K){if(0==O.length)return K;if(0==K.length)return O;let B=0;return O.endsWith("/")&&B++,K.startsWith("/")&&B++,2==B?O+K.substring(1):1==B?O+K:O+"/"+K}function Ct(O){const K=O.match(/#|\?|$/),B=K&&K.index||O.length;return O.slice(0,B-("/"===O[B-1]?1:0))+O.slice(B)}function sn(O){return O&&"?"!==O[0]?"?"+O:O}let Ot=(()=>{class O{historyGo(B){throw new Error("Not implemented")}}return O.\u0275fac=function(B){return new(B||O)},O.\u0275prov=Y.Yz7({token:O,factory:function(){return function ln(O){const K=(0,Y.LFG)(Ft).location;return new At((0,Y.LFG)(Ve),K&&K.origin||"")}()},providedIn:"root"}),O})();const Yt=new Y.OlP("appBaseHref");let At=(()=>{class O extends Ot{constructor(B,te){if(super(),this._platformLocation=B,this._removeListenerFns=[],null==te&&(te=this._platformLocation.getBaseHrefFromDOM()),null==te)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=te}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(B){this._removeListenerFns.push(this._platformLocation.onPopState(B),this._platformLocation.onHashChange(B))}getBaseHref(){return this._baseHref}prepareExternalUrl(B){return bt(this._baseHref,B)}path(B=!1){const te=this._platformLocation.pathname+sn(this._platformLocation.search),De=this._platformLocation.hash;return De&&B?`${te}${De}`:te}pushState(B,te,De,et){const mt=this.prepareExternalUrl(De+sn(et));this._platformLocation.pushState(B,te,mt)}replaceState(B,te,De,et){const mt=this.prepareExternalUrl(De+sn(et));this._platformLocation.replaceState(B,te,mt)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(B=0){var te,De;null===(De=(te=this._platformLocation).historyGo)||void 0===De||De.call(te,B)}}return O.\u0275fac=function(B){return new(B||O)(Y.LFG(Ve),Y.LFG(Yt,8))},O.\u0275prov=Y.Yz7({token:O,factory:O.\u0275fac}),O})(),ft=(()=>{class O extends Ot{constructor(B,te){super(),this._platformLocation=B,this._baseHref="",this._removeListenerFns=[],null!=te&&(this._baseHref=te)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(B){this._removeListenerFns.push(this._platformLocation.onPopState(B),this._platformLocation.onHashChange(B))}getBaseHref(){return this._baseHref}path(B=!1){let te=this._platformLocation.hash;return null==te&&(te="#"),te.length>0?te.substring(1):te}prepareExternalUrl(B){const te=bt(this._baseHref,B);return te.length>0?"#"+te:te}pushState(B,te,De,et){let mt=this.prepareExternalUrl(De+sn(et));0==mt.length&&(mt=this._platformLocation.pathname),this._platformLocation.pushState(B,te,mt)}replaceState(B,te,De,et){let mt=this.prepareExternalUrl(De+sn(et));0==mt.length&&(mt=this._platformLocation.pathname),this._platformLocation.replaceState(B,te,mt)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(B=0){var te,De;null===(De=(te=this._platformLocation).historyGo)||void 0===De||De.call(te,B)}}return O.\u0275fac=function(B){return new(B||O)(Y.LFG(Ve),Y.LFG(Yt,8))},O.\u0275prov=Y.Yz7({token:O,factory:O.\u0275fac}),O})(),cn=(()=>{class O{constructor(B,te){this._subject=new Y.vpe,this._urlChangeListeners=[],this._platformStrategy=B;const De=this._platformStrategy.getBaseHref();this._platformLocation=te,this._baseHref=Ct(an(De)),this._platformStrategy.onPopState(et=>{this._subject.emit({url:this.path(!0),pop:!0,state:et.state,type:et.type})})}path(B=!1){return this.normalize(this._platformStrategy.path(B))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(B,te=""){return this.path()==this.normalize(B+sn(te))}normalize(B){return O.stripTrailingSlash(function Gt(O,K){return O&&K.startsWith(O)?K.substring(O.length):K}(this._baseHref,an(B)))}prepareExternalUrl(B){return B&&"/"!==B[0]&&(B="/"+B),this._platformStrategy.prepareExternalUrl(B)}go(B,te="",De=null){this._platformStrategy.pushState(De,"",B,te),this._notifyUrlChangeListeners(this.prepareExternalUrl(B+sn(te)),De)}replaceState(B,te="",De=null){this._platformStrategy.replaceState(De,"",B,te),this._notifyUrlChangeListeners(this.prepareExternalUrl(B+sn(te)),De)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(B=0){var te,De;null===(De=(te=this._platformStrategy).historyGo)||void 0===De||De.call(te,B)}onUrlChange(B){this._urlChangeListeners.push(B),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(te=>{this._notifyUrlChangeListeners(te.url,te.state)}))}_notifyUrlChangeListeners(B="",te){this._urlChangeListeners.forEach(De=>De(B,te))}subscribe(B,te,De){return this._subject.subscribe({next:B,error:te,complete:De})}}return O.normalizeQueryParams=sn,O.joinWithSlash=bt,O.stripTrailingSlash=Ct,O.\u0275fac=function(B){return new(B||O)(Y.LFG(Ot),Y.LFG(Ve))},O.\u0275prov=Y.Yz7({token:O,factory:function(){return function Pn(){return new cn((0,Y.LFG)(Ot),(0,Y.LFG)(Ve))}()},providedIn:"root"}),O})();function an(O){return O.replace(/\/index.html$/,"")}var Be=(()=>((Be=Be||{})[Be.Decimal=0]="Decimal",Be[Be.Percent=1]="Percent",Be[Be.Currency=2]="Currency",Be[Be.Scientific=3]="Scientific",Be))(),He=(()=>((He=He||{})[He.Zero=0]="Zero",He[He.One=1]="One",He[He.Two=2]="Two",He[He.Few=3]="Few",He[He.Many=4]="Many",He[He.Other=5]="Other",He))(),$e=(()=>(($e=$e||{})[$e.Decimal=0]="Decimal",$e[$e.Group=1]="Group",$e[$e.List=2]="List",$e[$e.PercentSign=3]="PercentSign",$e[$e.PlusSign=4]="PlusSign",$e[$e.MinusSign=5]="MinusSign",$e[$e.Exponential=6]="Exponential",$e[$e.SuperscriptingExponent=7]="SuperscriptingExponent",$e[$e.PerMille=8]="PerMille",$e[$e.Infinity=9]="Infinity",$e[$e.NaN=10]="NaN",$e[$e.TimeSeparator=11]="TimeSeparator",$e[$e.CurrencyDecimal=12]="CurrencyDecimal",$e[$e.CurrencyGroup=13]="CurrencyGroup",$e))();function Ur(O,K){const B=(0,Y.cg1)(O),te=B[Y.wAp.NumberSymbols][K];if(void 0===te){if(K===$e.CurrencyDecimal)return B[Y.wAp.NumberSymbols][$e.Decimal];if(K===$e.CurrencyGroup)return B[Y.wAp.NumberSymbols][$e.Group]}return te}const Ir=Y.kL8,Le=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function Wt(O){const K=parseInt(O);if(isNaN(K))throw new Error("Invalid integer literal when parsing "+O);return K}class br{}let at=(()=>{class O extends br{constructor(B){super(),this.locale=B}getPluralCategory(B,te){switch(Ir(te||this.locale)(B)){case He.Zero:return"zero";case He.One:return"one";case He.Two:return"two";case He.Few:return"few";case He.Many:return"many";default:return"other"}}}return O.\u0275fac=function(B){return new(B||O)(Y.LFG(Y.soG))},O.\u0275prov=Y.Yz7({token:O,factory:O.\u0275fac}),O})();function Kn(O,K){K=encodeURIComponent(K);for(const B of O.split(";")){const te=B.indexOf("="),[De,et]=-1==te?[B,""]:[B.slice(0,te),B.slice(te+1)];if(De.trim()===K)return decodeURIComponent(et)}return null}class Rn{constructor(K,B,te,De){this.$implicit=K,this.ngForOf=B,this.index=te,this.count=De}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Lo=(()=>{class O{constructor(B,te,De){this._viewContainer=B,this._template=te,this._differs=De,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(B){this._ngForOf=B,this._ngForOfDirty=!0}set ngForTrackBy(B){this._trackByFn=B}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(B){B&&(this._template=B)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const B=this._ngForOf;!this._differ&&B&&(this._differ=this._differs.find(B).create(this.ngForTrackBy))}if(this._differ){const B=this._differ.diff(this._ngForOf);B&&this._applyChanges(B)}}_applyChanges(B){const te=this._viewContainer;B.forEachOperation((De,et,mt)=>{if(null==De.previousIndex)te.createEmbeddedView(this._template,new Rn(De.item,this._ngForOf,-1,-1),null===mt?void 0:mt);else if(null==mt)te.remove(null===et?void 0:et);else if(null!==et){const Kt=te.get(et);te.move(Kt,mt),rr(Kt,De)}});for(let De=0,et=te.length;De<et;De++){const Kt=te.get(De).context;Kt.index=De,Kt.count=et,Kt.ngForOf=this._ngForOf}B.forEachIdentityChange(De=>{rr(te.get(De.currentIndex),De)})}static ngTemplateContextGuard(B,te){return!0}}return O.\u0275fac=function(B){return new(B||O)(Y.Y36(Y.s_b),Y.Y36(Y.Rgc),Y.Y36(Y.ZZ4))},O.\u0275dir=Y.lG2({type:O,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),O})();function rr(O,K){O.context.$implicit=K.item}let _n=(()=>{class O{constructor(B,te,De){this._ngEl=B,this._differs=te,this._renderer=De,this._ngStyle=null,this._differ=null}set ngStyle(B){this._ngStyle=B,!this._differ&&B&&(this._differ=this._differs.find(B).create())}ngDoCheck(){if(this._differ){const B=this._differ.diff(this._ngStyle);B&&this._applyChanges(B)}}_setStyle(B,te){const[De,et]=B.split(".");null!=(te=null!=te&&et?`${te}${et}`:te)?this._renderer.setStyle(this._ngEl.nativeElement,De,te):this._renderer.removeStyle(this._ngEl.nativeElement,De)}_applyChanges(B){B.forEachRemovedItem(te=>this._setStyle(te.key,null)),B.forEachAddedItem(te=>this._setStyle(te.key,te.currentValue)),B.forEachChangedItem(te=>this._setStyle(te.key,te.currentValue))}}return O.\u0275fac=function(B){return new(B||O)(Y.Y36(Y.SBq),Y.Y36(Y.aQg),Y.Y36(Y.Qsj))},O.\u0275dir=Y.lG2({type:O,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}}),O})();let Vl=(()=>{class O{constructor(B){this._locale=B}transform(B,te,De){if(!function Gi(O){return!(null==O||""===O||O!=O)}(B))return null;De=De||this._locale;try{return function $t(O,K,B){return function Ae(O,K,B,te,De,et,mt=!1){let Kt="",xn=!1;if(isFinite(O)){let yr=function Dt(O){let te,De,et,mt,Kt,K=Math.abs(O)+"",B=0;for((De=K.indexOf("."))>-1&&(K=K.replace(".","")),(et=K.search(/e/i))>0?(De<0&&(De=et),De+=+K.slice(et+1),K=K.substring(0,et)):De<0&&(De=K.length),et=0;"0"===K.charAt(et);et++);if(et===(Kt=K.length))te=[0],De=1;else{for(Kt--;"0"===K.charAt(Kt);)Kt--;for(De-=et,te=[],mt=0;et<=Kt;et++,mt++)te[mt]=Number(K.charAt(et))}return De>22&&(te=te.splice(0,21),B=De-1,De=1),{digits:te,exponent:B,integerLen:De}}(O);mt&&(yr=function cr(O){if(0===O.digits[0])return O;const K=O.digits.length-O.integerLen;return O.exponent?O.exponent+=2:(0===K?O.digits.push(0,0):1===K&&O.digits.push(0),O.integerLen+=2),O}(yr));let er=K.minInt,Zt=K.minFrac,Jr=K.maxFrac;if(et){const Hi=et.match(Le);if(null===Hi)throw new Error(`${et} is not a valid digit info`);const oi=Hi[1],To=Hi[3],qo=Hi[5];null!=oi&&(er=Wt(oi)),null!=To&&(Zt=Wt(To)),null!=qo?Jr=Wt(qo):null!=To&&Zt>Jr&&(Jr=Zt)}!function fn(O,K,B){if(K>B)throw new Error(`The minimum number of digits after fraction (${K}) is higher than the maximum (${B}).`);let te=O.digits,De=te.length-O.integerLen;const et=Math.min(Math.max(K,De),B);let mt=et+O.integerLen,Kt=te[mt];if(mt>0){te.splice(Math.max(O.integerLen,mt));for(let Zt=mt;Zt<te.length;Zt++)te[Zt]=0}else{De=Math.max(0,De),O.integerLen=1,te.length=Math.max(1,mt=et+1),te[0]=0;for(let Zt=1;Zt<mt;Zt++)te[Zt]=0}if(Kt>=5)if(mt-1<0){for(let Zt=0;Zt>mt;Zt--)te.unshift(0),O.integerLen++;te.unshift(1),O.integerLen++}else te[mt-1]++;for(;De<Math.max(0,et);De++)te.push(0);let xn=0!==et;const yr=K+O.integerLen,er=te.reduceRight(function(Zt,Jr,jn,Mr){return Mr[jn]=(Jr+=Zt)<10?Jr:Jr-10,xn&&(0===Mr[jn]&&jn>=yr?Mr.pop():xn=!1),Jr>=10?1:0},0);er&&(te.unshift(er),O.integerLen++)}(yr,Zt,Jr);let jn=yr.digits,Mr=yr.integerLen;const kr=yr.exponent;let po=[];for(xn=jn.every(Hi=>!Hi);Mr<er;Mr++)jn.unshift(0);for(;Mr<0;Mr++)jn.unshift(0);Mr>0?po=jn.splice(Mr,jn.length):(po=jn,jn=[0]);const Zo=[];for(jn.length>=K.lgSize&&Zo.unshift(jn.splice(-K.lgSize,jn.length).join(""));jn.length>K.gSize;)Zo.unshift(jn.splice(-K.gSize,jn.length).join(""));jn.length&&Zo.unshift(jn.join("")),Kt=Zo.join(Ur(B,te)),po.length&&(Kt+=Ur(B,De)+po.join("")),kr&&(Kt+=Ur(B,$e.Exponential)+"+"+kr)}else Kt=Ur(B,$e.Infinity);return Kt=O<0&&!xn?K.negPre+Kt+K.negSuf:K.posPre+Kt+K.posSuf,Kt}(O,function _r(O,K="-"){const B={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},te=O.split(";"),De=te[0],et=te[1],mt=-1!==De.indexOf(".")?De.split("."):[De.substring(0,De.lastIndexOf("0")+1),De.substring(De.lastIndexOf("0")+1)],Kt=mt[0],xn=mt[1]||"";B.posPre=Kt.substr(0,Kt.indexOf("#"));for(let er=0;er<xn.length;er++){const Zt=xn.charAt(er);"0"===Zt?B.minFrac=B.maxFrac=er+1:"#"===Zt?B.maxFrac=er+1:B.posSuf+=Zt}const yr=Kt.split(",");if(B.gSize=yr[1]?yr[1].length:0,B.lgSize=yr[2]||yr[1]?(yr[2]||yr[1]).length:0,et){const er=De.length-B.posPre.length-B.posSuf.length,Zt=et.indexOf("#");B.negPre=et.substr(0,Zt).replace(/'/g,""),B.negSuf=et.substr(Zt+er).replace(/'/g,"")}else B.negPre=K+B.posPre,B.negSuf=B.posSuf;return B}(function xr(O,K){return(0,Y.cg1)(O)[Y.wAp.NumberFormats][K]}(K,Be.Decimal),Ur(K,$e.MinusSign)),K,$e.Group,$e.Decimal,B)}(function da(O){if("string"==typeof O&&!isNaN(Number(O)-parseFloat(O)))return Number(O);if("number"!=typeof O)throw new Error(`${O} is not a number`);return O}(B),De,te)}catch(et){throw function Tn(O,K){return new Y.vHH(2100,"")}()}}}return O.\u0275fac=function(B){return new(B||O)(Y.Y36(Y.soG,16))},O.\u0275pipe=Y.Yjl({name:"number",type:O,pure:!0}),O})();let Hs=(()=>{class O{}return O.\u0275fac=function(B){return new(B||O)},O.\u0275mod=Y.oAB({type:O}),O.\u0275inj=Y.cJS({providers:[{provide:br,useClass:at}]}),O})();const Co="browser";let Vn=(()=>{class O{}return O.\u0275prov=(0,Y.Yz7)({token:O,providedIn:"root",factory:()=>new fo((0,Y.LFG)(Ft),window)}),O})();class fo{constructor(K,B){this.document=K,this.window=B,this.offset=()=>[0,0]}setOffset(K){this.offset=Array.isArray(K)?()=>K:K}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(K){this.supportsScrolling()&&this.window.scrollTo(K[0],K[1])}scrollToAnchor(K){if(!this.supportsScrolling())return;const B=function Ua(O,K){const B=O.getElementById(K)||O.getElementsByName(K)[0];if(B)return B;if("function"==typeof O.createTreeWalker&&O.body&&(O.body.createShadowRoot||O.body.attachShadow)){const te=O.createTreeWalker(O.body,NodeFilter.SHOW_ELEMENT);let De=te.currentNode;for(;De;){const et=De.shadowRoot;if(et){const mt=et.getElementById(K)||et.querySelector(`[name="${K}"]`);if(mt)return mt}De=te.nextNode()}}return null}(this.document,K);B&&(this.scrollToElement(B),B.focus())}setHistoryScrollRestoration(K){if(this.supportScrollRestoration()){const B=this.window.history;B&&B.scrollRestoration&&(B.scrollRestoration=K)}}scrollToElement(K){const B=K.getBoundingClientRect(),te=B.left+this.window.pageXOffset,De=B.top+this.window.pageYOffset,et=this.offset();this.window.scrollTo(te-et[0],De-et[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const K=is(this.window.history)||is(Object.getPrototypeOf(this.window.history));return!(!K||!K.writable&&!K.set)}catch(K){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(K){return!1}}}function is(O){return Object.getOwnPropertyDescriptor(O,"scrollRestoration")}class os{}},223:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{deG:()=>Yc,tb:()=>jv,AFp:()=>Nv,ip1:()=>Rg,CZH:()=>Ih,hGG:()=>cw,z2F:()=>Jd,sBO:()=>Nb,Sil:()=>Fg,_Vd:()=>Zd,EJc:()=>Gv,SBq:()=>qd,qLn:()=>tc,vpe:()=>Ul,tBr:()=>ur,XFs:()=>qt,OlP:()=>Wr,zs3:()=>Ti,ZZ4:()=>Xp,aQg:()=>Yp,soG:()=>qp,YKP:()=>Jy,h0i:()=>Ch,PXZ:()=>kb,R0b:()=>la,FiY:()=>Cr,Lbi:()=>Vv,g9A:()=>Uv,Qsj:()=>f1,FYo:()=>Xy,JOm:()=>Ma,tp0:()=>hr,Rgc:()=>Kd,dDg:()=>qv,GfV:()=>Yy,s_b:()=>$p,ifc:()=>Un,eFA:()=>Yv,G48:()=>Bb,_c5:()=>nw,VLi:()=>Mb,c2e:()=>$v,zSh:()=>Ra,wAp:()=>In,vHH:()=>Gt,cg1:()=>ug,kL8:()=>xy,dqk:()=>Wn,sIi:()=>P,CqO:()=>C_,QGY:()=>ig,F4k:()=>D_,RDi:()=>et,AaK:()=>Ot,TTD:()=>qs,xp6:()=>qf,uIk:()=>Ie,Suo:()=>yv,Xpm:()=>Me,lG2:()=>W,Yz7:()=>Ir,cJS:()=>Vr,oAB:()=>it,Yjl:()=>J,Y36:()=>Ud,_UZ:()=>x_,qZA:()=>rg,TgZ:()=>ng,EpF:()=>E_,LFG:()=>Dn,$8M:()=>ro,$Z:()=>v_,NdJ:()=>og,CRH:()=>vv,oxw:()=>M_,ALo:()=>cv,xi3:()=>uv,Q6J:()=>eg,VKq:()=>rv,iGM:()=>gv,MAs:()=>zi,CHM:()=>jl,LSH:()=>ru,YNc:()=>ai,_uU:()=>ey,hij:()=>Fp,AsE:()=>cg,Gf:()=>_v});var Y=Re(189),Fe=Re(421),Pt=Re(515),c=Re(669),Tt=Re(76),Ft=Re(579),Ve=Re(727),ze=Re(306),qe=Re(698),lt=Re(961),en=Re(482);function bt(r,o,...s){return!0===o?(r(),null):!1===o?null:o(...s).pipe((0,qe.q)(1)).subscribe(()=>r())}function Ct(r){for(let o in r)if(r[o]===Ct)return o;throw Error("Could not find renamed property on target object.")}function Ot(r){if("string"==typeof r)return r;if(Array.isArray(r))return"["+r.map(Ot).join(", ")+"]";if(null==r)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;const o=r.toString();if(null==o)return""+o;const s=o.indexOf("\n");return-1===s?o:o.substring(0,s)}function ln(r,o){return null==r||""===r?null===o?"":o:null==o||""===o?r:r+" "+o}const Yt=Ct({__forward_ref__:Ct});function At(r){return r.__forward_ref__=At,r.toString=function(){return Ot(this())},r}function ft(r){return function cn(r){return"function"==typeof r&&r.hasOwnProperty(Yt)&&r.__forward_ref__===At}(r)?r():r}class Gt extends Error{constructor(o,s){super(function an(r,o){return`NG0${Math.abs(r)}${o?": "+o:""}`}(o,s)),this.code=o}}function gt(r){return"string"==typeof r?r:null==r?"":String(r)}function Be(r){return"function"==typeof r?r.name||r.toString():"object"==typeof r&&null!=r&&"function"==typeof r.type?r.type.name||r.type.toString():gt(r)}function _t(r,o){const s=o?` in ${o}`:"";throw new Gt(-201,`No provider for ${Be(r)} found${s}`)}function xr(r,o){null==r&&function $n(r,o,s,h){throw new Error(`ASSERTION ERROR: ${r}`+(null==h?"":` [Expected=> ${s} ${h} ${o} <=Actual]`))}(o,r,null,"!=")}function Ir(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function Vr(r){return{providers:r.providers||[],imports:r.imports||[]}}function Or(r){return ko(r,zr)||ko(r,bs)}function ko(r,o){return r.hasOwnProperty(o)?r[o]:null}function co(r){return r&&(r.hasOwnProperty(Xi)||r.hasOwnProperty(jr))?r[Xi]:null}const zr=Ct({\u0275prov:Ct}),Xi=Ct({\u0275inj:Ct}),bs=Ct({ngInjectableDef:Ct}),jr=Ct({ngInjectorDef:Ct});var qt=(()=>((qt=qt||{})[qt.Default=0]="Default",qt[qt.Host=1]="Host",qt[qt.Self=2]="Self",qt[qt.SkipSelf=4]="SkipSelf",qt[qt.Optional=8]="Optional",qt))();let gr;function on(r){const o=gr;return gr=r,o}function wo(r,o,s){const h=Or(r);return h&&"root"==h.providedIn?void 0===h.value?h.value=h.factory():h.value:s&qt.Optional?null:void 0!==o?o:void _t(Ot(r),"Injector")}function $r(r){return{toString:r}.toString()}var Qr=(()=>((Qr=Qr||{})[Qr.OnPush=0]="OnPush",Qr[Qr.Default=1]="Default",Qr))(),Un=(()=>{return(r=Un||(Un={}))[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",Un;var r})();const dn="undefined"!=typeof globalThis&&globalThis,qn="undefined"!=typeof window&&window,Do="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Wn=dn||"undefined"!=typeof global&&global||qn||Do,Ai={},En=[],ae=Ct({\u0275cmp:Ct}),V=Ct({\u0275dir:Ct}),Z=Ct({\u0275pipe:Ct}),ce=Ct({\u0275mod:Ct}),he=Ct({\u0275fac:Ct}),xe=Ct({__NG_ELEMENT_ID__:Ct});let ke=0;function Me(r){return $r(()=>{const s={},h={type:r.type,providersResolver:null,decls:r.decls,vars:r.vars,factory:null,template:r.template||null,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:s,inputs:null,outputs:null,exportAs:r.exportAs||null,onPush:r.changeDetection===Qr.OnPush,directiveDefs:null,pipeDefs:null,selectors:r.selectors||En,viewQuery:r.viewQuery||null,features:r.features||null,data:r.data||{},encapsulation:r.encapsulation||Un.Emulated,id:"c",styles:r.styles||En,_:null,setInput:null,schemas:r.schemas||null,tView:null},m=r.directives,y=r.features,w=r.pipes;return h.id+=ke++,h.inputs=vt(r.inputs,s),h.outputs=vt(r.outputs),y&&y.forEach(I=>I(h)),h.directiveDefs=m?()=>("function"==typeof m?m():m).map(Le):null,h.pipeDefs=w?()=>("function"==typeof w?w():w).map(rt):null,h})}function Le(r){return ne(r)||function Ae(r){return r[V]||null}(r)}function rt(r){return function je(r){return r[Z]||null}(r)}const wt={};function it(r){return $r(()=>{const o={type:r.type,bootstrap:r.bootstrap||En,declarations:r.declarations||En,imports:r.imports||En,exports:r.exports||En,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null};return null!=r.id&&(wt[r.id]=r.type),o})}function vt(r,o){if(null==r)return Ai;const s={};for(const h in r)if(r.hasOwnProperty(h)){let m=r[h],y=m;Array.isArray(m)&&(y=m[1],m=m[0]),s[m]=h,o&&(o[m]=y)}return s}const W=Me;function J(r){return{type:r.type,name:r.name,factory:null,pure:!1!==r.pure,onDestroy:r.type.prototype.ngOnDestroy||null}}function ne(r){return r[ae]||null}function yt(r,o){const s=r[ce]||null;if(!s&&!0===o)throw new Error(`Type ${Ot(r)} does not have '\u0275mod' property.`);return s}function Tn(r){return Array.isArray(r)&&"object"==typeof r[1]}function Pi(r){return Array.isArray(r)&&!0===r[1]}function ji(r){return 0!=(8&r.flags)}function uo(r){return 2==(2&r.flags)}function Ho(r){return 1==(1&r.flags)}function $i(r){return null!==r.template}function Oo(r){return 0!=(512&r[2])}function ho(r,o){return r.hasOwnProperty(he)?r[he]:null}class zn{constructor(o,s,h){this.previousValue=o,this.currentValue=s,this.firstChange=h}isFirstChange(){return this.firstChange}}function qs(){return fa}function fa(r){return r.type.prototype.ngOnChanges&&(r.setInput=Es),fl}function fl(){const r=Vn(this),o=null==r?void 0:r.current;if(o){const s=r.previous;if(s===Ai)r.previous=o;else for(let h in o)s[h]=o[h];r.current=null,this.ngOnChanges(o)}}function Es(r,o,s,h){const m=Vn(r)||function fo(r,o){return r[Ki]=o}(r,{previous:Ai,current:null}),y=m.current||(m.current={}),w=m.previous,I=this.declaredInputs[s],k=w[I];y[I]=new zn(k&&k.currentValue,o,w===Ai),r[h]=o}qs.ngInherit=!0;const Ki="__ngSimpleChanges__";function Vn(r){return r[Ki]||null}const K="math";let De;function et(r){De=r}function xn(r){return!!r.listen}const yr={createRenderer:(r,o)=>function mt(){return void 0!==De?De:"undefined"!=typeof document?document:void 0}()};function Zt(r){for(;Array.isArray(r);)r=r[0];return r}function kr(r,o){return Zt(o[r.index])}function Zo(r,o){return r.data[o]}function Hi(r,o){return r[o]}function oi(r,o){const s=o[r];return Tn(s)?s:s[0]}function To(r){return 4==(4&r[2])}function qo(r){return 128==(128&r[2])}function Ji(r,o){return null==o?null:r[o]}function pl(r){r[18]=0}function Bo(r,o){r[5]+=o;let s=r,h=r[3];for(;null!==h&&(1===o&&1===s[5]||-1===o&&0===s[5]);)h[5]+=o,s=h,h=h[3]}const bn={lFrame:_a(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function fc(){return bn.bindingsEnabled}function ut(){return bn.lFrame.lView}function Nn(){return bn.lFrame.tView}function jl(r){return bn.lFrame.contextLView=r,r[8]}function Zr(){let r=So();for(;null!==r&&64===r.type;)r=r.parent;return r}function So(){return bn.lFrame.currentTNode}function ei(r,o){const s=bn.lFrame;s.currentTNode=r,s.isParent=o}function Wo(){return bn.lFrame.isParent}function Xs(){return bn.isInCheckNoChangesMode}function _l(r){bn.isInCheckNoChangesMode=r}function ki(){const r=bn.lFrame;let o=r.bindingRootIndex;return-1===o&&(o=r.bindingRootIndex=r.tView.bindingStartIndex),o}function ss(){return bn.lFrame.bindingIndex++}function No(r,o){const s=bn.lFrame;s.bindingIndex=s.bindingRootIndex=r,Yo(o)}function Yo(r){bn.lFrame.currentDirectiveIndex=r}function Gl(){return bn.lFrame.currentQueryIndex}function as(r){bn.lFrame.currentQueryIndex=r}function Ys(r){const o=r[1];return 2===o.type?o.declTNode:1===o.type?r[6]:null}function to(r,o,s){if(s&qt.SkipSelf){let m=o,y=r;for(;!(m=m.parent,null!==m||s&qt.Host||(m=Ys(y),null===m||(y=y[15],10&m.type))););if(null===m)return!1;o=m,r=y}const h=bn.lFrame=$a();return h.currentTNode=o,h.lView=r,!0}function Cs(r){const o=$a(),s=r[1];bn.lFrame=o,o.currentTNode=s.firstChild,o.lView=r,o.tView=s,o.contextLView=r,o.bindingIndex=s.bindingStartIndex,o.inI18n=!1}function $a(){const r=bn.lFrame,o=null===r?null:r.child;return null===o?_a(r):o}function _a(r){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return null!==r&&(r.child=o),o}function ls(){const r=bn.lFrame;return bn.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}const yl=ls;function cs(){const r=ls();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function wi(){return bn.lFrame.selectedIndex}function Ri(r){bn.lFrame.selectedIndex=r}function vr(){const r=bn.lFrame;return Zo(r.tView,r.selectedIndex)}function Za(r,o){for(let s=o.directiveStart,h=o.directiveEnd;s<h;s++){const y=r.data[s].type.prototype,{ngAfterContentInit:w,ngAfterContentChecked:I,ngAfterViewInit:k,ngAfterViewChecked:G,ngOnDestroy:q}=y;w&&(r.contentHooks||(r.contentHooks=[])).push(-s,w),I&&((r.contentHooks||(r.contentHooks=[])).push(s,I),(r.contentCheckHooks||(r.contentCheckHooks=[])).push(s,I)),k&&(r.viewHooks||(r.viewHooks=[])).push(-s,k),G&&((r.viewHooks||(r.viewHooks=[])).push(s,G),(r.viewCheckHooks||(r.viewCheckHooks=[])).push(s,G)),null!=q&&(r.destroyHooks||(r.destroyHooks=[])).push(s,q)}}function Ks(r,o,s){xa(r,o,3,s)}function Qs(r,o,s,h){(3&r[2])===s&&xa(r,o,s,h)}function xl(r,o){let s=r[2];(3&s)===o&&(s&=2047,s+=1,r[2]=s)}function xa(r,o,s,h){const y=null!=h?h:-1,w=o.length-1;let I=0;for(let k=void 0!==h?65535&r[18]:0;k<w;k++)if("number"==typeof o[k+1]){if(I=o[k],null!=h&&I>=h)break}else o[k]<0&&(r[18]+=65536),(I<y||-1==y)&&(Ei(r,s,o,k),r[18]=(4294901760&r[18])+k+2),k++}function Ei(r,o,s,h){const m=s[h]<0,y=s[h+1],I=r[m?-s[h]:s[h]];if(m){if(r[2]>>11<r[18]>>16&&(3&r[2])===o){r[2]+=2048;try{y.call(I)}finally{}}}else try{y.call(I)}finally{}}class Io{constructor(o,s,h){this.factory=o,this.resolving=!1,this.canSeeViewProviders=s,this.injectImpl=h}}function Wa(r,o,s){const h=xn(r);let m=0;for(;m<s.length;){const y=s[m];if("number"==typeof y){if(0!==y)break;m++;const w=s[m++],I=s[m++],k=s[m++];h?r.setAttribute(o,I,k,w):o.setAttributeNS(w,I,k)}else{const w=y,I=s[++m];Wl(w)?h&&r.setProperty(o,w,I):h?r.setAttribute(o,w,I):o.setAttribute(w,I),m++}}return m}function no(r){return 3===r||4===r||6===r}function Wl(r){return 64===r.charCodeAt(0)}function fi(r,o){if(null!==o&&0!==o.length)if(null===r||0===r.length)r=o.slice();else{let s=-1;for(let h=0;h<o.length;h++){const m=o[h];"number"==typeof m?s=m:0===s||hs(r,s,m,null,-1===s||2===s?o[++h]:null)}}return r}function hs(r,o,s,h,m){let y=0,w=r.length;if(-1===o)w=-1;else for(;y<r.length;){const I=r[y++];if("number"==typeof I){if(I===o){w=-1;break}if(I>o){w=y-1;break}}}for(;y<r.length;){const I=r[y];if("number"==typeof I)break;if(I===s){if(null===h)return void(null!==m&&(r[y+1]=m));if(h===r[y+1])return void(r[y+2]=m)}y++,null!==h&&y++,null!==m&&y++}-1!==w&&(r.splice(w,0,o),y=w+1),r.splice(y++,0,s),null!==h&&r.splice(y++,0,h),null!==m&&r.splice(y++,0,m)}function gc(r){return-1!==r}function Ts(r){return 32767&r}function Js(r,o){let s=function El(r){return r>>16}(r),h=o;for(;s>0;)h=h[15],s--;return h}let Dl=!0;function ds(r){const o=Dl;return Dl=r,o}let Ya=0;function ba(r,o){const s=Ss(r,o);if(-1!==s)return s;const h=o[1];h.firstCreatePass&&(r.injectorIndex=o.length,Ka(h.data,r),Ka(o,null),Ka(h.blueprint,null));const m=Is(r,o),y=r.injectorIndex;if(gc(m)){const w=Ts(m),I=Js(m,o),k=I[1].data;for(let G=0;G<8;G++)o[y+G]=I[w+G]|k[w+G]}return o[y+8]=m,y}function Ka(r,o){r.push(0,0,0,0,0,0,0,0,o)}function Ss(r,o){return-1===r.injectorIndex||r.parent&&r.parent.injectorIndex===r.injectorIndex||null===o[r.injectorIndex+8]?-1:r.injectorIndex}function Is(r,o){if(r.parent&&-1!==r.parent.injectorIndex)return r.parent.injectorIndex;let s=0,h=null,m=o;for(;null!==m;){const y=m[1],w=y.type;if(h=2===w?y.declTNode:1===w?m[6]:null,null===h)return-1;if(s++,m=m[15],-1!==h.injectorIndex)return h.injectorIndex|s<<16}return-1}function Cl(r,o,s){!function Bt(r,o,s){let h;"string"==typeof s?h=s.charCodeAt(0)||0:s.hasOwnProperty(xe)&&(h=s[xe]),null==h&&(h=s[xe]=Ya++);const m=255&h;o.data[r+(m>>5)]|=1<<m}(r,o,s)}function T(r,o,s){if(s&qt.Optional)return r;_t(o,"NodeInjector")}function C(r,o,s,h){if(s&qt.Optional&&void 0===h&&(h=null),0==(s&(qt.Self|qt.Host))){const m=r[9],y=on(void 0);try{return m?m.get(o,h,s&qt.Optional):wo(o,h,s&qt.Optional)}finally{on(y)}}return T(h,o,s)}function L(r,o,s,h=qt.Default,m){if(null!==r){const y=function Lt(r){if("string"==typeof r)return r.charCodeAt(0)||0;const o=r.hasOwnProperty(xe)?r[xe]:void 0;return"number"==typeof o?o>=0?255&o:X:o}(s);if("function"==typeof y){if(!to(o,r,h))return h&qt.Host?T(m,s,h):C(o,s,h,m);try{const w=y(h);if(null!=w||h&qt.Optional)return w;_t(s)}finally{yl()}}else if("number"==typeof y){let w=null,I=Ss(r,o),k=-1,G=h&qt.Host?o[16][6]:null;for((-1===I||h&qt.SkipSelf)&&(k=-1===I?Is(r,o):o[I+8],-1!==k&&Qt(h,!1)?(w=o[1],I=Ts(k),o=Js(k,o)):I=-1);-1!==I;){const q=o[1];if(Mn(y,I,q.data)){const de=ge(I,o,s,w,h,G);if(de!==U)return de}k=o[I+8],-1!==k&&Qt(h,o[1].data[I+8]===G)&&Mn(y,I,o)?(w=q,I=Ts(k),o=Js(k,o)):I=-1}}}return C(o,s,h,m)}const U={};function X(){return new Gn(Zr(),ut())}function ge(r,o,s,h,m,y){const w=o[1],I=w.data[r+8],q=be(I,w,s,null==h?uo(I)&&Dl:h!=w&&0!=(3&I.type),m&qt.Host&&y===I);return null!==q?Ue(o,w,q,I):U}function be(r,o,s,h,m){const y=r.providerIndexes,w=o.data,I=1048575&y,k=r.directiveStart,q=y>>20,Ce=m?I+q:r.directiveEnd;for(let Oe=h?I:I+q;Oe<Ce;Oe++){const st=w[Oe];if(Oe<k&&s===st||Oe>=k&&st.type===s)return Oe}if(m){const Oe=w[k];if(Oe&&$i(Oe)&&Oe.type===s)return k}return null}function Ue(r,o,s,h){let m=r[s];const y=o.data;if(function us(r){return r instanceof Io}(m)){const w=m;w.resolving&&function He(r,o){const s=o?`. Dependency path: ${o.join(" > ")} > ${r}`:"";throw new Gt(-200,`Circular dependency in DI detected for ${r}${s}`)}(Be(y[s]));const I=ds(w.canSeeViewProviders);w.resolving=!0;const k=w.injectImpl?on(w.injectImpl):null;to(r,h,qt.Default);try{m=r[s]=w.factory(void 0,y,r,h),o.firstCreatePass&&s>=h.directiveStart&&function mc(r,o,s){const{ngOnChanges:h,ngOnInit:m,ngDoCheck:y}=o.type.prototype;if(h){const w=fa(o);(s.preOrderHooks||(s.preOrderHooks=[])).push(r,w),(s.preOrderCheckHooks||(s.preOrderCheckHooks=[])).push(r,w)}m&&(s.preOrderHooks||(s.preOrderHooks=[])).push(0-r,m),y&&((s.preOrderHooks||(s.preOrderHooks=[])).push(r,y),(s.preOrderCheckHooks||(s.preOrderCheckHooks=[])).push(r,y))}(s,y[s],o)}finally{null!==k&&on(k),ds(I),w.resolving=!1,yl()}}return m}function Mn(r,o,s){return!!(s[o+(r>>5)]&1<<r)}function Qt(r,o){return!(r&qt.Self||r&qt.Host&&o)}class Gn{constructor(o,s){this._tNode=o,this._lView=s}get(o,s,h){return L(this._tNode,this._lView,o,h,s)}}function ro(r){return function M(r,o){if("class"===o)return r.classes;if("style"===o)return r.styles;const s=r.attrs;if(s){const h=s.length;let m=0;for(;m<h;){const y=s[m];if(no(y))break;if(0===y)m+=2;else if("number"==typeof y)for(m++;m<h&&"string"==typeof s[m];)m++;else{if(y===o)return s[m+1];m+=2}}}return null}(Zr(),r)}const io="__parameters__";function mo(r,o,s){return $r(()=>{const h=function ps(r){return function(...s){if(r){const h=r(...s);for(const m in h)this[m]=h[m]}}}(o);function m(...y){if(this instanceof m)return h.apply(this,y),this;const w=new m(...y);return I.annotation=w,I;function I(k,G,q){const de=k.hasOwnProperty(io)?k[io]:Object.defineProperty(k,io,{value:[]})[io];for(;de.length<=q;)de.push(null);return(de[q]=de[q]||[]).push(w),k}}return s&&(m.prototype=Object.create(s.prototype)),m.prototype.ngMetadataName=r,m.annotationCls=m,m})}class Wr{constructor(o,s){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof s?this.__NG_ELEMENT_ID__=s:void 0!==s&&(this.\u0275prov=Ir({token:this,providedIn:s.providedIn||"root",factory:s.factory}))}toString(){return`InjectionToken ${this._desc}`}}const Yc=new Wr("AnalyzeForEntryComponents");function p(r,o){void 0===o&&(o=r);for(let s=0;s<r.length;s++){let h=r[s];Array.isArray(h)?(o===r&&(o=r.slice(0,s)),p(h,o)):o!==r&&o.push(h)}return o}function _(r,o){r.forEach(s=>Array.isArray(s)?_(s,o):o(s))}function v(r,o,s){o>=r.length?r.push(s):r.splice(o,0,s)}function E(r,o){return o>=r.length-1?r.pop():r.splice(o,1)[0]}const Xe={},Et="__NG_DI_FLAG__",Ne="ngTempTokenPath",jt=/\n/gm,mn="__source",yn=Ct({provide:String,useValue:Ct});let hn;function nn(r){const o=hn;return hn=r,o}function An(r,o=qt.Default){if(void 0===hn)throw new Gt(203,"");return null===hn?wo(r,void 0,o):hn.get(r,o&qt.Optional?null:void 0,o)}function Dn(r,o=qt.Default){return(function rn(){return gr}()||An)(ft(r),o)}function Fi(r){const o=[];for(let s=0;s<r.length;s++){const h=ft(r[s]);if(Array.isArray(h)){if(0===h.length)throw new Gt(900,"");let m,y=qt.Default;for(let w=0;w<h.length;w++){const I=h[w],k=mi(I);"number"==typeof k?-1===k?m=I.token:y|=k:m=I}o.push(Dn(m,y))}else o.push(Dn(h))}return o}function Ci(r,o){return r[Et]=o,r.prototype[Et]=o,r}function mi(r){return r[Et]}const ur=Ci(mo("Inject",r=>({token:r})),-1),Cr=Ci(mo("Optional"),8),hr=Ci(mo("SkipSelf"),4);class kh{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}const ra=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,sm=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var Oi=(()=>((Oi=Oi||{})[Oi.NONE=0]="NONE",Oi[Oi.HTML=1]="HTML",Oi[Oi.STYLE=2]="STYLE",Oi[Oi.SCRIPT=3]="SCRIPT",Oi[Oi.URL=4]="URL",Oi[Oi.RESOURCE_URL=5]="RESOURCE_URL",Oi))();function ru(r){const o=function Sl(){const r=ut();return r&&r[12]}();return o?o.sanitize(Oi.URL,r)||"":function gs(r,o){const s=function na(r){return r instanceof kh&&r.getTypeName()||null}(r);if(null!=s&&s!==o){if("ResourceURL"===s&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${s} (see https://g.co/ng/security#xss)`)}return s===o}(r,"URL")?function ms(r){return r instanceof kh?r.changingThisBreaksApplicationSecurity:r}(r):function gi(r){return(r=String(r)).match(ra)||r.match(sm)?r:"unsafe:"+r}(gt(r))}const _f="__ngContext__";function wr(r,o){r[_f]=o}function ou(r){const o=function Dc(r){return r[_f]||null}(r);return o?Array.isArray(o)?o:o.lView:null}function Uh(r){return r.ngOriginalError}function lu(r,...o){r.error(...o)}class tc{constructor(){this._console=console}handleError(o){const s=this._findOriginalError(o),h=function dm(r){return r&&r.ngErrorLogger||lu}(o);h(this._console,"ERROR",o),s&&h(this._console,"ORIGINAL ERROR",s)}_findOriginalError(o){let s=o&&Uh(o);for(;s&&Uh(s);)s=Uh(s);return s||null}}const $h=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Wn))();function Rs(r){return r instanceof Function?r():r}var Ma=(()=>((Ma=Ma||{})[Ma.Important=1]="Important",Ma[Ma.DashCase=2]="DashCase",Ma))();function Zu(r,o){return undefined(r,o)}function cu(r){const o=r[3];return Pi(o)?o[3]:o}function Zh(r){return Pf(r[13])}function qh(r){return Pf(r[4])}function Pf(r){for(;null!==r&&!Pi(r);)r=r[4];return r}function Al(r,o,s,h,m){if(null!=h){let y,w=!1;Pi(h)?y=h:Tn(h)&&(w=!0,h=h[0]);const I=Zt(h);0===r&&null!==s?null==m?Of(o,s,I):el(o,s,I,m||null,!0):1===r&&null!==s?el(o,s,I,m||null,!0):2===r?function Jh(r,o,s){const h=ic(r,o);h&&function Yh(r,o,s,h){xn(r)?r.removeChild(o,s,h):o.removeChild(s)}(r,h,o,s)}(o,I,w):3===r&&o.destroyNode(I),null!=y&&function vm(r,o,s,h,m){const y=s[7];y!==Zt(s)&&Al(o,r,h,y,m);for(let I=10;I<s.length;I++){const k=s[I];du(k[1],k,r,o,h,y)}}(o,r,y,s,m)}}function Xr(r,o,s){if(xn(r))return r.createElement(o,s);{const h=null!==s?function te(r){const o=r.toLowerCase();return"svg"===o?"http://www.w3.org/2000/svg":o===K?"http://www.w3.org/1998/MathML/":null}(s):null;return null===h?r.createElement(o):r.createElementNS(h,o)}}function Xh(r,o){const s=r[9],h=s.indexOf(o),m=o[3];1024&o[2]&&(o[2]&=-1025,Bo(m,-1)),s.splice(h,1)}function rc(r,o){if(r.length<=10)return;const s=10+o,h=r[s];if(h){const m=h[17];null!==m&&m!==r&&Xh(m,h),o>0&&(r[s-1][4]=h[4]);const y=E(r,10+o);!function qu(r,o){du(r,o,o[11],2,null,null),o[0]=null,o[6]=null}(h[1],h);const w=y[19];null!==w&&w.detachView(y[1]),h[3]=null,h[4]=null,h[2]&=-129}return h}function Yu(r,o){if(!(256&o[2])){const s=o[11];xn(s)&&s.destroyNode&&du(r,o,s,3,null,null),function Xu(r){let o=r[13];if(!o)return hu(r[1],r);for(;o;){let s=null;if(Tn(o))s=o[13];else{const h=o[10];h&&(s=h)}if(!s){for(;o&&!o[4]&&o!==r;)Tn(o)&&hu(o[1],o),o=o[3];null===o&&(o=r),Tn(o)&&hu(o[1],o),s=o&&o[4]}o=s}}(o)}}function hu(r,o){if(!(256&o[2])){o[2]&=-129,o[2]|=256,function Lf(r,o){let s;if(null!=r&&null!=(s=r.destroyHooks))for(let h=0;h<s.length;h+=2){const m=o[s[h]];if(!(m instanceof Io)){const y=s[h+1];if(Array.isArray(y))for(let w=0;w<y.length;w+=2){const I=m[y[w]],k=y[w+1];try{k.call(I)}finally{}}else try{y.call(m)}finally{}}}}(r,o),function _m(r,o){const s=r.cleanup,h=o[7];let m=-1;if(null!==s)for(let y=0;y<s.length-1;y+=2)if("string"==typeof s[y]){const w=s[y+1],I="function"==typeof w?w(o):Zt(o[w]),k=h[m=s[y+2]],G=s[y+3];"boolean"==typeof G?I.removeEventListener(s[y],k,G):G>=0?h[m=G]():h[m=-G].unsubscribe(),y+=2}else{const w=h[m=s[y+1]];s[y].call(w)}if(null!==h){for(let y=m+1;y<h.length;y++)h[y]();o[7]=null}}(r,o),1===o[1].type&&xn(o[11])&&o[11].destroy();const s=o[17];if(null!==s&&Pi(o[3])){s!==o[3]&&Xh(s,o);const h=o[19];null!==h&&h.detachView(r)}}}function Ic(r,o,s){return function Ff(r,o,s){let h=o;for(;null!==h&&40&h.type;)h=(o=h).parent;if(null===h)return s[0];if(2&h.flags){const m=r.data[h.directiveStart].encapsulation;if(m===Un.None||m===Un.Emulated)return null}return kr(h,s)}(r,o.parent,s)}function el(r,o,s,h,m){xn(r)?r.insertBefore(o,s,h,m):o.insertBefore(s,h,m)}function Of(r,o,s){xn(r)?r.appendChild(o,s):o.appendChild(s)}function Ku(r,o,s,h,m){null!==h?el(r,o,s,h,m):Of(r,o,s)}function ic(r,o){return xn(r)?r.parentNode(o):o.parentNode}let Nf=function Bf(r,o,s){return 40&r.type?kr(r,s):null};function tl(r,o,s,h){const m=Ic(r,h,o),y=o[11],I=function zf(r,o,s){return Nf(r,o,s)}(h.parent||o[6],h,o);if(null!=m)if(Array.isArray(s))for(let k=0;k<s.length;k++)Ku(y,m,s[k],I,!1);else Ku(y,m,s,I,!1)}function Qu(r,o){if(null!==o){const s=o.type;if(3&s)return kr(o,r);if(4&s)return Ju(-1,r[o.index]);if(8&s){const h=o.child;if(null!==h)return Qu(r,h);{const m=r[o.index];return Pi(m)?Ju(-1,m):Zt(m)}}if(32&s)return Zu(o,r)()||Zt(r[o.index]);{const h=Uf(r,o);return null!==h?Array.isArray(h)?h[0]:Qu(cu(r[16]),h):Qu(r,o.next)}}return null}function Uf(r,o){return null!==o?r[16][6].projection[o.projection]:null}function Ju(r,o){const s=10+r+1;if(s<o.length){const h=o[s],m=h[1].firstChild;if(null!==m)return Qu(h,m)}return o[7]}function ed(r,o,s,h,m,y,w){for(;null!=s;){const I=h[s.index],k=s.type;if(w&&0===o&&(I&&wr(Zt(I),h),s.flags|=4),64!=(64&s.flags))if(8&k)ed(r,o,s.child,h,m,y,!1),Al(o,r,m,I,y);else if(32&k){const G=Zu(s,h);let q;for(;q=G();)Al(o,r,m,q,y);Al(o,r,m,I,y)}else 16&k?Vf(r,o,h,s,m,y):Al(o,r,m,I,y);s=w?s.projectionNext:s.next}}function du(r,o,s,h,m,y){ed(s,h,r.firstChild,o,m,y,!1)}function Vf(r,o,s,h,m,y){const w=s[16],k=w[6].projection[h.projection];if(Array.isArray(k))for(let G=0;G<k.length;G++)Al(o,r,m,k[G],y);else ed(r,o,k,w[3],m,y,!0)}function td(r,o,s){xn(r)?r.setAttribute(o,"style",s):o.style.cssText=s}function pu(r,o,s){xn(r)?""===s?r.removeAttribute(o,"class"):r.setAttribute(o,"class",s):o.className=s}function jf(r,o,s){let h=r.length;for(;;){const m=r.indexOf(o,s);if(-1===m)return m;if(0===m||r.charCodeAt(m-1)<=32){const y=o.length;if(m+y===h||r.charCodeAt(m+y)<=32)return m}s=m+1}}const Mc="ng-template";function $f(r,o,s){let h=0;for(;h<r.length;){let m=r[h++];if(s&&"class"===m){if(m=r[h],-1!==jf(m.toLowerCase(),o,0))return!0}else if(1===m){for(;h<r.length&&"string"==typeof(m=r[h++]);)if(m.toLowerCase()===o)return!0;return!1}}return!1}function nd(r){return 4===r.type&&r.value!==Mc}function xm(r,o,s){return o===(4!==r.type||s?r.value:Mc)}function bm(r,o,s){let h=4;const m=r.attrs||[],y=function Dm(r){for(let o=0;o<r.length;o++)if(no(r[o]))return o;return r.length}(m);let w=!1;for(let I=0;I<o.length;I++){const k=o[I];if("number"!=typeof k){if(!w)if(4&h){if(h=2|1&h,""!==k&&!xm(r,k,s)||""===k&&1===o.length){if(ia(h))return!1;w=!0}}else{const G=8&h?k:o[++I];if(8&h&&null!==r.attrs){if(!$f(r.attrs,G,s)){if(ia(h))return!1;w=!0}continue}const de=wm(8&h?"class":k,m,nd(r),s);if(-1===de){if(ia(h))return!1;w=!0;continue}if(""!==G){let Ce;Ce=de>y?"":m[de+1].toLowerCase();const Oe=8&h?Ce:null;if(Oe&&-1!==jf(Oe,G,0)||2&h&&G!==Ce){if(ia(h))return!1;w=!0}}}}else{if(!w&&!ia(h)&&!ia(k))return!1;if(w&&ia(k))continue;w=!1,h=k|1&h}}return ia(h)||w}function ia(r){return 0==(1&r)}function wm(r,o,s,h){if(null===o)return-1;let m=0;if(h||!s){let y=!1;for(;m<o.length;){const w=o[m];if(w===r)return m;if(3===w||6===w)y=!0;else{if(1===w||2===w){let I=o[++m];for(;"string"==typeof I;)I=o[++m];continue}if(4===w)break;if(0===w){m+=4;continue}}m+=y?1:2}return-1}return function eh(r,o){let s=r.indexOf(4);if(s>-1)for(s++;s<r.length;){const h=r[s];if("number"==typeof h)return-1;if(h===o)return s;s++}return-1}(o,r)}function Gf(r,o,s=!1){for(let h=0;h<o.length;h++)if(bm(r,o[h],s))return!0;return!1}function rd(r,o){return r?":not("+o.trim()+")":o}function Hf(r){let o=r[0],s=1,h=2,m="",y=!1;for(;s<r.length;){let w=r[s];if("string"==typeof w)if(2&h){const I=r[++s];m+="["+w+(I.length>0?'="'+I+'"':"")+"]"}else 8&h?m+="."+w:4&h&&(m+=" "+w);else""!==m&&!ia(w)&&(o+=rd(y,m),m=""),h=w,y=y||!ia(h);s++}return""!==m&&(o+=rd(y,m)),o}const Bn={};function qf(r){Wf(Nn(),ut(),wi()+r,Xs())}function Wf(r,o,s,h){if(!h)if(3==(3&o[2])){const y=r.preOrderCheckHooks;null!==y&&Ks(o,y,s)}else{const y=r.preOrderHooks;null!==y&&Qs(o,y,0,s)}Ri(s)}function ip(r,o){const s=r.contentQueries;if(null!==s)for(let h=0;h<s.length;h+=2){const m=s[h],y=s[h+1];if(-1!==y){const w=r.data[y];as(m),w.contentQueries(2,o[y],y)}}}function kc(r,o,s,h,m,y,w,I,k,G){const q=o.blueprint.slice();return q[0]=m,q[2]=140|h,pl(q),q[3]=q[15]=r,q[8]=s,q[10]=w||r&&r[10],q[11]=I||r&&r[11],q[12]=k||r&&r[12]||null,q[9]=G||r&&r[9]||null,q[6]=y,q[16]=2==o.type?r[16]:q,q}function ac(r,o,s,h,m){let y=r.data[o];if(null===y)y=function ih(r,o,s,h,m){const y=So(),w=Wo(),k=r.data[o]=function Om(r,o,s,h,m,y){return{type:s,index:h,insertBeforeIndex:null,injectorIndex:o?o.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:m,attrs:y,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,w?y:y&&y.parent,s,o,h,m);return null===r.firstChild&&(r.firstChild=k),null!==y&&(w?null==y.child&&null!==k.parent&&(y.child=k):null===y.next&&(y.next=k)),k}(r,o,s,h,m),function Xc(){return bn.lFrame.inI18n}()&&(y.flags|=64);else if(64&y.type){y.type=s,y.value=h,y.attrs=m;const w=function Ws(){const r=bn.lFrame,o=r.currentTNode;return r.isParent?o:o.parent}();y.injectorIndex=null===w?-1:w.injectorIndex}return ei(y,!0),y}function lc(r,o,s,h){if(0===s)return-1;const m=o.length;for(let y=0;y<s;y++)o.push(h),r.blueprint.push(h),r.data.push(null);return m}function xu(r,o,s){Cs(o);try{const h=r.viewQuery;null!==h&&fh(1,h,s);const m=r.template;null!==m&&pd(r,o,m,1,s),r.firstCreatePass&&(r.firstCreatePass=!1),r.staticContentQueries&&ip(r,o),r.staticViewQueries&&fh(2,r.viewQuery,s);const y=r.components;null!==y&&function Rl(r,o){for(let s=0;s<o.length;s++)Hm(r,o[s])}(o,y)}catch(h){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),h}finally{o[2]&=-5,cs()}}function Rc(r,o,s,h){const m=o[2];if(256==(256&m))return;Cs(o);const y=Xs();try{pl(o),function $l(r){return bn.lFrame.bindingIndex=r}(r.bindingStartIndex),null!==s&&pd(r,o,s,2,h);const w=3==(3&m);if(!y)if(w){const G=r.preOrderCheckHooks;null!==G&&Ks(o,G,null)}else{const G=r.preOrderHooks;null!==G&&Qs(o,G,0,null),xl(o,0)}if(function $m(r){for(let o=Zh(r);null!==o;o=qh(o)){if(!o[2])continue;const s=o[9];for(let h=0;h<s.length;h++){const m=s[h],y=m[3];0==(1024&m[2])&&Bo(y,1),m[2]|=1024}}}(o),function jm(r){for(let o=Zh(r);null!==o;o=qh(o))for(let s=10;s<o.length;s++){const h=o[s],m=h[1];qo(h)&&Rc(m,h,m.template,h[8])}}(o),null!==r.contentQueries&&ip(r,o),!y)if(w){const G=r.contentCheckHooks;null!==G&&Ks(o,G)}else{const G=r.contentHooks;null!==G&&Qs(o,G,1),xl(o,1)}!function rp(r,o){const s=r.hostBindingOpCodes;if(null!==s)try{for(let h=0;h<s.length;h++){const m=s[h];if(m<0)Ri(~m);else{const y=m,w=s[++h],I=s[++h];No(w,y),I(2,o[y])}}}finally{Ri(-1)}}(r,o);const I=r.components;null!==I&&function op(r,o){for(let s=0;s<o.length;s++)Gm(r,o[s])}(o,I);const k=r.viewQuery;if(null!==k&&fh(2,k,h),!y)if(w){const G=r.viewCheckHooks;null!==G&&Ks(o,G)}else{const G=r.viewHooks;null!==G&&Qs(o,G,2),xl(o,2)}!0===r.firstUpdatePass&&(r.firstUpdatePass=!1),y||(o[2]&=-73),1024&o[2]&&(o[2]&=-1025,Bo(o[3],-1))}finally{cs()}}function sp(r,o,s,h){const m=o[10],y=!Xs(),w=To(o);try{y&&!w&&m.begin&&m.begin(),w&&xu(r,o,h),Rc(r,o,s,h)}finally{y&&!w&&m.end&&m.end()}}function pd(r,o,s,h,m){const y=wi(),w=2&h;try{Ri(-1),w&&o.length>20&&Wf(r,o,20,Xs()),s(h,m)}finally{Ri(y)}}function oh(r,o,s){!fc()||(function lh(r,o,s,h){const m=s.directiveStart,y=s.directiveEnd;r.firstCreatePass||ba(s,o),wr(h,o);const w=s.initialInputs;for(let I=m;I<y;I++){const k=r.data[I],G=$i(k);G&&vd(o,s,k);const q=Ue(o,r,I,s);wr(q,o),null!==w&&bd(0,I-m,q,k,0,w),G&&(oi(s.index,o)[8]=q)}}(r,o,s,kr(s,o)),128==(128&s.flags)&&function _d(r,o,s){const h=s.directiveStart,m=s.directiveEnd,w=s.index,I=function ma(){return bn.lFrame.currentDirectiveIndex}();try{Ri(w);for(let k=h;k<m;k++){const G=r.data[k],q=o[k];Yo(k),(null!==G.hostBindings||0!==G.hostVars||null!==G.hostAttrs)&&dp(G,q)}}finally{Ri(-1),Yo(I)}}(r,o,s))}function sh(r,o,s=kr){const h=o.localNames;if(null!==h){let m=o.index+1;for(let y=0;y<h.length;y+=2){const w=h[y+1],I=-1===w?s(o,r):r[w];r[m++]=I}}}function ah(r){const o=r.tView;return null===o||o.incompleteFirstPass?r.tView=il(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts):o}function il(r,o,s,h,m,y,w,I,k,G){const q=20+h,de=q+m,Ce=function ap(r,o){const s=[];for(let h=0;h<o;h++)s.push(h<r?null:Bn);return s}(q,de),Oe="function"==typeof G?G():G;return Ce[1]={type:r,blueprint:Ce,template:s,queries:null,viewQuery:I,declTNode:o,data:Ce.slice().fill(null,q),bindingStartIndex:q,expandoStartIndex:de,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof y?y():y,pipeRegistry:"function"==typeof w?w():w,firstChild:null,schemas:k,consts:Oe,incompleteFirstPass:!1}}function Eu(r,o,s,h){const m=Ed(o);null===s?m.push(h):(m.push(s),r.firstCreatePass&&mh(r).push(h,m.length-1))}function lp(r,o,s){for(let h in r)if(r.hasOwnProperty(h)){const m=r[h];(s=null===s?{}:s).hasOwnProperty(h)?s[h].push(o,m):s[h]=[o,m]}return s}function Aa(r,o,s,h){let m=!1;if(fc()){const y=function Vm(r,o,s){const h=r.directiveRegistry;let m=null;if(h)for(let y=0;y<h.length;y++){const w=h[y];Gf(s,w.selectors,!1)&&(m||(m=[]),Cl(ba(s,o),r,w.type),$i(w)?(fp(r,s),m.unshift(w)):m.push(w))}return m}(r,o,s),w=null===h?null:{"":-1};if(null!==y){m=!0,pp(s,r.data.length,y.length);for(let q=0;q<y.length;q++){const de=y[q];de.providersResolver&&de.providersResolver(de)}let I=!1,k=!1,G=lc(r,o,y.length,null);for(let q=0;q<y.length;q++){const de=y[q];s.mergedAttrs=fi(s.mergedAttrs,de.hostAttrs),uh(r,s,o,G,de),yd(G,de,w),null!==de.contentQueries&&(s.flags|=8),(null!==de.hostBindings||null!==de.hostAttrs||0!==de.hostVars)&&(s.flags|=128);const Ce=de.type.prototype;!I&&(Ce.ngOnChanges||Ce.ngOnInit||Ce.ngDoCheck)&&((r.preOrderHooks||(r.preOrderHooks=[])).push(s.index),I=!0),!k&&(Ce.ngOnChanges||Ce.ngDoCheck)&&((r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(s.index),k=!0),G++}!function zm(r,o){const h=o.directiveEnd,m=r.data,y=o.attrs,w=[];let I=null,k=null;for(let G=o.directiveStart;G<h;G++){const q=m[G],de=q.inputs,Ce=null===y||nd(o)?null:mp(de,y);w.push(Ce),I=lp(de,G,I),k=lp(q.outputs,G,k)}null!==I&&(I.hasOwnProperty("class")&&(o.flags|=16),I.hasOwnProperty("style")&&(o.flags|=32)),o.initialInputs=w,o.inputs=I,o.outputs=k}(r,s)}w&&function ch(r,o,s){if(o){const h=r.localNames=[];for(let m=0;m<o.length;m+=2){const y=s[o[m+1]];if(null==y)throw new Gt(-301,`Export of name '${o[m+1]}' not found!`);h.push(o[m],y)}}}(s,h,w)}return s.mergedAttrs=fi(s.mergedAttrs,s.attrs),m}function gd(r,o,s,h,m,y){const w=y.hostBindings;if(w){let I=r.hostBindingOpCodes;null===I&&(I=r.hostBindingOpCodes=[]);const k=~o.index;(function hp(r){let o=r.length;for(;o>0;){const s=r[--o];if("number"==typeof s&&s<0)return s}return 0})(I)!=k&&I.push(k),I.push(h,m,w)}}function dp(r,o){null!==r.hostBindings&&r.hostBindings(1,o)}function fp(r,o){o.flags|=2,(r.components||(r.components=[])).push(o.index)}function yd(r,o,s){if(s){if(o.exportAs)for(let h=0;h<o.exportAs.length;h++)s[o.exportAs[h]]=r;$i(o)&&(s[""]=r)}}function pp(r,o,s){r.flags|=1,r.directiveStart=o,r.directiveEnd=o+s,r.providerIndexes=o}function uh(r,o,s,h,m){r.data[h]=m;const y=m.factory||(m.factory=ho(m.type)),w=new Io(y,$i(m),null);r.blueprint[h]=w,s[h]=w,gd(r,o,0,h,lc(r,s,m.hostVars,Bn),m)}function vd(r,o,s){const h=kr(o,r),m=ah(s),y=r[10],w=Cu(r,kc(r,m,null,s.onPush?64:16,h,o,y,y.createRenderer(h,s),null,null));r[o.index]=w}function yo(r,o,s,h,m,y){const w=kr(r,o);!function xd(r,o,s,h,m,y,w){if(null==y)xn(r)?r.removeAttribute(o,m,s):o.removeAttribute(m);else{const I=null==w?gt(y):w(y,h||"",m);xn(r)?r.setAttribute(o,m,I,s):s?o.setAttributeNS(s,m,I):o.setAttribute(m,I)}}(o[11],w,y,r.value,s,h,m)}function bd(r,o,s,h,m,y){const w=y[o];if(null!==w){const I=h.setInput;for(let k=0;k<w.length;){const G=w[k++],q=w[k++],de=w[k++];null!==I?h.setInput(s,de,G,q):s[q]=de}}}function mp(r,o){let s=null,h=0;for(;h<o.length;){const m=o[h];if(0!==m)if(5!==m){if("number"==typeof m)break;r.hasOwnProperty(m)&&(null===s&&(s=[]),s.push(m,r[m],o[h+1])),h+=2}else h+=2;else h+=4}return s}function gp(r,o,s,h){return new Array(r,!0,!1,o,null,0,h,s,null,null)}function Gm(r,o){const s=oi(o,r);if(qo(s)){const h=s[1];80&s[2]?Rc(h,s,h.template,s[8]):s[5]>0&&Du(s)}}function Du(r){for(let h=Zh(r);null!==h;h=qh(h))for(let m=10;m<h.length;m++){const y=h[m];if(1024&y[2]){const w=y[1];Rc(w,y,w.template,y[8])}else y[5]>0&&Du(y)}const s=r[1].components;if(null!==s)for(let h=0;h<s.length;h++){const m=oi(s[h],r);qo(m)&&m[5]>0&&Du(m)}}function Hm(r,o){const s=oi(o,r),h=s[1];(function _p(r,o){for(let s=o.length;s<r.blueprint.length;s++)o.push(r.blueprint[s])})(h,s),xu(h,s,s[8])}function Cu(r,o){return r[13]?r[14][4]=o:r[13]=o,r[14]=o,o}function hh(r){for(;r;){r[2]|=64;const o=cu(r);if(Oo(r)&&!o)return r;r=o}return null}function zc(r,o,s){const h=o[10];h.begin&&h.begin();try{Rc(r,o,r.template,s)}catch(m){throw Po(o,m),m}finally{h.end&&h.end()}}function dh(r){!function Oc(r){for(let o=0;o<r.components.length;o++){const s=r.components[o],h=ou(s),m=h[1];sp(m,h,m.template,s)}}(r[8])}function fh(r,o,s){as(0),o(r,s)}const ph=(()=>Promise.resolve(null))();function Ed(r){return r[7]||(r[7]=[])}function mh(r){return r.cleanup||(r.cleanup=[])}function Po(r,o){const s=r[9],h=s?s.get(tc,null):null;h&&h.handleError(o)}function Bc(r,o,s,h,m){for(let y=0;y<s.length;){const w=s[y++],I=s[y++],k=o[w],G=r.data[w];null!==G.setInput?G.setInput(k,m,h,I):k[I]=m}}function Pa(r,o,s){const h=function Mr(r,o){return Zt(o[r])}(o,r);!function nc(r,o,s){xn(r)?r.setValue(o,s):o.textContent=s}(r[11],h,s)}function Tu(r,o,s){let h=s?r.styles:null,m=s?r.classes:null,y=0;if(null!==o)for(let w=0;w<o.length;w++){const I=o[w];"number"==typeof I?y=I:1==y?m=ln(m,I):2==y&&(h=ln(h,I+": "+o[++w]+";"))}s?r.styles=h:r.stylesWithoutHost=h,s?r.classes=m:r.classesWithoutHost=m}const ka=new Wr("INJECTOR",-1);class sa{get(o,s=Xe){if(s===Xe){const h=new Error(`NullInjectorError: No provider for ${Ot(o)}!`);throw h.name="NullInjectorError",h}return s}}const Ra=new Wr("Set Injector scope."),Ll={},vp={};let Su;function Cd(){return void 0===Su&&(Su=new sa),Su}function Td(r,o=null,s=null,h){const m=xp(r,o,s,h);return m._resolveInjectorDefTypes(),m}function xp(r,o=null,s=null,h){return new bp(r,s,o||Cd(),h)}class bp{constructor(o,s,h,m=null){this.parent=h,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const y=[];s&&_(s,I=>this.processProvider(I,o,s)),_([o],I=>this.processInjectorType(I,[],y)),this.records.set(ka,cc(void 0,this));const w=this.records.get(Ra);this.scope=null!=w?w.value:null,this.source=m||("object"==typeof o?null:Ot(o))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(o=>o.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(o,s=Xe,h=qt.Default){this.assertNotDestroyed();const m=nn(this),y=on(void 0);try{if(!(h&qt.SkipSelf)){let I=this.records.get(o);if(void 0===I){const k=function Ad(r){return"function"==typeof r||"object"==typeof r&&r instanceof Wr}(o)&&Or(o);I=k&&this.injectableDefInScope(k)?cc(gh(o),Ll):null,this.records.set(o,I)}if(null!=I)return this.hydrate(o,I)}return(h&qt.Self?Cd():this.parent).get(o,s=h&qt.Optional&&s===Xe?null:s)}catch(w){if("NullInjectorError"===w.name){if((w[Ne]=w[Ne]||[]).unshift(Ot(o)),m)throw w;return function ea(r,o,s,h){const m=r[Ne];throw o[mn]&&m.unshift(o[mn]),r.message=function As(r,o,s,h=null){r=r&&"\n"===r.charAt(0)&&"\u0275"==r.charAt(1)?r.substr(2):r;let m=Ot(o);if(Array.isArray(o))m=o.map(Ot).join(" -> ");else if("object"==typeof o){let y=[];for(let w in o)if(o.hasOwnProperty(w)){let I=o[w];y.push(w+":"+("string"==typeof I?JSON.stringify(I):Ot(I)))}m=`{${y.join(", ")}}`}return`${s}${h?"("+h+")":""}[${m}]: ${r.replace(jt,"\n  ")}`}("\n"+r.message,m,s,h),r.ngTokenPath=m,r[Ne]=null,r}(w,o,"R3InjectorError",this.source)}throw w}finally{on(y),nn(m)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(o=>this.get(o))}toString(){const o=[];return this.records.forEach((h,m)=>o.push(Ot(m))),`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Gt(205,"")}processInjectorType(o,s,h){if(!(o=ft(o)))return!1;let m=co(o);const y=null==m&&o.ngModule||void 0,w=void 0===y?o:y,I=-1!==h.indexOf(w);if(void 0!==y&&(m=co(y)),null==m)return!1;if(null!=m.imports&&!I){let q;h.push(w);try{_(m.imports,de=>{this.processInjectorType(de,s,h)&&(void 0===q&&(q=[]),q.push(de))})}finally{}if(void 0!==q)for(let de=0;de<q.length;de++){const{ngModule:Ce,providers:Oe}=q[de];_(Oe,st=>this.processProvider(st,Ce,Oe||En))}}this.injectorDefTypes.add(w);const k=ho(w)||(()=>new w);this.records.set(w,cc(k,Ll));const G=m.providers;if(null!=G&&!I){const q=o;_(G,de=>this.processProvider(de,q,G))}return void 0!==y&&void 0!==o.providers}processProvider(o,s,h){let m=sl(o=ft(o))?o:ft(o&&o.provide);const y=function Ep(r,o,s){return Id(r)?cc(void 0,r.useValue):cc(function Sd(r,o,s){let h;if(sl(r)){const m=ft(r);return ho(m)||gh(m)}if(Id(r))h=()=>ft(r.useValue);else if(function Dp(r){return!(!r||!r.useFactory)}(r))h=()=>r.useFactory(...Fi(r.deps||[]));else if(function Fl(r){return!(!r||!r.useExisting)}(r))h=()=>Dn(ft(r.useExisting));else{const m=ft(r&&(r.useClass||r.provide));if(!function Nc(r){return!!r.deps}(r))return ho(m)||gh(m);h=()=>new m(...Fi(r.deps))}return h}(r),Ll)}(o);if(sl(o)||!0!==o.multi)this.records.get(m);else{let w=this.records.get(m);w||(w=cc(void 0,Ll,!0),w.factory=()=>Fi(w.multi),this.records.set(m,w)),m=o,w.multi.push(o)}this.records.set(m,y)}hydrate(o,s){return s.value===Ll&&(s.value=vp,s.value=s.factory()),"object"==typeof s.value&&s.value&&function Md(r){return null!==r&&"object"==typeof r&&"function"==typeof r.ngOnDestroy}(s.value)&&this.onDestroy.add(s.value),s.value}injectableDefInScope(o){if(!o.providedIn)return!1;const s=ft(o.providedIn);return"string"==typeof s?"any"===s||s===this.scope:this.injectorDefTypes.has(s)}}function gh(r){const o=Or(r),s=null!==o?o.factory:ho(r);if(null!==s)return s;if(r instanceof Wr)throw new Gt(204,"");if(r instanceof Function)return function wp(r){const o=r.length;if(o>0)throw function S(r,o){const s=[];for(let h=0;h<r;h++)s.push(o);return s}(o,"?"),new Gt(204,"");const s=function lr(r){const o=r&&(r[zr]||r[bs]);if(o){const s=function Kr(r){if(r.hasOwnProperty("name"))return r.name;const o=(""+r).match(/^function\s*([^\s(]+)/);return null===o?"":o[1]}(r);return console.warn(`DEPRECATED: DI is instantiating a token "${s}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${s}" class.`),o}return null}(r);return null!==s?()=>s.factory(r):()=>new r}(r);throw new Gt(204,"")}function cc(r,o,s=!1){return{factory:r,value:o,multi:s?[]:void 0}}function Id(r){return null!==r&&"object"==typeof r&&yn in r}function sl(r){return"function"==typeof r}let Ti=(()=>{class r{static create(s,h){var m;if(Array.isArray(s))return Td({name:""},h,s,"");{const y=null!==(m=s.name)&&void 0!==m?m:"";return Td({name:y},s.parent,s.providers,y)}}}return r.THROW_IF_NOT_FOUND=Xe,r.NULL=new sa,r.\u0275prov=Ir({token:r,providedIn:"any",factory:()=>Dn(ka)}),r.__NG_ELEMENT_ID__=-1,r})();function Rp(r,o){Za(ou(r)[1],Zr())}let b=null;function D(){if(!b){const r=Wn.Symbol;if(r&&r.iterator)b=r.iterator;else{const o=Object.getOwnPropertyNames(Map.prototype);for(let s=0;s<o.length;++s){const h=o[s];"entries"!==h&&"size"!==h&&Map.prototype[h]===Map.prototype.entries&&(b=h)}}}return b}function P(r){return!!H(r)&&(Array.isArray(r)||!(r instanceof Map)&&D()in r)}function H(r){return null!==r&&("function"==typeof r||"object"==typeof r)}function ee(r,o,s){return r[o]=s}function fe(r,o,s){return!Object.is(r[o],s)&&(r[o]=s,!0)}function ve(r,o,s,h){const m=fe(r,o,s);return fe(r,o+1,h)||m}function Ie(r,o,s,h){const m=ut();return fe(m,ss(),o)&&(Nn(),yo(vr(),m,r,o,s,h)),Ie}function We(r,o,s,h,m,y){const I=ve(r,function eo(){return bn.lFrame.bindingIndex}(),s,m);return function Xo(r){const o=bn.lFrame,s=o.bindingIndex;return o.bindingIndex=o.bindingIndex+r,s}(2),I?o+gt(s)+h+gt(m)+y:Bn}function ai(r,o,s,h,m,y,w,I){const k=ut(),G=Nn(),q=r+20,de=G.firstCreatePass?function _i(r,o,s,h,m,y,w,I,k){const G=o.consts,q=ac(o,r,4,w||null,Ji(G,I));Aa(o,s,q,Ji(G,k)),Za(o,q);const de=q.tViews=il(2,q,h,m,y,o.directiveRegistry,o.pipeRegistry,null,o.schemas,G);return null!==o.queries&&(o.queries.template(o,q),de.queries=o.queries.embeddedTView(q)),q}(q,G,k,o,s,h,m,y,w):G.data[q];ei(de,!1);const Ce=k[11].createComment("");tl(G,k,Ce,de),wr(Ce,k),Cu(k,k[q]=gp(Ce,k,Ce,de)),Ho(de)&&oh(G,k,de),null!=w&&sh(k,de,I)}function zi(r){return Hi(function Qn(){return bn.lFrame.contextLView}(),20+r)}function Ud(r,o=qt.Default){const s=ut();return null===s?Dn(r,o):L(Zr(),s,ft(r),o)}function v_(){throw new Error("invalid")}function eg(r,o,s){const h=ut();return fe(h,ss(),o)&&function ys(r,o,s,h,m,y,w,I){const k=kr(o,s);let q,G=o.inputs;!I&&null!=G&&(q=G[h])?(Bc(r,s,q,h,m),uo(o)&&function Fc(r,o){const s=oi(o,r);16&s[2]||(s[2]|=64)}(s,o.index)):3&o.type&&(h=function Bm(r){return"class"===r?"className":"for"===r?"htmlFor":"formaction"===r?"formAction":"innerHtml"===r?"innerHTML":"readonly"===r?"readOnly":"tabindex"===r?"tabIndex":r}(h),m=null!=w?w(m,o.value||"",h):m,xn(y)?y.setProperty(k,h,m):Wl(h)||(k.setProperty?k.setProperty(h,m):k[h]=m))}(Nn(),vr(),h,r,o,h[11],s,!1),eg}function tg(r,o,s,h,m){const w=m?"class":"style";Bc(r,s,o.inputs[w],w,h)}function ng(r,o,s,h){const m=ut(),y=Nn(),w=20+r,I=m[11],k=m[w]=Xr(I,o,function va(){return bn.lFrame.currentNamespace}()),G=y.firstCreatePass?function _0(r,o,s,h,m,y,w){const I=o.consts,G=ac(o,r,2,m,Ji(I,y));return Aa(o,s,G,Ji(I,w)),null!==G.attrs&&Tu(G,G.attrs,!1),null!==G.mergedAttrs&&Tu(G,G.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,G),G}(w,y,m,0,o,s,h):y.data[w];ei(G,!0);const q=G.mergedAttrs;null!==q&&Wa(I,k,q);const de=G.classes;null!==de&&pu(I,k,de);const Ce=G.styles;null!==Ce&&td(I,k,Ce),64!=(64&G.flags)&&tl(y,m,k,G),0===function Zc(){return bn.lFrame.elementDepthCount}()&&wr(k,m),function qc(){bn.lFrame.elementDepthCount++}(),Ho(G)&&(oh(y,m,G),function Lc(r,o,s){if(ji(o)){const m=o.directiveEnd;for(let y=o.directiveStart;y<m;y++){const w=r.data[y];w.contentQueries&&w.contentQueries(1,s[y],y)}}}(y,G,m)),null!==h&&sh(m,G)}function rg(){let r=Zr();Wo()?function gl(){bn.lFrame.isParent=!1}():(r=r.parent,ei(r,!1));const o=r;!function Wc(){bn.lFrame.elementDepthCount--}();const s=Nn();s.firstCreatePass&&(Za(s,r),ji(r)&&s.queries.elementEnd(r)),null!=o.classesWithoutHost&&function wl(r){return 0!=(16&r.flags)}(o)&&tg(s,o,ut(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function Zl(r){return 0!=(32&r.flags)}(o)&&tg(s,o,ut(),o.stylesWithoutHost,!1)}function x_(r,o,s,h){ng(r,o,s,h),rg()}function E_(){return ut()}function ig(r){return!!r&&"function"==typeof r.then}function D_(r){return!!r&&"function"==typeof r.subscribe}const C_=D_;function og(r,o,s,h){const m=ut(),y=Nn(),w=Zr();return function S_(r,o,s,h,m,y,w,I){const k=Ho(h),q=r.firstCreatePass&&mh(r),de=o[8],Ce=Ed(o);let Oe=!0;if(3&h.type||I){const Ut=kr(h,o),Xt=I?I(Ut):Ut,dt=Ce.length,vn=I?or=>I(Zt(or[h.index])):h.index;if(xn(s)){let or=null;if(!I&&k&&(or=function x0(r,o,s,h){const m=r.cleanup;if(null!=m)for(let y=0;y<m.length-1;y+=2){const w=m[y];if(w===s&&m[y+1]===h){const I=o[7],k=m[y+2];return I.length>k?I[k]:null}"string"==typeof w&&(y+=2)}return null}(r,o,m,h.index)),null!==or)(or.__ngLastListenerFn__||or).__ngNextListenerFn__=y,or.__ngLastListenerFn__=y,Oe=!1;else{y=sg(h,o,de,y,!1);const Lr=s.listen(Xt,m,y);Ce.push(y,Lr),q&&q.push(m,vn,dt,dt+1)}}else y=sg(h,o,de,y,!0),Xt.addEventListener(m,y,w),Ce.push(y),q&&q.push(m,vn,dt,w)}else y=sg(h,o,de,y,!1);const st=h.outputs;let Mt;if(Oe&&null!==st&&(Mt=st[m])){const Ut=Mt.length;if(Ut)for(let Xt=0;Xt<Ut;Xt+=2){const ca=o[Mt[Xt]][Mt[Xt+1]].subscribe(y),Lu=Ce.length;Ce.push(y,ca),q&&q.push(m,h.index,Lu,-(Lu+1))}}}(y,m,m[11],w,r,o,!!s,h),og}function I_(r,o,s,h){try{return!1!==s(h)}catch(m){return Po(r,m),!1}}function sg(r,o,s,h,m){return function y(w){if(w===Function)return h;const I=2&r.flags?oi(r.index,o):o;0==(32&o[2])&&hh(I);let k=I_(o,0,h,w),G=y.__ngNextListenerFn__;for(;G;)k=I_(o,0,G,w)&&k,G=G.__ngNextListenerFn__;return m&&!1===k&&(w.preventDefault(),w.returnValue=!1),k}}function M_(r=1){return function vl(r){return(bn.lFrame.contextLView=function ya(r,o){for(;r>0;)o=o[15],r--;return o}(r,bn.lFrame.contextLView))[8]}(r)}function ey(r,o=""){const s=ut(),h=Nn(),m=r+20,y=h.firstCreatePass?ac(h,m,1,o,null):h.data[m],w=s[m]=function Wh(r,o){return xn(r)?r.createText(o):r.createTextNode(o)}(s[11],o);tl(h,s,w,y),ei(y,!1)}function Fp(r,o,s){const h=ut(),m=function Ye(r,o,s,h){return fe(r,ss(),s)?o+gt(s)+h:Bn}(h,r,o,s);return m!==Bn&&Pa(h,wi(),m),Fp}function cg(r,o,s,h,m){const y=ut(),w=We(y,r,o,s,h,m);return w!==Bn&&Pa(y,wi(),w),cg}const ku=void 0;var ax=["en",[["a","p"],["AM","PM"],ku],[["AM","PM"],ku,ku],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],ku,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],ku,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",ku,"{1} 'at' {0}",ku],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function sx(r){const s=Math.floor(Math.abs(r)),h=r.toString().replace(/^[^.]*\.?/,"").length;return 1===s&&0===h?1:5}];let wh={};function ug(r){const o=function lx(r){return r.toLowerCase().replace(/_/g,"-")}(r);let s=by(o);if(s)return s;const h=o.split("-")[0];if(s=by(h),s)return s;if("en"===h)return ax;throw new Error(`Missing locale data for the locale "${r}".`)}function xy(r){return ug(r)[In.PluralCase]}function by(r){return r in wh||(wh[r]=Wn.ng&&Wn.ng.common&&Wn.ng.common.locales&&Wn.ng.common.locales[r]),wh[r]}var In=(()=>((In=In||{})[In.LocaleId=0]="LocaleId",In[In.DayPeriodsFormat=1]="DayPeriodsFormat",In[In.DayPeriodsStandalone=2]="DayPeriodsStandalone",In[In.DaysFormat=3]="DaysFormat",In[In.DaysStandalone=4]="DaysStandalone",In[In.MonthsFormat=5]="MonthsFormat",In[In.MonthsStandalone=6]="MonthsStandalone",In[In.Eras=7]="Eras",In[In.FirstDayOfWeek=8]="FirstDayOfWeek",In[In.WeekendRange=9]="WeekendRange",In[In.DateFormat=10]="DateFormat",In[In.TimeFormat=11]="TimeFormat",In[In.DateTimeFormat=12]="DateTimeFormat",In[In.NumberSymbols=13]="NumberSymbols",In[In.NumberFormats=14]="NumberFormats",In[In.CurrencyCode=15]="CurrencyCode",In[In.CurrencySymbol=16]="CurrencySymbol",In[In.CurrencyName=17]="CurrencyName",In[In.Currencies=18]="Currencies",In[In.Directionality=19]="Directionality",In[In.PluralCase=20]="PluralCase",In[In.ExtraData=21]="ExtraData",In))();const Op="en-US";let wy=Op;class qy{}class u1{resolveComponentFactory(o){throw function c1(r){const o=Error(`No component factory found for ${Ot(r)}. Did you add it to @NgModule.entryComponents?`);return o.ngComponent=r,o}(o)}}let Zd=(()=>{class r{}return r.NULL=new u1,r})();function h1(){return Dh(Zr(),ut())}function Dh(r,o){return new qd(kr(r,o))}let qd=(()=>{class r{constructor(s){this.nativeElement=s}}return r.__NG_ELEMENT_ID__=h1,r})();function d1(r){return r instanceof qd?r.nativeElement:r}class Xy{}let f1=(()=>{class r{}return r.__NG_ELEMENT_ID__=()=>function m1(){const r=ut(),s=oi(Zr().index,r);return function p1(r){return r[11]}(Tn(s)?s:r)}(),r})(),g1=(()=>{class r{}return r.\u0275prov=Ir({token:r,providedIn:"root",factory:()=>null}),r})();class Yy{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const _1=new Yy("13.2.0"),_g={};function Vp(r,o,s,h,m=!1){for(;null!==s;){const y=o[s.index];if(null!==y&&h.push(Zt(y)),Pi(y))for(let I=10;I<y.length;I++){const k=y[I],G=k[1].firstChild;null!==G&&Vp(k[1],k,G,h)}const w=s.type;if(8&w)Vp(r,o,s.child,h);else if(32&w){const I=Zu(s,o);let k;for(;k=I();)h.push(k)}else if(16&w){const I=Uf(o,s);if(Array.isArray(I))h.push(...I);else{const k=cu(o[16]);Vp(k[1],k,I,h,!0)}}s=m?s.projectionNext:s.next}return h}class Wd{constructor(o,s){this._lView=o,this._cdRefInjectingView=s,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const o=this._lView,s=o[1];return Vp(s,o,s.firstChild,[])}get context(){return this._lView[8]}set context(o){this._lView[8]=o}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[3];if(Pi(o)){const s=o[8],h=s?s.indexOf(this):-1;h>-1&&(rc(o,h),E(s,h))}this._attachedToViewContainer=!1}Yu(this._lView[1],this._lView)}onDestroy(o){Eu(this._lView[1],this._lView,null,o)}markForCheck(){hh(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){zc(this._lView[1],this._lView,this.context)}checkNoChanges(){!function Zm(r,o,s){_l(!0);try{zc(r,o,s)}finally{_l(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Gt(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Wu(r,o){du(r,o,o[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new Gt(902,"");this._appRef=o}}class y1 extends Wd{constructor(o){super(o),this._view=o}detectChanges(){dh(this._view)}checkNoChanges(){!function qm(r){_l(!0);try{dh(r)}finally{_l(!1)}}(this._view)}get context(){return null}}class Ky extends Zd{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const s=ne(o);return new yg(s,this.ngModule)}}function Qy(r){const o=[];for(let s in r)r.hasOwnProperty(s)&&o.push({propName:r[s],templateName:s});return o}const x1=new Wr("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>$h});class yg extends qy{constructor(o,s){super(),this.componentDef=o,this.ngModule=s,this.componentType=o.type,this.selector=function Zf(r){return r.map(Hf).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!s}get inputs(){return Qy(this.componentDef.inputs)}get outputs(){return Qy(this.componentDef.outputs)}create(o,s,h,m){const y=(m=m||this.ngModule)?function b1(r,o){return{get:(s,h,m)=>{const y=r.get(s,_g,m);return y!==_g||h===_g?y:o.get(s,h,m)}}}(o,m.injector):o,w=y.get(Xy,yr),I=y.get(g1,null),k=w.createRenderer(null,this.componentDef),G=this.componentDef.selectors[0][0]||"div",q=h?function wu(r,o,s){if(xn(r))return r.selectRootElement(o,s===Un.ShadowDom);let h="string"==typeof o?r.querySelector(o):o;return h.textContent="",h}(k,h,this.componentDef.encapsulation):Xr(w.createRenderer(null,this.componentDef),G,function v1(r){const o=r.toLowerCase();return"svg"===o?"svg":"math"===o?K:null}(G)),de=this.componentDef.onPush?576:528,Ce=function kp(r,o){return{components:[],scheduler:r||$h,clean:ph,playerHandler:o||null,flags:0}}(),Oe=il(0,null,null,1,0,null,null,null,null,null),st=kc(null,Oe,Ce,de,null,null,w,k,I,y);let Mt,Ut;Cs(st);try{const Xt=function Pu(r,o,s,h,m,y){const w=s[1];s[20]=r;const k=ac(w,20,2,"#host",null),G=k.mergedAttrs=o.hostAttrs;null!==G&&(Tu(k,G,!0),null!==r&&(Wa(m,r,G),null!==k.classes&&pu(m,r,k.classes),null!==k.styles&&td(m,r,k.styles)));const q=h.createRenderer(r,o),de=kc(s,ah(o),null,o.onPush?64:16,s[20],k,h,q,y||null,null);return w.firstCreatePass&&(Cl(ba(k,s),w,o.type),fp(w,k),pp(k,s.length,1)),Cu(s,de),s[20]=de}(q,this.componentDef,st,w,k);if(q)if(h)Wa(k,q,["ng-version",_1.full]);else{const{attrs:dt,classes:vn}=function Tm(r){const o=[],s=[];let h=1,m=2;for(;h<r.length;){let y=r[h];if("string"==typeof y)2===m?""!==y&&o.push(y,r[++h]):8===m&&s.push(y);else{if(!ia(m))break;m=y}h++}return{attrs:o,classes:s}}(this.componentDef.selectors[0]);dt&&Wa(k,q,dt),vn&&vn.length>0&&pu(k,q,vn.join(" "))}if(Ut=Zo(Oe,20),void 0!==s){const dt=Ut.projection=[];for(let vn=0;vn<this.ngContentSelectors.length;vn++){const or=s[vn];dt.push(null!=or?Array.from(or):null)}}Mt=function Pp(r,o,s,h,m){const y=s[1],w=function Um(r,o,s){const h=Zr();r.firstCreatePass&&(s.providersResolver&&s.providersResolver(s),uh(r,h,o,lc(r,o,1,null),s));const m=Ue(o,r,h.directiveStart,h);wr(m,o);const y=kr(h,o);return y&&wr(y,o),m}(y,s,o);if(h.components.push(w),r[8]=w,m&&m.forEach(k=>k(w,o)),o.contentQueries){const k=Zr();o.contentQueries(1,w,k.directiveStart)}const I=Zr();return!y.firstCreatePass||null===o.hostBindings&&null===o.hostAttrs||(Ri(I.index),gd(s[1],I,0,I.directiveStart,I.directiveEnd,o),dp(o,w)),w}(Xt,this.componentDef,st,Ce,[Rp]),xu(Oe,st,null)}finally{cs()}return new E1(this.componentType,Mt,Dh(Ut,st),st,Ut)}}class E1 extends class l1{}{constructor(o,s,h,m,y){super(),this.location=h,this._rootLView=m,this._tNode=y,this.instance=s,this.hostView=this.changeDetectorRef=new y1(m),this.componentType=o}get injector(){return new Gn(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}class Ch{}class Jy{}const Th=new Map;class nv extends Ch{constructor(o,s){super(),this._parent=s,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Ky(this);const h=yt(o);this._bootstrapComponents=Rs(h.bootstrap),this._r3Injector=xp(o,s,[{provide:Ch,useValue:this},{provide:Zd,useValue:this.componentFactoryResolver}],Ot(o)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(o)}get(o,s=Ti.THROW_IF_NOT_FOUND,h=qt.Default){return o===Ti||o===Ch||o===ka?this:this._r3Injector.get(o,s,h)}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(s=>s()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class vg extends Jy{constructor(o){super(),this.moduleType=o,null!==yt(o)&&function C1(r){const o=new Set;!function s(h){const m=yt(h,!0),y=m.id;null!==y&&(function ev(r,o,s){if(o&&o!==s)throw new Error(`Duplicate module registered for ${r} - ${Ot(o)} vs ${Ot(o.name)}`)}(y,Th.get(y),h),Th.set(y,h));const w=Rs(m.imports);for(const I of w)o.has(I)||(o.add(I),s(I))}(r)}(o)}create(o){return new nv(this.moduleType,o)}}function rv(r,o,s,h){return function iv(r,o,s,h,m,y){const w=o+s;return fe(r,w,m)?ee(r,w+1,y?h.call(y,m):h(m)):Xd(r,w+1)}(ut(),ki(),r,o,s,h)}function Xd(r,o){const s=r[o];return s===Bn?void 0:s}function cv(r,o){const s=Nn();let h;const m=r+20;s.firstCreatePass?(h=function F1(r,o){if(o)for(let s=o.length-1;s>=0;s--){const h=o[s];if(r===h.name)return h}}(o,s.pipeRegistry),s.data[m]=h,h.onDestroy&&(s.destroyHooks||(s.destroyHooks=[])).push(m,h.onDestroy)):h=s.data[m];const y=h.factory||(h.factory=ho(h.type)),w=on(Ud);try{const I=ds(!1),k=y();return ds(I),function Si(r,o,s,h){s>=r.data.length&&(r.data[s]=null,r.blueprint[s]=null),o[s]=h}(s,ut(),m,k),k}finally{on(w)}}function uv(r,o,s,h){const m=r+20,y=ut(),w=Hi(y,m);return function Yd(r,o){return r[1].data[o].pure}(y,m)?function ov(r,o,s,h,m,y,w){const I=o+s;return ve(r,I,m,y)?ee(r,I+2,w?h.call(w,m,y):h(m,y)):Xd(r,I+2)}(y,ki(),o,w.transform,s,h,w):w.transform(s,h)}function xg(r){return o=>{setTimeout(r,void 0,o)}}const Ul=class U1 extends Ft.x{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,s,h){var m,y,w;let I=o,k=s||(()=>null),G=h;if(o&&"object"==typeof o){const de=o;I=null===(m=de.next)||void 0===m?void 0:m.bind(de),k=null===(y=de.error)||void 0===y?void 0:y.bind(de),G=null===(w=de.complete)||void 0===w?void 0:w.bind(de)}this.__isAsync&&(k=xg(k),I&&(I=xg(I)),G&&(G=xg(G)));const q=super.subscribe({next:I,error:k,complete:G});return o instanceof Ve.w0&&o.add(q),q}};function V1(){return this._results[D()]()}class bg{constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const s=D(),h=bg.prototype;h[s]||(h[s]=V1)}get changes(){return this._changes||(this._changes=new Ul)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,s){return this._results.reduce(o,s)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,s){const h=this;h.dirty=!1;const m=p(o);(this._changesDetected=!function l(r,o,s){if(r.length!==o.length)return!1;for(let h=0;h<r.length;h++){let m=r[h],y=o[h];if(s&&(m=s(m),y=s(y)),y!==m)return!1}return!0}(h._results,m,s))&&(h._results=m,h.length=m.length,h.last=m[this.length-1],h.first=m[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let Kd=(()=>{class r{}return r.__NG_ELEMENT_ID__=G1,r})();const j1=Kd,$1=class extends j1{constructor(o,s,h){super(),this._declarationLView=o,this._declarationTContainer=s,this.elementRef=h}createEmbeddedView(o){const s=this._declarationTContainer.tViews,h=kc(this._declarationLView,s,o,16,null,s.declTNode,null,null,null,null);h[17]=this._declarationLView[this._declarationTContainer.index];const y=this._declarationLView[19];return null!==y&&(h[19]=y.createEmbeddedView(s)),xu(s,h,o),new Wd(h)}};function G1(){return jp(Zr(),ut())}function jp(r,o){return 4&r.type?new $1(o,r,Dh(r,o)):null}let $p=(()=>{class r{}return r.__NG_ELEMENT_ID__=H1,r})();function H1(){return fv(Zr(),ut())}const Z1=$p,hv=class extends Z1{constructor(o,s,h){super(),this._lContainer=o,this._hostTNode=s,this._hostLView=h}get element(){return Dh(this._hostTNode,this._hostLView)}get injector(){return new Gn(this._hostTNode,this._hostLView)}get parentInjector(){const o=Is(this._hostTNode,this._hostLView);if(gc(o)){const s=Js(o,this._hostLView),h=Ts(o);return new Gn(s[1].data[h+8],s)}return new Gn(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const s=dv(this._lContainer);return null!==s&&s[o]||null}get length(){return this._lContainer.length-10}createEmbeddedView(o,s,h){const m=o.createEmbeddedView(s||{});return this.insert(m,h),m}createComponent(o,s,h,m,y){const w=o&&!function d(r){return"function"==typeof r}(o);let I;if(w)I=s;else{const de=s||{};I=de.index,h=de.injector,m=de.projectableNodes,y=de.ngModuleRef}const k=w?o:new yg(ne(o)),G=h||this.parentInjector;if(!y&&null==k.ngModule&&G){const de=G.get(Ch,null);de&&(y=de)}const q=k.create(G,m,void 0,y);return this.insert(q.hostView,I),q}insert(o,s){const h=o._lView,m=h[1];if(function Va(r){return Pi(r[3])}(h)){const q=this.indexOf(o);if(-1!==q)this.detach(q);else{const de=h[3],Ce=new hv(de,de[6],de[3]);Ce.detach(Ce.indexOf(o))}}const y=this._adjustIndex(s),w=this._lContainer;!function uu(r,o,s,h){const m=10+h,y=s.length;h>0&&(s[m-1][4]=o),h<y-10?(o[4]=s[m],v(s,10+h,o)):(s.push(o),o[4]=null),o[3]=s;const w=o[17];null!==w&&s!==w&&function Rf(r,o){const s=r[9];o[16]!==o[3][3][16]&&(r[2]=!0),null===s?r[9]=[o]:s.push(o)}(w,o);const I=o[19];null!==I&&I.insertView(r),o[2]|=128}(m,h,w,y);const I=Ju(y,w),k=h[11],G=ic(k,w[7]);return null!==G&&function kf(r,o,s,h,m,y){h[0]=m,h[6]=o,du(r,h,s,1,m,y)}(m,w[6],k,h,G,I),o.attachToViewContainerRef(),v(wg(w),y,o),o}move(o,s){return this.insert(o,s)}indexOf(o){const s=dv(this._lContainer);return null!==s?s.indexOf(o):-1}remove(o){const s=this._adjustIndex(o,-1),h=rc(this._lContainer,s);h&&(E(wg(this._lContainer),s),Yu(h[1],h))}detach(o){const s=this._adjustIndex(o,-1),h=rc(this._lContainer,s);return h&&null!=E(wg(this._lContainer),s)?new Wd(h):null}_adjustIndex(o,s=0){return null==o?this.length+s:o}};function dv(r){return r[8]}function wg(r){return r[8]||(r[8]=[])}function fv(r,o){let s;const h=o[r.index];if(Pi(h))s=h;else{let m;if(8&r.type)m=Zt(h);else{const y=o[11];m=y.createComment("");const w=kr(r,o);el(y,ic(y,w),m,function ym(r,o){return xn(r)?r.nextSibling(o):o.nextSibling}(y,w),!1)}o[r.index]=s=gp(h,o,m,r),Cu(o,s)}return new hv(s,r,o)}class Eg{constructor(o){this.queryList=o,this.matches=null}clone(){return new Eg(this.queryList)}setDirty(){this.queryList.setDirty()}}class Dg{constructor(o=[]){this.queries=o}createEmbeddedView(o){const s=o.queries;if(null!==s){const h=null!==o.contentQueries?o.contentQueries[0]:s.length,m=[];for(let y=0;y<h;y++){const w=s.getByIndex(y);m.push(this.queries[w.indexInDeclarationView].clone())}return new Dg(m)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let s=0;s<this.queries.length;s++)null!==wv(o,s).matches&&this.queries[s].setDirty()}}class pv{constructor(o,s,h=null){this.predicate=o,this.flags=s,this.read=h}}class Cg{constructor(o=[]){this.queries=o}elementStart(o,s){for(let h=0;h<this.queries.length;h++)this.queries[h].elementStart(o,s)}elementEnd(o){for(let s=0;s<this.queries.length;s++)this.queries[s].elementEnd(o)}embeddedTView(o){let s=null;for(let h=0;h<this.length;h++){const m=null!==s?s.length:0,y=this.getByIndex(h).embeddedTView(o,m);y&&(y.indexInDeclarationView=h,null!==s?s.push(y):s=[y])}return null!==s?new Cg(s):null}template(o,s){for(let h=0;h<this.queries.length;h++)this.queries[h].template(o,s)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class Tg{constructor(o,s=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=s}elementStart(o,s){this.isApplyingToNode(s)&&this.matchTNode(o,s)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,s){this.elementStart(o,s)}embeddedTView(o,s){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,s),new Tg(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const s=this._declarationNodeIndex;let h=o.parent;for(;null!==h&&8&h.type&&h.index!==s;)h=h.parent;return s===(null!==h?h.index:-1)}return this._appliesToNextNode}matchTNode(o,s){const h=this.metadata.predicate;if(Array.isArray(h))for(let m=0;m<h.length;m++){const y=h[m];this.matchTNodeWithReadOption(o,s,X1(s,y)),this.matchTNodeWithReadOption(o,s,be(s,o,y,!1,!1))}else h===Kd?4&s.type&&this.matchTNodeWithReadOption(o,s,-1):this.matchTNodeWithReadOption(o,s,be(s,o,h,!1,!1))}matchTNodeWithReadOption(o,s,h){if(null!==h){const m=this.metadata.read;if(null!==m)if(m===qd||m===$p||m===Kd&&4&s.type)this.addMatch(s.index,-2);else{const y=be(s,o,m,!1,!1);null!==y&&this.addMatch(s.index,y)}else this.addMatch(s.index,h)}}addMatch(o,s){null===this.matches?this.matches=[o,s]:this.matches.push(o,s)}}function X1(r,o){const s=r.localNames;if(null!==s)for(let h=0;h<s.length;h+=2)if(s[h]===o)return s[h+1];return null}function K1(r,o,s,h){return-1===s?function Y1(r,o){return 11&r.type?Dh(r,o):4&r.type?jp(r,o):null}(o,r):-2===s?function Q1(r,o,s){return s===qd?Dh(o,r):s===Kd?jp(o,r):s===$p?fv(o,r):void 0}(r,o,h):Ue(r,r[1],s,o)}function mv(r,o,s,h){const m=o[19].queries[h];if(null===m.matches){const y=r.data,w=s.matches,I=[];for(let k=0;k<w.length;k+=2){const G=w[k];I.push(G<0?null:K1(o,y[G],w[k+1],s.metadata.read))}m.matches=I}return m.matches}function Sg(r,o,s,h){const m=r.queries.getByIndex(s),y=m.matches;if(null!==y){const w=mv(r,o,m,s);for(let I=0;I<y.length;I+=2){const k=y[I];if(k>0)h.push(w[I/2]);else{const G=y[I+1],q=o[-k];for(let de=10;de<q.length;de++){const Ce=q[de];Ce[17]===Ce[3]&&Sg(Ce[1],Ce,G,h)}if(null!==q[9]){const de=q[9];for(let Ce=0;Ce<de.length;Ce++){const Oe=de[Ce];Sg(Oe[1],Oe,G,h)}}}}}return h}function gv(r){const o=ut(),s=Nn(),h=Gl();as(h+1);const m=wv(s,h);if(r.dirty&&To(o)===(2==(2&m.metadata.flags))){if(null===m.matches)r.reset([]);else{const y=m.crossesNgTemplate?Sg(s,o,h,[]):mv(s,o,m,h);r.reset(y,d1),r.notifyOnChanges()}return!0}return!1}function _v(r,o,s){const h=Nn();h.firstCreatePass&&(bv(h,new pv(r,o,s),-1),2==(2&o)&&(h.staticViewQueries=!0)),xv(h,ut(),o)}function yv(r,o,s,h){const m=Nn();if(m.firstCreatePass){const y=Zr();bv(m,new pv(o,s,h),y.index),function eb(r,o){const s=r.contentQueries||(r.contentQueries=[]);o!==(s.length?s[s.length-1]:-1)&&s.push(r.queries.length-1,o)}(m,r),2==(2&s)&&(m.staticContentQueries=!0)}xv(m,ut(),s)}function vv(){return function J1(r,o){return r[19].queries[o].queryList}(ut(),Gl())}function xv(r,o,s){const h=new bg(4==(4&s));Eu(r,o,h,h.destroy),null===o[19]&&(o[19]=new Dg),o[19].queries.push(new Eg(h))}function bv(r,o,s){null===r.queries&&(r.queries=new Cg),r.queries.track(new Tg(o,s))}function wv(r,o){return r.queries.getByIndex(o)}function Zp(...r){}const Rg=new Wr("Application Initializer");let Ih=(()=>{class r{constructor(s){this.appInits=s,this.resolve=Zp,this.reject=Zp,this.initialized=!1,this.done=!1,this.donePromise=new Promise((h,m)=>{this.resolve=h,this.reject=m})}runInitializers(){if(this.initialized)return;const s=[],h=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let m=0;m<this.appInits.length;m++){const y=this.appInits[m]();if(ig(y))s.push(y);else if(C_(y)){const w=new Promise((I,k)=>{y.subscribe({complete:I,error:k})});s.push(w)}}Promise.all(s).then(()=>{h()}).catch(m=>{this.reject(m)}),0===s.length&&h(),this.initialized=!0}}return r.\u0275fac=function(s){return new(s||r)(Dn(Rg,8))},r.\u0275prov=Ir({token:r,factory:r.\u0275fac}),r})();const Nv=new Wr("AppId"),vb={provide:Nv,useFactory:function yb(){return`${Lg()}${Lg()}${Lg()}`},deps:[]};function Lg(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Uv=new Wr("Platform Initializer"),Vv=new Wr("Platform ID"),jv=new Wr("appBootstrapListener");let $v=(()=>{class r{log(s){console.log(s)}warn(s){console.warn(s)}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=Ir({token:r,factory:r.\u0275fac}),r})();const qp=new Wr("LocaleId"),Gv=new Wr("DefaultCurrencyCode");class xb{constructor(o,s){this.ngModuleFactory=o,this.componentFactories=s}}let Fg=(()=>{class r{compileModuleSync(s){return new vg(s)}compileModuleAsync(s){return Promise.resolve(this.compileModuleSync(s))}compileModuleAndAllComponentsSync(s){const h=this.compileModuleSync(s),y=Rs(yt(s).declarations).reduce((w,I)=>{const k=ne(I);return k&&w.push(new yg(k)),w},[]);return new xb(h,y)}compileModuleAndAllComponentsAsync(s){return Promise.resolve(this.compileModuleAndAllComponentsSync(s))}clearCache(){}clearCacheFor(s){}getModuleId(s){}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=Ir({token:r,factory:r.\u0275fac}),r})();const wb=(()=>Promise.resolve(0))();function Og(r){"undefined"==typeof Zone?wb.then(()=>{r&&r.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",r)}class la{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:s=!1,shouldCoalesceRunChangeDetection:h=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Ul(!1),this.onMicrotaskEmpty=new Ul(!1),this.onStable=new Ul(!1),this.onError=new Ul(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const m=this;m._nesting=0,m._outer=m._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(m._inner=m._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(m._inner=m._inner.fork(Zone.longStackTraceZoneSpec)),m.shouldCoalesceEventChangeDetection=!h&&s,m.shouldCoalesceRunChangeDetection=h,m.lastRequestAnimationFrameId=-1,m.nativeRequestAnimationFrame=function Eb(){let r=Wn.requestAnimationFrame,o=Wn.cancelAnimationFrame;if("undefined"!=typeof Zone&&r&&o){const s=r[Zone.__symbol__("OriginalDelegate")];s&&(r=s);const h=o[Zone.__symbol__("OriginalDelegate")];h&&(o=h)}return{nativeRequestAnimationFrame:r,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function Tb(r){const o=()=>{!function Cb(r){r.isCheckStableRunning||-1!==r.lastRequestAnimationFrameId||(r.lastRequestAnimationFrameId=r.nativeRequestAnimationFrame.call(Wn,()=>{r.fakeTopEventTask||(r.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{r.lastRequestAnimationFrameId=-1,Bg(r),r.isCheckStableRunning=!0,zg(r),r.isCheckStableRunning=!1},void 0,()=>{},()=>{})),r.fakeTopEventTask.invoke()}),Bg(r))}(r)};r._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(s,h,m,y,w,I)=>{try{return Hv(r),s.invokeTask(m,y,w,I)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===y.type||r.shouldCoalesceRunChangeDetection)&&o(),Zv(r)}},onInvoke:(s,h,m,y,w,I,k)=>{try{return Hv(r),s.invoke(m,y,w,I,k)}finally{r.shouldCoalesceRunChangeDetection&&o(),Zv(r)}},onHasTask:(s,h,m,y)=>{s.hasTask(m,y),h===m&&("microTask"==y.change?(r._hasPendingMicrotasks=y.microTask,Bg(r),zg(r)):"macroTask"==y.change&&(r.hasPendingMacrotasks=y.macroTask))},onHandleError:(s,h,m,y)=>(s.handleError(m,y),r.runOutsideAngular(()=>r.onError.emit(y)),!1)})}(m)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!la.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(la.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(o,s,h){return this._inner.run(o,s,h)}runTask(o,s,h,m){const y=this._inner,w=y.scheduleEventTask("NgZoneEvent: "+m,o,Db,Zp,Zp);try{return y.runTask(w,s,h)}finally{y.cancelTask(w)}}runGuarded(o,s,h){return this._inner.runGuarded(o,s,h)}runOutsideAngular(o){return this._outer.run(o)}}const Db={};function zg(r){if(0==r._nesting&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function Bg(r){r.hasPendingMicrotasks=!!(r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&-1!==r.lastRequestAnimationFrameId)}function Hv(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function Zv(r){r._nesting--,zg(r)}class Sb{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Ul,this.onMicrotaskEmpty=new Ul,this.onStable=new Ul,this.onError=new Ul}run(o,s,h){return o.apply(s,h)}runGuarded(o,s,h){return o.apply(s,h)}runOutsideAngular(o){return o()}runTask(o,s,h,m){return o.apply(s,h)}}let qv=(()=>{class r{constructor(s){this._ngZone=s,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),s.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{la.assertNotInAngularZone(),Og(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Og(()=>{for(;0!==this._callbacks.length;){let s=this._callbacks.pop();clearTimeout(s.timeoutId),s.doneCb(this._didWork)}this._didWork=!1});else{let s=this.getPendingTasks();this._callbacks=this._callbacks.filter(h=>!h.updateCb||!h.updateCb(s)||(clearTimeout(h.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(s=>({source:s.source,creationLocation:s.creationLocation,data:s.data})):[]}addCallback(s,h,m){let y=-1;h&&h>0&&(y=setTimeout(()=>{this._callbacks=this._callbacks.filter(w=>w.timeoutId!==y),s(this._didWork,this.getPendingTasks())},h)),this._callbacks.push({doneCb:s,timeoutId:y,updateCb:m})}whenStable(s,h,m){if(m&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(s,h,m),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(s,h,m){return[]}}return r.\u0275fac=function(s){return new(s||r)(Dn(la))},r.\u0275prov=Ir({token:r,factory:r.\u0275fac}),r})(),Wv=(()=>{class r{constructor(){this._applications=new Map,Ng.addToWindow(this)}registerApplication(s,h){this._applications.set(s,h)}unregisterApplication(s){this._applications.delete(s)}unregisterAllApplications(){this._applications.clear()}getTestability(s){return this._applications.get(s)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(s,h=!0){return Ng.findTestabilityInTree(this,s,h)}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=Ir({token:r,factory:r.\u0275fac}),r})();class Ib{addToWindow(o){}findTestabilityInTree(o,s,h){return null}}function Mb(r){Ng=r}let ul,Ng=new Ib;const Xv=new Wr("AllowMultipleToken");class kb{constructor(o,s){this.name=o,this.token=s}}function Yv(r,o,s=[]){const h=`Platform: ${o}`,m=new Wr(h);return(y=[])=>{let w=Kv();if(!w||w.injector.get(Xv,!1))if(r)r(s.concat(y).concat({provide:m,useValue:!0}));else{const I=s.concat(y).concat({provide:m,useValue:!0},{provide:Ra,useValue:"platform"});!function Rb(r){if(ul&&!ul.destroyed&&!ul.injector.get(Xv,!1))throw new Gt(400,"");ul=r.get(Qv);const o=r.get(Uv,null);o&&o.forEach(s=>s())}(Ti.create({providers:I,name:h}))}return function Lb(r){const o=Kv();if(!o)throw new Gt(401,"");return o}()}}function Kv(){return ul&&!ul.destroyed?ul:null}let Qv=(()=>{class r{constructor(s){this._injector=s,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(s,h){const I=function Fb(r,o){let s;return s="noop"===r?new Sb:("zone.js"===r?void 0:r)||new la({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==o?void 0:o.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==o?void 0:o.ngZoneRunCoalescing)}),s}(h?h.ngZone:void 0,{ngZoneEventCoalescing:h&&h.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:h&&h.ngZoneRunCoalescing||!1}),k=[{provide:la,useValue:I}];return I.run(()=>{const G=Ti.create({providers:k,parent:this.injector,name:s.moduleType.name}),q=s.create(G),de=q.injector.get(tc,null);if(!de)throw new Gt(402,"");return I.runOutsideAngular(()=>{const Ce=I.onError.subscribe({next:Oe=>{de.handleError(Oe)}});q.onDestroy(()=>{Ug(this._modules,q),Ce.unsubscribe()})}),function Ob(r,o,s){try{const h=s();return ig(h)?h.catch(m=>{throw o.runOutsideAngular(()=>r.handleError(m)),m}):h}catch(h){throw o.runOutsideAngular(()=>r.handleError(h)),h}}(de,I,()=>{const Ce=q.injector.get(Ih);return Ce.runInitializers(),Ce.donePromise.then(()=>(function dx(r){xr(r,"Expected localeId to be defined"),"string"==typeof r&&(wy=r.toLowerCase().replace(/_/g,"-"))}(q.injector.get(qp,Op)||Op),this._moduleDoBootstrap(q),q))})})}bootstrapModule(s,h=[]){const m=Jv({},h);return function Ab(r,o,s){const h=new vg(s);return Promise.resolve(h)}(0,0,s).then(y=>this.bootstrapModuleFactory(y,m))}_moduleDoBootstrap(s){const h=s.injector.get(Jd);if(s._bootstrapComponents.length>0)s._bootstrapComponents.forEach(m=>h.bootstrap(m));else{if(!s.instance.ngDoBootstrap)throw new Gt(403,"");s.instance.ngDoBootstrap(h)}this._modules.push(s)}onDestroy(s){this._destroyListeners.push(s)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Gt(404,"");this._modules.slice().forEach(s=>s.destroy()),this._destroyListeners.forEach(s=>s()),this._destroyed=!0}get destroyed(){return this._destroyed}}return r.\u0275fac=function(s){return new(s||r)(Dn(Ti))},r.\u0275prov=Ir({token:r,factory:r.\u0275fac}),r})();function Jv(r,o){return Array.isArray(o)?o.reduce(Jv,r):Object.assign(Object.assign({},r),o)}let Jd=(()=>{class r{constructor(s,h,m,y,w){this._zone=s,this._injector=h,this._exceptionHandler=m,this._componentFactoryResolver=y,this._initStatus=w,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const I=new ze.y(G=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{G.next(this._stable),G.complete()})}),k=new ze.y(G=>{let q;this._zone.runOutsideAngular(()=>{q=this._zone.onStable.subscribe(()=>{la.assertNotInAngularZone(),Og(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,G.next(!0))})})});const de=this._zone.onUnstable.subscribe(()=>{la.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{G.next(!1)}))});return()=>{q.unsubscribe(),de.unsubscribe()}});this.isStable=function Jt(...r){const o=(0,c.yG)(r),s=(0,c._6)(r,1/0),h=r;return h.length?1===h.length?(0,Fe.Xf)(h[0]):(0,Y.J)(s)((0,Tt.D)(h,o)):Pt.E}(I,k.pipe(function On(r={}){const{connector:o=(()=>new Ft.x),resetOnError:s=!0,resetOnComplete:h=!0,resetOnRefCountZero:m=!0}=r;return y=>{let w=null,I=null,k=null,G=0,q=!1,de=!1;const Ce=()=>{null==I||I.unsubscribe(),I=null},Oe=()=>{Ce(),w=k=null,q=de=!1},st=()=>{const Mt=w;Oe(),null==Mt||Mt.unsubscribe()};return(0,en.e)((Mt,Ut)=>{G++,!de&&!q&&Ce();const Xt=k=null!=k?k:o();Ut.add(()=>{G--,0===G&&!de&&!q&&(I=bt(st,m))}),Xt.subscribe(Ut),w||(w=new lt.Hp({next:dt=>Xt.next(dt),error:dt=>{de=!0,Ce(),I=bt(Oe,s,dt),Xt.error(dt)},complete:()=>{q=!0,Ce(),I=bt(Oe,h),Xt.complete()}}),(0,Tt.D)(Mt).subscribe(w))})(y)}}()))}bootstrap(s,h){if(!this._initStatus.done)throw new Gt(405,"");let m;m=s instanceof qy?s:this._componentFactoryResolver.resolveComponentFactory(s),this.componentTypes.push(m.componentType);const y=function Pb(r){return r.isBoundToModule}(m)?void 0:this._injector.get(Ch),I=m.create(Ti.NULL,[],h||m.selector,y),k=I.location.nativeElement,G=I.injector.get(qv,null),q=G&&I.injector.get(Wv);return G&&q&&q.registerApplication(k,G),I.onDestroy(()=>{this.detachView(I.hostView),Ug(this.components,I),q&&q.unregisterApplication(k)}),this._loadComponent(I),I}tick(){if(this._runningTick)throw new Gt(101,"");try{this._runningTick=!0;for(let s of this._views)s.detectChanges()}catch(s){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(s))}finally{this._runningTick=!1}}attachView(s){const h=s;this._views.push(h),h.attachToAppRef(this)}detachView(s){const h=s;Ug(this._views,h),h.detachFromAppRef()}_loadComponent(s){this.attachView(s.hostView),this.tick(),this.components.push(s),this._injector.get(jv,[]).concat(this._bootstrapListeners).forEach(m=>m(s))}ngOnDestroy(){this._views.slice().forEach(s=>s.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return r.\u0275fac=function(s){return new(s||r)(Dn(la),Dn(Ti),Dn(tc),Dn(Zd),Dn(Ih))},r.\u0275prov=Ir({token:r,factory:r.\u0275fac}),r})();function Ug(r,o){const s=r.indexOf(o);s>-1&&r.splice(s,1)}let t0=!0;function Bb(){t0=!1}let Nb=(()=>{class r{}return r.__NG_ELEMENT_ID__=Ub,r})();function Ub(r){return function Vb(r,o,s){if(uo(r)&&!s){const h=oi(r.index,o);return new Wd(h,h)}return 47&r.type?new Wd(o[16],o):null}(Zr(),ut(),16==(16&r))}class c0{constructor(){}supports(o){return P(o)}create(o){return new qb(o)}}const Zb=(r,o)=>o;class qb{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||Zb}forEachItem(o){let s;for(s=this._itHead;null!==s;s=s._next)o(s)}forEachOperation(o){let s=this._itHead,h=this._removalsHead,m=0,y=null;for(;s||h;){const w=!h||s&&s.currentIndex<h0(h,m,y)?s:h,I=h0(w,m,y),k=w.currentIndex;if(w===h)m--,h=h._nextRemoved;else if(s=s._next,null==w.previousIndex)m++;else{y||(y=[]);const G=I-m,q=k-m;if(G!=q){for(let Ce=0;Ce<G;Ce++){const Oe=Ce<y.length?y[Ce]:y[Ce]=0,st=Oe+Ce;q<=st&&st<G&&(y[Ce]=Oe+1)}y[w.previousIndex]=q-G}}I!==k&&o(w,I,k)}}forEachPreviousItem(o){let s;for(s=this._previousItHead;null!==s;s=s._nextPrevious)o(s)}forEachAddedItem(o){let s;for(s=this._additionsHead;null!==s;s=s._nextAdded)o(s)}forEachMovedItem(o){let s;for(s=this._movesHead;null!==s;s=s._nextMoved)o(s)}forEachRemovedItem(o){let s;for(s=this._removalsHead;null!==s;s=s._nextRemoved)o(s)}forEachIdentityChange(o){let s;for(s=this._identityChangesHead;null!==s;s=s._nextIdentityChange)o(s)}diff(o){if(null==o&&(o=[]),!P(o))throw new Gt(900,"");return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let m,y,w,s=this._itHead,h=!1;if(Array.isArray(o)){this.length=o.length;for(let I=0;I<this.length;I++)y=o[I],w=this._trackByFn(I,y),null!==s&&Object.is(s.trackById,w)?(h&&(s=this._verifyReinsertion(s,y,w,I)),Object.is(s.item,y)||this._addIdentityChange(s,y)):(s=this._mismatch(s,y,w,I),h=!0),s=s._next}else m=0,function $(r,o){if(Array.isArray(r))for(let s=0;s<r.length;s++)o(r[s]);else{const s=r[D()]();let h;for(;!(h=s.next()).done;)o(h.value)}}(o,I=>{w=this._trackByFn(m,I),null!==s&&Object.is(s.trackById,w)?(h&&(s=this._verifyReinsertion(s,I,w,m)),Object.is(s.item,I)||this._addIdentityChange(s,I)):(s=this._mismatch(s,I,w,m),h=!0),s=s._next,m++}),this.length=m;return this._truncate(s),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,s,h,m){let y;return null===o?y=this._itTail:(y=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(h,null))?(Object.is(o.item,s)||this._addIdentityChange(o,s),this._reinsertAfter(o,y,m)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(h,m))?(Object.is(o.item,s)||this._addIdentityChange(o,s),this._moveAfter(o,y,m)):o=this._addAfter(new Wb(s,h),y,m),o}_verifyReinsertion(o,s,h,m){let y=null===this._unlinkedRecords?null:this._unlinkedRecords.get(h,null);return null!==y?o=this._reinsertAfter(y,o._prev,m):o.currentIndex!=m&&(o.currentIndex=m,this._addToMoves(o,m)),o}_truncate(o){for(;null!==o;){const s=o._next;this._addToRemovals(this._unlink(o)),o=s}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,s,h){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const m=o._prevRemoved,y=o._nextRemoved;return null===m?this._removalsHead=y:m._nextRemoved=y,null===y?this._removalsTail=m:y._prevRemoved=m,this._insertAfter(o,s,h),this._addToMoves(o,h),o}_moveAfter(o,s,h){return this._unlink(o),this._insertAfter(o,s,h),this._addToMoves(o,h),o}_addAfter(o,s,h){return this._insertAfter(o,s,h),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,s,h){const m=null===s?this._itHead:s._next;return o._next=m,o._prev=s,null===m?this._itTail=o:m._prev=o,null===s?this._itHead=o:s._next=o,null===this._linkedRecords&&(this._linkedRecords=new u0),this._linkedRecords.put(o),o.currentIndex=h,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const s=o._prev,h=o._next;return null===s?this._itHead=h:s._next=h,null===h?this._itTail=s:h._prev=s,o}_addToMoves(o,s){return o.previousIndex===s||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new u0),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,s){return o.item=s,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class Wb{constructor(o,s){this.item=o,this.trackById=s,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Xb{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,s){let h;for(h=this._head;null!==h;h=h._nextDup)if((null===s||s<=h.currentIndex)&&Object.is(h.trackById,o))return h;return null}remove(o){const s=o._prevDup,h=o._nextDup;return null===s?this._head=h:s._nextDup=h,null===h?this._tail=s:h._prevDup=s,null===this._head}}class u0{constructor(){this.map=new Map}put(o){const s=o.trackById;let h=this.map.get(s);h||(h=new Xb,this.map.set(s,h)),h.add(o)}get(o,s){const m=this.map.get(o);return m?m.get(o,s):null}remove(o){const s=o.trackById;return this.map.get(s).remove(o)&&this.map.delete(s),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function h0(r,o,s){const h=r.previousIndex;if(null===h)return h;let m=0;return s&&h<s.length&&(m=s[h]),h+o+m}class d0{constructor(){}supports(o){return o instanceof Map||H(o)}create(){return new Yb}}class Yb{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let s;for(s=this._mapHead;null!==s;s=s._next)o(s)}forEachPreviousItem(o){let s;for(s=this._previousMapHead;null!==s;s=s._nextPrevious)o(s)}forEachChangedItem(o){let s;for(s=this._changesHead;null!==s;s=s._nextChanged)o(s)}forEachAddedItem(o){let s;for(s=this._additionsHead;null!==s;s=s._nextAdded)o(s)}forEachRemovedItem(o){let s;for(s=this._removalsHead;null!==s;s=s._nextRemoved)o(s)}diff(o){if(o){if(!(o instanceof Map||H(o)))throw new Gt(900,"")}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let s=this._mapHead;if(this._appendAfter=null,this._forEach(o,(h,m)=>{if(s&&s.key===m)this._maybeAddToChanges(s,h),this._appendAfter=s,s=s._next;else{const y=this._getOrCreateRecordForKey(m,h);s=this._insertBeforeOrAppend(s,y)}}),s){s._prev&&(s._prev._next=null),this._removalsHead=s;for(let h=s;null!==h;h=h._nextRemoved)h===this._mapHead&&(this._mapHead=null),this._records.delete(h.key),h._nextRemoved=h._next,h.previousValue=h.currentValue,h.currentValue=null,h._prev=null,h._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,s){if(o){const h=o._prev;return s._next=o,s._prev=h,o._prev=s,h&&(h._next=s),o===this._mapHead&&(this._mapHead=s),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=s,s._prev=this._appendAfter):this._mapHead=s,this._appendAfter=s,null}_getOrCreateRecordForKey(o,s){if(this._records.has(o)){const m=this._records.get(o);this._maybeAddToChanges(m,s);const y=m._prev,w=m._next;return y&&(y._next=w),w&&(w._prev=y),m._next=null,m._prev=null,m}const h=new Kb(o);return this._records.set(o,h),h.currentValue=s,this._addToAdditions(h),h}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,s){Object.is(s,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=s,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,s){o instanceof Map?o.forEach(s):Object.keys(o).forEach(h=>s(o[h],h))}}class Kb{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function f0(){return new Xp([new c0])}let Xp=(()=>{class r{constructor(s){this.factories=s}static create(s,h){if(null!=h){const m=h.factories.slice();s=s.concat(m)}return new r(s)}static extend(s){return{provide:r,useFactory:h=>r.create(s,h||f0()),deps:[[r,new hr,new Cr]]}}find(s){const h=this.factories.find(m=>m.supports(s));if(null!=h)return h;throw new Gt(901,"")}}return r.\u0275prov=Ir({token:r,providedIn:"root",factory:f0}),r})();function p0(){return new Yp([new d0])}let Yp=(()=>{class r{constructor(s){this.factories=s}static create(s,h){if(h){const m=h.factories.slice();s=s.concat(m)}return new r(s)}static extend(s){return{provide:r,useFactory:h=>r.create(s,h||p0()),deps:[[r,new hr,new Cr]]}}find(s){const h=this.factories.find(y=>y.supports(s));if(h)return h;throw new Gt(901,"")}}return r.\u0275prov=Ir({token:r,providedIn:"root",factory:p0}),r})();const Qb=[new d0],ew=new Xp([new c0]),tw=new Yp(Qb),nw=Yv(null,"core",[{provide:Vv,useValue:"unknown"},{provide:Qv,deps:[Ti]},{provide:Wv,deps:[]},{provide:$v,deps:[]}]),aw=[{provide:Jd,useClass:Jd,deps:[la,Ti,tc,Zd,Ih]},{provide:x1,deps:[la],useFactory:function lw(r){let o=[];return r.onStable.subscribe(()=>{for(;o.length;)o.pop()()}),function(s){o.push(s)}}},{provide:Ih,useClass:Ih,deps:[[new Cr,Rg]]},{provide:Fg,useClass:Fg,deps:[]},vb,{provide:Xp,useFactory:function rw(){return ew},deps:[]},{provide:Yp,useFactory:function iw(){return tw},deps:[]},{provide:qp,useFactory:function ow(r){return r||function sw(){return"undefined"!=typeof $localize&&$localize.locale||Op}()},deps:[[new ur(qp),new Cr,new hr]]},{provide:Gv,useValue:"USD"}];let cw=(()=>{class r{constructor(s){}}return r.\u0275fac=function(s){return new(s||r)(Dn(Jd))},r.\u0275mod=it({type:r}),r.\u0275inj=Vr({providers:aw}),r})()},895:(Hn,Vt,Re)=>{"use strict";Re.d(Vt,{rH:()=>us,Od:()=>qa,Bz:()=>El,lC:()=>De});var Y=Re(223),Fe=Re(669),Pt=Re(76);function c(...M){const T=(0,Fe.yG)(M);return(0,Pt.D)(M,T)}var Tt=Re(579);class Jt extends Tt.x{constructor(T){super(),this._value=T}get value(){return this.getValue()}_subscribe(T){const C=super._subscribe(T);return!C.closed&&T.next(this._value),C}getValue(){const{hasError:T,thrownError:C,_value:L}=this;if(T)throw C;return this._throwIfClosed(),L}next(T){super.next(this._value=T)}}var Ft=Re(306);const{isArray:Ve}=Array,{getPrototypeOf:ze,prototype:qe,keys:lt}=Object;var bt=Re(671),Ct=Re(4);const{isArray:sn}=Array;var At=Re(403),ft=Re(672);function cn(...M){const T=(0,Fe.yG)(M),C=(0,Fe.jO)(M),{args:L,keys:U}=function en(M){if(1===M.length){const T=M[0];if(Ve(T))return{args:T,keys:null};if(function On(M){return M&&"object"==typeof M&&ze(M)===qe}(T)){const C=lt(T);return{args:C.map(L=>T[L]),keys:C}}}return{args:M,keys:null}}(M);if(0===L.length)return(0,Pt.D)([],T);const X=new Ft.y(function Pn(M,T,C=bt.y){return L=>{Gt(T,()=>{const{length:U}=M,X=new Array(U);let ge=U,be=U;for(let Ue=0;Ue<U;Ue++)Gt(T,()=>{const Lt=(0,Pt.D)(M[Ue],T);let Mn=!1;Lt.subscribe(new At.Q(L,Qt=>{X[Ue]=Qt,Mn||(Mn=!0,be--),be||L.next(C(X.slice()))},()=>{--ge||L.complete()}))},L)},L)}}(L,T,U?ge=>function Yt(M,T){return M.reduce((C,L,U)=>(C[L]=T[U],C),{})}(U,ge):bt.y));return C?X.pipe(function ln(M){return(0,Ct.U)(T=>function Ot(M,T){return sn(T)?M(...T):M(T)}(M,T))}(C)):X}function Gt(M,T,C){M?(0,ft.f)(C,M,T):T()}const gt=(0,Re(888).d)(M=>function(){M(this),this.name="EmptyError",this.message="no elements in sequence"});var Be=Re(189);function Je(...M){return function He(){return(0,Be.J)(1)}()((0,Pt.D)(M,(0,Fe.yG)(M)))}var Ke=Re(421);function _t(M){return new Ft.y(T=>{(0,Ke.Xf)(M()).subscribe(T)})}var $e=Re(727),tn=Re(482);function wn(){return(0,tn.e)((M,T)=>{let C=null;M._refCount++;const L=new At.Q(T,void 0,void 0,void 0,()=>{if(!M||M._refCount<=0||0<--M._refCount)return void(C=null);const U=M._connection,X=C;C=null,U&&(!X||U===X)&&U.unsubscribe(),T.unsubscribe()});M.subscribe(L),L.closed||(C=M.connect())})}class ri extends Ft.y{constructor(T,C){super(),this.source=T,this.subjectFactory=C,this._subject=null,this._refCount=0,this._connection=null,(0,tn.A)(T)&&(this.lift=T.lift)}_subscribe(T){return this.getSubject().subscribe(T)}getSubject(){const T=this._subject;return(!T||T.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:T}=this;this._subject=this._connection=null,null==T||T.unsubscribe()}connect(){let T=this._connection;if(!T){T=this._connection=new $e.w0;const C=this.getSubject();T.add(this.source.subscribe(new At.Q(C,void 0,()=>{this._teardown(),C.complete()},L=>{this._teardown(),C.error(L)},()=>this._teardown()))),T.closed&&(this._connection=null,T=$e.w0.EMPTY)}return T}refCount(){return wn()(this)}}var zt=Re(515);function Zn(M,T){return(0,tn.e)((C,L)=>{let U=null,X=0,ge=!1;const be=()=>ge&&!U&&L.complete();C.subscribe(new At.Q(L,Ue=>{null==U||U.unsubscribe();let Lt=0;const Mn=X++;(0,Ke.Xf)(M(Ue,Mn)).subscribe(U=new At.Q(L,Qt=>L.next(T?T(Ue,Qt,Mn,Lt++):Qt),()=>{U=null,be()}))},()=>{ge=!0,be()}))})}function sr(M,T,C,L,U){return(X,ge)=>{let be=C,Ue=T,Lt=0;X.subscribe(new At.Q(ge,Mn=>{const Qt=Lt++;Ue=be?M(Ue,Mn,Qt):(be=!0,Mn),L&&ge.next(Ue)},U&&(()=>{be&&ge.next(Ue),ge.complete()})))}}function vi(M,T){return(0,tn.e)(sr(M,T,arguments.length>=2,!0))}function Fr(M,T){return(0,tn.e)((C,L)=>{let U=0;C.subscribe(new At.Q(L,X=>M.call(T,X,U++)&&L.next(X)))})}function pn(M){return(0,tn.e)((T,C)=>{let X,L=null,U=!1;L=T.subscribe(new At.Q(C,void 0,void 0,ge=>{X=(0,Ke.Xf)(M(ge,pn(M)(T))),L?(L.unsubscribe(),L=null,X.subscribe(C)):U=!0})),U&&(L.unsubscribe(),L=null,X.subscribe(C))})}var mr=Re(577),Ur=Re(576);function xr(M,T){return(0,Ur.m)(T)?(0,mr.z)(M,T,1):(0,mr.z)(M,1)}function $n(M){return M<=0?()=>zt.E:(0,tn.e)((T,C)=>{let L=[];T.subscribe(new At.Q(C,U=>{L.push(U),M<L.length&&L.shift()},()=>{for(const U of L)C.next(U);C.complete()},void 0,()=>{L=null}))})}function Mi(M=xs){return(0,tn.e)((T,C)=>{let L=!1;T.subscribe(new At.Q(C,U=>{L=!0,C.next(U)},()=>L?C.complete():C.error(M())))})}function xs(){return new gt}function Fn(M){return(0,tn.e)((T,C)=>{let L=!1;T.subscribe(new At.Q(C,U=>{L=!0,C.next(U)},()=>{L||C.next(M),C.complete()}))})}var Wi=Re(698);function Vr(M,T){const C=arguments.length>=2;return L=>L.pipe(M?Fr((U,X)=>M(U,X,L)):bt.y,(0,Wi.q)(1),C?Fn(T):Mi(()=>new gt))}function Or(M,T,C){const L=(0,Ur.m)(M)||T||C?{next:M,error:T,complete:C}:M;return L?(0,tn.e)((U,X)=>{var ge;null===(ge=L.subscribe)||void 0===ge||ge.call(L);let be=!0;U.subscribe(new At.Q(X,Ue=>{var Lt;null===(Lt=L.next)||void 0===Lt||Lt.call(L,Ue),X.next(Ue)},()=>{var Ue;be=!1,null===(Ue=L.complete)||void 0===Ue||Ue.call(L),X.complete()},Ue=>{var Lt;be=!1,null===(Lt=L.error)||void 0===Lt||Lt.call(L,Ue),X.error(Ue)},()=>{var Ue,Lt;be&&(null===(Ue=L.unsubscribe)||void 0===Ue||Ue.call(L)),null===(Lt=L.finalize)||void 0===Lt||Lt.call(L)}))}):bt.y}var lr=Re(808);class Kr{constructor(T,C){this.id=T,this.url=C}}class co extends Kr{constructor(T,C,L="imperative",U=null){super(T,C),this.navigationTrigger=L,this.restoredState=U}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class zr extends Kr{constructor(T,C,L){super(T,C),this.urlAfterRedirects=L}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Xi extends Kr{constructor(T,C,L){super(T,C),this.reason=L}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class bs extends Kr{constructor(T,C,L){super(T,C),this.error=L}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class jr extends Kr{constructor(T,C,L,U){super(T,C),this.urlAfterRedirects=L,this.state=U}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class qt extends Kr{constructor(T,C,L,U){super(T,C),this.urlAfterRedirects=L,this.state=U}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class gr extends Kr{constructor(T,C,L,U,X){super(T,C),this.urlAfterRedirects=L,this.state=U,this.shouldActivate=X}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class rn extends Kr{constructor(T,C,L,U){super(T,C),this.urlAfterRedirects=L,this.state=U}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class on extends Kr{constructor(T,C,L,U){super(T,C),this.urlAfterRedirects=L,this.state=U}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class wo{constructor(T){this.route=T}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Eo{constructor(T){this.route=T}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class $r{constructor(T){this.snapshot=T}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Qr{constructor(T){this.snapshot=T}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class xi{constructor(T){this.snapshot=T}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class jo{constructor(T){this.snapshot=T}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Un{constructor(T,C,L){this.routerEvent=T,this.position=C,this.anchor=L}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const dn="primary";class qn{constructor(T){this.params=T||{}}has(T){return Object.prototype.hasOwnProperty.call(this.params,T)}get(T){if(this.has(T)){const C=this.params[T];return Array.isArray(C)?C[0]:C}return null}getAll(T){if(this.has(T)){const C=this.params[T];return Array.isArray(C)?C:[C]}return[]}get keys(){return Object.keys(this.params)}}function Do(M){return new qn(M)}const Yi="ngNavigationCancelingError";function Wn(M){const T=Error("NavigationCancelingError: "+M);return T[Yi]=!0,T}function Vs(M,T,C){const L=C.path.split("/");if(L.length>M.length||"full"===C.pathMatch&&(T.hasChildren()||L.length<M.length))return null;const U={};for(let X=0;X<L.length;X++){const ge=L[X],be=M[X];if(ge.startsWith(":"))U[ge.substring(1)]=be;else if(ge!==be.path)return null}return{consumed:M.slice(0,L.length),posParams:U}}function En(M,T){const C=M?Object.keys(M):void 0,L=T?Object.keys(T):void 0;if(!C||!L||C.length!=L.length)return!1;let U;for(let X=0;X<C.length;X++)if(U=C[X],!ae(M[U],T[U]))return!1;return!0}function ae(M,T){if(Array.isArray(M)&&Array.isArray(T)){if(M.length!==T.length)return!1;const C=[...M].sort(),L=[...T].sort();return C.every((U,X)=>L[X]===U)}return M===T}function V(M){return Array.prototype.concat.apply([],M)}function Z(M){return M.length>0?M[M.length-1]:null}function he(M,T){for(const C in M)M.hasOwnProperty(C)&&T(M[C],C)}function xe(M){return(0,Y.CqO)(M)?M:(0,Y.QGY)(M)?(0,Pt.D)(Promise.resolve(M)):c(M)}const Me={exact:function wt(M,T,C){if(!yt(M.segments,T.segments)||!W(M.segments,T.segments,C)||M.numberOfChildren!==T.numberOfChildren)return!1;for(const L in T.children)if(!M.children[L]||!wt(M.children[L],T.children[L],C))return!1;return!0},subset:Ht},we={exact:function rt(M,T){return En(M,T)},subset:function it(M,T){return Object.keys(T).length<=Object.keys(M).length&&Object.keys(T).every(C=>ae(M[C],T[C]))},ignored:()=>!0};function Le(M,T,C){return Me[C.paths](M.root,T.root,C.matrixParams)&&we[C.queryParams](M.queryParams,T.queryParams)&&!("exact"===C.fragment&&M.fragment!==T.fragment)}function Ht(M,T,C){return vt(M,T,T.segments,C)}function vt(M,T,C,L){if(M.segments.length>C.length){const U=M.segments.slice(0,C.length);return!(!yt(U,C)||T.hasChildren()||!W(U,C,L))}if(M.segments.length===C.length){if(!yt(M.segments,C)||!W(M.segments,C,L))return!1;for(const U in T.children)if(!M.children[U]||!Ht(M.children[U],T.children[U],L))return!1;return!0}{const U=C.slice(0,M.segments.length),X=C.slice(M.segments.length);return!!(yt(M.segments,U)&&W(M.segments,U,L)&&M.children[dn])&&vt(M.children[dn],T,X,L)}}function W(M,T,C){return T.every((L,U)=>we[C](M[U].parameters,L.parameters))}class J{constructor(T,C,L){this.root=T,this.queryParams=C,this.fragment=L}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Do(this.queryParams)),this._queryParamMap}toString(){return Dt.serialize(this)}}class ne{constructor(T,C){this.segments=T,this.children=C,this.parent=null,he(C,(L,U)=>L.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return fn(this)}}class Ae{constructor(T,C){this.path=T,this.parameters=C}get parameterMap(){return this._parameterMap||(this._parameterMap=Do(this.parameters)),this._parameterMap}toString(){return Nr(this)}}function yt(M,T){return M.length===T.length&&M.every((C,L)=>C.path===T[L].path)}class _r{}class cr{parse(T){const C=new $o(T);return new J(C.parseRootSegment(),C.parseQueryParams(),C.parseFragment())}serialize(T){const C=`/${Wt(T.root,!0)}`,L=function Lo(M){const T=Object.keys(M).map(C=>{const L=M[C];return Array.isArray(L)?L.map(U=>`${Pr(C)}=${Pr(U)}`).join("&"):`${Pr(C)}=${Pr(L)}`}).filter(C=>!!C);return T.length?`?${T.join("&")}`:""}(T.queryParams);return`${C}${L}${"string"==typeof T.fragment?`#${function at(M){return encodeURI(M)}(T.fragment)}`:""}`}}const Dt=new cr;function fn(M){return M.segments.map(T=>Nr(T)).join("/")}function Wt(M,T){if(!M.hasChildren())return fn(M);if(T){const C=M.children[dn]?Wt(M.children[dn],!1):"",L=[];return he(M.children,(U,X)=>{X!==dn&&L.push(`${X}:${Wt(U,!1)}`)}),L.length>0?`${C}(${L.join("//")})`:C}{const C=function $t(M,T){let C=[];return he(M.children,(L,U)=>{U===dn&&(C=C.concat(T(L,U)))}),he(M.children,(L,U)=>{U!==dn&&(C=C.concat(T(L,U)))}),C}(M,(L,U)=>U===dn?[Wt(M.children[dn],!1)]:[`${U}:${Wt(L,!1)}`]);return 1===Object.keys(M.children).length&&null!=M.children[dn]?`${fn(M)}/${C[0]}`:`${fn(M)}/(${C.join("//")})`}}function br(M){return encodeURIComponent(M).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Pr(M){return br(M).replace(/%3B/gi,";")}function kn(M){return br(M).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Kn(M){return decodeURIComponent(M)}function Gr(M){return Kn(M.replace(/\+/g,"%20"))}function Nr(M){return`${kn(M.path)}${function Rn(M){return Object.keys(M).map(T=>`;${kn(T)}=${kn(M[T])}`).join("")}(M.parameters)}`}const rr=/^[^\/()?;=#]+/;function Fo(M){const T=M.match(rr);return T?T[0]:""}const ui=/^[^=?&#]+/,bi=/^[^&#]+/;class $o{constructor(T){this.url=T,this.remaining=T}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new ne([],{}):new ne([],this.parseChildren())}parseQueryParams(){const T={};if(this.consumeOptional("?"))do{this.parseQueryParam(T)}while(this.consumeOptional("&"));return T}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const T=[];for(this.peekStartsWith("(")||T.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),T.push(this.parseSegment());let C={};this.peekStartsWith("/(")&&(this.capture("/"),C=this.parseParens(!0));let L={};return this.peekStartsWith("(")&&(L=this.parseParens(!1)),(T.length>0||Object.keys(C).length>0)&&(L[dn]=new ne(T,C)),L}parseSegment(){const T=Fo(this.remaining);if(""===T&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(T),new Ae(Kn(T),this.parseMatrixParams())}parseMatrixParams(){const T={};for(;this.consumeOptional(";");)this.parseParam(T);return T}parseParam(T){const C=Fo(this.remaining);if(!C)return;this.capture(C);let L="";if(this.consumeOptional("=")){const U=Fo(this.remaining);U&&(L=U,this.capture(L))}T[Kn(C)]=Kn(L)}parseQueryParam(T){const C=function Cn(M){const T=M.match(ui);return T?T[0]:""}(this.remaining);if(!C)return;this.capture(C);let L="";if(this.consumeOptional("=")){const ge=function Ln(M){const T=M.match(bi);return T?T[0]:""}(this.remaining);ge&&(L=ge,this.capture(L))}const U=Gr(C),X=Gr(L);if(T.hasOwnProperty(U)){let ge=T[U];Array.isArray(ge)||(ge=[ge],T[U]=ge),ge.push(X)}else T[U]=X}parseParens(T){const C={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const L=Fo(this.remaining),U=this.remaining[L.length];if("/"!==U&&")"!==U&&";"!==U)throw new Error(`Cannot parse url '${this.url}'`);let X;L.indexOf(":")>-1?(X=L.substr(0,L.indexOf(":")),this.capture(X),this.capture(":")):T&&(X=dn);const ge=this.parseChildren();C[X]=1===Object.keys(ge).length?ge[dn]:new ne([],ge),this.consumeOptional("//")}return C}peekStartsWith(T){return this.remaining.startsWith(T)}consumeOptional(T){return!!this.peekStartsWith(T)&&(this.remaining=this.remaining.substring(T.length),!0)}capture(T){if(!this.consumeOptional(T))throw new Error(`Expected "${T}".`)}}class Vi{constructor(T){this._root=T}get root(){return this._root.value}parent(T){const C=this.pathFromRoot(T);return C.length>1?C[C.length-2]:null}children(T){const C=Jn(T,this._root);return C?C.children.map(L=>L.value):[]}firstChild(T){const C=Jn(T,this._root);return C&&C.children.length>0?C.children[0].value:null}siblings(T){const C=ii(T,this._root);return C.length<2?[]:C[C.length-2].children.map(U=>U.value).filter(U=>U!==T)}pathFromRoot(T){return ii(T,this._root).map(C=>C.value)}}function Jn(M,T){if(M===T.value)return T;for(const C of T.children){const L=Jn(M,C);if(L)return L}return null}function ii(M,T){if(M===T.value)return[T];for(const C of T.children){const L=ii(M,C);if(L.length)return L.unshift(T),L}return[]}class hi{constructor(T,C){this.value=T,this.children=C}toString(){return`TreeNode(${this.value})`}}function Hr(M){const T={};return M&&M.children.forEach(C=>T[C.value.outlet]=C),T}class _n extends Vi{constructor(T,C){super(T),this.snapshot=C,$i(this,T)}toString(){return this.snapshot.toString()}}function Go(M,T){const C=function ws(M,T){const ge=new uo([],{},{},"",{},dn,T,null,M.root,-1,{});return new Ho("",new hi(ge,[]))}(M,T),L=new Jt([new Ae("",{})]),U=new Jt({}),X=new Jt({}),ge=new Jt({}),be=new Jt(""),Ue=new Tn(L,U,ge,be,X,dn,T,C.root);return Ue.snapshot=C.root,new _n(new hi(Ue,[]),C)}class Tn{constructor(T,C,L,U,X,ge,be,Ue){this.url=T,this.params=C,this.queryParams=L,this.fragment=U,this.data=X,this.outlet=ge,this.component=be,this._futureSnapshot=Ue}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,Ct.U)(T=>Do(T)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,Ct.U)(T=>Do(T)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Pi(M,T="emptyOnly"){const C=M.pathFromRoot;let L=0;if("always"!==T)for(L=C.length-1;L>=1;){const U=C[L],X=C[L-1];if(U.routeConfig&&""===U.routeConfig.path)L--;else{if(X.component)break;L--}}return function ji(M){return M.reduce((T,C)=>({params:Object.assign(Object.assign({},T.params),C.params),data:Object.assign(Object.assign({},T.data),C.data),resolve:Object.assign(Object.assign({},T.resolve),C._resolvedData)}),{params:{},data:{},resolve:{}})}(C.slice(L))}class uo{constructor(T,C,L,U,X,ge,be,Ue,Lt,Mn,Qt){this.url=T,this.params=C,this.queryParams=L,this.fragment=U,this.data=X,this.outlet=ge,this.component=be,this.routeConfig=Ue,this._urlSegment=Lt,this._lastPathIndex=Mn,this._resolve=Qt}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Do(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Do(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(L=>L.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Ho extends Vi{constructor(T,C){super(C),this.url=T,$i(this,C)}toString(){return Oo(this._root)}}function $i(M,T){T.value._routerState=M,T.children.forEach(C=>$i(M,C))}function Oo(M){const T=M.children.length>0?` { ${M.children.map(Oo).join(", ")} } `:"";return`${M.value}${T}`}function hl(M){if(M.snapshot){const T=M.snapshot,C=M._futureSnapshot;M.snapshot=C,En(T.queryParams,C.queryParams)||M.queryParams.next(C.queryParams),T.fragment!==C.fragment&&M.fragment.next(C.fragment),En(T.params,C.params)||M.params.next(C.params),function Ai(M,T){if(M.length!==T.length)return!1;for(let C=0;C<M.length;++C)if(!En(M[C],T[C]))return!1;return!0}(T.url,C.url)||M.url.next(C.url),En(T.data,C.data)||M.data.next(C.data)}else M.snapshot=M._futureSnapshot,M.data.next(M._futureSnapshot.data)}function js(M,T){const C=En(M.params,T.params)&&function je(M,T){return yt(M,T)&&M.every((C,L)=>En(C.parameters,T[L].parameters))}(M.url,T.url);return C&&!(!M.parent!=!T.parent)&&(!M.parent||js(M.parent,T.parent))}function ns(M,T,C){if(C&&M.shouldReuseRoute(T.value,C.value.snapshot)){const L=C.value;L._futureSnapshot=T.value;const U=function rs(M,T,C){return T.children.map(L=>{for(const U of C.children)if(M.shouldReuseRoute(L.value,U.value.snapshot))return ns(M,L,U);return ns(M,L)})}(M,T,C);return new hi(L,U)}{if(M.shouldAttach(T.value)){const X=M.retrieve(T.value);if(null!==X){const ge=X.route;return ge.value._futureSnapshot=T.value,ge.children=T.children.map(be=>ns(M,be)),ge}}const L=function dl(M){return new Tn(new Jt(M.url),new Jt(M.params),new Jt(M.queryParams),new Jt(M.fragment),new Jt(M.data),M.outlet,M.component,M)}(T.value),U=T.children.map(X=>ns(M,X));return new hi(L,U)}}function za(M){return"object"==typeof M&&null!=M&&!M.outlets&&!M.segmentPath}function ua(M){return"object"==typeof M&&null!=M&&M.outlets}function $s(M,T,C,L,U){let X={};return L&&he(L,(ge,be)=>{X[be]=Array.isArray(ge)?ge.map(Ue=>`${Ue}`):`${ge}`}),new J(C.root===M?T:ha(C.root,M,T),X,U)}function ha(M,T,C){const L={};return he(M.children,(U,X)=>{L[X]=U===T?C:ha(U,T,C)}),new ne(M.segments,L)}class Ba{constructor(T,C,L){if(this.isAbsolute=T,this.numberOfDoubleDots=C,this.commands=L,T&&L.length>0&&za(L[0]))throw new Error("Root segment cannot have matrix parameters");const U=L.find(ua);if(U&&U!==Z(L))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Na{constructor(T,C,L){this.segmentGroup=T,this.processChildren=C,this.index=L}}function Gs(M,T,C){if(M||(M=new ne([],{})),0===M.segments.length&&M.hasChildren())return zo(M,T,C);const L=function Hs(M,T,C){let L=0,U=T;const X={match:!1,pathIndex:0,commandIndex:0};for(;U<M.segments.length;){if(L>=C.length)return X;const ge=M.segments[U],be=C[L];if(ua(be))break;const Ue=`${be}`,Lt=L<C.length-1?C[L+1]:null;if(U>0&&void 0===Ue)break;if(Ue&&Lt&&"object"==typeof Lt&&void 0===Lt.outlets){if(!zn(Ue,Lt,ge))return X;L+=2}else{if(!zn(Ue,{},ge))return X;L++}U++}return{match:!0,pathIndex:U,commandIndex:L}}(M,T,C),U=C.slice(L.commandIndex);if(L.match&&L.pathIndex<M.segments.length){const X=new ne(M.segments.slice(0,L.pathIndex),{});return X.children[dn]=new ne(M.segments.slice(L.pathIndex),M.children),zo(X,0,U)}return L.match&&0===U.length?new ne(M.segments,{}):L.match&&!M.hasChildren()?Co(M,T,C):L.match?zo(M,0,U):Co(M,T,C)}function zo(M,T,C){if(0===C.length)return new ne(M.segments,{});{const L=function da(M){return ua(M[0])?M[0].outlets:{[dn]:M}}(C),U={};return he(L,(X,ge)=>{"string"==typeof X&&(X=[X]),null!==X&&(U[ge]=Gs(M.children[ge],T,X))}),he(M.children,(X,ge)=>{void 0===L[ge]&&(U[ge]=X)}),new ne(M.segments,U)}}function Co(M,T,C){const L=M.segments.slice(0,T);let U=0;for(;U<C.length;){const X=C[U];if(ua(X)){const Ue=Zs(X.outlets);return new ne(L,Ue)}if(0===U&&za(C[0])){L.push(new Ae(M.segments[T].path,ho(C[0]))),U++;continue}const ge=ua(X)?X.outlets[dn]:`${X}`,be=U<C.length-1?C[U+1]:null;ge&&be&&za(be)?(L.push(new Ae(ge,ho(be))),U+=2):(L.push(new Ae(ge,{})),U++)}return new ne(L,{})}function Zs(M){const T={};return he(M,(C,L)=>{"string"==typeof C&&(C=[C]),null!==C&&(T[L]=Co(new ne([],{}),0,C))}),T}function ho(M){const T={};return he(M,(C,L)=>T[L]=`${C}`),T}function zn(M,T,C){return M==C.path&&En(T,C.parameters)}class fa{constructor(T,C,L,U){this.routeReuseStrategy=T,this.futureState=C,this.currState=L,this.forwardEvent=U}activate(T){const C=this.futureState._root,L=this.currState?this.currState._root:null;this.deactivateChildRoutes(C,L,T),hl(this.futureState.root),this.activateChildRoutes(C,L,T)}deactivateChildRoutes(T,C,L){const U=Hr(C);T.children.forEach(X=>{const ge=X.value.outlet;this.deactivateRoutes(X,U[ge],L),delete U[ge]}),he(U,(X,ge)=>{this.deactivateRouteAndItsChildren(X,L)})}deactivateRoutes(T,C,L){const U=T.value,X=C?C.value:null;if(U===X)if(U.component){const ge=L.getContext(U.outlet);ge&&this.deactivateChildRoutes(T,C,ge.children)}else this.deactivateChildRoutes(T,C,L);else X&&this.deactivateRouteAndItsChildren(C,L)}deactivateRouteAndItsChildren(T,C){T.value.component&&this.routeReuseStrategy.shouldDetach(T.value.snapshot)?this.detachAndStoreRouteSubtree(T,C):this.deactivateRouteAndOutlet(T,C)}detachAndStoreRouteSubtree(T,C){const L=C.getContext(T.value.outlet),U=L&&T.value.component?L.children:C,X=Hr(T);for(const ge of Object.keys(X))this.deactivateRouteAndItsChildren(X[ge],U);if(L&&L.outlet){const ge=L.outlet.detach(),be=L.children.onOutletDeactivated();this.routeReuseStrategy.store(T.value.snapshot,{componentRef:ge,route:T,contexts:be})}}deactivateRouteAndOutlet(T,C){const L=C.getContext(T.value.outlet),U=L&&T.value.component?L.children:C,X=Hr(T);for(const ge of Object.keys(X))this.deactivateRouteAndItsChildren(X[ge],U);L&&L.outlet&&(L.outlet.deactivate(),L.children.onOutletDeactivated(),L.attachRef=null,L.resolver=null,L.route=null)}activateChildRoutes(T,C,L){const U=Hr(C);T.children.forEach(X=>{this.activateRoutes(X,U[X.value.outlet],L),this.forwardEvent(new jo(X.value.snapshot))}),T.children.length&&this.forwardEvent(new Qr(T.value.snapshot))}activateRoutes(T,C,L){const U=T.value,X=C?C.value:null;if(hl(U),U===X)if(U.component){const ge=L.getOrCreateContext(U.outlet);this.activateChildRoutes(T,C,ge.children)}else this.activateChildRoutes(T,C,L);else if(U.component){const ge=L.getOrCreateContext(U.outlet);if(this.routeReuseStrategy.shouldAttach(U.snapshot)){const be=this.routeReuseStrategy.retrieve(U.snapshot);this.routeReuseStrategy.store(U.snapshot,null),ge.children.onOutletReAttached(be.contexts),ge.attachRef=be.componentRef,ge.route=be.route.value,ge.outlet&&ge.outlet.attach(be.componentRef,be.route.value),hl(be.route.value),this.activateChildRoutes(T,null,ge.children)}else{const be=function fl(M){for(let T=M.parent;T;T=T.parent){const C=T.routeConfig;if(C&&C._loadedConfig)return C._loadedConfig;if(C&&C.component)return null}return null}(U.snapshot),Ue=be?be.module.componentFactoryResolver:null;ge.attachRef=null,ge.route=U,ge.resolver=Ue,ge.outlet&&ge.outlet.activateWith(U,Ue),this.activateChildRoutes(T,null,ge.children)}}else this.activateChildRoutes(T,null,L)}}class Es{constructor(T,C){this.routes=T,this.module=C}}function Ki(M){return"function"==typeof M}function fo(M){return M instanceof J}const O=Symbol("INITIAL_VALUE");function K(){return Zn(M=>cn(M.map(T=>T.pipe((0,Wi.q)(1),function Ui(...M){const T=(0,Fe.yG)(M);return(0,tn.e)((C,L)=>{(T?Je(M,C,T):Je(M,C)).subscribe(L)})}(O)))).pipe(vi((T,C)=>{let L=!1;return C.reduce((U,X,ge)=>U!==O?U:(X===O&&(L=!0),L||!1!==X&&ge!==C.length-1&&!fo(X)?U:X),T)},O),Fr(T=>T!==O),(0,Ct.U)(T=>fo(T)?T:!0===T),(0,Wi.q)(1)))}class B{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new te,this.attachRef=null}}class te{constructor(){this.contexts=new Map}onChildOutletCreated(T,C){const L=this.getOrCreateContext(T);L.outlet=C,this.contexts.set(T,L)}onChildOutletDestroyed(T){const C=this.getContext(T);C&&(C.outlet=null,C.attachRef=null)}onOutletDeactivated(){const T=this.contexts;return this.contexts=new Map,T}onOutletReAttached(T){this.contexts=T}getOrCreateContext(T){let C=this.getContext(T);return C||(C=new B,this.contexts.set(T,C)),C}getContext(T){return this.contexts.get(T)||null}}let De=(()=>{class M{constructor(C,L,U,X,ge){this.parentContexts=C,this.location=L,this.resolver=U,this.changeDetector=ge,this.activated=null,this._activatedRoute=null,this.activateEvents=new Y.vpe,this.deactivateEvents=new Y.vpe,this.attachEvents=new Y.vpe,this.detachEvents=new Y.vpe,this.name=X||dn,C.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const C=this.parentContexts.getContext(this.name);C&&C.route&&(C.attachRef?this.attach(C.attachRef,C.route):this.activateWith(C.route,C.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const C=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(C.instance),C}attach(C,L){this.activated=C,this._activatedRoute=L,this.location.insert(C.hostView),this.attachEvents.emit(C.instance)}deactivate(){if(this.activated){const C=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(C)}}activateWith(C,L){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=C;const ge=(L=L||this.resolver).resolveComponentFactory(C._futureSnapshot.routeConfig.component),be=this.parentContexts.getOrCreateContext(this.name).children,Ue=new et(C,be,this.location.injector);this.activated=this.location.createComponent(ge,this.location.length,Ue),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return M.\u0275fac=function(C){return new(C||M)(Y.Y36(te),Y.Y36(Y.s_b),Y.Y36(Y._Vd),Y.$8M("name"),Y.Y36(Y.sBO))},M.\u0275dir=Y.lG2({type:M,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),M})();class et{constructor(T,C,L){this.route=T,this.childContexts=C,this.parent=L}get(T,C){return T===Tn?this.route:T===te?this.childContexts:this.parent.get(T,C)}}let mt=(()=>{class M{}return M.\u0275fac=function(C){return new(C||M)},M.\u0275cmp=Y.Xpm({type:M,selectors:[["ng-component"]],decls:1,vars:0,template:function(C,L){1&C&&Y._UZ(0,"router-outlet")},directives:[De],encapsulation:2}),M})();function Kt(M,T=""){for(let C=0;C<M.length;C++){const L=M[C];xn(L,yr(T,L))}}function xn(M,T){M.children&&Kt(M.children,T)}function yr(M,T){return T?M||T.path?M&&!T.path?`${M}/`:!M&&T.path?T.path:`${M}/${T.path}`:"":M}function er(M){const T=M.children&&M.children.map(er),C=T?Object.assign(Object.assign({},M),{children:T}):Object.assign({},M);return!C.component&&(T||C.loadChildren)&&C.outlet&&C.outlet!==dn&&(C.component=mt),C}function Zt(M){return M.outlet||dn}function Jr(M,T){const C=M.filter(L=>Zt(L)===T);return C.push(...M.filter(L=>Zt(L)!==T)),C}const jn={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function Mr(M,T,C){var L;if(""===T.path)return"full"===T.pathMatch&&(M.hasChildren()||C.length>0)?Object.assign({},jn):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const X=(T.matcher||Vs)(C,M,T);if(!X)return Object.assign({},jn);const ge={};he(X.posParams,(Ue,Lt)=>{ge[Lt]=Ue.path});const be=X.consumed.length>0?Object.assign(Object.assign({},ge),X.consumed[X.consumed.length-1].parameters):ge;return{matched:!0,consumedSegments:X.consumed,lastChild:X.consumed.length,parameters:be,positionalParamSegments:null!==(L=X.posParams)&&void 0!==L?L:{}}}function kr(M,T,C,L,U="corrected"){if(C.length>0&&function Hi(M,T,C){return C.some(L=>To(M,T,L)&&Zt(L)!==dn)}(M,C,L)){const ge=new ne(T,function Zo(M,T,C,L){const U={};U[dn]=L,L._sourceSegment=M,L._segmentIndexShift=T.length;for(const X of C)if(""===X.path&&Zt(X)!==dn){const ge=new ne([],{});ge._sourceSegment=M,ge._segmentIndexShift=T.length,U[Zt(X)]=ge}return U}(M,T,L,new ne(C,M.children)));return ge._sourceSegment=M,ge._segmentIndexShift=T.length,{segmentGroup:ge,slicedSegments:[]}}if(0===C.length&&function oi(M,T,C){return C.some(L=>To(M,T,L))}(M,C,L)){const ge=new ne(M.segments,function po(M,T,C,L,U,X){const ge={};for(const be of L)if(To(M,C,be)&&!U[Zt(be)]){const Ue=new ne([],{});Ue._sourceSegment=M,Ue._segmentIndexShift="legacy"===X?M.segments.length:T.length,ge[Zt(be)]=Ue}return Object.assign(Object.assign({},U),ge)}(M,T,C,L,M.children,U));return ge._sourceSegment=M,ge._segmentIndexShift=T.length,{segmentGroup:ge,slicedSegments:C}}const X=new ne(M.segments,M.children);return X._sourceSegment=M,X._segmentIndexShift=T.length,{segmentGroup:X,slicedSegments:C}}function To(M,T,C){return(!(M.hasChildren()||T.length>0)||"full"!==C.pathMatch)&&""===C.path}function qo(M,T,C,L){return!!(Zt(M)===L||L!==dn&&To(T,C,M))&&("**"===M.path||Mr(T,M,C).matched)}function Va(M,T,C){return 0===T.length&&!M.children[C]}class Ji{constructor(T){this.segmentGroup=T||null}}class pl{constructor(T){this.urlTree=T}}function Bo(M){return new Ft.y(T=>T.error(new Ji(M)))}function bn(M){return new Ft.y(T=>T.error(new pl(M)))}function Hc(M){return new Ft.y(T=>T.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${M}'`)))}class Wc{constructor(T,C,L,U,X){this.configLoader=C,this.urlSerializer=L,this.urlTree=U,this.config=X,this.allowRedirects=!0,this.ngModule=T.get(Y.h0i)}apply(){const T=kr(this.urlTree.root,[],[],this.config).segmentGroup,C=new ne(T.segments,T.children);return this.expandSegmentGroup(this.ngModule,this.config,C,dn).pipe((0,Ct.U)(X=>this.createUrlTree(Ds(X),this.urlTree.queryParams,this.urlTree.fragment))).pipe(pn(X=>{if(X instanceof pl)return this.allowRedirects=!1,this.match(X.urlTree);throw X instanceof Ji?this.noMatchError(X):X}))}match(T){return this.expandSegmentGroup(this.ngModule,this.config,T.root,dn).pipe((0,Ct.U)(U=>this.createUrlTree(Ds(U),T.queryParams,T.fragment))).pipe(pn(U=>{throw U instanceof Ji?this.noMatchError(U):U}))}noMatchError(T){return new Error(`Cannot match any routes. URL Segment: '${T.segmentGroup}'`)}createUrlTree(T,C,L){const U=T.segments.length>0?new ne([],{[dn]:T}):T;return new J(U,C,L)}expandSegmentGroup(T,C,L,U){return 0===L.segments.length&&L.hasChildren()?this.expandChildren(T,C,L).pipe((0,Ct.U)(X=>new ne([],X))):this.expandSegment(T,L,C,L.segments,U,!0)}expandChildren(T,C,L){const U=[];for(const X of Object.keys(L.children))"primary"===X?U.unshift(X):U.push(X);return(0,Pt.D)(U).pipe(xr(X=>{const ge=L.children[X],be=Jr(C,X);return this.expandSegmentGroup(T,be,ge,X).pipe((0,Ct.U)(Ue=>({segment:Ue,outlet:X})))}),vi((X,ge)=>(X[ge.outlet]=ge.segment,X),{}),function Ir(M,T){const C=arguments.length>=2;return L=>L.pipe(M?Fr((U,X)=>M(U,X,L)):bt.y,$n(1),C?Fn(T):Mi(()=>new gt))}())}expandSegment(T,C,L,U,X,ge){return(0,Pt.D)(L).pipe(xr(be=>this.expandSegmentAgainstRoute(T,C,L,be,U,X,ge).pipe(pn(Lt=>{if(Lt instanceof Ji)return c(null);throw Lt}))),Vr(be=>!!be),pn((be,Ue)=>{if(be instanceof gt||"EmptyError"===be.name){if(Va(C,U,X))return c(new ne([],{}));throw new Ji(C)}throw be}))}expandSegmentAgainstRoute(T,C,L,U,X,ge,be){return qo(U,C,X,ge)?void 0===U.redirectTo?this.matchSegmentAgainstRoute(T,C,U,X,ge):be&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(T,C,L,U,X,ge):Bo(C):Bo(C)}expandSegmentAgainstRouteUsingRedirect(T,C,L,U,X,ge){return"**"===U.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(T,L,U,ge):this.expandRegularSegmentAgainstRouteUsingRedirect(T,C,L,U,X,ge)}expandWildCardWithParamsAgainstRouteUsingRedirect(T,C,L,U){const X=this.applyRedirectCommands([],L.redirectTo,{});return L.redirectTo.startsWith("/")?bn(X):this.lineralizeSegments(L,X).pipe((0,mr.z)(ge=>{const be=new ne(ge,{});return this.expandSegment(T,be,C,ge,U,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(T,C,L,U,X,ge){const{matched:be,consumedSegments:Ue,lastChild:Lt,positionalParamSegments:Mn}=Mr(C,U,X);if(!be)return Bo(C);const Qt=this.applyRedirectCommands(Ue,U.redirectTo,Mn);return U.redirectTo.startsWith("/")?bn(Qt):this.lineralizeSegments(U,Qt).pipe((0,mr.z)(Gn=>this.expandSegment(T,C,L,Gn.concat(X.slice(Lt)),ge,!1)))}matchSegmentAgainstRoute(T,C,L,U,X){if("**"===L.path)return L.loadChildren?(L._loadedConfig?c(L._loadedConfig):this.configLoader.load(T.injector,L)).pipe((0,Ct.U)(Gn=>(L._loadedConfig=Gn,new ne(U,{})))):c(new ne(U,{}));const{matched:ge,consumedSegments:be,lastChild:Ue}=Mr(C,L,U);if(!ge)return Bo(C);const Lt=U.slice(Ue);return this.getChildConfig(T,L,U).pipe((0,mr.z)(Qt=>{const Gn=Qt.module,ar=Qt.routes,{segmentGroup:fs,slicedSegments:ro}=kr(C,be,Lt,ar),pi=new ne(fs.segments,fs.children);if(0===ro.length&&pi.hasChildren())return this.expandChildren(Gn,ar,pi).pipe((0,Ct.U)(ps=>new ne(be,ps)));if(0===ar.length&&0===ro.length)return c(new ne(be,{}));const io=Zt(L)===X;return this.expandSegment(Gn,pi,ar,ro,io?dn:X,!0).pipe((0,Ct.U)(oo=>new ne(be.concat(oo.segments),oo.children)))}))}getChildConfig(T,C,L){return C.children?c(new Es(C.children,T)):C.loadChildren?void 0!==C._loadedConfig?c(C._loadedConfig):this.runCanLoadGuards(T.injector,C,L).pipe((0,mr.z)(U=>U?this.configLoader.load(T.injector,C).pipe((0,Ct.U)(X=>(C._loadedConfig=X,X))):function Zc(M){return new Ft.y(T=>T.error(Wn(`Cannot load children because the guard of the route "path: '${M.path}'" returned false`)))}(C))):c(new Es([],T))}runCanLoadGuards(T,C,L){const U=C.canLoad;return U&&0!==U.length?c(U.map(ge=>{const be=T.get(ge);let Ue;if(function is(M){return M&&Ki(M.canLoad)}(be))Ue=be.canLoad(C,L);else{if(!Ki(be))throw new Error("Invalid CanLoad guard");Ue=be(C,L)}return xe(Ue)})).pipe(K(),Or(ge=>{if(!fo(ge))return;const be=Wn(`Redirecting to "${this.urlSerializer.serialize(ge)}"`);throw be.url=ge,be}),(0,Ct.U)(ge=>!0===ge)):c(!0)}lineralizeSegments(T,C){let L=[],U=C.root;for(;;){if(L=L.concat(U.segments),0===U.numberOfChildren)return c(L);if(U.numberOfChildren>1||!U.children[dn])return Hc(T.redirectTo);U=U.children[dn]}}applyRedirectCommands(T,C,L){return this.applyRedirectCreatreUrlTree(C,this.urlSerializer.parse(C),T,L)}applyRedirectCreatreUrlTree(T,C,L,U){const X=this.createSegmentGroup(T,C.root,L,U);return new J(X,this.createQueryParams(C.queryParams,this.urlTree.queryParams),C.fragment)}createQueryParams(T,C){const L={};return he(T,(U,X)=>{if("string"==typeof U&&U.startsWith(":")){const be=U.substring(1);L[X]=C[be]}else L[X]=U}),L}createSegmentGroup(T,C,L,U){const X=this.createSegments(T,C.segments,L,U);let ge={};return he(C.children,(be,Ue)=>{ge[Ue]=this.createSegmentGroup(T,be,L,U)}),new ne(X,ge)}createSegments(T,C,L,U){return C.map(X=>X.path.startsWith(":")?this.findPosParam(T,X,U):this.findOrReturn(X,L))}findPosParam(T,C,L){const U=L[C.path.substring(1)];if(!U)throw new Error(`Cannot redirect to '${T}'. Cannot find '${C.path}'.`);return U}findOrReturn(T,C){let L=0;for(const U of C){if(U.path===T.path)return C.splice(L),U;L++}return T}}function Ds(M){const T={};for(const L of Object.keys(M.children)){const X=Ds(M.children[L]);(X.segments.length>0||X.hasChildren())&&(T[L]=X)}return function fc(M){if(1===M.numberOfChildren&&M.children[dn]){const T=M.children[dn];return new ne(M.segments.concat(T.segments),T.children)}return M}(new ne(M.segments,T))}class ut{constructor(T){this.path=T,this.route=this.path[this.path.length-1]}}class Nn{constructor(T,C){this.component=T,this.route=C}}function jl(M,T,C){const L=M._root;return ei(L,T?T._root:null,C,[L.value])}function So(M,T,C){const L=function Ws(M){if(!M)return null;for(let T=M.parent;T;T=T.parent){const C=T.routeConfig;if(C&&C._loadedConfig)return C._loadedConfig}return null}(T);return(L?L.module.injector:C).get(M)}function ei(M,T,C,L,U={canDeactivateChecks:[],canActivateChecks:[]}){const X=Hr(T);return M.children.forEach(ge=>{(function Wo(M,T,C,L,U={canDeactivateChecks:[],canActivateChecks:[]}){const X=M.value,ge=T?T.value:null,be=C?C.getContext(M.value.outlet):null;if(ge&&X.routeConfig===ge.routeConfig){const Ue=function gl(M,T,C){if("function"==typeof C)return C(M,T);switch(C){case"pathParamsChange":return!yt(M.url,T.url);case"pathParamsOrQueryParamsChange":return!yt(M.url,T.url)||!En(M.queryParams,T.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!js(M,T)||!En(M.queryParams,T.queryParams);default:return!js(M,T)}}(ge,X,X.routeConfig.runGuardsAndResolvers);Ue?U.canActivateChecks.push(new ut(L)):(X.data=ge.data,X._resolvedData=ge._resolvedData),ei(M,T,X.component?be?be.children:null:C,L,U),Ue&&be&&be.outlet&&be.outlet.isActivated&&U.canDeactivateChecks.push(new Nn(be.outlet.component,ge))}else ge&&pa(T,be,U),U.canActivateChecks.push(new ut(L)),ei(M,null,X.component?be?be.children:null:C,L,U)})(ge,X[ge.value.outlet],C,L.concat([ge.value]),U),delete X[ge.value.outlet]}),he(X,(ge,be)=>pa(ge,C.getContext(be),U)),U}function pa(M,T,C){const L=Hr(M),U=M.value;he(L,(X,ge)=>{pa(X,U.component?T?T.children.getContext(ge):null:T,C)}),C.canDeactivateChecks.push(new Nn(U.component&&T&&T.outlet&&T.outlet.isActivated?T.outlet.component:null,U))}class Xc{}function ja(M){return new Ft.y(T=>T.error(M))}class ma{constructor(T,C,L,U,X,ge){this.rootComponentType=T,this.config=C,this.urlTree=L,this.url=U,this.paramsInheritanceStrategy=X,this.relativeLinkResolution=ge}recognize(){const T=kr(this.urlTree.root,[],[],this.config.filter(ge=>void 0===ge.redirectTo),this.relativeLinkResolution).segmentGroup,C=this.processSegmentGroup(this.config,T,dn);if(null===C)return null;const L=new uo([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},dn,this.rootComponentType,null,this.urlTree.root,-1,{}),U=new hi(L,C),X=new Ho(this.url,U);return this.inheritParamsAndData(X._root),X}inheritParamsAndData(T){const C=T.value,L=Pi(C,this.paramsInheritanceStrategy);C.params=Object.freeze(L.params),C.data=Object.freeze(L.data),T.children.forEach(U=>this.inheritParamsAndData(U))}processSegmentGroup(T,C,L){return 0===C.segments.length&&C.hasChildren()?this.processChildren(T,C):this.processSegment(T,C,C.segments,L)}processChildren(T,C){const L=[];for(const X of Object.keys(C.children)){const ge=C.children[X],be=Jr(T,X),Ue=this.processSegmentGroup(be,ge,X);if(null===Ue)return null;L.push(...Ue)}const U=as(L);return function Yo(M){M.sort((T,C)=>T.value.outlet===dn?-1:C.value.outlet===dn?1:T.value.outlet.localeCompare(C.value.outlet))}(U),U}processSegment(T,C,L,U){for(const X of T){const ge=this.processSegmentAgainstRoute(X,C,L,U);if(null!==ge)return ge}return Va(C,L,U)?[]:null}processSegmentAgainstRoute(T,C,L,U){if(T.redirectTo||!qo(T,C,L,U))return null;let X,ge=[],be=[];if("**"===T.path){const ar=L.length>0?Z(L).parameters:{};X=new uo(L,ar,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,$a(T),Zt(T),T.component,T,to(C),Cs(C)+L.length,_a(T))}else{const ar=Mr(C,T,L);if(!ar.matched)return null;ge=ar.consumedSegments,be=L.slice(ar.lastChild),X=new uo(ge,ar.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,$a(T),Zt(T),T.component,T,to(C),Cs(C)+ge.length,_a(T))}const Ue=function ga(M){return M.children?M.children:M.loadChildren?M._loadedConfig.routes:[]}(T),{segmentGroup:Lt,slicedSegments:Mn}=kr(C,ge,be,Ue.filter(ar=>void 0===ar.redirectTo),this.relativeLinkResolution);if(0===Mn.length&&Lt.hasChildren()){const ar=this.processChildren(Ue,Lt);return null===ar?null:[new hi(X,ar)]}if(0===Ue.length&&0===Mn.length)return[new hi(X,[])];const Qt=Zt(T)===U,Gn=this.processSegment(Ue,Lt,Mn,Qt?dn:U);return null===Gn?null:[new hi(X,Gn)]}}function Gl(M){const T=M.value.routeConfig;return T&&""===T.path&&void 0===T.redirectTo}function as(M){const T=[],C=new Set;for(const L of M){if(!Gl(L)){T.push(L);continue}const U=T.find(X=>L.value.routeConfig===X.value.routeConfig);void 0!==U?(U.children.push(...L.children),C.add(U)):T.push(L)}for(const L of C){const U=as(L.children);T.push(new hi(L.value,U))}return T.filter(L=>!C.has(L))}function to(M){let T=M;for(;T._sourceSegment;)T=T._sourceSegment;return T}function Cs(M){let T=M,C=T._segmentIndexShift?T._segmentIndexShift:0;for(;T._sourceSegment;)T=T._sourceSegment,C+=T._segmentIndexShift?T._segmentIndexShift:0;return C-1}function $a(M){return M.data||{}}function _a(M){return M.resolve||{}}function ya(M){return[...Object.keys(M),...Object.getOwnPropertySymbols(M)]}function Ri(M){return Zn(T=>{const C=M(T);return C?(0,Pt.D)(C).pipe((0,Ct.U)(()=>T)):c(T)})}class Hl extends class pc{shouldDetach(T){return!1}store(T,C){}shouldAttach(T){return!1}retrieve(T){return null}shouldReuseRoute(T,C){return T.routeConfig===C.routeConfig}}{}const Ga=new Y.OlP("ROUTES");class Ha{constructor(T,C,L,U){this.injector=T,this.compiler=C,this.onLoadStartListener=L,this.onLoadEndListener=U}load(T,C){if(C._loader$)return C._loader$;this.onLoadStartListener&&this.onLoadStartListener(C);const U=this.loadModuleFactory(C.loadChildren).pipe((0,Ct.U)(X=>{this.onLoadEndListener&&this.onLoadEndListener(C);const ge=X.create(T);return new Es(V(ge.injector.get(Ga,void 0,Y.XFs.Self|Y.XFs.Optional)).map(er),ge)}),pn(X=>{throw C._loader$=void 0,X}));return C._loader$=new ri(U,()=>new Tt.x).pipe(wn()),C._loader$}loadModuleFactory(T){return xe(T()).pipe((0,mr.z)(C=>C instanceof Y.YKP?c(C):(0,Pt.D)(this.compiler.compileModuleAsync(C))))}}class mc{shouldProcessUrl(T){return!0}extract(T){return T}merge(T,C){return T}}function Za(M){throw M}function Ks(M,T,C){return T.parse("/")}function Qs(M,T){return c(null)}const xl={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},xa={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Ei=(()=>{class M{constructor(C,L,U,X,ge,be,Ue){this.rootComponentType=C,this.urlSerializer=L,this.rootContexts=U,this.location=X,this.config=Ue,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Tt.x,this.errorHandler=Za,this.malformedUriErrorHandler=Ks,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Qs,afterPreactivation:Qs},this.urlHandlingStrategy=new mc,this.routeReuseStrategy=new Hl,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=ge.get(Y.h0i),this.console=ge.get(Y.c2e);const Qt=ge.get(Y.R0b);this.isNgZoneEnabled=Qt instanceof Y.R0b&&Y.R0b.isInAngularZone(),this.resetConfig(Ue),this.currentUrlTree=function ke(){return new J(new ne([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Ha(ge,be,Gn=>this.triggerEvent(new wo(Gn)),Gn=>this.triggerEvent(new Eo(Gn))),this.routerState=Go(this.currentUrlTree,this.rootComponentType),this.transitions=new Jt({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var C;return null===(C=this.location.getState())||void 0===C?void 0:C.\u0275routerPageId}setupNavigations(C){const L=this.events;return C.pipe(Fr(U=>0!==U.id),(0,Ct.U)(U=>Object.assign(Object.assign({},U),{extractedUrl:this.urlHandlingStrategy.extract(U.rawUrl)})),Zn(U=>{let X=!1,ge=!1;return c(U).pipe(Or(be=>{this.currentNavigation={id:be.id,initialUrl:be.currentRawUrl,extractedUrl:be.extractedUrl,trigger:be.source,extras:be.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Zn(be=>{const Ue=this.browserUrlTree.toString(),Lt=!this.navigated||be.extractedUrl.toString()!==Ue||Ue!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||Lt)&&this.urlHandlingStrategy.shouldProcessUrl(be.rawUrl))return Io(be.source)&&(this.browserUrlTree=be.extractedUrl),c(be).pipe(Zn(Qt=>{const Gn=this.transitions.getValue();return L.next(new co(Qt.id,this.serializeUrl(Qt.extractedUrl),Qt.source,Qt.restoredState)),Gn!==this.transitions.getValue()?zt.E:Promise.resolve(Qt)}),function ml(M,T,C,L){return Zn(U=>function qc(M,T,C,L,U){return new Wc(M,T,C,L,U).apply()}(M,T,C,U.extractedUrl,L).pipe((0,Ct.U)(X=>Object.assign(Object.assign({},U),{urlAfterRedirects:X}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Or(Qt=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:Qt.urlAfterRedirects})}),function ls(M,T,C,L,U){return(0,mr.z)(X=>function No(M,T,C,L,U="emptyOnly",X="legacy"){try{const ge=new ma(M,T,C,L,U,X).recognize();return null===ge?ja(new Xc):c(ge)}catch(ge){return ja(ge)}}(M,T,X.urlAfterRedirects,C(X.urlAfterRedirects),L,U).pipe((0,Ct.U)(ge=>Object.assign(Object.assign({},X),{targetSnapshot:ge}))))}(this.rootComponentType,this.config,Qt=>this.serializeUrl(Qt),this.paramsInheritanceStrategy,this.relativeLinkResolution),Or(Qt=>{if("eager"===this.urlUpdateStrategy){if(!Qt.extras.skipLocationChange){const ar=this.urlHandlingStrategy.merge(Qt.urlAfterRedirects,Qt.rawUrl);this.setBrowserUrl(ar,Qt)}this.browserUrlTree=Qt.urlAfterRedirects}const Gn=new jr(Qt.id,this.serializeUrl(Qt.extractedUrl),this.serializeUrl(Qt.urlAfterRedirects),Qt.targetSnapshot);L.next(Gn)}));if(Lt&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:Gn,extractedUrl:ar,source:fs,restoredState:ro,extras:pi}=be,io=new co(Gn,this.serializeUrl(ar),fs,ro);L.next(io);const Qo=Go(ar,this.rootComponentType).snapshot;return c(Object.assign(Object.assign({},be),{targetSnapshot:Qo,urlAfterRedirects:ar,extras:Object.assign(Object.assign({},pi),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=be.rawUrl,be.resolve(null),zt.E}),Ri(be=>{const{targetSnapshot:Ue,id:Lt,extractedUrl:Mn,rawUrl:Qt,extras:{skipLocationChange:Gn,replaceUrl:ar}}=be;return this.hooks.beforePreactivation(Ue,{navigationId:Lt,appliedUrlTree:Mn,rawUrlTree:Qt,skipLocationChange:!!Gn,replaceUrl:!!ar})}),Or(be=>{const Ue=new qt(be.id,this.serializeUrl(be.extractedUrl),this.serializeUrl(be.urlAfterRedirects),be.targetSnapshot);this.triggerEvent(Ue)}),(0,Ct.U)(be=>Object.assign(Object.assign({},be),{guards:jl(be.targetSnapshot,be.currentSnapshot,this.rootContexts)})),function Qn(M,T){return(0,mr.z)(C=>{const{targetSnapshot:L,currentSnapshot:U,guards:{canActivateChecks:X,canDeactivateChecks:ge}}=C;return 0===ge.length&&0===X.length?c(Object.assign(Object.assign({},C),{guardsResult:!0})):function Xs(M,T,C,L){return(0,Pt.D)(M).pipe((0,mr.z)(U=>function Xo(M,T,C,L,U){const X=T&&T.routeConfig?T.routeConfig.canDeactivate:null;return X&&0!==X.length?c(X.map(be=>{const Ue=So(be,T,U);let Lt;if(function os(M){return M&&Ki(M.canDeactivate)}(Ue))Lt=xe(Ue.canDeactivate(M,T,C,L));else{if(!Ki(Ue))throw new Error("Invalid CanDeactivate guard");Lt=xe(Ue(M,T,C,L))}return Lt.pipe(Vr())})).pipe(K()):c(!0)}(U.component,U.route,C,T,L)),Vr(U=>!0!==U,!0))}(ge,L,U,M).pipe((0,mr.z)(be=>be&&function Vn(M){return"boolean"==typeof M}(be)?function _l(M,T,C,L){return(0,Pt.D)(T).pipe(xr(U=>Je(function eo(M,T){return null!==M&&T&&T(new $r(M)),c(!0)}(U.route.parent,L),function ki(M,T){return null!==M&&T&&T(new xi(M)),c(!0)}(U.route,L),function ss(M,T,C){const L=T[T.length-1],X=T.slice(0,T.length-1).reverse().map(ge=>function Zr(M){const T=M.routeConfig?M.routeConfig.canActivateChild:null;return T&&0!==T.length?{node:M,guards:T}:null}(ge)).filter(ge=>null!==ge).map(ge=>_t(()=>c(ge.guards.map(Ue=>{const Lt=So(Ue,ge.node,C);let Mn;if(function Qi(M){return M&&Ki(M.canActivateChild)}(Lt))Mn=xe(Lt.canActivateChild(L,M));else{if(!Ki(Lt))throw new Error("Invalid CanActivateChild guard");Mn=xe(Lt(L,M))}return Mn.pipe(Vr())})).pipe(K())));return c(X).pipe(K())}(M,U.path,C),function $l(M,T,C){const L=T.routeConfig?T.routeConfig.canActivate:null;if(!L||0===L.length)return c(!0);const U=L.map(X=>_t(()=>{const ge=So(X,T,C);let be;if(function Ua(M){return M&&Ki(M.canActivate)}(ge))be=xe(ge.canActivate(T,M));else{if(!Ki(ge))throw new Error("Invalid CanActivate guard");be=xe(ge(T,M))}return be.pipe(Vr())}));return c(U).pipe(K())}(M,U.route,C))),Vr(U=>!0!==U,!0))}(L,X,M,T):c(be)),(0,Ct.U)(be=>Object.assign(Object.assign({},C),{guardsResult:be})))})}(this.ngModule.injector,be=>this.triggerEvent(be)),Or(be=>{if(fo(be.guardsResult)){const Lt=Wn(`Redirecting to "${this.serializeUrl(be.guardsResult)}"`);throw Lt.url=be.guardsResult,Lt}const Ue=new gr(be.id,this.serializeUrl(be.extractedUrl),this.serializeUrl(be.urlAfterRedirects),be.targetSnapshot,!!be.guardsResult);this.triggerEvent(Ue)}),Fr(be=>!!be.guardsResult||(this.restoreHistory(be),this.cancelNavigationTransition(be,""),!1)),Ri(be=>{if(be.guards.canActivateChecks.length)return c(be).pipe(Or(Ue=>{const Lt=new rn(Ue.id,this.serializeUrl(Ue.extractedUrl),this.serializeUrl(Ue.urlAfterRedirects),Ue.targetSnapshot);this.triggerEvent(Lt)}),Zn(Ue=>{let Lt=!1;return c(Ue).pipe(function yl(M,T){return(0,mr.z)(C=>{const{targetSnapshot:L,guards:{canActivateChecks:U}}=C;if(!U.length)return c(C);let X=0;return(0,Pt.D)(U).pipe(xr(ge=>function cs(M,T,C,L){return function vl(M,T,C,L){const U=ya(M);if(0===U.length)return c({});const X={};return(0,Pt.D)(U).pipe((0,mr.z)(ge=>function wi(M,T,C,L){const U=So(M,T,L);return xe(U.resolve?U.resolve(T,C):U(T,C))}(M[ge],T,C,L).pipe(Or(be=>{X[ge]=be}))),$n(1),(0,mr.z)(()=>ya(X).length===U.length?c(X):zt.E))}(M._resolve,M,T,L).pipe((0,Ct.U)(X=>(M._resolvedData=X,M.data=Object.assign(Object.assign({},M.data),Pi(M,C).resolve),null)))}(ge.route,L,M,T)),Or(()=>X++),$n(1),(0,mr.z)(ge=>X===U.length?c(C):zt.E))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Or({next:()=>Lt=!0,complete:()=>{Lt||(this.restoreHistory(Ue),this.cancelNavigationTransition(Ue,"At least one route resolver didn't emit any value."))}}))}),Or(Ue=>{const Lt=new on(Ue.id,this.serializeUrl(Ue.extractedUrl),this.serializeUrl(Ue.urlAfterRedirects),Ue.targetSnapshot);this.triggerEvent(Lt)}))}),Ri(be=>{const{targetSnapshot:Ue,id:Lt,extractedUrl:Mn,rawUrl:Qt,extras:{skipLocationChange:Gn,replaceUrl:ar}}=be;return this.hooks.afterPreactivation(Ue,{navigationId:Lt,appliedUrlTree:Mn,rawUrlTree:Qt,skipLocationChange:!!Gn,replaceUrl:!!ar})}),(0,Ct.U)(be=>{const Ue=function di(M,T,C){const L=ns(M,T._root,C?C._root:void 0);return new _n(L,T)}(this.routeReuseStrategy,be.targetSnapshot,be.currentRouterState);return Object.assign(Object.assign({},be),{targetRouterState:Ue})}),Or(be=>{this.currentUrlTree=be.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(be.urlAfterRedirects,be.rawUrl),this.routerState=be.targetRouterState,"deferred"===this.urlUpdateStrategy&&(be.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,be),this.browserUrlTree=be.urlAfterRedirects)}),((M,T,C)=>(0,Ct.U)(L=>(new fa(T,L.targetRouterState,L.currentRouterState,C).activate(M),L)))(this.rootContexts,this.routeReuseStrategy,be=>this.triggerEvent(be)),Or({next(){X=!0},complete(){X=!0}}),function ko(M){return(0,tn.e)((T,C)=>{try{T.subscribe(C)}finally{C.add(M)}})}(()=>{var be;X||ge||this.cancelNavigationTransition(U,`Navigation ID ${U.id} is not equal to the current navigation id ${this.navigationId}`),(null===(be=this.currentNavigation)||void 0===be?void 0:be.id)===U.id&&(this.currentNavigation=null)}),pn(be=>{if(ge=!0,function Ro(M){return M&&M[Yi]}(be)){const Ue=fo(be.url);Ue||(this.navigated=!0,this.restoreHistory(U,!0));const Lt=new Xi(U.id,this.serializeUrl(U.extractedUrl),be.message);L.next(Lt),Ue?setTimeout(()=>{const Mn=this.urlHandlingStrategy.merge(be.url,this.rawUrlTree),Qt={skipLocationChange:U.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Io(U.source)};this.scheduleNavigation(Mn,"imperative",null,Qt,{resolve:U.resolve,reject:U.reject,promise:U.promise})},0):U.resolve(!1)}else{this.restoreHistory(U,!0);const Ue=new bs(U.id,this.serializeUrl(U.extractedUrl),be);L.next(Ue);try{U.resolve(this.errorHandler(be))}catch(Lt){U.reject(Lt)}}return zt.E}))}))}resetRootComponentType(C){this.rootComponentType=C,this.routerState.root.component=this.rootComponentType}setTransition(C){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),C))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(C=>{const L="popstate"===C.type?"popstate":"hashchange";"popstate"===L&&setTimeout(()=>{var U;const X={replaceUrl:!0},ge=(null===(U=C.state)||void 0===U?void 0:U.navigationId)?C.state:null;if(ge){const Ue=Object.assign({},ge);delete Ue.navigationId,delete Ue.\u0275routerPageId,0!==Object.keys(Ue).length&&(X.state=Ue)}const be=this.parseUrl(C.url);this.scheduleNavigation(be,L,ge,X)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(C){this.events.next(C)}resetConfig(C){Kt(C),this.config=C.map(er),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(C,L={}){const{relativeTo:U,queryParams:X,fragment:ge,queryParamsHandling:be,preserveFragment:Ue}=L,Lt=U||this.routerState.root,Mn=Ue?this.currentUrlTree.fragment:ge;let Qt=null;switch(be){case"merge":Qt=Object.assign(Object.assign({},this.currentUrlTree.queryParams),X);break;case"preserve":Qt=this.currentUrlTree.queryParams;break;default:Qt=X||null}return null!==Qt&&(Qt=this.removeEmptyProps(Qt)),function Oa(M,T,C,L,U){if(0===C.length)return $s(T.root,T.root,T,L,U);const X=function Vl(M){if("string"==typeof M[0]&&1===M.length&&"/"===M[0])return new Ba(!0,0,M);let T=0,C=!1;const L=M.reduce((U,X,ge)=>{if("object"==typeof X&&null!=X){if(X.outlets){const be={};return he(X.outlets,(Ue,Lt)=>{be[Lt]="string"==typeof Ue?Ue.split("/"):Ue}),[...U,{outlets:be}]}if(X.segmentPath)return[...U,X.segmentPath]}return"string"!=typeof X?[...U,X]:0===ge?(X.split("/").forEach((be,Ue)=>{0==Ue&&"."===be||(0==Ue&&""===be?C=!0:".."===be?T++:""!=be&&U.push(be))}),U):[...U,X]},[]);return new Ba(C,T,L)}(C);if(X.toRoot())return $s(T.root,new ne([],{}),T,L,U);const ge=function dc(M,T,C){if(M.isAbsolute)return new Na(T.root,!0,0);if(-1===C.snapshot._lastPathIndex){const X=C.snapshot._urlSegment;return new Na(X,X===T.root,0)}const L=za(M.commands[0])?0:1;return function Gi(M,T,C){let L=M,U=T,X=C;for(;X>U;){if(X-=U,L=L.parent,!L)throw new Error("Invalid number of '../'");U=L.segments.length}return new Na(L,!1,U-X)}(C.snapshot._urlSegment,C.snapshot._lastPathIndex+L,M.numberOfDoubleDots)}(X,T,M),be=ge.processChildren?zo(ge.segmentGroup,ge.index,X.commands):Gs(ge.segmentGroup,ge.index,X.commands);return $s(ge.segmentGroup,be,T,L,U)}(Lt,this.currentUrlTree,C,Qt,null!=Mn?Mn:null)}navigateByUrl(C,L={skipLocationChange:!1}){const U=fo(C)?C:this.parseUrl(C),X=this.urlHandlingStrategy.merge(U,this.rawUrlTree);return this.scheduleNavigation(X,"imperative",null,L)}navigate(C,L={skipLocationChange:!1}){return function qr(M){for(let T=0;T<M.length;T++){const C=M[T];if(null==C)throw new Error(`The requested path contains ${C} segment at index ${T}`)}}(C),this.navigateByUrl(this.createUrlTree(C,L),L)}serializeUrl(C){return this.urlSerializer.serialize(C)}parseUrl(C){let L;try{L=this.urlSerializer.parse(C)}catch(U){L=this.malformedUriErrorHandler(U,this.urlSerializer,C)}return L}isActive(C,L){let U;if(U=!0===L?Object.assign({},xl):!1===L?Object.assign({},xa):L,fo(C))return Le(this.currentUrlTree,C,U);const X=this.parseUrl(C);return Le(this.currentUrlTree,X,U)}removeEmptyProps(C){return Object.keys(C).reduce((L,U)=>{const X=C[U];return null!=X&&(L[U]=X),L},{})}processNavigations(){this.navigations.subscribe(C=>{this.navigated=!0,this.lastSuccessfulId=C.id,this.currentPageId=C.targetPageId,this.events.next(new zr(C.id,this.serializeUrl(C.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,C.resolve(!0)},C=>{this.console.warn(`Unhandled Navigation Error: ${C}`)})}scheduleNavigation(C,L,U,X,ge){var be,Ue,Lt;if(this.disposed)return Promise.resolve(!1);const Mn=this.transitions.value,Qt=Io(L)&&Mn&&!Io(Mn.source),Gn=Mn.rawUrl.toString()===C.toString(),ar=Mn.id===(null===(be=this.currentNavigation)||void 0===be?void 0:be.id);if(Qt&&Gn&&ar)return Promise.resolve(!0);let ro,pi,io;ge?(ro=ge.resolve,pi=ge.reject,io=ge.promise):io=new Promise((ps,mo)=>{ro=ps,pi=mo});const Qo=++this.navigationId;let oo;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(U=this.location.getState()),oo=U&&U.\u0275routerPageId?U.\u0275routerPageId:X.replaceUrl||X.skipLocationChange?null!==(Ue=this.browserPageId)&&void 0!==Ue?Ue:0:(null!==(Lt=this.browserPageId)&&void 0!==Lt?Lt:0)+1):oo=0,this.setTransition({id:Qo,targetPageId:oo,source:L,restoredState:U,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:C,extras:X,resolve:ro,reject:pi,promise:io,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),io.catch(ps=>Promise.reject(ps))}setBrowserUrl(C,L){const U=this.urlSerializer.serialize(C),X=Object.assign(Object.assign({},L.extras.state),this.generateNgRouterState(L.id,L.targetPageId));this.location.isCurrentPathEqualTo(U)||L.extras.replaceUrl?this.location.replaceState(U,"",X):this.location.go(U,"",X)}restoreHistory(C,L=!1){var U,X;if("computed"===this.canceledNavigationResolution){const ge=this.currentPageId-C.targetPageId;"popstate"!==C.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(U=this.currentNavigation)||void 0===U?void 0:U.finalUrl)||0===ge?this.currentUrlTree===(null===(X=this.currentNavigation)||void 0===X?void 0:X.finalUrl)&&0===ge&&(this.resetState(C),this.browserUrlTree=C.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(ge)}else"replace"===this.canceledNavigationResolution&&(L&&this.resetState(C),this.resetUrlToCurrentUrlTree())}resetState(C){this.routerState=C.currentRouterState,this.currentUrlTree=C.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,C.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(C,L){const U=new Xi(C.id,this.serializeUrl(C.extractedUrl),L);this.triggerEvent(U),C.resolve(!1)}generateNgRouterState(C,L){return"computed"===this.canceledNavigationResolution?{navigationId:C,\u0275routerPageId:L}:{navigationId:C}}}return M.\u0275fac=function(C){Y.$Z()},M.\u0275prov=Y.Yz7({token:M,factory:M.\u0275fac}),M})();function Io(M){return"imperative"!==M}let us=(()=>{class M{constructor(C,L,U,X,ge){this.router=C,this.route=L,this.tabIndexAttribute=U,this.renderer=X,this.el=ge,this.commands=null,this.onChanges=new Tt.x,this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(C){if(null!=this.tabIndexAttribute)return;const L=this.renderer,U=this.el.nativeElement;null!==C?L.setAttribute(U,"tabindex",C):L.removeAttribute(U,"tabindex")}ngOnChanges(C){this.onChanges.next(this)}set routerLink(C){null!=C?(this.commands=Array.isArray(C)?C:[C],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){if(null===this.urlTree)return!0;const C={skipLocationChange:Uo(this.skipLocationChange),replaceUrl:Uo(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,C),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Uo(this.preserveFragment)})}}return M.\u0275fac=function(C){return new(C||M)(Y.Y36(Ei),Y.Y36(Tn),Y.$8M("tabindex"),Y.Y36(Y.Qsj),Y.Y36(Y.SBq))},M.\u0275dir=Y.lG2({type:M,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(C,L){1&C&&Y.NdJ("click",function(){return L.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[Y.TTD]}),M})(),bl=(()=>{class M{constructor(C,L,U){this.router=C,this.route=L,this.locationStrategy=U,this.commands=null,this.href=null,this.onChanges=new Tt.x,this.subscription=C.events.subscribe(X=>{X instanceof zr&&this.updateTargetUrlAndHref()})}set routerLink(C){this.commands=null!=C?Array.isArray(C)?C:[C]:null}ngOnChanges(C){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(C,L,U,X,ge){if(0!==C||L||U||X||ge||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const be={skipLocationChange:Uo(this.skipLocationChange),replaceUrl:Uo(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,be),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Uo(this.preserveFragment)})}}return M.\u0275fac=function(C){return new(C||M)(Y.Y36(Ei),Y.Y36(Tn),Y.Y36(lr.S$))},M.\u0275dir=Y.lG2({type:M,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(C,L){1&C&&Y.NdJ("click",function(X){return L.onClick(X.button,X.ctrlKey,X.shiftKey,X.altKey,X.metaKey)}),2&C&&Y.uIk("target",L.target)("href",L.href,Y.LSH)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[Y.TTD]}),M})();function Uo(M){return""===M||!!M}let qa=(()=>{class M{constructor(C,L,U,X,ge,be){this.router=C,this.element=L,this.renderer=U,this.cdr=X,this.link=ge,this.linkWithHref=be,this.classes=[],this.isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new Y.vpe,this.routerEventsSubscription=C.events.subscribe(Ue=>{Ue instanceof zr&&this.update()})}ngAfterContentInit(){c(this.links.changes,this.linksWithHrefs.changes,c(null)).pipe((0,Be.J)()).subscribe(C=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){var C;null===(C=this.linkInputChangesSubscription)||void 0===C||C.unsubscribe();const L=[...this.links.toArray(),...this.linksWithHrefs.toArray(),this.link,this.linkWithHref].filter(U=>!!U).map(U=>U.onChanges);this.linkInputChangesSubscription=(0,Pt.D)(L).pipe((0,Be.J)()).subscribe(U=>{this.isActive!==this.isLinkActive(this.router)(U)&&this.update()})}set routerLinkActive(C){const L=Array.isArray(C)?C:C.split(" ");this.classes=L.filter(U=>!!U)}ngOnChanges(C){this.update()}ngOnDestroy(){var C;this.routerEventsSubscription.unsubscribe(),null===(C=this.linkInputChangesSubscription)||void 0===C||C.unsubscribe()}update(){!this.links||!this.linksWithHrefs||!this.router.navigated||Promise.resolve().then(()=>{const C=this.hasActiveLinks();this.isActive!==C&&(this.isActive=C,this.cdr.markForCheck(),this.classes.forEach(L=>{C?this.renderer.addClass(this.element.nativeElement,L):this.renderer.removeClass(this.element.nativeElement,L)}),this.isActiveChange.emit(C))})}isLinkActive(C){const L=function wl(M){return!!M.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return U=>!!U.urlTree&&C.isActive(U.urlTree,L)}hasActiveLinks(){const C=this.isLinkActive(this.router);return this.link&&C(this.link)||this.linkWithHref&&C(this.linkWithHref)||this.links.some(C)||this.linksWithHrefs.some(C)}}return M.\u0275fac=function(C){return new(C||M)(Y.Y36(Ei),Y.Y36(Y.SBq),Y.Y36(Y.Qsj),Y.Y36(Y.sBO),Y.Y36(us,8),Y.Y36(bl,8))},M.\u0275dir=Y.lG2({type:M,selectors:[["","routerLinkActive",""]],contentQueries:function(C,L,U){if(1&C&&(Y.Suo(U,us,5),Y.Suo(U,bl,5)),2&C){let X;Y.iGM(X=Y.CRH())&&(L.links=X),Y.iGM(X=Y.CRH())&&(L.linksWithHrefs=X)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[Y.TTD]}),M})();class Zl{}class Li{preload(T,C){return c(null)}}let Wa=(()=>{class M{constructor(C,L,U,X){this.router=C,this.injector=U,this.preloadingStrategy=X,this.loader=new Ha(U,L,Ue=>C.triggerEvent(new wo(Ue)),Ue=>C.triggerEvent(new Eo(Ue)))}setUpPreloading(){this.subscription=this.router.events.pipe(Fr(C=>C instanceof zr),xr(()=>this.preload())).subscribe(()=>{})}preload(){const C=this.injector.get(Y.h0i);return this.processRoutes(C,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(C,L){const U=[];for(const X of L)if(X.loadChildren&&!X.canLoad&&X._loadedConfig){const ge=X._loadedConfig;U.push(this.processRoutes(ge.module,ge.routes))}else X.loadChildren&&!X.canLoad?U.push(this.preloadConfig(C,X)):X.children&&U.push(this.processRoutes(C,X.children));return(0,Pt.D)(U).pipe((0,Be.J)(),(0,Ct.U)(X=>{}))}preloadConfig(C,L){return this.preloadingStrategy.preload(L,()=>(L._loadedConfig?c(L._loadedConfig):this.loader.load(C.injector,L)).pipe((0,mr.z)(X=>(L._loadedConfig=X,this.processRoutes(X.module,X.routes)))))}}return M.\u0275fac=function(C){return new(C||M)(Y.LFG(Ei),Y.LFG(Y.Sil),Y.LFG(Y.zs3),Y.LFG(Zl))},M.\u0275prov=Y.Yz7({token:M,factory:M.\u0275fac}),M})(),no=(()=>{class M{constructor(C,L,U={}){this.router=C,this.viewportScroller=L,this.options=U,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},U.scrollPositionRestoration=U.scrollPositionRestoration||"disabled",U.anchorScrolling=U.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(C=>{C instanceof co?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=C.navigationTrigger,this.restoredId=C.restoredState?C.restoredState.navigationId:0):C instanceof zr&&(this.lastId=C.id,this.scheduleScrollEvent(C,this.router.parseUrl(C.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(C=>{C instanceof Un&&(C.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(C.position):C.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(C.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(C,L){this.router.triggerEvent(new Un(C,"popstate"===this.lastSource?this.store[this.restoredId]:null,L))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return M.\u0275fac=function(C){Y.$Z()},M.\u0275prov=Y.Yz7({token:M,factory:M.\u0275fac}),M})();const fi=new Y.OlP("ROUTER_CONFIGURATION"),hs=new Y.OlP("ROUTER_FORROOT_GUARD"),gc=[lr.Ye,{provide:_r,useClass:cr},{provide:Ei,useFactory:function Xa(M,T,C,L,U,X,ge={},be,Ue){const Lt=new Ei(null,M,T,C,L,U,V(X));return be&&(Lt.urlHandlingStrategy=be),Ue&&(Lt.routeReuseStrategy=Ue),function Xl(M,T){M.errorHandler&&(T.errorHandler=M.errorHandler),M.malformedUriErrorHandler&&(T.malformedUriErrorHandler=M.malformedUriErrorHandler),M.onSameUrlNavigation&&(T.onSameUrlNavigation=M.onSameUrlNavigation),M.paramsInheritanceStrategy&&(T.paramsInheritanceStrategy=M.paramsInheritanceStrategy),M.relativeLinkResolution&&(T.relativeLinkResolution=M.relativeLinkResolution),M.urlUpdateStrategy&&(T.urlUpdateStrategy=M.urlUpdateStrategy),M.canceledNavigationResolution&&(T.canceledNavigationResolution=M.canceledNavigationResolution)}(ge,Lt),ge.enableTracing&&Lt.events.subscribe(Mn=>{var Qt,Gn;null===(Qt=console.group)||void 0===Qt||Qt.call(console,`Router Event: ${Mn.constructor.name}`),console.log(Mn.toString()),console.log(Mn),null===(Gn=console.groupEnd)||void 0===Gn||Gn.call(console)}),Lt},deps:[_r,te,lr.Ye,Y.zs3,Y.Sil,Ga,fi,[class va{},new Y.FiY],[class vr{},new Y.FiY]]},te,{provide:Tn,useFactory:function Ya(M){return M.routerState.root},deps:[Ei]},Wa,Li,class ql{preload(T,C){return C().pipe(pn(()=>c(null)))}},{provide:fi,useValue:{enableTracing:!1}}];function Ts(){return new Y.PXZ("Router",Ei)}let El=(()=>{class M{constructor(C,L){}static forRoot(C,L){return{ngModule:M,providers:[gc,Ko(C),{provide:hs,useFactory:ds,deps:[[Ei,new Y.FiY,new Y.tp0]]},{provide:fi,useValue:L||{}},{provide:lr.S$,useFactory:Dl,deps:[lr.lw,[new Y.tBr(lr.mr),new Y.FiY],fi]},{provide:no,useFactory:Js,deps:[Ei,lr.EM,fi]},{provide:Zl,useExisting:L&&L.preloadingStrategy?L.preloadingStrategy:Li},{provide:Y.PXZ,multi:!0,useFactory:Ts},[Bt,{provide:Y.ip1,multi:!0,useFactory:ba,deps:[Bt]},{provide:Ss,useFactory:Ka,deps:[Bt]},{provide:Y.tb,multi:!0,useExisting:Ss}]]}}static forChild(C){return{ngModule:M,providers:[Ko(C)]}}}return M.\u0275fac=function(C){return new(C||M)(Y.LFG(hs,8),Y.LFG(Ei,8))},M.\u0275mod=Y.oAB({type:M}),M.\u0275inj=Y.cJS({}),M})();function Js(M,T,C){return C.scrollOffset&&T.setOffset(C.scrollOffset),new no(M,T,C)}function Dl(M,T,C={}){return C.useHash?new lr.Do(M,T):new lr.b0(M,T)}function ds(M){return"guarded"}function Ko(M){return[{provide:Y.deG,multi:!0,useValue:M},{provide:Ga,multi:!0,useValue:M}]}let Bt=(()=>{class M{constructor(C){this.injector=C,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Tt.x}appInitializer(){return this.injector.get(lr.V_,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let L=null;const U=new Promise(be=>L=be),X=this.injector.get(Ei),ge=this.injector.get(fi);return"disabled"===ge.initialNavigation?(X.setUpLocationChangeListener(),L(!0)):"enabled"===ge.initialNavigation||"enabledBlocking"===ge.initialNavigation?(X.hooks.afterPreactivation=()=>this.initNavigation?c(null):(this.initNavigation=!0,L(!0),this.resultOfPreactivationDone),X.initialNavigation()):L(!0),U})}bootstrapListener(C){const L=this.injector.get(fi),U=this.injector.get(Wa),X=this.injector.get(no),ge=this.injector.get(Ei),be=this.injector.get(Y.z2F);C===be.components[0]&&(("enabledNonBlocking"===L.initialNavigation||void 0===L.initialNavigation)&&ge.initialNavigation(),U.setUpPreloading(),X.init(),ge.resetRootComponentType(be.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return M.\u0275fac=function(C){return new(C||M)(Y.LFG(Y.zs3))},M.\u0275prov=Y.Yz7({token:M,factory:M.\u0275fac}),M})();function ba(M){return M.appInitializer.bind(M)}function Ka(M){return M.bootstrapListener.bind(M)}const Ss=new Y.OlP("Router Initializer")}},Hn=>{Hn(Hn.s=574)}]);